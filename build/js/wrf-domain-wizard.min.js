!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).WRF=t.WRF||{})}(this,function(N){"use strict";function B(){B=function(){return r};var h,r={},t=Object.prototype,l=t.hasOwnProperty,d=Object.defineProperty||function(t,e,i){t[e]=i.value},e="function"==typeof Symbol?Symbol:{},s=e.iterator||"@@iterator",i=e.asyncIterator||"@@asyncIterator",a=e.toStringTag||"@@toStringTag";function n(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{n({},"")}catch(h){n=function(t,e,i){return t[e]=i}}function o(t,e,i,s){var a,n,r,o,e=e&&e.prototype instanceof m?e:m,e=Object.create(e.prototype),s=new S(s||[]);return d(e,"_invoke",{value:(a=t,n=i,r=s,o=c,function(t,e){if(o===p)throw Error("Generator is already running");if(o===g){if("throw"===t)throw e;return{value:h,done:!0}}for(r.method=t,r.arg=e;;){var i=r.delegate;if(i){i=function t(e,i){var s=i.method,a=e.iterator[s];if(a===h)return i.delegate=null,"throw"===s&&e.iterator.return&&(i.method="return",i.arg=h,t(e,i),"throw"===i.method)||"return"!==s&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+s+"' method")),f;s=u(a,e.iterator,i.arg);if("throw"===s.type)return i.method="throw",i.arg=s.arg,i.delegate=null,f;a=s.arg;return a?a.done?(i[e.resultName]=a.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=h),i.delegate=null,f):a:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,f)}(i,r);if(i){if(i===f)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===c)throw o=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=p;i=u(a,n,r);if("normal"===i.type){if(o=r.done?g:_,i.arg===f)continue;return{value:i.arg,done:r.done}}"throw"===i.type&&(o=g,r.method="throw",r.arg=i.arg)}})}),e}function u(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}r.wrap=o;var c="suspendedStart",_="suspendedYield",p="executing",g="completed",f={};function m(){}function y(){}function v(){}var e={},b=(n(e,s,function(){return this}),Object.getPrototypeOf),b=b&&b(b(j([]))),M=(b&&b!==t&&l.call(b,s)&&(e=b),v.prototype=m.prototype=Object.create(e));function x(t){["next","throw","return"].forEach(function(e){n(t,e,function(t){return this._invoke(e,t)})})}function w(r,o){var e;d(this,"_invoke",{value:function(i,s){function t(){return new o(function(t,e){!function e(t,i,s,a){var n,t=u(r[t],r,i);if("throw"!==t.type)return(i=(n=t.arg).value)&&"object"==typeof i&&l.call(i,"__await")?o.resolve(i.__await).then(function(t){e("next",t,s,a)},function(t){e("throw",t,s,a)}):o.resolve(i).then(function(t){n.value=t,s(n)},function(t){return e("throw",t,s,a)});a(t.arg)}(i,s,t,e)})}return e=e?e.then(t,t):t()}})}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function j(e){if(e||""===e){var i,t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return i=-1,(t=function t(){for(;++i<e.length;)if(l.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=h,t.done=!0,t}).next=t}throw new TypeError(typeof e+" is not iterable")}return d(M,"constructor",{value:y.prototype=v,configurable:!0}),d(v,"constructor",{value:y,configurable:!0}),y.displayName=n(v,a,"GeneratorFunction"),r.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,n(t,a,"GeneratorFunction")),t.prototype=Object.create(M),t},r.awrap=function(t){return{__await:t}},x(w.prototype),n(w.prototype,i,function(){return this}),r.AsyncIterator=w,r.async=function(t,e,i,s,a){void 0===a&&(a=Promise);var n=new w(o(t,e,i,s),a);return r.isGeneratorFunction(e)?n:n.next().then(function(t){return t.done?t.value:n.next()})},x(M),n(M,a,"Generator"),n(M,s,function(){return this}),n(M,"toString",function(){return"[object Generator]"}),r.keys=function(t){var e,i=Object(t),s=[];for(e in i)s.push(e);return s.reverse(),function t(){for(;s.length;){var e=s.pop();if(e in i)return t.value=e,t.done=!1,t}return t.done=!0,t}},r.values=j,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&l.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=h)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var s=this;function t(t,e){return n.type="throw",n.arg=i,s.next=t,e&&(s.method="next",s.arg=h),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var a=this.tryEntries[e],n=a.completion;if("root"===a.tryLoc)return t("end");if(a.tryLoc<=this.prev){var r=l.call(a,"catchLoc"),o=l.call(a,"finallyLoc");if(r&&o){if(this.prev<a.catchLoc)return t(a.catchLoc,!0);if(this.prev<a.finallyLoc)return t(a.finallyLoc)}else if(r){if(this.prev<a.catchLoc)return t(a.catchLoc,!0)}else{if(!o)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return t(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;0<=i;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&l.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var a=s;break}}var n=(a=a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc?null:a)?a.completion:{};return n.type=t,n.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(n)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),k(i),f}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i,s,a=this.tryEntries[e];if(a.tryLoc===t)return"throw"===(i=a.completion).type&&(s=i.arg,k(a)),s}throw Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:j(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=h),f}},r}function T(t){t=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);if("object"!=typeof(i=i.call(t,e||"default")))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:t+""}function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e,i,s,a,n,r){try{var o=t[n](r),h=o.value}catch(t){return void i(t)}o.done?e(h):Promise.resolve(h).then(s,a)}function G(o){return function(){var t=this,r=arguments;return new Promise(function(e,i){var s=o.apply(t,r);function a(t){O(s,e,i,a,n,"next",t)}function n(t){O(s,e,i,a,n,"throw",t)}a(void 0)})}}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,T(s.key),s)}}function a(t,e,i){return e&&I(t.prototype,e),i&&I(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function t(t,e,i){return(e=T(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function z(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var s,a,n,r,o=[],h=!0,l=!1;try{if(n=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;h=!1}else for(;!(h=(s=n.call(i)).done)&&(o.push(s.value),o.length!==e);h=!0);}catch(t){l=!0,a=t}finally{try{if(!h&&null!=i.return&&(r=i.return(),Object(r)!==r))return}finally{if(l)throw a}}return o}}(t,e)||U(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(t,e){var i;if(t)return"string"==typeof t?R(t,e):"Map"===(i="Object"===(i=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?R(t,e):void 0}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function q(t,e){var i,s,a,n,r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return s=!(i=!0),{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}};if(Array.isArray(t)||(r=U(t))||e&&t&&"number"==typeof t.length)return r&&(t=r),n=0,{s:e=function(){},n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var F=a(function t(s,e){K(this,t);var a,n=[],r=[],o=0;this.addElevationDataOverlay=function(t,e){var i="elevation-data-overlay-"+o;r.push({name:t,overlay:e}),o++,t=$('<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="'+i+'" data-overlay-name="'+t+'"><label class="custom-control-label" for="'+i+'">'+t+'</label><div class="elevation-data-history" style="display:none;"></div></div>'),a.append(t),e.downloadHistory=$("div.elevation-data-history",t),$("input#"+i,t).on("click",{overlay:e,map:s},function(t){this.checked?t.data.overlay.addTo(t.data.map):t.data.overlay.remove()}),e.on("elevationDataDownload",function(t){var e,i;e=t.source.downloadHistory,i=t.filename,t=t.downloadUrl,n.includes(t)||(n.push(t),e.append('<div><a href="'+t+'" title="'+t+'" target="_blank">'+i+"</a></div>"),e.show())})},e=$("#elevation-data",e.getContainer()),a=$("div.elevation-data-overlays",e),$("button",e).on("click",function(t){$.each(r,function(){this.overlay.clearDownloaded(),this.overlay.downloadHistory.empty()})})});var D=L.LayerGroup.extend({_defaultOptions:{},_lineOptions:{stroke:!0,color:"purple",opacity:1,weight:2,dashArray:"4 6",interactive:!1},_textOptions:{offset:-5,repeat:!0},_map:null,_lines:null,initialize:function(t){var e=this;this._lines=[this._createLine(this._arcticCirle,"Arctic Circle"),this._createLine(this._antarcticCirle,"Antarctic Circle"),this._createLine(this._primeMeridian,"Prime Meridian"),this._createLine(this._equator,"Equator"),this._createLine(this._tropicOfCancer,"Tropic of Cancer"),this._createLine(this._tropicOfCapricorn,"Tropic of Capricorn")],this._internationalDateLine.forEach(function(t){e._lines.push(e._createLine(t.map(function(t){return[t[1],t[0]]}),"International Date Line"))}),L.LayerGroup.prototype.initialize.call(this,this._lines,Object.assign({},this._defaultOptions,t))},_arcticCirle:[[66.566667,-180],[66.566667,0],[66.566667,180]],_antarcticCirle:[[-66.563833,-180],[-66.563833,0],[-66.563833,180]],_primeMeridian:[[-90,0],[0,0],[90,0]],_equator:[[0,-180],[0,0],[0,180]],_tropicOfCancer:[[23.43615,-180],[23.43615,0],[23.43615,180]],_tropicOfCapricorn:[[-23.43615,-180],[-23.43615,0],[-23.43615,180]],_internationalDateLine:[[[180.00125809707686,-51.003774291230535],[180.0033129137219,-51.49551639693058],[180,-51.999999906277594],[180,-52.49999984841105],[180,-52.99999979054451],[180,-53.49999973267808],[180,-53.99999967481159],[180,-54.49999961694505],[180,-54.99999955907856],[180,-55.49999950121202],[180,-55.99999944334559],[180,-56.49999938547904],[180,-56.99999932761256],[180,-57.49999926974601],[180,-57.99999921187958],[180,-58.49999915401304],[180,-58.99999909614655],[180,-59.49999903828001],[180,-59.99999898041358],[180,-60.499998922547036],[180,-60.999998864680606],[180,-61.499998806814006],[180,-61.999998748947576],[180,-62.49999869108103],[180,-62.9999986332146],[180,-63.499998575348],[180,-63.99999851748157],[180,-64.49999845961503],[180,-64.9999984017486],[180,-65.49999834388211],[180,-65.99999828601557],[180,-66.49999822814902],[180,-66.99999817028254],[180,-67.499998112416],[180,-67.99999805454956],[180,-68.49999799668308],[180,-68.99999793881653],[180,-69.4999978809501],[180,-69.99999782308356],[180,-70.49999776521707],[180,-70.99999770735053],[180,-71.49999764948399],[180,-71.99999759161756],[180,-72.49999753375107],[180,-72.99999747588453],[180,-73.4999974180181],[180,-73.99999736015155],[180,-74.49999730228507],[180,-74.99999724441852],[180,-75.4999971865521],[180,-75.9999971286855],[180,-76.49999707081906],[180,-76.99999701295252],[180,-77.49999695508609],[180,-77.99999689721955],[180,-78.49999683935306],[180,-78.99999678148652],[180,-79.49999672362009],[180,-79.9999966657536],[180,-80.49999660788706],[180,-80.99999655002051],[180,-81.49999649215408],[180,-81.9999964342876],[180,-82.49999637642105],[180,-82.99999631855451],[180,-83.49999626068808],[180,-83.99999620282159],[180,-84.49999614495505],[180,-84.9999960870885],[180,-85.49999602922207],[180,-85.99999597135559],[180,-86.49999591348904],[180,-86.99999585562261],[180,-87.49999579775601],[180,-87.99999573988958],[180,-88.49999568202304],[180,-88.99999562415655],[180,-89.49999556629001],[180,-89.99999550842358]],[[-179.99997104515307,-2.509433512836307],[-179.52243587869717,-2.509433512608187],[-178.9807967829974,-2.509433512349445],[-178.50686257424397,-2.509433512123044],[-178.03292836550668,-2.509433511896645],[-177.52514171328818,-2.509433511654073],[-177.0173550610535,-2.509433511411502],[-176.50956840885115,-2.50943351116893],[-175.90022442618894,-2.509433510877845],[-175.42629021745165,-2.509433510651445],[-174.98620845216328,-2.509433510441216],[-174.51227424345836,-2.509433510214816],[-173.97063514774243,-2.509433509956073],[-173.46284849566948,-2.509433509713503],[-172.95506184337012,-2.509433509470931],[-172.51498007804938,-2.509433509260703],[-172.00719342583085,-2.509433509018131],[-171.46555433021973,-2.50943350898213],[-171.02547256495367,-2.509433509112815],[-170.5176859127452,-2.509433509263605],[-170.00989926051665,-2.509433509414395],[-169.53596505175923,-2.509433509555132],[-168.96047351260842,-2.509433509726027],[-168.4526868603598,-2.509433509876817],[-167.94490020817142,-2.509433510027607],[-167.3567705984319,-2.509433510202255],[-166.73344279716918,-2.509433510387356],[-166.22698895864679,-2.50943351053775],[-165.68157713258094,-2.509433510699712],[-165.12642580958004,-2.509433510864568],[-164.63945096484676,-2.509433511009178],[-164.07456014498024,-2.509433511176925],[-163.50966932506745,-2.509433511344672],[-162.96425749897267,-2.509433511506635],[-162.43832466669016,-2.509433511662813],[-161.89291284057802,-2.509433511824776],[-161.38645900207877,-2.50943351197517],[-160.88000516355063,-2.509433512125564],[-160.37355132503404,-2.509433512275959],[-159.9060554740841,-2.509433512414784],[-159.4969966045188,-2.509433512536256],[-159.04897974735795,-2.509433512669297],[-158.4865713546375,-2.509433512836307],[-158.48657135463745,-1.932251930971415],[-158.48657135463742,-1.445277086243941],[-158.48657135463736,-1.016739222883756],[-158.4865713546373,-.62715934710176],[-158.48657135463728,-.228073404634912],[-158.94327470606876,.138068983191904],[-159.33017869792837,.448252718422208],[-159.63162653355062,.689925633661372],[-159.9900114000082,.977245379300379],[-160.2891079468391,1.217033249269297],[-160.639768712542,1.498160527335493],[-160.63976871261212,1.983025820632832],[-160.63976871268812,2.508958652946959],[-160.63976871275855,2.995933497680071],[-160.63976871283455,3.5218663299773],[-160.6397687129134,4.067278156074896],[-160.63976871297817,4.515295013226993],[-160.6397687130392,4.937315428082729],[-160.0034504430375,4.937315428082729],[-159.47751761073184,4.937315428082729],[-158.99054276600435,4.937315428082729],[-158.50356792127687,4.937315428082729],[-157.9971140827603,4.937315428082729],[-157.4906602442437,4.937315428082728],[-156.98420640572715,4.937315428082728],[-156.47775256721056,4.937315428082728],[-156.01999621316673,4.937315428082729],[-155.52863393116675,4.937315428082729],[-155.34358244032686,4.440358715492633],[-155.1566113010309,3.93824677728544],[-154.94815780081225,3.3784438504008],[-154.74207633449288,2.825011032523971],[-154.56222129689453,2.342009421340204],[-154.40073059362982,1.908325322692539],[-154.22812571355882,1.444794046139374],[-154.04915072448006,.964155809696339],[-153.89003205511452,.536841820056472],[-153.72426372574768,.068728874079682],[-153.55187136875537,-.371290409830009],[-153.3649002294594,-.873402348037196],[-153.17318502236498,-1.388254504260015],[-152.9982081083948,-1.858155889820966],[-152.82397718711445,-2.326053908248409],[-152.6457481907255,-2.804688777557893],[-152.44529084072406,-3.343018002678394],[-152.2710599194437,-3.81091602110582],[-152.11993740029536,-4.216756308981527],[-151.95282258071265,-4.665544000385537],[-151.80644412936277,-5.058644070245614],[-151.65206952779567,-5.473217841869862],[-151.47472057992624,-5.949489336438642],[-151.30523372644433,-6.404647136850451],[-151.13100280516397,-6.872545155277875],[-150.97574815507735,-7.289482301642839],[-150.81513750033213,-7.720803025549777],[-150.6019399323151,-8.293346170450048],[-150.38474428918946,-8.876626166232372],[-150.17466474776148,-9.440795834991272],[-150.00023316037058,-9.90923274327129],[-150.00016801218877,-10.50025628547553],[-150.00019926131836,-11.000177884848654],[-150.00023316120186,-11.645359271235485],[-150.62431493358625,-11.645359271235485],[-151.15024776589192,-11.645359271235485],[-151.59826462304122,-11.645359271235485],[-152.10471846155778,-11.645359271235485],[-152.61117230007437,-11.645359271235485],[-153.11762613859096,-11.645359271235485],[-153.64355897089663,-11.645359271235485],[-154.0915758280459,-11.645359271235485],[-154.56615865556606,-11.645359271235485],[-154.69737191344396,-11.142520356713785],[-154.81676110369585,-10.684993946633012],[-154.92187359344564,-10.282179085518584],[-155.03753735129658,-9.838929375939893],[-155.1567181985145,-9.38220138353979],[-155.26658958843166,-8.961149339436588],[-155.39425476821796,-8.471907463545627],[-155.50991852606887,-8.028657753966943],[-155.62206519455276,-7.598886327209675],[-155.74000423097038,-7.146917234976939],[-155.86539413218998,-6.666394741740031],[-155.97629898987353,-6.241382215150122],[-156.08043825517493,-5.842296970487039],[-156.5387116600836,-5.842296970543612],[-157.06332167659238,-5.842296970608372],[-157.71283883987974,-5.842296970688552],[-158.3123931444673,-5.842296970762565],[-158.9119474490457,-5.842296970836578],[-159.5614646123484,-5.842296970916758],[-160.21098177564807,-5.842296970996939],[-160.8604989389416,-5.842296971077118],[-161.48503467288367,-5.842296971154215],[-162.13455183618024,-5.842296971234395],[-162.73410614074317,-5.842296971308407],[-163.30867901598248,-5.842296971379337],[-163.9332147499215,-5.842296971456433],[-164.632694771927,-5.84229697154278],[-165.3321747939449,-5.842296971629128],[-165.93172909851705,-5.84229697170314],[-166.55626483245612,-5.842296971780238],[-167.08087484895873,-5.842296971844998],[-167.6804291535401,-5.84229697191901],[-168.2799834581278,-5.842296971993024],[-168.8795377627154,-5.842296972067036],[-169.3960784865953,-5.842296972130801],[-169.62507785291177,-6.35660891369496],[-169.84589895245523,-6.852553205032295],[-170.07078561618377,-7.357628387180476],[-170.32250417147964,-7.922965579961256],[-170.5494912380281,-8.432758077575215],[-170.76306235879287,-8.912419569872858],[-170.99278789473252,-9.428362422975272],[-171.10019629681767,-10.009622299589058],[-171.18151071292272,-10.449669880174843],[-171.29378558833838,-11.057265552059103],[-171.24930411675018,-11.50294873519149],[-171.19851260561944,-12.011855512521727],[-171.1518074190982,-12.479819261344975],[-171.10374265244792,-12.961405356236922],[-171.0570374659267,-13.429369105060173],[-171.00328719125883,-13.967921285392412],[-171.23670082511237,-14.430983758804853],[-171.61975036496315,-14.603559135697955],[-172.01754249584656,-14.782776494734737],[-172.49998268803537,-15.000130359793022],[-172.49998268803571,-15.531222537643785],[-172.49998268803571,-16.06255885838963],[-172.49998268803571,-16.39438269732112],[-172.50000834762596,-16.85032831923978],[-172.49998268803571,-17.285565042578842],[-172.49998268803571,-17.656323677732257],[-172.49998268803571,-18.187497236548083],[-172.49998268803571,-18.718833557293937],[-172.49998268803571,-19.24992573514479],[-172.49998268803571,-19.78126205589066],[-172.49998268803571,-20.31259837663658],[-172.49998268803571,-20.663767886230215],[-172.49998268803571,-21.11972164426905],[-172.49998268803571,-21.59640057312783],[-172.50002337851834,-22.00060235349548],[-172.49998268803571,-22.437455373830048],[-172.49998268803571,-22.968873075540913],[-172.49998268803571,-23.499965253391768],[-172.49998268803571,-24.00005128356237],[-172.4999826880357,-24.4668367316905],[-172.49998268803571,-24.999979201008337],[-172.49998268803571,-25.440919760228013],[-172.49998268803571,-26.000151261349433],[-172.4999826880357,-26.37355244712563],[-172.49998268803571,-27.000079178795485],[-172.4999826880357,-27.389085817303034],[-172.49998268803571,-27.999925715276312],[-172.4999826880357,-28.425344358300386],[-172.49998268803571,-28.819122603879382],[-172.49998268803571,-29.23634671712846],[-172.49998268803571,-29.83465597405679],[-172.49998268803571,-30.35278524455547],[-172.49998268803571,-30.937534410323924],[-172.49998268803574,-31.316505687683012],[-172.49998268803571,-31.875043127584203],[-172.49998268803571,-32.29058871622052],[-172.49998268803571,-32.81247046387958],[-172.49998268803571,-33.28539691557798],[-172.49998268803571,-33.75006056210494],[-172.49998268803574,-34.218029602475596],[-172.49998268803571,-34.68756927936531],[-172.49998268803571,-35.1921126310131],[-172.49998268803571,-35.62491523469564],[-172.49998268803571,-36.20764600119051],[-172.49998268803571,-36.56250533292097],[-172.49998268803571,-37.181729029728025],[-172.49998268803571,-37.68949571481673],[-172.49998268803571,-38.16617464367551],[-172.49998268803571,-38.62212840171434],[-172.49998268803574,-39.14025767221302],[-172.49998268803571,-39.679112113531644],[-172.49998268803571,-40.11434070075053],[-172.49998268803571,-40.63246997124921],[-172.49998268803571,-41.24996753825775],[-172.49998268803571,-41.62727817060667],[-172.49998268803571,-42.18747625551806],[-172.49998268803571,-42.60136119914418],[-172.49998268803571,-43.12506635374355],[-172.49998268803571,-43.57544422768169],[-172.49998268803571,-44.06241230907372],[-172.49998268803571,-44.547170091351106],[-172.49998268803571,-45.000002407299114],[-172.86689700070133,-45.293814163530286],[-173.23785131828305,-45.59088902920324],[-173.5714028935483,-45.85794075848945],[-173.90624576392617,-46.12590805862702],[-174.3749594320739,-46.50131845035642],[-174.7081874738896,-46.768109133257866],[-175.16252364519994,-47.13190631769315],[-175.5811187084202,-47.46713012276399],[-176.05762649442528,-47.84865401319251],[-176.37586513614897,-48.10343253146634],[-176.71873122522487,-48.37796350417781],[-177.04631862336407,-48.640283684786894],[-177.45303057494647,-48.96597314146773],[-177.8240200561051,-49.26299691201707],[-178.22907111596393,-49.587228227563244],[-178.59374865974553,-49.879198166270044],[-178.93694852025067,-50.154079832475546],[-179.318148001907,-50.45933465670629],[-179.69421442579434,-50.76044895305493],[-179.9999710451536,-51.00526657952802]],[[179.99967354891336,59.50186446727048],[179.61392777462385,59.26939974063383],[179.41356783869549,59.14785726934673],[178.9379774790021,58.858222414769365],[178.69464839353236,58.709539391641464],[178.50144998252767,58.59064180171805],[178.22556851104224,58.42071834671457],[178.0305797188063,58.29978623266521],[177.54294497628698,57.99631661403129],[177.26934217182253,57.82529451599964],[177.03756918338877,57.67941913616562],[176.7823584770235,57.518691730211664],[176.50143138570536,57.340426726291696],[176.0567657927272,57.057180277469996],[175.79211489441718,56.88794856066948],[175.5907783869084,56.75830868336078],[175.2888550066101,56.56376748643279],[175.07604378303063,56.42586744117262],[174.78046811800544,56.23368629223072],[174.26711699053342,55.897786359028146],[174.0086510455665,55.72761876112963],[173.74896438612393,55.55598630586044],[173.48805701220587,55.38288899322052],[173.22617306670725,55.20832682320971],[172.96298702576792,55.03229979582816],[172.69866165131822,54.854848601558615],[172.4333597052879,54.675891859435765],[172.1669998067121,54.49547025994222],[171.89966333655596,54.31362449356052],[171.63110615192394,54.13035456029037],[171.3615723957116,53.94557907916716],[171.09106206791878,53.759420121638165],[170.81973793047567,53.57171492577363],[170.5473558404869,53.3825448725381],[170.2739971789176,53.191950652414484],[169.99966194576783,52.999932265402755],[170.48737806925226,52.765677157535215],[170.79988097500595,52.61512237221129],[171.33943677322074,52.3536860220204],[171.7344599775247,52.16126073018341],[172.06275079049595,52.00073677664204],[172.6840130776109,51.69629058642772],[172.9670560740199,51.55716982669183],[173.3544294676103,51.365843177882915],[173.68125542321073,51.204424033726205],[174.45356078143985,50.820916235975325],[174.8597331779544,50.61831832350836],[175.27843824308493,50.40884371949541],[175.70894354814644,50.192899328762024],[176.15043528348812,49.97060722275524],[176.60234378235506,49.742292925335654],[177.06409937799188,49.50828196036319],[177.53472549881798,49.26881847073308],[178.01381524000809,49.024227980305476],[178.31282702646087,48.87094693827025],[178.75261405028456,48.6449843095202],[179.1920327884419,48.418429622040364],[179.56044068606343,48.21944192185788],[180,48.00000029616075],[180.000000335276,48.00000012852257],[180.0000003318895,47.50505063227496],[180.0000003285029,47.010101136027174],[180.00000032511628,46.51515163977956],[180.00000032172966,46.02020214353172],[180.00000031834304,45.525252647284105],[180.00000031495642,45.03030315103649],[180.0000003115698,44.53535365478871],[180.0000003081832,44.040404158541094],[180.00000030479657,43.54545466229331],[180.00000030140995,43.05050516604564],[180.0000002980231,42.555555669797855],[180.00000029463672,42.06060617355024],[180.00000029124988,41.56565667730246],[180.00000028786326,41.07070718105484],[180.00000028447664,40.575757684807],[180.00000028109002,40.08080818855939],[180.0000002777034,39.585858692311604],[180.0000002743169,39.09090919606399],[180.0000002709303,38.595959699816206],[180.00000026754367,38.10101020356859],[180.00000026415705,37.60606070732075],[180.0000002607702,37.11111121107314],[180.00000025738382,36.61616171482552],[180.00000025399697,36.12121221857774],[180.00000025061036,35.626262722330125],[180.00000024722374,35.131313226082284],[180.00000024383712,34.63636372983467],[180.0000002404505,34.141414233586886],[180.0000002370639,33.64646473733927],[180.00000023367727,33.15151524109149],[180.00000023029065,32.656565744843874],[180.00000022690404,32.16161624859603],[180.00000022351742,31.66666675234842],[180.00000022013091,31.171717256100806],[180.00000021674418,30.67676775985302],[180.00000021335768,30.181818263605408],[180.00000020997084,29.686868767357566],[180.00000020658422,29.191919271109953],[180.0000002031976,28.69696977486217],[180.00000019981098,28.202020278614555],[180.00000019642437,27.70707078236677],[180.00000019303775,27.212121286119157],[180.00000018965113,26.717171789871315],[180.00000018626451,26.2222222936237],[180.0000001828779,25.727272797376088],[180.00000017949128,25.232323301128304],[180.00000017610466,24.73737380488052],[180.00000017271805,24.24242430863285],[180.00000016933143,23.747474812385065],[180.0000001659448,23.25252531613745],[180.0000001625582,22.757575819889837],[180.00000015917146,22.262626323642053],[180.00000015578485,21.76767682739444],[180.00000015239823,21.272727331146598],[180.0000001490116,20.777777834898984],[180.000000145625,20.2828283386512],[180.00000014223838,19.787878842403586],[180.00000013885176,19.292929346155802],[180.00000013546514,18.79797984990813],[180.00000013207853,18.303030353660347],[180.0000001286919,17.808080857412733],[180.0000001253053,17.31313136116512],[180.00000012191867,16.818181864917335],[180.00000011853206,16.32323236866972],[180.00000011514544,15.82828287242188],[180.00000011175882,15.333333376174267],[180.0000001083722,14.838383879926482],[180.00000010498547,14.343434383678868],[180.00000010159886,13.848484887431084],[180.00000009821213,13.353535391183414],[180.00000009482562,12.85858589493563],[180.0000000914389,12.363636398688016],[180.0000000880524,11.868686902440402],[180.00000008466577,11.373737406192618],[180.00000008127915,10.878787909945004],[180.00000007789254,10.383838413697163],[180.00000007450592,9.888888917449549],[180.0000000711193,9.393939421201765],[180.00000006773269,8.89898992495415],[180.00000006434607,8.404040428706367],[180.00000006095922,7.909090932458696],[180.00000005757283,7.414141436210912],[180.000000054186,6.919191939963298],[180.00000005079937,6.424242443715684],[180.00000004741275,5.9292929474679],[180.00000004402614,5.434343451220059],[180.00000004063952,4.939393954972445],[180.0000000372529,4.444444458724831],[180.0000000338664,3.949494962477047],[180.00000003047978,3.454545466229433],[180.00000002709317,2.959595969981649],[180.00000002370632,2.464646473733978],[180.00000002031993,1.969696977486194],[180.0000000169331,1.47474748123858],[180.00000001354647,.979797984990796],[180.00000001015985,.484848488743182],[180.00000000677323,-.010101007504545],[180.00000000338662,-.505050503752273],[179.9999959436228,-1.016266633357443],[179.9999917772833,-1.540903051885967],[179.99998813173622,-1.999959918098426],[179.99998416034828,-2.500047518955152]],[[-180,75.00000015366828],[-179.6093818493981,74.75190081654415],[-179.12602086158938,74.51465868349989],[-178.72949210943193,74.29155276784286],[-178.324743879806,74.06120394629717],[-177.99763309082778,73.87317322657239],[-177.6485901317715,73.67106359989562],[-177.28734002795892,73.4602869004422],[-176.69891496023766,73.11299363213408],[-176.29880544561854,72.8743439521546],[-175.91761700537137,72.64497170218925],[-175.44349150304868,72.35684239546536],[-175.0017556248117,72.08543687705702],[-174.59485079961186,71.8327082901254],[-174.1324848467375,71.542422387828],[-173.66035317805796,71.24208593634786],[-173.07030049103582,70.86118232947835],[-172.7271576519447,70.63616396114291],[-172.25929848393008,70.32532936517276],[-171.7887537440691,70.00765876813912],[-171.4737280283994,69.79191782981833],[-171.1367294521689,69.55843584111862],[-170.88965684230752,69.38391436159048],[-170.44043391528703,69.06286645450777],[-170.13041312896718,68.83727841941692],[-169.69848365701765,68.51623051233447],[-169.3898925456742,68.24811314738008],[-168.9999999897555,68.00000014714902],[-168.9999999897555,67.58333348009444],[-168.9999999897556,67.16666681303968],[-168.9999999897556,66.75000014598487],[-168.99999998975568,66.33333347893029],[-168.99999998975568,65.91666681187553],[-168.99999998975568,65.50000014482072],[-169.41717540941406,65.308653958994],[-169.83435082907243,65.11730777316711],[-170.25171145735928,64.88204144702736],[-170.63306265953656,64.69291208427448],[-171.0602720355138,64.47729321740115],[-171.5326071566058,64.23608003702259],[-171.8261482975049,64.08430453722318],[-172.3313206379905,63.82136263917899],[-172.60732418092348,63.67687073575051],[-173.17853717453866,63.37425561724952],[-173.48339026957868,63.210883329931676],[-173.78596469759734,63.048487614194514],[-174.42842672610516,62.699729488515835],[-174.76025761105566,62.51731405537877],[-175.10482461703475,62.32781847828312],[-175.4665630066373,62.12660404222174],[-175.7621793621451,61.962092421393635],[-176.1718104496736,61.73190636177813],[-176.3802677916236,61.61410741488279],[-176.7450172769327,61.40678940644341],[-177.12087526396974,61.19206573018547],[-177.38279989995095,61.0418364687216],[-177.59272209927147,60.920538140329526],[-177.9527107981258,60.7119180364497],[-178.20486971830215,60.565228846965184],[-178.6270334744469,60.31795278469137],[-178.80887924082853,60.210651982286045],[-179.0563180650326,60.06477660245177],[-179.49264210909453,59.80561891928223],[-179.9999710451536,59.50186446727048]],[[180.000000335276,89.99999550842358],[180.00000032410026,89.49999566326517],[180.00000031292427,88.99999581810658],[180.0000003017485,88.49999597294794],[180.00000029057253,87.99999612778953],[180.00000027939677,87.49999628263112],[180.0000002682208,86.99999643747253],[180.00000025704503,86.49999659231406],[180.00000024586905,85.99999674715548],[180.00000023469318,85.49999690199706],[180.00000022351742,84.99999705683842],[180.00000021234143,84.49999721168001],[180.00000020116568,83.99999736652143],[180.0000001899897,83.49999752136296],[180.00000017881393,82.99999767620454],[180.00000016763795,82.49999783104596],[180.00000015646208,81.99999798588732],[180.00000014528632,81.4999981407289],[180.00000013411034,80.99999829557049],[180.00000012293458,80.49999845041191],[180.0000001117586,79.99999860525344],[180.00000010058284,79.49999876009485],[180.00000008940685,78.99999891493644],[180.0000000782311,78.4999990697778],[180.0000000670551,77.99999922461939],[180.00000005587924,77.4999993794608],[180.00000004470348,76.99999953430233],[180.0000000335275,76.49999968914392],[180.00000002235174,75.99999984398534],[180.00000001117576,75.4999999988267],[180,75.00000015366828]]],_createLine:function(t,e,i,s){i=i||{},s=s||{};t=L.polyline(t,Object.assign({},this._lineOptions,i));return t.setText(e+" ".repeat(5*e.length),Object.assign({},this._textOptions,s)),t}}),y=L.LayerGroup.extend({options:{redraw:"moveend",minDistance:100,verticalLabelOffset:200},lineStyle:{stroke:!0,color:"#111",opacity:.6,weight:1,interactive:!1},_bounds:null,initialize:function(t){L.LayerGroup.prototype.initialize.call(this,t),L.Util.setOptions(this,t)},onAdd:function(t){return this._map=t,this.redraw(),this._map.on("viewreset "+this.options.redraw,this.redraw,this),this.eachLayer(t.addLayer,t),this},onRemove:function(t){return t.off("viewreset "+this.options.redraw,this.redraw,this),this.eachLayer(this.removeLayer,this),this},redraw:function(){return this._bounds=this._map.getBounds().pad(.5),this.clearLayers(),this.constructLines(),this},constructLines:function(){var t=this._map.getBounds(),e=this._map.getZoom(),i=(this._bounds=y.bboxIntersect(t,[[-85,-180],[85,180]]),this._map.getBounds);try{this._map.getBounds=function(){return y.bboxIntersect(i.apply(this),[[-85,-180],[85,180]])};for(var s=this._map.project(t.getCenter(),e),a=y.getGridDivisor(this._map.unproject(s.add([this.options.minDistance/2,0]),e).lng-this._map.unproject(s.subtract([this.options.minDistance/2,0]),e).lng,!1),n=Math.max(t.getWest(),-180),r=Math.min(t.getEast(),180),o=y.fixFloatingPoint(Math.ceil(n/a)*a);o<=r;o+=a)this.addLayer(this.buildXLine(o)),this.addLayer(this.buildLabel("gridlabel-horiz",y.fixFloatingPoint(o)));if(0<t.getNorth())for(var h=Math.max(0,t.getSouth()),l=!0;h<t.getNorth()&&h<85;){var d=this._map.project([h,t.getCenter().lng],e),u=this._map.unproject(d.subtract([0,this.options.minDistance]),e),c=y.getGridDivisor(u.lat-h,!0),h=y.fixFloatingPoint(l?Math.ceil(h/c)*c:Math.ceil(u.lat/c)*c),l=!1;this.addLayer(this.buildYLine(h)),this.addLayer(this.buildLabel("gridlabel-vert",h))}if(t.getSouth()<0)for(var _=Math.min(0,t.getNorth()),p=!0;_>t.getSouth()&&-85<_;){var g=this._map.project([_,t.getCenter().lng],e),f=this._map.unproject(g.add([0,this.options.minDistance]),e),m=y.getGridDivisor(y.fixFloatingPoint(_-f.lat),!0),_=y.fixFloatingPoint(p?Math.floor(_/m)*m:Math.floor(f.lat/m)*m),p=!1;this.addLayer(this.buildYLine(_)),this.addLayer(this.buildLabel("gridlabel-vert",_))}}finally{this._map.getBounds=i}},buildXLine:function(t){var e=new L.LatLng(this._bounds.getSouth(),t),t=new L.LatLng(this._bounds.getNorth(),t);return new L.Polyline([e,t],this.lineStyle)},buildYLine:function(t){var e=new L.LatLng(t,this._bounds.getWest()),t=new L.LatLng(t,this._bounds.getEast());return new L.Polyline([e,t],this.lineStyle)},buildLabel:function(t,e){var i,s=this._map.getBounds().pad(-.003),a=[],s=("gridlabel-horiz"==t?i=new L.LatLng(s.getNorth(),e):(i=new L.LatLng(e,s.getWest()),null!=this.options.verticalLabelOffset&&(s=this._map.latLngToContainerPoint(this._bounds.getSouthWest()),s=Math.max(0,this.options.verticalLabelOffset-s.x),a.push("margin-left: ".concat(s,"px")))),'<div class="'.concat(t,'"'));return 0<a.length&&(s+=' style="'.concat(a.join(";"),'"')),s=s+">"+e+"&#8239;Â°</div>",L.marker(i,{interactive:!1,icon:L.divIcon({iconSize:[0,0],className:"leaflet-grid-label",html:s})})}}),V=(y.fixFloatingPoint=function(t){return y.round(t,12)},y.round=function(t,e){e=Math.pow(10,e);return Math.round(t*e)/e},y.getGridDivisor=function(t,e){if(t<=0||!isFinite(t))throw new Error("Invalid number "+t);if(e&&5<=t)return 5;if(t<=10){for(var i=1;1<t;)i*=10,t/=10;for(;t<=.1;)i/=10,t*=10;return.1==t?y.fixFloatingPoint(.1*i):t<=.2?y.fixFloatingPoint(.2*i):t<=.5?y.fixFloatingPoint(.5*i):i}return t<=30?30:t<=45?45:t<=60?60:90},y.niceRound=y.getGridDivisor,y.bboxIntersect=function(t,e){t=t instanceof L.LatLngBounds?t:L.latLngBounds(t),e=e instanceof L.LatLngBounds?e:L.latLngBounds(e);return L.latLngBounds([[Math.max(t.getSouth(),e.getSouth()),Math.max(t.getWest(),e.getWest())],[Math.min(t.getNorth(),e.getNorth()),Math.min(t.getEast(),e.getEast())]])},L.Class.extend({_map:null,_container:null,_localStorageKey:"_wrf_domain_wizard_settings",_defaultOptions:{jsonBaseUrl:"json"},_settings:{showGraticule:{id:"showGraticule",value:!1,dataType:"boolean"},showGeographicLines:{id:"showGeographicLines",value:!0,dataType:"boolean"}},_options:null,_controls:{},_graticule:null,_geographicLines:null,initialize:function(t,e,i){for(var s in this._options=Object.assign({},this._defaultOptions,i),this._map=t,this._container=e.getContainer().querySelector("#settings"),this._graticule=new y({verticalLabelOffset:480}),this._geographicLines=new D({}),this._settings){var a=this._settings[s],n=localStorage.getItem(this._localStorageKey+"_".concat(a.id));if(n)switch(a.dataType){case"boolean":a.value="true"===n;break;case"int":a.value=parseInt(n);break;case"float":a.value=parseFloat(n);break;default:a.value=n}this._controls[s]=this._container.querySelector("#".concat(a.id))}var r,o=this;for(r in this._settings.showGraticule.value=!1,this._controls.showGraticule.addEventListener("click",function(t){o.showGraticule(t.currentTarget.checked)}),this.showGraticule(this._settings.showGraticule.value),this._controls.showGeographicLines.addEventListener("click",function(t){o.showGeographicLines(t.currentTarget.checked)}),this.showGeographicLines(this._settings.showGeographicLines.value),this._controls){var h,l=this._controls[r];"INPUT"===l.tagName&&(h=this._settings[r].value,"checkbox"===l.type?l.checked=!0===h:l.value=h)}},showGraticule:function(t){localStorage.setItem(this._localStorageKey+"_showGraticule",t),!0===t?this._graticule.addTo(this._map):this._graticule.remove()},showGeographicLines:function(t){localStorage.setItem(this._localStorageKey+"_showGeographicLines",t),!0===t?this._geographicLines.addTo(this._map):this._geographicLines.remove()}}));var W=function(){function i(){K(this,i),this.container=document.querySelector("div.modal#message-box-dialog"),this.dialogBody=this.container.querySelector("div.modal-body"),this.dialogTitle=this.container.querySelector("div.modal-header h5.modal-title"),this.titleIcon=this.dialogTitle.querySelector("i"),this.titleSpan=this.dialogTitle.querySelector("span")}return a(i,[{key:"open",value:function(){return $(this.container).modal(),this}},{key:"close",value:function(){return $(this.container).modal("hide"),this}},{key:"empty",value:function(){return this.titleSpan.innerHTML="",this.titleIcon.classList.remove("fa-exclamation-circle"),this.titleIcon.classList.remove("fa-info-circle"),this.titleIcon.classList.remove("fa-exclamation-triangle"),this.dialogBody.innerHTML="",this}},{key:"title",value:function(t,e){return e===i.types.error&&this.titleIcon.classList.add("fa-exclamation-circle"),e===i.types.info&&this.titleIcon.classList.add("fa-info-circle"),e===i.types.warning&&this.titleIcon.classList.add("fa-exclamation-triangle"),this.titleSpan.innerText=t,this}},{key:"html",value:function(t){return this.dialogBody.innerHTML=t,this}},{key:"text",value:function(t){return this.dialogBody.innerText=t,this}}])}(),H=(t(W,"types",{error:0,info:1,warning:2}),new W);function X(t,e){H.empty().title(t,W.types.error).text(e).open()}function J(a,t){var e,i,n,r,o={},h=0;t=$("#waypoints",t.getContainer()),e=$("button#button-waypoints-add",t),i=$("button#button-waypoints-remove",t),n=$("input#file-waypoints",t),r=$("#waypoints-layers",t),e.on("click",function(t){n.click()}),i.on("click",function(t){object.keys(o).forEach(function(t){o[t].remove()}),o={},r.empty()}),n.on("change",function(t){var e,s;t.target.files&&0!=t.target.files.length&&(t.target.files[0].name.endsWith(".wpt")||t.target.files[0].name.endsWith(".cup")||t.target.files[0].name.endsWith(".gpx")?(e=new FileReader,s=t.target.files[0].name,e.onerror=function(t){X("File Open Error","Unable to read file!")},e.onload=function(t){var e=s,t=t.target.result,i="waypoints-layer-"+h;if(void 0!==o[e])X("File Open Error","File name "+e+" already loaded");else{try{o[e]=L.waypoints(L.Waypoints.parse(t)).addTo(a),a.fitBounds(o[e].getBounds())}catch(t){return void X("File Open Error","Unable to parse file "+e+": "+t)}h++,r.append($('<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="'+i+'" data-filename="'+e+'" checked><label class="custom-control-label" for="'+i+'">'+e+"</label></div>")),$("input#"+i,r).on("click",{layer:o[e],map:a},function(t){this.checked?t.data.layer.addTo(t.data.map):t.data.layer.remove()})}},e.readAsText(t.target.files[0]),n.val(null)):X("File Open Error","Only files with extensions .wpt, .cup and .gpx are allowed!"))})}var m=function(){function h(t){if(K(this,h),!t)throw new Error("Invalid data");for(var e,i,s=h._tokenize(t),a=null,n=null,r=0;r<s.length;r++)e=s[r].name,i=s[r].value,"group"==e?a=i.match(/^end$/i)?null:this[i]={}:"object"==e?n=i.toLowerCase():"character"!=e&&"integer"!=e&&"real"!=e&&"logical"!=e||(null==a[n]?a[n]=i:(Array.isArray(a[n])||(a[n]=[a[n]]),a[n].push(i)))}return a(h,null,[{key:"_tokenize",value:function(t){var e,i,a=[];function s(t,e,i,s){a.push({pos:t,name:e,value:i,index:3<arguments.length&&void 0!==s?s:null})}for(var n,r="initial",o=0;o<t.length;)if(e=t[o],i=t.substr(o),e.match(/!/)){if(!(n=h._re_comment.exec(i))||0!=n.index)break;s(o,"comment",n[1]),o+=n[0].length,r="comment"}else if(e.match(/['"]/)){if(!(n=h._re_string.exec(i))||0!=n.index)break;s(o,"character",n[2]),o+=n[0].length,r="character"}else if(e.match(/\//))"object"==r&&s(o-1,"null",""),s(o,"group","end"),o++,r="group_end";else if(e.match(/[$&]/)){if(!(n=h._re_group.exec(i))||0!=n.index)break;r=n[1].match(/^end$/i)?("object"==r&&s(o-1,"null",""),"group_end"):"group_start",s(o,"group",n[1]),o+=n[0].length}else if(e.match(/\./))if((n=h._re_logical_p.exec(i))&&0==n.index)s(o,"logical",n[1]),o+=n[0].length,r="logical";else{if(!(n=h._re_real.exec(i))||0!=n.index)break;s(o,"real",parseFloat(n[1])),o+=n[0].length,r="real"}else if(e.match(/[[a-zA-Z_]/))"group_end"==r||"initial"==r?(n=h._re_orphan.exec(i))&&0==n.index&&(s(o,"orphan",n[0]),o+=n[0].length,r="orphan"):(n=h._re_object.exec(i))&&0==n.index?("object"==r&&s(o-1,"null",""),s(o,"object",n[1]),o+=n[0].length,r="object"):(n=h._re_array.exec(i))&&0==n.index?(s(o,"array",n[1],n[2]),o+=n[0].length,r="array"):(n=h._re_logical_c.exec(i))&&0==n.index?(s(o,"logical",n[1]),o+=n[0].length,r="logical"):(n=h._re_nondelimited_c.exec(i))&&0==n.index?(s(o,"nondelimited",n[1]),o+=n[0].length,r="nondelimited"):(s(o,"unknown",null),o++);else if(e.match(/\(/)){if(!(n=h._re_complex_start.exec(i))||0!=n.index)break;s(o,"complex","start"),o+=n[0].length,r="complex_start"}else if(e.match(/\)/)){if(!(n=h._re_complex_end.exec(i))||0!=n.index)break;s(o,"complex","end"),o+=n[0].length,r="complex_end"}else if(e.match(/[\+\-]/))if((n=h._re_real.exec(i))&&0==n.index)s(o,"real",parseFloat(n[1])),o+=n[0].length,r="real";else{if(!(n=h._re_integer.exec(i))||0!=n.index)break;s(o,"integer",parseInt(n[1],10)),o+=n[0].length,r="integer"}else if(e.match(/[\d]/))if((n=h._re_repeat.exec(i))&&0==n.index)s(o,"repeat",n[1]),o+=n[0].length,r="repeat";else if((n=h._re_real.exec(i))&&0==n.index)s(o,"real",parseFloat(n[1])),o+=n[0].length,r="real";else if((n=h._re_integer.exec(i))&&0==n.index)s(o,"integer",parseInt(n[1],10)),o+=n[0].length,r="integer";else{if(!(n=h._re_nondelimited_d.exec(i))||0!=n.index)break;s(o,"nondelimited",n[1]),o+=n[0].length,r="nondelimited"}else(n=h._re_null.exec(i))&&0==n.index?(s(o,"null",""),o+=n[0].length,r="null"):o++;return a}},{key:"isReal",value:function(t){t=h._re_real.exec(t);return null!==t&&0==t.index}},{key:"isInteger",value:function(t){t=h._re_integer.exec(t);return null!==t&&0==t.index}},{key:"isLogical",value:function(t){t=h._re_logical_p.exec(t);return null!==t&&0==t.index}},{key:"parseLogicalValue",value:function(t){return".true."===t.toLowerCase()}},{key:"parseValue",value:function(t){return h.isLogical(t)?h.parseLogicalValue(t):h.isReal(t)?parseFloat(t):h.isInteger(t)?parseInt(t):t}},{key:"_formatValue",value:function(t){if(null==t)throw new Error("Undefined value");if(Array.isArray(t)){for(var e=h._formatValue(t[0]),i=1;i<t.length;i++)e+=", "+h._formatValue(t[i]);return e}return"string"==typeof t?"'"+t+"'":"boolean"==typeof t?t?".true.":".false.":h._isInteger(t)?t.toString():t.toFixed(3)}},{key:"_isInteger",value:function(t){return"number"==typeof t&&isFinite(t)&&-9007199254740992<t&&t<9007199254740992&&Math.floor(t)===t}},{key:"formatSection",value:function(t,e,i){var s="&"+t+"\n";console.debug("format namelist section ".concat(t));for(var a=0;a<e.length;a++)if(console.debug("   ".concat(e[a],": ").concat(i[a])),null!==i[a]){if(void 0===i[a])throw new Error("Property ".concat(e[a]," is not defined"));s+=" "+e[a].padEnd(20)+" = "+h._formatValue(i[a])+"\n"}return s+"/\n\n"}},{key:"convertToArray",value:function(t,e){null==t[e]||Array.isArray(t[e])||(t[e]=[].concat(t[e]))}}])}(),Z=(t(m,"_re_comment",/(!.*)\n\s*/),t(m,"_re_group",/(?:&|\$)\s*([a-zA-Z_][\w]*)\s*/),t(m,"_re_array",/([a-zA-Z_][\w]*)\s*(\(\s*((\s*:\s*(\-|\+)?\d*){1,2}|((\-|\+)?\d+(\s*:\s*(\-|\+)?\d*){0,2}))(\s*,\s*(((\-|\+)?\d*(\s*:\s*(\-|\+)?\d*){0,2})))*\s*\)(\s*\(\s*(:\s*\d*|\d+(\s*:\s*\d*)?)\s*\))?)\s*=\s*/),t(m,"_re_object",/([a-zA-Z_][\w]*)\s*=\s*/),t(m,"_re_repeat",/([0-9]+)\s*\*\s*/),t(m,"_re_complex_start",/\(\s*/),t(m,"_re_complex_end",/\)\s*,?\s*/),t(m,"_re_string",/('((?:[^']+|'')*)'|"((?:[^"]+|"")*)")\s*,?\s*/),t(m,"_re_nondelimited_c",/([^'"\*\s,\/!&\$(=%\.][^\*\s,\/!&\$(=%\.]*)\s*,?\s*/),t(m,"_re_nondelimited_d",/(\d+[^\*\s\d,\/!&\$\(=%\.][^\s,\/!&\$\(=%\.]*)\s*,?\s*/),t(m,"_re_real",/(((\-|\+)?\d*\.\d*([eEdDqQ](\-|\+)?\d+)?)|((\-|\+)?\d+[eEdDqQ](\-|\+)?\d+))\s*,?\s*/),t(m,"_re_integer",/((\-|\+)?\d+)\b\s*,?\s*/),t(m,"_re_logical_c",/([tT][rR][uU][eE]|[tT]|[fF][aA][lL][sS][eE]|[fF])\s*,?\s*/),t(m,"_re_logical_p",/(\.(([tT][rR][uU][eE]|[[fF][aA][lL][sS][eE])\.?|[tTfF]\w*))\s*,?\s*/),t(m,"_re_null",/\s*\b|\s*,\s*/),t(m,"_re_orphan",/[^&]*/),function(){function s(t){K(this,s),this.share={wrf_core:"ARW",max_dom:1,start_year:null,start_month:null,start_day:null,start_hour:null,end_year:null,end_month:null,end_day:null,end_hour:null,start_date:null,end_date:null,interval_seconds:null,active_grid:!0,io_form_geogrid:2,output_from_geogrid:null,debug_level:0},this.geogrid={parent_id:1,parent_grid_ratio:null,i_parent_start:null,j_parent_start:null,s_we:1,e_we:null,s_sn:1,e_sn:null,geog_data_res:"default",dx:null,dy:null,map_proj:"lambert",ref_lat:null,ref_lon:null,ref_x:null,ref_y:null,truelat1:null,truelat2:null,stand_lon:null,pole_lat:90,pole_lon:0,geog_data_path:null,opt_geogrid_tbl_path:"./geogrid/"},this.ungrib={out_format:"WPS",prefix:"FILE",add_lvls:!1,interp_type:0,new_plvl:null,pmin:100},this.metgrid={fg_name:null,constants_name:null,io_form_metgrid:2,opt_output_from_metgrid_path:null,opt_metgrid_tbl_path:"./metgrid",process_only_bdy:0},"string"==typeof t&&("hgridspec"in(t=new m(t))?this._createWRFSI(t):this._create(t))}return a(s,[{key:"_create",value:function(t){"share"in t&&(Object.assign(this.share,t.share),m.convertToArray(this.geogrid,"start_year"),m.convertToArray(this.geogrid,"start_month"),m.convertToArray(this.geogrid,"start_day"),m.convertToArray(this.geogrid,"start_hour"),m.convertToArray(this.geogrid,"end_year"),m.convertToArray(this.geogrid,"end_month"),m.convertToArray(this.geogrid,"end_day"),m.convertToArray(this.geogrid,"end_hour"),m.convertToArray(this.geogrid,"start_date"),m.convertToArray(this.geogrid,"end_date"),m.convertToArray(this.geogrid,"active_grid")),"geogrid"in t&&(Object.assign(this.geogrid,t.geogrid),m.convertToArray(this.geogrid,"parent_id"),m.convertToArray(this.geogrid,"parent_grid_ratio"),m.convertToArray(this.geogrid,"i_parent_start"),m.convertToArray(this.geogrid,"J_parent_start"),m.convertToArray(this.geogrid,"s_we"),m.convertToArray(this.geogrid,"e_we"),m.convertToArray(this.geogrid,"s_sn"),m.convertToArray(this.geogrid,"e_sn"),m.convertToArray(this.geogrid,"geog_data_res")),"ungrib"in t&&Object.assign(this.ungrib,t.ungrib),"metgrid"in t&&Object.assign(this.metgrid,t.metgrid)}},{key:"_createWRFSI",value:function(t){this.share.wrf_core="ARW",this.share.max_dom=t.hgridspec.num_domains;var e=new Date,i=new Date(e);i.setDate(i.getDate()+1),this.share.start_date=[],this.share.end_date=[];for(var s=0;s<this.share.max_dom;s++)this.share.start_date.push(e.getFullYear().toString()+"-"+e.getMonth().toString().padStart(2,"0")+"-"+e.getDate().toString().padStart(2,"0")+"_03:00:00"),this.share.end_date.push(i.getFullYear().toString()+"-"+i.getMonth().toString().padStart(2,"0")+"-"+i.getDate().toString().padStart(2,"0")+"_03:00:00");this.geogrid.parent_id=[],this.geogrid.parent_grid_ratio=[],this.geogrid.i_parent_start=[],this.geogrid.j_parent_start=[],this.geogrid.e_we=[],this.geogrid.e_sn=[],this.geogrid.geog_data_res=[];for(s=0;s<this.share.max_dom;s++){this.geogrid.parent_id.push(t.hgridspec.parent_id[s]),this.geogrid.parent_grid_ratio.push(t.hgridspec.ratio_to_parent[s]),this.geogrid.i_parent_start.push(t.hgridspec.domain_origin_lli[s]),this.geogrid.j_parent_start.push(t.hgridspec.domain_origin_llj[s]);var a=(t.hgridspec.domain_origin_uri[s]-t.hgridspec.domain_origin_lli[s])*t.hgridspec.ratio_to_parent[s]+1,n=(t.hgridspec.domain_origin_urj[s]-t.hgridspec.domain_origin_llj[s])*t.hgridspec.ratio_to_parent[s]+1;this.geogrid.e_we.push(a),this.geogrid.e_sn.push(n),this.geogrid.geog_data_res.push("default")}this.geogrid.dx=t.hgridspec.moad_delta_x,this.geogrid.dy=t.hgridspec.moad_delta_y,this.geogrid.map_proj=t.hgridspec.map_proj_name,this.geogrid.ref_lat=t.hgridspec.moad_known_lat,this.geogrid.ref_lon=t.hgridspec.moad_known_lon,Array.isArray(t.hgridspec.moad_stand_lats)?(this.geogrid.truelat1=t.hgridspec.moad_stand_lats[0],this.geogrid.truelat2=t.hgridspec.moad_stand_lats[1]):(this.geogrid.truelat1=t.hgridspec.moad_stand_lats,this.geogrid.truelat2=0),Array.isArray(t.hgridspec.moad_stand_lons)?this.geogrid.stand_lon=t.hgridspec.moad_stand_lons[0]:this.geogrid.stand_lon=t.hgridspec.moad_stand_lons,this.geogrid.geog_data_path="/home/wrf/geog",this.share.interval_seconds=10800,this.share.io_form_geogrid=2,this.ungrib.out_format="WPS",this.ungrib.prefix="UNGRIB",this.metgrid.fg_name="UNGRIB",this.metgrid.io_form_metgrid=2,this.metgrid.opt_metgrid_tbl_path="/home/wrf"}},{key:"_setDefaults",value:function(){if(!this.share.start_date||!this.share.end_date){var t=new Date,e=s._formarDate(t)+"_03:00:00",i=s._formarDate(t)+"_18:00:00";for(this.share.start_date=[],this.share.end_date=[];this.share.start_date.length<this.share.max_dom;)this.share.start_date.push(e),this.share.end_date.push(i)}null===this.share.interval_seconds&&(this.share.interval_seconds=21600),null===this.share.debug_level&&(this.share.debug_level=0),null===this.geogrid.geog_data_path&&(this.geogrid.geog_data_path="geog"),null===this.geogrid.opt_geogrid_tbl_path&&(this.geogrid.opt_geogrid_tbl_path="geogrid"),null===this.metgrid.fg_name&&(this.metgrid.fg_name="FILE")}},{key:"toString",value:function(){this._setDefaults();var t="";return(t+=m.formatSection("share",["wrf_core","max_dom","start_date","end_date","interval_seconds","io_form_geogrid","debug_level"],[this.share.wrf_core,this.share.max_dom,this.share.start_date,this.share.end_date,this.share.interval_seconds,this.share.io_form_geogrid,this.share.debug_level]))+m.formatSection("geogrid",["parent_id","parent_grid_ratio","i_parent_start","j_parent_start","e_we","e_sn","geog_data_res","dx","dy","map_proj","ref_lat","ref_lon","truelat1","truelat2","pole_lat","pole_lon","stand_lon","geog_data_path","opt_geogrid_tbl_path"],[this.geogrid.parent_id,this.geogrid.parent_grid_ratio,this.geogrid.i_parent_start,this.geogrid.j_parent_start,this.geogrid.e_we,this.geogrid.e_sn,this.geogrid.geog_data_res,this.geogrid.dx,this.geogrid.dy,this.geogrid.map_proj,this.geogrid.ref_lat,this.geogrid.ref_lon,this.geogrid.truelat1,this.geogrid.truelat2,this.geogrid.pole_lat,this.geogrid.pole_lon,this.geogrid.stand_lon,this.geogrid.geog_data_path,this.geogrid.opt_geogrid_tbl_path])+m.formatSection("ungrib",["out_format","prefix"],[this.ungrib.out_format,this.ungrib.prefix])+m.formatSection("metgrid",["fg_name","io_form_metgrid","opt_metgrid_tbl_path"],[this.metgrid.fg_name,this.metgrid.io_form_metgrid,this.metgrid.opt_metgrid_tbl_path])}}],[{key:"_formarDate",value:function(t){return t.getFullYear().toString()+"-"+t.getMonth().toString().padStart(2,"0")+"-"+t.getDay().toString().padStart(2,"0")}}])}()),l=637e4,Q="lambert",et="mercator",it="polar",Y="lat-lon";function st(t){return t<0?Math.ceil(t):Math.floor(t)}function at(t){return t*l*Math.PI*2/360}function nt(t,e){if(void 0===t)throw new Error("Invalid map_proj argument");if(isNaN(e))throw new Error("Invalid distance argument");return t===Y?at(e):e}var rt=1,ot=2,ht=3,lt=4,dt=5,ut=6378137,ct=6356752.314,_t=.0066943799901413165,pt=484813681109536e-20,f=Math.PI/2,gt=.16666666666666666,ft=.04722222222222222,mt=.022156084656084655,v=1e-10,b=.017453292519943295,M=57.29577951308232,x=Math.PI/4,yt=2*Math.PI,d=3.14159265359,vt={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},bt={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Mt=/[\s_\-\/\(\)]/g;function g(t,e){if(t[e])return t[e];for(var i,s=Object.keys(t),a=e.toLowerCase().replace(Mt,""),n=-1;++n<s.length;)if((i=s[n]).toLowerCase().replace(Mt,"")===a)return t[i]}function xt(t){var e,i,s,a={},n=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,e){e=e.split("=");return e.push(!0),t[e[0].toLowerCase()]=e[1],t},{}),r={proj:"projName",datum:"datumCode",rf:function(t){a.rf=parseFloat(t)},lat_0:function(t){a.lat0=t*b},lat_1:function(t){a.lat1=t*b},lat_2:function(t){a.lat2=t*b},lat_ts:function(t){a.lat_ts=t*b},lon_0:function(t){a.long0=t*b},lon_1:function(t){a.long1=t*b},lon_2:function(t){a.long2=t*b},alpha:function(t){a.alpha=parseFloat(t)*b},gamma:function(t){a.rectified_grid_angle=parseFloat(t)},lonc:function(t){a.longc=t*b},x_0:function(t){a.x0=parseFloat(t)},y_0:function(t){a.y0=parseFloat(t)},k_0:function(t){a.k0=parseFloat(t)},k:function(t){a.k0=parseFloat(t)},a:function(t){a.a=parseFloat(t)},b:function(t){a.b=parseFloat(t)},r:function(t){a.a=a.b=parseFloat(t)},r_a:function(){a.R_A=!0},zone:function(t){a.zone=parseInt(t,10)},south:function(){a.utmSouth=!0},towgs84:function(t){a.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){a.to_meter=parseFloat(t)},units:function(t){t=g(bt,a.units=t);t&&(a.to_meter=t.to_meter)},from_greenwich:function(t){a.from_greenwich=t*b},pm:function(t){var e=g(vt,t);a.from_greenwich=(e||parseFloat(t))*b},nadgrids:function(t){"@null"===t?a.datumCode="none":a.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(a.axis=t)},approx:function(){a.approx=!0}};for(e in n)i=n[e],e in r?"function"==typeof(s=r[e])?s(i):a[s]=i:a[e]=i;return"string"==typeof a.datumCode&&"WGS84"!==a.datumCode&&(a.datumCode=a.datumCode.toLowerCase()),a}var wt=/\s/,Lt=/[A-Za-z]/,kt=/[A-Za-z84_]/,St=/[,\]]/,jt=/[\d\.E\-\+]/;function s(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function Gt(t,e,i){Array.isArray(e)&&(i.unshift(e),e=null);i=i.reduce(function(t,e){return Et(e,t),t},e?{}:t);e&&(t[e]=i)}function Et(t,e){if(Array.isArray(t)){var i,s=t.shift();if("PARAMETER"===s&&(s=t.shift()),1===t.length)return Array.isArray(t[0])?(e[s]={},void Et(t[0],e[s])):void(e[s]=t[0]);if(t.length)if("TOWGS84"===s)e[s]=t;else if("AXIS"===s)s in e||(e[s]=[]),e[s].push(t);else switch(Array.isArray(s)||(e[s]={}),s){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[s]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&Et(t[2],e[s]));case"SPHEROID":case"ELLIPSOID":return e[s]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&Et(t[3],e[s]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void Gt(e,s,t);default:for(i=-1;++i<t.length;)if(!Array.isArray(t[i]))return Et(t,e[s]);return Gt(e,s,t)}else e[s]=!0}else e[t]=!0}s.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;wt.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case 1:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},s.prototype.afterquote=function(t){if('"'===t)this.word+='"',this.state=4;else{if(!St.test(t))throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place);this.word=this.word.trim(),this.afterItem(t)}},s.prototype.afterItem=function(t){","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,this.state=1):"]"===t&&(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),this.currentObject||(this.state=-1))},s.prototype.number=function(t){if(jt.test(t))this.word+=t;else{if(!St.test(t))throw new Error("havn't handled \""+t+'" in number yet, index '+this.place);this.word=parseFloat(this.word),this.afterItem(t)}},s.prototype.quoted=function(t){'"'===t?this.state=5:this.word+=t},s.prototype.keyword=function(t){var e;if(kt.test(t))this.word+=t;else if("["===t)(e=[]).push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=1;else{if(!St.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},s.prototype.neutral=function(t){if(Lt.test(t))this.word=t,this.state=2;else if('"'===t)this.word="",this.state=4;else if(jt.test(t))this.word=t,this.state=3;else{if(!St.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)}},s.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function o(t){return.017453292519943295*t}function At(a){if("GEOGCS"===a.type?a.projName="longlat":"LOCAL_CS"===a.type?(a.projName="identity",a.local=!0):"object"==typeof a.PROJECTION?a.projName=Object.keys(a.PROJECTION)[0]:a.projName=a.PROJECTION,a.AXIS){for(var t="",e=0,i=a.AXIS.length;e<i;++e){var s=[a.AXIS[e][0].toLowerCase(),a.AXIS[e][1].toLowerCase()];-1!==s[0].indexOf("north")||("y"===s[0]||"lat"===s[0])&&"north"===s[1]?t+="n":-1!==s[0].indexOf("south")||("y"===s[0]||"lat"===s[0])&&"south"===s[1]?t+="s":-1!==s[0].indexOf("east")||("x"===s[0]||"lon"===s[0])&&"east"===s[1]?t+="e":-1===s[0].indexOf("west")&&("x"!==s[0]&&"lon"!==s[0]||"west"!==s[1])||(t+="w")}2===t.length&&(t+="u"),3===t.length&&(a.axis=t)}a.UNIT&&(a.units=a.UNIT.name.toLowerCase(),"metre"===a.units&&(a.units="meter"),a.UNIT.convert)&&("GEOGCS"===a.type?a.DATUM&&a.DATUM.SPHEROID&&(a.to_meter=a.UNIT.convert*a.DATUM.SPHEROID.a):a.to_meter=a.UNIT.convert);var n=a.GEOGCS;function r(t){return t*(a.to_meter||1)}(n="GEOGCS"===a.type?a:n)&&(n.DATUM?a.datumCode=n.DATUM.name.toLowerCase():a.datumCode=n.name.toLowerCase(),"d_"===a.datumCode.slice(0,2)&&(a.datumCode=a.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==a.datumCode&&"new_zealand_1949"!==a.datumCode||(a.datumCode="nzgd49"),"wgs_1984"!==a.datumCode&&"world_geodetic_system_1984"!==a.datumCode||("Mercator_Auxiliary_Sphere"===a.PROJECTION&&(a.sphere=!0),a.datumCode="wgs84"),"_ferro"===a.datumCode.slice(-6)&&(a.datumCode=a.datumCode.slice(0,-6)),"_jakarta"===a.datumCode.slice(-8)&&(a.datumCode=a.datumCode.slice(0,-8)),~a.datumCode.indexOf("belge")&&(a.datumCode="rnb72"),n.DATUM&&n.DATUM.SPHEROID&&(a.ellps=n.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===a.ellps.toLowerCase().slice(0,13)&&(a.ellps="intl"),a.a=n.DATUM.SPHEROID.a,a.rf=parseFloat(n.DATUM.SPHEROID.rf,10)),n.DATUM&&n.DATUM.TOWGS84&&(a.datum_params=n.DATUM.TOWGS84),~a.datumCode.indexOf("osgb_1936")&&(a.datumCode="osgb36"),~a.datumCode.indexOf("osni_1952")&&(a.datumCode="osni52"),(~a.datumCode.indexOf("tm65")||~a.datumCode.indexOf("geodetic_datum_of_1965"))&&(a.datumCode="ire65"),"ch1903+"===a.datumCode&&(a.datumCode="ch1903"),~a.datumCode.indexOf("israel"))&&(a.datumCode="isr93"),a.b&&!isFinite(a.b)&&(a.b=a.a);[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",o],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",o],["x0","false_easting",r],["y0","false_northing",r],["long0","central_meridian",o],["lat0","latitude_of_origin",o],["lat0","standard_parallel_1",o],["lat1","standard_parallel_1",o],["lat2","standard_parallel_2",o],["azimuth","Azimuth"],["alpha","azimuth",o],["srsCode","name"]].forEach(function(t){var e,i,s;e=a,i=(t=t)[0],s=t[1],!(i in e)&&s in e&&(e[i]=e[s],3===t.length)&&(e[i]=t[2](e[i]))}),a.long0||!a.longc||"Albers_Conic_Equal_Area"!==a.projName&&"Lambert_Azimuthal_Equal_Area"!==a.projName||(a.long0=a.longc),a.lat_ts||!a.lat1||"Stereographic_South_Pole"!==a.projName&&"Polar Stereographic (variant B)"!==a.projName?!a.lat_ts&&a.lat0&&"Polar_Stereographic"===a.projName&&(a.lat_ts=a.lat0,a.lat0=o(0<a.lat0?90:-90)):(a.lat0=o(0<a.lat1?90:-90),a.lat_ts=a.lat1)}function Ct(t){var t=new s(t).output(),e=t.shift(),i=t.shift(),i=(t.unshift(["name",i]),t.unshift(["type",e]),{});return Et(t,i),At(i),i}function n(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?n[t]=xt(arguments[1]):n[t]=Ct(arguments[1]):n[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?n.apply(e,t):n(t)});if("string"==typeof t){if(t in n)return n[t]}else"EPSG"in t?n["EPSG:"+t.EPSG]=t:"ESRI"in t?n["ESRI:"+t.ESRI]=t:"IAU2000"in t?n["IAU2000:"+t.IAU2000]=t:console.log(t)}}(e=n)("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"];var Nt=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var Tt=["3857","900913","3785","102113"];function Pt(t){var e,i,s;return"string"==typeof t?t in n?n[t]:(s=t,Nt.some(function(t){return-1<s.indexOf(t)})?function(t){if(t=g(t,"authority"))return(t=g(t,"epsg"))&&-1<Tt.indexOf(t)}(e=Ct(t))?n["EPSG:3857"]:(i=function(t){if(t=g(t,"extension"))return g(t,"proj4")}(e))?xt(i):e:"+"===t[0]?xt(t):void 0):t}function Ot(t,e){var i,s;if(t=t||{},e)for(s in e)void 0!==(i=e[s])&&(t[s]=i)}function r(t,e,i){t*=e;return i/Math.sqrt(1-t*t)}function It(t){return t<0?-1:1}function w(t){return Math.abs(t)<=d?t:t-It(t)*yt}function k(t,e,i){i*=t,i=Math.pow((1-i)/(1+i),.5*t);return Math.tan(.5*(f-e))/i}function Bt(t,e){for(var i,s=.5*t,a=f-2*Math.atan(e),n=0;n<=15;n++)if(i=t*Math.sin(a),a+=i=f-2*Math.atan(e*Math.pow((1-i)/(1+i),s))-a,Math.abs(i)<=1e-10)return a;return-9999}function zt(t){return t}var Ut=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,i,s=t.x,a=t.y;return 90<a*M&&a*M<-90&&180<s*M&&s*M<-180||Math.abs(Math.abs(a)-f)<=v?null:(i=this.sphere?(e=this.x0+this.a*this.k0*w(s-this.long0),this.y0+this.a*this.k0*Math.log(Math.tan(x+.5*a))):(i=Math.sin(a),a=k(this.e,a,i),e=this.x0+this.a*this.k0*w(s-this.long0),this.y0-this.a*this.k0*Math.log(a)),t.x=e,t.y=i,t)},inverse:function(t){var e=t.x-this.x0,i=t.y-this.y0;if(this.sphere)s=f-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var s,i=Math.exp(-i/(this.a*this.k0));if(-9999===(s=Bt(this.e,i)))return null}return i=w(this.long0+e/(this.a*this.k0)),t.x=i,t.y=s,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:zt,inverse:zt,names:["longlat","identity"]}],Rt={},qt=[];function Ft(t,e){var i=qt.length;return t.names?((qt[i]=t).names.forEach(function(t){Rt[t.toLowerCase()]=i}),this):(console.log(e),!0)}var e={start:function(){Ut.forEach(Ft)},add:Ft,get:function(t){return!!t&&(t=t.toLowerCase(),void 0!==Rt[t]&&qt[Rt[t]]?qt[Rt[t]]:void 0)}},Dt={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},Vt=Dt.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Dt.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var S={};S.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},S.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},S.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},S.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},S.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},S.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},S.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},S.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},S.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},S.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},S.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},S.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},S.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},S.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},S.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},S.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},S.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},S.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var $t={};function Wt(t){var e;return 0===t.length?null:"null"===(t=(e="@"===t[0])?t.slice(1):t)?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:$t[t]||null,isNull:!1}}function Ht(t){return t/3600*Math.PI/180}function Jt(t,e,i){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,i)))}function j(t,e){if(!(this instanceof j))return new j(t);e=e||function(t){if(t)throw t};var i,s,a,n,r,o,h,l,d,u,c,_,p=Pt(t);"object"==typeof p&&(i=j.projections.get(p.projName))?(p.datumCode&&"none"!==p.datumCode&&(s=g(S,p.datumCode))&&(p.datum_params=p.datum_params||(s.towgs84?s.towgs84.split(","):null),p.ellps=s.ellipse,p.datumName=s.datumName||p.datumCode),p.k0=p.k0||1,p.axis=p.axis||"enu",p.ellps=p.ellps||"wgs84",p.lat1=p.lat1||p.lat0,s=p.a,n=p.b,o=p.rf,a=p.ellps,h=p.sphere,s||(s=(a=(a=g(Dt,a))||Vt).a,n=a.b,o=a.rf),o&&!n&&(n=(1-1/o)*s),(0===o||Math.abs(s-n)<v)&&(h=!0,n=s),n=(a={a:s,b:n,rf:o,sphere:h}).a,o=a.b,h=p.R_A,l=((r=n*n)-(o=o*o))/r,c=0,h?(r=(n*=1-l*(gt+l*(ft+l*mt)))*n,l=0):c=Math.sqrt(l),n={es:l,e:c,ep2:h=(r-o)/o},c=void 0===(l=p.nadgrids)?null:l.split(",").map(Wt),r=p.datum||(r=p.datumCode,o=p.datum_params,h=a.a,l=a.b,d=n.es,u=n.ep2,c=c,(_={}).datum_type=void 0===r||"none"===r?dt:lt,o&&(_.datum_params=o.map(parseFloat),0===_.datum_params[0]&&0===_.datum_params[1]&&0===_.datum_params[2]||(_.datum_type=rt),3<_.datum_params.length)&&(0===_.datum_params[3]&&0===_.datum_params[4]&&0===_.datum_params[5]&&0===_.datum_params[6]||(_.datum_type=ot,_.datum_params[3]*=pt,_.datum_params[4]*=pt,_.datum_params[5]*=pt,_.datum_params[6]=_.datum_params[6]/1e6+1)),c&&(_.datum_type=ht,_.grids=c),_.a=h,_.b=l,_.es=d,_.ep2=u,_),Ot(this,p),Ot(this,i),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=n.es,this.e=n.e,this.ep2=n.ep2,this.datum=r,this.init(),e(null,this)):e(t)}function Zt(t,e,i){var s=t.x,a=t.y,n=t.z||0;if(a<-f&&-1.001*f<a)a=-f;else if(f<a&&a<1.001*f)a=f;else{if(a<-f)return{x:-1/0,y:-1/0,z:t.z};if(f<a)return{x:1/0,y:1/0,z:t.z}}return s>Math.PI&&(s-=2*Math.PI),t=Math.sin(a),a=Math.cos(a),{x:((i=i/Math.sqrt(1-e*(t*t)))+n)*a*Math.cos(s),y:(i+n)*a*Math.sin(s),z:(i*(1-e)+n)*t}}function Qt(t,e,i,s){var a,n,r,o,h,l,d,u,c,_,p,g=1e-12,f=t.x,m=t.y,y=t.z||0,v=Math.sqrt(f*f+m*m),b=Math.sqrt(f*f+m*m+y*y);if(v/i<g){if(_=0,b/i<g)return p=-s,{x:t.x,y:t.y,z:t.z}}else _=Math.atan2(m,f);for(a=y/b,o=(n=v/b)*(1-e)*(r=1/Math.sqrt(1-e*(2-e)*n*n)),h=a*r,c=0;c++,u=e*(u=i/Math.sqrt(1-e*h*h))/(u+(p=v*o+y*h-u*(1-e*h*h))),u=(d=a*(r=1/Math.sqrt(1-u*(2-u)*n*n)))*o-(l=n*(1-u)*r)*h,o=l,h=d,1e-24<u*u&&c<30;);return{x:_,y:Math.atan(d/Math.abs(l)),z:p}}function Kt(t){return t===rt||t===ot}function Xt(t,e,i){if((a=e,(s=t).datum_type!==a.datum_type||s.a!==a.a||5e-11<Math.abs(s.es-a.es)||(s.datum_type===rt?s.datum_params[0]!==a.datum_params[0]||s.datum_params[1]!==a.datum_params[1]||s.datum_params[2]!==a.datum_params[2]:s.datum_type===ot&&(s.datum_params[0]!==a.datum_params[0]||s.datum_params[1]!==a.datum_params[1]||s.datum_params[2]!==a.datum_params[2]||s.datum_params[3]!==a.datum_params[3]||s.datum_params[4]!==a.datum_params[4]||s.datum_params[5]!==a.datum_params[5]||s.datum_params[6]!==a.datum_params[6])))&&(t.datum_type!==dt&&e.datum_type!==dt)){var s=t.a,a=t.es;if(t.datum_type===ht){if(0!==Yt(t,!1,i))return;s=ut,a=_t}var n,r,o,h,l,d=e.a,u=e.b,c=e.es;if(e.datum_type===ht&&(d=ut,u=ct,c=_t),a!==c||s!==d||Kt(t.datum_type)||Kt(e.datum_type))if(i=Zt(i,a,s),Kt(t.datum_type)&&(a=i,s=t.datum_type,t=t.datum_params,i=s===rt?{x:a.x+t[0],y:a.y+t[1],z:a.z+t[2]}:s===ot?(s=t[0],r=t[1],l=t[2],h=t[3],o=t[4],n=t[5],{x:(t=t[6])*(a.x-n*a.y+o*a.z)+s,y:t*(n*a.x+a.y-h*a.z)+r,z:t*(-o*a.x+h*a.y+a.z)+l}):void 0),Kt(e.datum_type)&&(s=i,n=e.datum_type,r=e.datum_params,i=n===rt?{x:s.x-r[0],y:s.y-r[1],z:s.z-r[2]}:n===ot?(n=r[0],t=r[1],o=r[2],h=r[3],a=r[4],l=r[5],r=r[6],{x:(n=(s.x-n)/r)+l*(t=(s.y-t)/r)-a*(s=(s.z-o)/r),y:-l*n+t+h*s,z:a*n-h*t+s}):void 0),i=Qt(i,c,d,u),e.datum_type===ht)if(0!==Yt(e,!0,i))return}return i}function Yt(t,e,i){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;var s={x:-i.x,y:i.y},a={x:Number.NaN,y:Number.NaN},n=[];t:for(var r=0;r<t.grids.length;r++){var o=t.grids[r];if(n.push(o.name),o.isNull){a=s;break}if(o.mandatory,null===o.grid){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1}else for(var h=o.grid.subgrids,l=0,d=h.length;l<d;l++){var u=h[l],c=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,_=u.ll[0]-c,p=u.ll[1]-c,g=u.ll[0]+(u.lim[0]-1)*u.del[0]+c,c=u.ll[1]+(u.lim[1]-1)*u.del[1]+c;if(!(s.y<p||s.x<_||c<s.y||g<s.x)&&(a=function(t,e,i){var s={x:Number.NaN,y:Number.NaN};if(!isNaN(t.x)){var a={x:t.x,y:t.y},n=(a.x-=i.ll[0],a.y-=i.ll[1],a.x=w(a.x-Math.PI)+Math.PI,te(a,i));if(e){if(isNaN(n.x))return s;n.x=a.x-n.x,n.y=a.y-n.y;var r,o=9;do{if(r=te(n,i),isNaN(r.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}}while(r={x:a.x-(r.x+n.x),y:a.y-(r.y+n.y)},n.x+=r.x,n.y+=r.y,o--&&1e-12<Math.abs(r.x)&&1e-12<Math.abs(r.y));if(o<0)return console.log("Inverse grid shift iterator failed to converge."),s;s.x=w(n.x+i.ll[0]),s.y=n.y+i.ll[1]}else isNaN(n.x)||(s.x=t.x+n.x,s.y=t.y+n.y)}return s}(s,e,u),!isNaN(a.x)))break t}}return isNaN(a.x)?(console.log("Failed to find a grid shift table for location '"+-s.x*M+" "+s.y*M+" tried: '"+n+"'"),-1):(i.x=-a.x,i.y=a.y,0)}function te(t,e){var i,s,a,n,r,o,t={x:t.x/e.del[0],y:t.y/e.del[1]},h=Math.floor(t.x),l=Math.floor(t.y),d=t.x-+h,t=t.y-+l,u={x:Number.NaN,y:Number.NaN};return h<0||h>=e.lim[0]||l<0||l>=e.lim[1]||(l=l*e.lim[0]+h,h=e.cvs[l][0],i=e.cvs[l][1],o=e.cvs[++l][0],s=e.cvs[l][1],l+=e.lim[0],a=e.cvs[l][0],n=e.cvs[l][1],r=e.cvs[--l][0],e=e.cvs[l][1],u.x=(l=(1-d)*(1-t))*h+(h=d*(1-t))*o+(o=(1-d)*t)*r+(r=d*t)*a,u.y=l*i+h*s+o*e+r*n),u}function ee(t,e,i){for(var s,a,n=i.x,r=i.y,o=i.z||0,h={},l=0;l<3;l++)if(!e||2!==l||void 0!==i.z)switch(a=0===l?(s=n,-1!=="ew".indexOf(t.axis[l])?"x":"y"):1===l?(s=r,-1!=="ns".indexOf(t.axis[l])?"y":"x"):(s=o,"z"),t.axis[l]){case"e":h[a]=s;break;case"w":h[a]=-s;break;case"n":h[a]=s;break;case"s":h[a]=-s;break;case"u":void 0!==i[a]&&(h.z=s);break;case"d":void 0!==i[a]&&(h.z=-s);break;default:return null}return h}function ie(t){var e={x:t[0],y:t[1]};return 2<t.length&&(e.z=t[2]),3<t.length&&(e.m=t[3]),e}function se(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function ae(t,e,i,s){var a,n,r=void 0!==(i=Array.isArray(i)?ie(i):{x:i.x,y:i.y,z:i.z,m:i.m}).z;if(se((n=i).x),se(n.y),t.datum&&e.datum&&(n=e,((a=t).datum.datum_type===rt||a.datum.datum_type===ot||a.datum.datum_type===ht)&&"WGS84"!==n.datumCode||(n.datum.datum_type===rt||n.datum.datum_type===ot||n.datum.datum_type===ht)&&"WGS84"!==a.datumCode)&&(i=ae(t,n=new j("WGS84"),i,s),t=n),s&&"enu"!==t.axis&&(i=ee(t,!1,i)),"longlat"===t.projName)i={x:i.x*b,y:i.y*b,z:i.z||0};else if(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter,z:i.z||0}),!(i=t.inverse(i)))return;if(t.from_greenwich&&(i.x+=t.from_greenwich),i=Xt(t.datum,e.datum,i))return e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y,z:i.z||0}),"longlat"===e.projName?i={x:i.x*M,y:i.y*M,z:i.z||0}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter,z:i.z||0})),s&&"enu"!==e.axis?ee(e,!0,i):(i&&!r&&delete i.z,i)}(j.projections=e).start();var ne=j("WGS84");function re(e,i,s,t){var a,n;return Array.isArray(s)?(n=ae(e,i,s,t)||{x:NaN,y:NaN},2<s.length?void 0!==e.name&&"geocent"===e.name||void 0!==i.name&&"geocent"===i.name?("number"==typeof n.z?[n.x,n.y,n.z]:[n.x,n.y,s[2]]).concat(s.splice(3)):[n.x,n.y].concat(s.splice(2)):[n.x,n.y]):(a=ae(e,i,s,t),2!==(n=Object.keys(s)).length&&n.forEach(function(t){if(void 0!==e.name&&"geocent"===e.name||void 0!==i.name&&"geocent"===i.name){if("x"===t||"y"===t||"z"===t)return}else if("x"===t||"y"===t)return;a[t]=s[t]}),a)}function oe(t){return t instanceof j?t:t.oProj||j(t)}function i(i,s,t){i=oe(i);var e=!1;return void 0===s?(s=i,i=ne,e=!0):void 0===s.x&&!Array.isArray(s)||(t=s,s=i,i=ne,e=!0),s=oe(s),t?re(i,s,t):(t={forward:function(t,e){return re(i,s,t,e)},inverse:function(t,e){return re(s,i,t,e)}},e&&(t.oProj=s),t)}var he=6,le="AJSAJS",de="AFAFAF",ue=65,_=73,p=79,ce=86,_e=90,e={forward:pe,inverse:function(t){t=ye(be(t.toUpperCase()));if(t.lat&&t.lon)return[t.lon,t.lat,t.lon,t.lat];return[t.left,t.bottom,t.right,t.top]},toPoint:ge};function pe(t,e){return e=e||5,t=function(t){var e,i,s,a,n,r=t.lat,t=t.lon,o=.00669438,h=fe(r),l=fe(t);n=Math.floor((t+180)/6)+1,180===t&&(n=60);56<=r&&r<64&&3<=t&&t<12&&(n=32);72<=r&&r<84&&(0<=t&&t<9?n=31:9<=t&&t<21?n=33:21<=t&&t<33?n=35:33<=t&&t<42&&(n=37));t=fe(6*(n-1)-180+3),e=o/(1-o),i=6378137/Math.sqrt(1-o*Math.sin(h)*Math.sin(h)),s=Math.tan(h)*Math.tan(h),a=e*Math.cos(h)*Math.cos(h),l=Math.cos(h)*(l-t),t=6378137*(.9983242984503243*h-.002514607064228144*Math.sin(2*h)+2639046602129982e-21*Math.sin(4*h)-35*o*o*o/3072*Math.sin(6*h));o=.9996*i*(l+(1-s+a)*l*l*l/6+(5-18*s+s*s+72*a-58*e)*l*l*l*l*l/120)+5e5,t=.9996*(t+i*Math.tan(h)*(l*l/2+(5-s+9*a+4*a*a)*l*l*l*l/24+(61-58*s+s*s+600*a-330*e)*l*l*l*l*l*l/720));r<0&&(t+=1e7);return{northing:Math.round(t),easting:Math.round(o),zoneNumber:n,zoneLetter:function(t){var e="Z";t<=84&&72<=t?e="X":t<72&&64<=t?e="W":t<64&&56<=t?e="V":t<56&&48<=t?e="U":t<48&&40<=t?e="T":t<40&&32<=t?e="S":t<32&&24<=t?e="R":t<24&&16<=t?e="Q":t<16&&8<=t?e="P":t<8&&0<=t?e="N":t<0&&-8<=t?e="M":t<-8&&-16<=t?e="L":t<-16&&-24<=t?e="K":t<-24&&-32<=t?e="J":t<-32&&-40<=t?e="H":t<-40&&-48<=t?e="G":t<-48&&-56<=t?e="F":t<-56&&-64<=t?e="E":t<-64&&-72<=t?e="D":t<-72&&-80<=t&&(e="C");return e}(r)}}({lat:t[1],lon:t[0]}),e=e,i="00000"+t.easting,s="00000"+t.northing,t.zoneNumber+t.zoneLetter+function(t,e,i){i=ve(i),t=Math.floor(t/1e5),e=Math.floor(e/1e5)%20;return function(t,e,i){var i=i-1,s=le.charCodeAt(i),i=de.charCodeAt(i),t=s+t-1,e=i+e,a=!1;_e<t&&(t=t-_e+ue-1,a=!0);(t===_||s<_&&_<t||(_<t||s<_)&&a)&&t++;(t===p||s<p&&p<t||(p<t||s<p)&&a)&&++t===_&&t++;_e<t&&(t=t-_e+ue-1);a=ce<e&&(e=e-ce+ue-1,!0);(e===_||i<_&&_<e||(_<e||i<_)&&a)&&e++;(e===p||i<p&&p<e||(p<e||i<p)&&a)&&++e===_&&e++;ce<e&&(e=e-ce+ue-1);return String.fromCharCode(t)+String.fromCharCode(e)}(t,e,i)}(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,e)+s.substr(s.length-5,e);var i,s}function ge(t){t=ye(be(t.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function fe(t){return t*(Math.PI/180)}function me(t){return t/Math.PI*180}function ye(t){var e,i,s,a,n,r=t.northing,o=t.easting,h=t.zoneLetter,l=t.zoneNumber;return l<0||60<l?null:(n=6378137,o=o-5e5,r=r,h<"N"&&(r-=1e7),h=6*(l-1)-180+3,e=(l=.00669438)/(1-l),i=(r=r/.9996/6367449.145945056)+(3*(i=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)))/2-27*i*i*i/32)*Math.sin(2*r)+(21*i*i/16-55*i*i*i*i/32)*Math.sin(4*r)+151*i*i*i/96*Math.sin(6*r),r=n/Math.sqrt(1-l*Math.sin(i)*Math.sin(i)),s=Math.tan(i)*Math.tan(i),a=e*Math.cos(i)*Math.cos(i),n=n*(1-l)/Math.pow(1-l*Math.sin(i)*Math.sin(i),1.5),l=o/(.9996*r),o=me(o=i-r*Math.tan(i)/n*(l*l/2-(5+3*s+10*a-4*a*a-9*e)*l*l*l*l/24+(61+90*s+298*a+45*s*s-252*e-3*a*a)*l*l*l*l*l*l/720)),r=h+me(r=(l-(1+2*s+a)*l*l*l/6+(5-2*a+28*s-3*a*a+8*e+24*s*s)*l*l*l*l*l/120)/Math.cos(i)),t.accuracy?{top:(n=ye({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber})).lat,right:n.lon,bottom:o,left:r}:{lat:o,lon:r})}function ve(t){t%=he;return t=0===t?he:t}function be(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,s=null,a="",n=0;!/[A-Z]/.test(e=t.charAt(n));){if(2<=n)throw"MGRSPoint bad conversion from: "+t;a+=e,n++}var r=parseInt(a,10);if(0===n||i<n+3)throw"MGRSPoint bad conversion from: "+t;var o=t.charAt(n++);if(o<="A"||"B"===o||"Y"===o||"Z"<=o||"I"===o||"O"===o)throw"MGRSPoint zone letter "+o+" not handled: "+t;for(var s=t.substring(n,n+=2),h=ve(r),l=function(t,e){var i=le.charCodeAt(e-1),s=1e5,a=!1;for(;i!==t.charCodeAt(0);){if(++i===_&&i++,i===p&&i++,_e<i){if(a)throw"Bad character: "+t;i=ue,a=!0}s+=1e5}return s}(s.charAt(0),h),d=function(t,e){if("V"<t)throw"MGRSPoint given invalid Northing "+t;var i=de.charCodeAt(e-1),s=0,a=!1;for(;i!==t.charCodeAt(0);){if(++i===_&&i++,i===p&&i++,ce<i){if(a)throw"Bad character: "+t;i=ue,a=!0}s+=1e5}return s}(s.charAt(1),h);d<function(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}{if(0<=e)return e;throw"Invalid zone letter: "+t}}(o);)d+=2e6;s=i-n;if(s%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var u,c,h=s/2,i=0,s=0;return 0<h&&(u=1e5/Math.pow(10,h),c=t.substring(n,n+h),i=parseFloat(c)*u,c=t.substring(n+h),s=parseFloat(c)*u),{easting:i+l,northing:s+d,zoneLetter:o,zoneNumber:r,accuracy:u}}function Me(t,e,i){if(!(this instanceof Me))return new Me(t,e,i);var s;Array.isArray(t)?(this.x=t[0],this.y=t[1],this.z=t[2]||0):"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z||0):"string"==typeof t&&void 0===e?(s=t.split(","),this.x=parseFloat(s[0],10),this.y=parseFloat(s[1],10),this.z=parseFloat(s[2],10)||0):(this.x=t,this.y=e,this.z=i||0),console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Me.fromMGRS=function(t){return new Me(ge(t))},Me.prototype.toMGRS=function(t){return pe([this.x,this.y],t)};var xe=1,we=.25,Le=.046875,ke=.01953125,Se=.01068115234375,je=.75,Ge=.46875,Ee=.013020833333333334,Ae=.007120768229166667,Ce=.3645833333333333,Ne=.005696614583333333,Te=.3076171875;function Pe(t){var e=[],i=(e[0]=xe-t*(we+t*(Le+t*(ke+t*Se))),e[1]=t*(je-t*(Le+t*(ke+t*Se))),t*t);return e[2]=i*(Ge-t*(Ee+t*Ae)),e[3]=(i*=t)*(Ce-t*Ne),e[4]=i*t*Te,e}function Oe(t,e,i,s){return s[0]*t-(i*=e)*(s[1]+(e*=e)*(s[2]+e*(s[3]+e*s[4])))}var Ie=20;function Be(t,e,i){for(var s=1/(1-e),a=t,n=Ie;n;--n){var r=Math.sin(a),o=1-e*r*r;if(a-=o=(Oe(a,r,Math.cos(a),i)-t)*(o*Math.sqrt(o))*s,Math.abs(o)<v)return a}return a}var ze={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Pe(this.es),this.ml0=Oe(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e=t.x,i=t.y,e=w(e-this.long0),s=Math.sin(i),a=Math.cos(i);if(this.es)var n=a*e,r=Math.pow(n,2),o=this.ep2*Math.pow(a,2),h=Math.pow(o,2),l=Math.abs(a)>v?Math.tan(i):0,l=Math.pow(l,2),d=Math.pow(l,2),u=1-this.es*Math.pow(s,2),u=(n/=Math.sqrt(u),Oe(i,s,a,this.en)),c=this.a*(this.k0*n*(1+r/6*(1-l+o+r/20*(5-18*l+d+14*o-58*l*o+r/42*(61+179*d-d*l-479*l)))))+this.x0,u=this.a*(this.k0*(u-this.ml0+s*e*n/2*(1+r/12*(5-l+9*o+4*h+r/30*(61+d-58*l+270*o-330*l*o+r/56*(1385+543*d-d*l-3111*l))))))+this.y0;else{s=a*Math.sin(e);if(Math.abs(Math.abs(s)-1)<v)return 93;if(c=.5*this.a*this.k0*Math.log((1+s)/(1-s))+this.x0,u=a*Math.cos(e)/Math.sqrt(1-Math.pow(s,2)),1<=(s=Math.abs(u))){if(v<s-1)return 93;u=0}else u=Math.acos(u);u=this.a*this.k0*((u=i<0?-u:u)-this.lat0)+this.y0}return t.x=c,t.y=u,t},inverse:function(t){var e,i,s,a,n,r,o,h,l,d=(t.x-this.x0)*(1/this.a),u=(t.y-this.y0)*(1/this.a);return s=this.es?(o=Be(h=this.ml0+u/this.k0,this.es,this.en),Math.abs(o)<f?(n=Math.sin(o),e=Math.cos(o),l=Math.abs(e)>v?Math.tan(o):0,r=this.ep2*Math.pow(e,2),a=Math.pow(r,2),i=Math.pow(l,2),s=Math.pow(i,2),h=1-this.es*Math.pow(n,2),n=d*Math.sqrt(h)/this.k0,l=o-(h*=l)*(o=Math.pow(n,2))/(1-this.es)*.5*(1-o/12*(5+3*i-9*r*i+r-4*a-o/30*(61+90*i-252*r*i+45*s+46*r-o/56*(1385+3633*i+4095*s+1574*s*i)))),w(this.long0+n*(1-o/6*(1+2*i+r-o/20*(5+28*i+24*s+8*r*i+6*r-o/42*(61+662*i+1320*s+720*s*i))))/e)):(l=f*It(u),0)):(n=.5*((a=Math.exp(d/this.k0))-1/a),r=this.lat0+u/this.k0,o=Math.cos(r),h=Math.sqrt((1-Math.pow(o,2))/(1+Math.pow(n,2))),l=Math.asin(h),u<0&&(l=-l),0==n&&0===o?0:w(Math.atan2(n,o)+this.long0)),t.x=s,t.y=l,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function Ue(t){t=Math.exp(t);return(t-1/t)/2}function h(t,e){t=Math.abs(t),e=Math.abs(e);var i=Math.max(t,e),t=Math.min(t,e)/(i||1);return i*Math.sqrt(1+Math.pow(t,2))}function Re(t){var e,i,s,a=Math.abs(t);return e=a*(1+a/(h(1,a)+1)),a=0==(s=(i=1+e)-1)?e:e*Math.log(i)/s,t<0?-a:a}function qe(t,e){for(var i,s=2*Math.cos(2*e),a=t.length-1,n=t[a],r=0;0<=--a;)i=s*n-r+t[a],r=n,n=i;return e+i*Math.sin(2*e)}function Fe(t,e,i){for(var s,a,n=Math.sin(e),e=Math.cos(e),r=Ue(i),i=(i=i,((i=Math.exp(i))+1/i)/2),o=2*e*i,h=-2*n*r,l=t.length-1,d=t[l],u=0,c=0,_=0;0<=--l;)s=c,a=u,d=o*(c=d)-s-h*(u=_)+t[l],_=h*c-a+o*u;return[(o=n*i)*d-(h=e*r)*_,o*_+h*d]}var De={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(ze.init.apply(this),this.forward=ze.forward,this.inverse=ze.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=e=(e=this.es/(1+Math.sqrt(1-this.es)))/(2-e),e=(this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+-2854/675*e))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+4642/4725*e))))-2),this.cgb[1]=(t*=e)*(7/3+e*(e*(-227/45+e*(2704/315+2323/945*e))-1.6)),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+-1522/945*e)))),this.cgb[2]=(t*=e)*(56/15+e*(-136/35+e*(-1262/105+73814/2835*e))),this.cbg[2]=t*(-26/15+e*(34/21+e*(1.6+-12686/2835*e))),this.cgb[3]=(t*=e)*(4279/630+e*(-332/35+-399572/14175*e)),this.cbg[3]=t*(1237/630+e*(-24832/14175*e-2.4)),this.cgb[4]=(t*=e)*(4174/315+-144838/6237*e),this.cbg[4]=t*(-734/315+109598/31185*e),this.cgb[5]=601676/22275*(t*=e),this.cbg[5]=444337/155925*t,t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(.25+t*(1/64+t/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+-96199/604800*e))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+7891/37800*e))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+1118711/3870720*e)))),this.gtu[1]=t*(13/48+e*(e*(557/1440+e*(281/630+-1983433/1935360*e))-.6)),this.utg[2]=(t*=e)*(-17/480+e*(37/840+e*(209/4480+-5569/90720*e))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+167603/181440*e))),this.utg[3]=(t*=e)*(-4397/161280+e*(11/504+830251/7257600*e)),this.gtu[3]=t*(49561/161280+e*(-179/168+6601661/7257600*e)),this.utg[4]=(t*=e)*(-4583/161280+108847/3991680*e),this.gtu[4]=t*(34729/80640+-3418889/1995840*e),this.utg[5]=-.03233083094085698*(t*=e),this.gtu[5]=.6650675310896665*t,qe(this.cbg,this.lat0));this.Zb=-this.Qn*(e+function(t,e){for(var i,s=2*Math.cos(e),a=t.length-1,n=t[a],r=0;0<=--a;)i=s*n-r+t[a],r=n,n=i;return Math.sin(e)*i}(this.gtu,2*e))},forward:function(t){var e,i=w(t.x-this.long0),s=t.y,s=qe(this.cbg,s),a=Math.sin(s),n=Math.cos(s),r=Math.sin(i),o=Math.cos(i),r=(s=Math.atan2(a,o*n),i=Math.atan2(r*n,h(a,n*o)),i=Re(Math.tan(i)),Fe(this.gtu,2*s,2*i));return s+=r[0],i+=r[1],a=Math.abs(i)<=2.623395162778?(e=this.a*(this.Qn*i)+this.x0,this.a*(this.Qn*s+this.Zb)+this.y0):e=1/0,t.x=e,t.y=a,t},inverse:function(t){var e,i,s,a,n=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);return r=(r-this.Zb)/this.Qn,n/=this.Qn,a=Math.abs(n)<=2.623395162778?(r+=(s=Fe(this.utg,2*r,2*n))[0],n+=s[1],n=Math.atan(Ue(n)),s=Math.sin(r),e=Math.cos(r),a=Math.sin(n),i=Math.cos(n),r=Math.atan2(s*i,h(a,i*e)),s=w((n=Math.atan2(a,i*e))+this.long0),qe(this.cgb,r)):s=1/0,t.x=s,t.y=a,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]};var Ve={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(w(e)+Math.PI)/Math.PI)+1)<0)return 0;if(60<t)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*b,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,De.init.apply(this),this.forward=De.forward,this.inverse=De.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function $e(t,e){return Math.pow((1-t)/(1+t),e)}var We={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+x)/(Math.pow(Math.tan(.5*this.lat0+x),this.C)*$e(this.e*t,this.ratexp))},forward:function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+x),this.C)*$e(this.e*Math.sin(i),this.ratexp))-f,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,i=t.y,s=Math.pow(Math.tan(.5*i+x)/this.K,1/this.C),a=20;0<a&&(i=2*Math.atan(s*$e(this.e*Math.sin(t.y),-.5*this.e))-f,!(Math.abs(i-t.y)<1e-14));--a)t.y=i;return a?(t.x=e,t.y=i,t):null},names:["gauss"]};var He={init:function(){We.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,i,s,a;return t.x=w(t.x-this.long0),We.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),s=Math.cos(t.x),a=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*s),t.x=a*i*Math.sin(t.x),t.y=a*(this.cosc0*e-this.sinc0*i*s),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,i,s,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=(a=h(t.x,t.y))?(i=2*Math.atan2(a,this.R2),e=Math.sin(i),i=Math.cos(i),s=Math.asin(i*this.sinc0+t.y*e*this.cosc0/a),Math.atan2(t.x*e,a*this.cosc0*i-t.y*this.sinc0*e)):(s=this.phic0,0),t.x=a,t.y=s,We.inverse.apply(this,[t]),t.x=w(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var Je={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=v&&(this.k0=.5*(1+It(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=v&&(0<this.lat0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=v&&Math.abs(Math.cos(this.lat_ts))>v&&(this.k0=.5*this.cons*r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/k(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=r(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-f,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,i,s=t.x,a=t.y,n=Math.sin(a),r=Math.cos(a),o=w(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=v&&Math.abs(a+this.lat0)<=v?(t.x=NaN,t.y=NaN):this.sphere?(e=2*this.k0/(1+this.sinlat0*n+this.coslat0*r*Math.cos(o)),t.x=this.a*e*r*Math.sin(o)+this.x0,t.y=this.a*e*(this.coslat0*n-this.sinlat0*r*Math.cos(o))+this.y0):(r=2*Math.atan(this.ssfn_(a,n,this.e))-f,i=Math.cos(r),r=Math.sin(r),Math.abs(this.coslat0)<=v?(a=k(this.e,a*this.con,this.con*n),n=2*this.a*this.k0*a/this.cons,t.x=this.x0+n*Math.sin(s-this.long0),t.y=this.y0-this.con*n*Math.cos(s-this.long0)):(Math.abs(this.sinlat0)<v?(e=2*this.a*this.k0/(1+i*Math.cos(o)),t.y=e*r):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*i*Math.cos(o))),t.y=e*(this.cosX0*r-this.sinX0*i*Math.cos(o))+this.y0),t.x=e*i*Math.sin(o)+this.x0)),t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,s,a,n=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere)i=2*Math.atan(n/(2*this.a*this.k0)),s=this.long0,a=this.lat0,n<=v||(a=Math.asin(Math.cos(i)*this.sinlat0+t.y*Math.sin(i)*this.coslat0/n),s=Math.abs(this.coslat0)<v?0<this.lat0?w(this.long0+Math.atan2(t.x,-1*t.y)):w(this.long0+Math.atan2(t.x,t.y)):w(this.long0+Math.atan2(t.x*Math.sin(i),n*this.coslat0*Math.cos(i)-t.y*this.sinlat0*Math.sin(i))));else if(Math.abs(this.coslat0)<=v){if(n<=v)return a=this.lat0,s=this.long0,t.x=s,t.y=a,t;t.x*=this.con,t.y*=this.con,i=n*this.cons/(2*this.a*this.k0),a=this.con*Bt(this.e,i),s=this.con*w(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else i=2*Math.atan(n*this.cosX0/(2*this.a*this.k0*this.ms1)),s=this.long0,n<=v?e=this.X0:(e=Math.asin(Math.cos(i)*this.sinX0+t.y*Math.sin(i)*this.cosX0/n),s=w(this.long0+Math.atan2(t.x*Math.sin(i),n*this.cosX0*Math.cos(i)-t.y*this.sinX0*Math.sin(i)))),a=-1*Bt(this.e,Math.tan(.5*(f+e)));return t.x=s,t.y=a,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(t,e,i){return e*=i,Math.tan(.5*(f+t))*Math.pow((1-e)/(1+e),.5*i)}};var Ze={init:function(){var t=this.lat0,e=(this.lambda0=this.long0,Math.sin(t)),i=this.a,s=2*(s=1/this.rf)-Math.pow(s,2),a=this.e=Math.sqrt(s),i=(this.R=this.k0*i*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha),Math.log(Math.tan(Math.PI/4+this.b0/2))),s=Math.log(Math.tan(Math.PI/4+t/2)),t=Math.log((1+a*e)/(1-a*e));this.K=i-this.alpha*s+this.alpha*a/2*t},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),e=-this.alpha*(e+i)+this.K,i=2*(Math.atan(Math.exp(e))-Math.PI/4),e=this.alpha*(t.x-this.lambda0),s=Math.atan(Math.sin(e)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(e))),i=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(e));return t.y=this.R/2*Math.log((1+Math.sin(i))/(1-Math.sin(i)))+this.y0,t.x=this.R*s+this.x0,t},inverse:function(t){for(var e,i=t.x-this.x0,s=t.y-this.y0,i=i/this.R,s=2*(Math.atan(Math.exp(s/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(i)),i=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(s))),s=this.lambda0+i/this.alpha,n=a,r=-1e3,o=0;1e-7<Math.abs(n-r);){if(20<++o)return;e=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(n))/2)),r=n,n=2*Math.atan(Math.exp(e))-Math.PI/2}return t.x=s,t.y=n,t},names:["somerc"]},Qe=1e-7;var Ke={init:function(){var t,e,i,s,a,n=0,r=0,o=0,h=0,l=0,d=0,u=0,c=(this.no_off=(_="object"==typeof(c=this).PROJECTION?Object.keys(c.PROJECTION)[0]:c.PROJECTION,"no_uoff"in c||"no_off"in c||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(_)),this.no_rot="no_rot"in this,!1),_=("alpha"in this&&(c=!0),!1);if("rectified_grid_angle"in this&&(_=!0),c&&(u=this.alpha),_&&(n=this.rectified_grid_angle*b),c||_)r=this.longc;else if(o=this.long1,l=this.lat1,h=this.long2,d=this.lat2,Math.abs(l-d)<=Qe||(t=Math.abs(l))<=Qe||Math.abs(t-f)<=Qe||Math.abs(Math.abs(this.lat0)-f)<=Qe||Math.abs(Math.abs(d)-f)<=Qe)throw new Error;var p=1-this.es,g=Math.sqrt(p);Math.abs(this.lat0)>v?(s=Math.sin(this.lat0),e=Math.cos(this.lat0),t=1-this.es*s*s,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/p),this.A=this.B*this.k0*g/t,(i=(e=this.B*g/(e*Math.sqrt(t)))*e-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=e,this.E*=Math.pow(k(this.e,this.lat0,s),this.B)):(this.B=1/g,this.A=this.k0,this.E=e=i=1),c||_?(c?(a=Math.asin(Math.sin(u)/e),_||(n=u)):(a=n,u=Math.asin(e*Math.sin(a))),this.lam0=r-Math.asin(.5*(i-1/i)*Math.tan(a))/this.B):(p=Math.pow(k(this.e,l,Math.sin(l)),this.B),s=Math.pow(k(this.e,d,Math.sin(d)),this.B),i=this.E/p,g=(s-p)/(s+p),c=this.E*this.E,(t=o-h)<-Math.pi?h-=yt:t>Math.pi&&(h+=yt),this.lam0=w(.5*(o+h)-Math.atan((c-s*p)/(c+s*p)*Math.tan(.5*this.B*(o-h))/g)/this.B),a=Math.atan(2*Math.sin(this.B*w(o-this.lam0))/(i-1/i)),n=u=Math.asin(e*Math.sin(a))),this.singam=Math.sin(a),this.cosgam=Math.cos(a),this.sinrot=Math.sin(n),this.cosrot=Math.cos(n),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(e*e-1)/Math.cos(u))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*a,this.v_pole_n=this.ArB*Math.log(Math.tan(x-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(x+i))},forward:function(t){var e,i,s,a,n={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-f)>v){if(s=.5*((a=this.E/Math.pow(k(this.e,t.y,Math.sin(t.y)),this.B))-(i=1/a)),a=.5*(a+i),e=Math.sin(this.B*t.x),a=(s*this.singam-e*this.cosgam)/a,Math.abs(Math.abs(a)-1)<v)throw new Error;a=.5*this.ArB*Math.log((1-a)/(1+a)),i=Math.cos(this.B*t.x),s=Math.abs(i)<Qe?this.A*t.x:this.ArB*Math.atan2(s*this.cosgam+e*this.singam,i)}else a=0<t.y?this.v_pole_n:this.v_pole_s,s=this.ArB*t.y;return this.no_rot?(n.x=s,n.y=a):(s-=this.u_0,n.x=a*this.cosrot+s*this.sinrot,n.y=s*this.cosrot-a*this.sinrot),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n},inverse:function(t){var e,i,s,a={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),t=this.no_rot?(s=t.y,t.x):(s=t.x*this.cosrot-t.y*this.sinrot,t.y*this.cosrot+t.x*this.sinrot+this.u_0),e=.5*((s=Math.exp(-this.BrA*s))-1/s),s=.5*(s+1/s),s=((i=Math.sin(this.BrA*t))*this.cosgam+e*this.singam)/s,Math.abs(Math.abs(s)-1)<v)a.x=0,a.y=s<0?-f:f;else{if(a.y=this.E/Math.sqrt((1+s)/(1-s)),a.y=Bt(this.e,Math.pow(a.y,1/this.B)),a.y===1/0)throw new Error;a.x=-this.rB*Math.atan2(e*this.cosgam-i*this.singam,Math.cos(this.BrA*t))}return a.x+=this.lam0,a},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};var Xe={init:function(){var t,e,i,s,a,n;this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,Math.abs(this.lat1+this.lat2)<v||(t=this.b/this.a,this.e=Math.sqrt(1-t*t),t=Math.sin(this.lat1),e=Math.cos(this.lat1),e=r(this.e,t,e),i=k(this.e,this.lat1,t),a=Math.sin(this.lat2),s=Math.cos(this.lat2),s=r(this.e,a,s),a=k(this.e,this.lat2,a),n=k(this.e,this.lat0,Math.sin(this.lat0)),Math.abs(this.lat1-this.lat2)>v?this.ns=Math.log(e/s)/Math.log(i/a):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=e/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(n,this.ns),this.title)||(this.title="Lambert Conformal Conic")},forward:function(t){var e,i=t.x,s=t.y,a=(Math.abs(2*Math.abs(s)-Math.PI)<=v&&(s=It(s)*(f-2*v)),Math.abs(Math.abs(s)-f));if(v<a)a=k(this.e,s,Math.sin(s)),e=this.a*this.f0*Math.pow(a,this.ns);else{if(s*this.ns<=0)return null;e=0}return a=this.ns*w(i-this.long0),t.x=this.k0*(e*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-e*Math.cos(a))+this.y0,t},inverse:function(t){var e,i,s=(t.x-this.x0)/this.k0,a=this.rh-(t.y-this.y0)/this.k0,n=0<this.ns?(e=Math.sqrt(s*s+a*a),1):(e=-Math.sqrt(s*s+a*a),-1),r=0;if(0!==e&&(r=Math.atan2(n*s,n*a)),0!==e||0<this.ns){if(n=1/this.ns,s=Math.pow(e/(this.a*this.f0),n),-9999===(i=Bt(this.e,s)))return null}else i=-f;return a=w(r/this.ns+this.long0),t.x=a,t.y=i,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]};var Ye={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e=t.x,i=t.y,e=w(e-this.long0),s=Math.pow((1+this.e*Math.sin(i))/(1-this.e*Math.sin(i)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(i/2+this.s45),this.alfa)/s)-this.s45),s=-e*this.alfa,e=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),i=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(e)),s=this.n*i,i=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(e/2+this.s45),this.n);return t.y=i*Math.cos(s),t.x=i*Math.sin(s),this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){for(var e,i,s,a,n=t.x,r=(t.x=t.y,t.y=n,this.czech||(t.y*=-1,t.x*=-1),n=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/n,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),n=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(e)),t.x=this.long0-n/this.alfa,s=e,a=0);t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-t.y)<1e-10&&(a=1),s=t.y,r+=1,0===a&&r<15;);return 15<=r?null:t},names:["Krovak","krovak"]};function E(t,e,i,s,a){return t*a-e*Math.sin(2*a)+i*Math.sin(4*a)-s*Math.sin(6*a)}function ti(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function ei(t){return.375*t*(1+.25*t*(1+.46875*t))}function ii(t){return.05859375*t*t*(1+.75*t)}function si(t){return t*t*t*(35/3072)}function ai(t,e,i){e*=i;return t/Math.sqrt(1-e*e)}function ni(t){return Math.abs(t)<f?t:t-It(t)*Math.PI}function ri(t,e,i,s,a){for(var n,r=t/e,o=0;o<15;o++)if(r+=n=(t-(e*r-i*Math.sin(2*r)+s*Math.sin(4*r)-a*Math.sin(6*r)))/(e-2*i*Math.cos(2*r)+4*s*Math.cos(4*r)-6*a*Math.cos(6*r)),Math.abs(n)<=1e-10)return r;return NaN}var oi={init:function(){this.sphere||(this.e0=ti(this.es),this.e1=ei(this.es),this.e2=ii(this.es),this.e3=si(this.es),this.ml0=this.a*E(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,i,s,a,n,r,o=t.x,h=t.y,o=w(o-this.long0);return h=this.sphere?(r=this.a*Math.asin(Math.cos(h)*Math.sin(o)),this.a*(Math.atan2(Math.tan(h),Math.cos(o))-this.lat0)):(e=Math.sin(h),i=Math.cos(h),s=ai(this.a,this.e,e),a=Math.tan(h)*Math.tan(h),r=s*(o=o*Math.cos(h))*(1-(o=o*o)*a*(1/6-(8-a+8*(n=this.es*i*i/(1-this.es)))*o/120)),this.a*E(this.e0,this.e1,this.e2,this.e3,h)-this.ml0+s*e/i*o*(.5+(5-a+6*n)*o/24)),t.x=r+this.x0,t.y=h+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=t.x/this.a,i=t.y/this.a;if(this.sphere)var s=i+this.lat0,a=Math.asin(Math.sin(s)*Math.cos(e)),s=Math.atan2(Math.tan(e),Math.cos(s));else{var n=ri(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(n)-f)<=v)return t.x=this.long0,t.y=f,i<0&&(t.y*=-1),t;var i=ai(this.a,this.e,Math.sin(n)),r=i*i*i/this.a/this.a*(1-this.es),o=Math.pow(Math.tan(n),2),e=e*this.a/i,h=e*e;a=n-i*Math.tan(n)/r*e*e*(.5-(1+3*o)*e*e/24),s=e*(1-h*(o/3+(1+3*o)*o*h/15))/Math.cos(n)}return t.x=w(s+this.long0),t.y=ni(a),t},names:["Cassini","Cassini_Soldner","cass"]};function hi(t,e){var i;return 1e-7<t?(1-t*t)*(e/(1-(i=t*e)*i)-.5/t*Math.log((1-i)/(1+i))):2*e}var li=.3333333333333333,di=.17222222222222222,ui=.10257936507936508,ci=.06388888888888888,_i=.0664021164021164,pi=.016415012942191543;var gi={init:function(){var t,e,i,s=Math.abs(this.lat0);if(Math.abs(s-f)<v?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(s)<v?this.mode=this.EQUIT:this.mode=this.OBLIQ,0<this.es)switch(this.qp=hi(this.e,1),this.mmf=.5/(1-this.es),this.apa=(s=this.es,(i=[])[0]=s*li,i[0]+=(e=s*s)*di,i[1]=e*ci,i[0]+=(e*=s)*ui,i[1]+=e*_i,i[2]=e*pi,i),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=hi(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,i,s,a,n,r,o,h,l,d,u=t.x,c=t.y,u=w(u-this.long0);if(this.sphere){if(n=Math.sin(c),d=Math.cos(c),s=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+d*s:1+this.sinph0*n+this.cosph0*d*s)<=v)return null;e=(i=Math.sqrt(2/i))*d*Math.sin(u),i*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*d*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(c+this.lat0)<v)return null;i=x-.5*c,e=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(u),i*=s}}else{switch(l=h=o=0,s=Math.cos(u),a=Math.sin(u),n=Math.sin(c),r=hi(this.e,n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=r/this.qp,h=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:l=1+this.sinb1*o+this.cosb1*h*s;break;case this.EQUIT:l=1+h*s;break;case this.N_POLE:l=f+c,r=this.qp-r;break;case this.S_POLE:l=c-f,r=this.qp+r}if(Math.abs(l)<v)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),i=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*o-this.sinb1*h*s):(l=Math.sqrt(2/(1+h*s)))*o*this.ymf,e=this.xmf*l*h*a;break;case this.N_POLE:case this.S_POLE:0<=r?(e=(l=Math.sqrt(r))*a,i=s*(this.mode===this.S_POLE?l:-l)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,s,a,n,r,o=t.x/this.a,h=t.y/this.a;if(this.sphere){var l,d=0,u=0,c=Math.sqrt(o*o+h*h);if(1<(l=.5*c))return null;switch(l=2*Math.asin(l),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(u=Math.sin(l),d=Math.cos(l)),this.mode){case this.EQUIT:l=Math.abs(c)<=v?0:Math.asin(h*u/c),o*=u,h=d*c;break;case this.OBLIQ:l=Math.abs(c)<=v?this.lat0:Math.asin(d*this.sinph0+h*u*this.cosph0/c),o*=u*this.cosph0,h=(d-Math.sin(l)*this.sinph0)*c;break;case this.N_POLE:h=-h,l=f-l;break;case this.S_POLE:l-=f}e=0!==h||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(o,h):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(o/=this.dd,h*=this.dd,(n=Math.sqrt(o*o+h*h))<v)return t.x=this.long0,t.y=this.lat0,t;a=2*Math.asin(.5*n/this.rq),r=Math.cos(a),o*=a=Math.sin(a),h=this.mode===this.OBLIQ?(s=r*this.sinb1+h*a*this.cosb1/n,i=this.qp*s,n*this.cosb1*r-h*this.sinb1*a):(i=this.qp*(s=h*a/n),n*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(!(i=o*o+(h=this.mode===this.N_POLE?-h:h)*h))return t.x=this.long0,t.y=this.lat0,t;s=1-i/this.qp,this.mode===this.S_POLE&&(s=-s)}e=Math.atan2(o,h),a=Math.asin(s),n=this.apa,r=a+a,l=a+n[0]*Math.sin(r)+n[1]*Math.sin(r+r)+n[2]*Math.sin(r+r+r)}return t.x=w(this.long0+e),t.y=l,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function fi(t){return 1<Math.abs(t)&&(t=1<t?1:-1),Math.asin(t)}var mi={init:function(){Math.abs(this.lat1+this.lat2)<v||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=r(this.e3,this.sin_po,this.cos_po),this.qs1=hi(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=r(this.e3,this.sin_po,this.cos_po),this.qs2=hi(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=hi(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>v?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,i=t.y,i=(this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i),hi(this.e3,this.sin_phi)),i=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,e=this.ns0*w(e-this.long0),s=i*Math.sin(e)+this.x0,i=this.rh-i*Math.cos(e)+this.y0;return t.x=s,t.y=i,t},inverse:function(t){var e,i,s;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,s=0<=this.ns0?(i=Math.sqrt(t.x*t.x+t.y*t.y),1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),-1),(e=0)!==i&&(e=Math.atan2(s*t.x,s*t.y)),s=i*this.ns0/this.a,s=this.sphere?Math.asin((this.c-s*s)/(2*this.ns0)):(i=(this.c-s*s)/this.ns0,this.phi1z(this.e3,i)),i=w(e/this.ns0+this.long0),t.x=i,t.y=s,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var i,s,a,n=fi(.5*e);if(t<v)return n;for(var r=t*t,o=1;o<=25;o++)if(n+=a=.5*(s=1-(i=t*(a=Math.sin(n)))*i)*s/Math.cos(n)*(e/(1-r)-a/s+.5/t*Math.log((1-i)/(1+i))),Math.abs(a)<=1e-7)return n;return null}};var yi={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,i=t.x,s=t.y,i=w(i-this.long0),a=Math.sin(s),s=Math.cos(s),n=Math.cos(i),r=0<(r=this.sin_p14*a+this.cos_p14*s*n)||Math.abs(r)<=v?(e=this.x0+ +this.a*s*Math.sin(i)/r,this.y0+ +this.a*(this.cos_p14*a-this.sin_p14*s*n)/r):(e=this.x0+this.infinity_dist*s*Math.sin(i),this.y0+this.infinity_dist*(this.cos_p14*a-this.sin_p14*s*n));return t.x=e,t.y=r,t},inverse:function(t){var e,i,s,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,s=(e=Math.sqrt(t.x*t.x+t.y*t.y))?(s=Math.atan2(e,this.rc),i=Math.sin(s),a=fi((s=Math.cos(s))*this.sin_p14+t.y*i*this.cos_p14/e),s=Math.atan2(t.x*i,e*this.cos_p14*s-t.y*this.sin_p14*i),w(this.long0+s)):(a=this.phic0,0),t.x=s,t.y=a,t},names:["gnom"]};var vi={init:function(){this.sphere||(this.k0=r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,i=t.x,s=t.y,i=w(i-this.long0);return i=this.sphere?(e=this.x0+this.a*i*Math.cos(this.lat_ts),this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts)):(s=hi(this.e,Math.sin(s)),e=this.x0+this.a*this.k0*i,this.y0+this.a*s*.5/this.k0),t.x=e,t.y=i,t},inverse:function(t){var e,i;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=w(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*f:f;for(var s,a,n,r=Math.asin(.5*e),o=0;o<30;o++)if(s=Math.sin(r),a=Math.cos(r),n=t*s,r+=a=Math.pow(1-n*n,2)/(2*a)*(e/(1-t*t)-s/(1-n*n)+.5/t*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-10)return r;return NaN}(this.e,2*t.y*this.k0/this.a),e=w(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},names:["cea"]};var bi={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,i=t.y,e=w(e-this.long0),i=ni(i-this.lat0);return t.x=this.x0+this.a*e*this.rc,t.y=this.y0+this.a*i,t},inverse:function(t){var e=t.x,i=t.y;return t.x=w(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=ni(this.lat0+(i-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var Mi={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ti(this.es),this.e1=ei(this.es),this.e2=ii(this.es),this.e3=si(this.es),this.ml0=this.a*E(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,i=t.x,s=t.y,a=(i=w(i-this.long0))*Math.sin(s);return s=this.sphere?Math.abs(s)<=v?(e=this.a*i,-1*this.a*this.lat0):(e=this.a*Math.sin(a)/Math.tan(s),this.a*(ni(s-this.lat0)+(1-Math.cos(a))/Math.tan(s))):Math.abs(s)<=v?(e=this.a*i,-1*this.ml0):(e=(i=ai(this.a,this.e,Math.sin(s))/Math.tan(s))*Math.sin(a),this.a*E(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+i*(1-Math.cos(a))),t.x=e+this.x0,t.y=s+this.y0,t},inverse:function(t){var e,i,s,a,n,r,o=t.x-this.x0,h=t.y-this.y0;if(this.sphere)if(Math.abs(h+this.a*this.lat0)<=v)e=w(o/this.a+this.long0),i=0;else{for(var l,d=this.lat0+h/this.a,u=o*o/this.a/this.a+d*d,c=d,_=20;_;--_)if(c+=s=-1*(d*(c*(l=Math.tan(c))+1)-c-.5*(c*c+u)*l)/((c-d)/l-1),Math.abs(s)<=v){i=c;break}e=w(this.long0+Math.asin(o*Math.tan(c)/this.a)/Math.sin(i))}else if(Math.abs(h+this.ml0)<=v)i=0,e=w(this.long0+o/this.a);else{for(d=(this.ml0+h)/this.a,u=o*o/this.a/this.a+d*d,c=d,_=20;_;--_)if(r=this.e*Math.sin(c),a=Math.sqrt(1-r*r)*Math.tan(c),r=this.a*E(this.e0,this.e1,this.e2,this.e3,c),n=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),c-=s=(d*(a*(r=r/this.a)+1)-r-.5*a*(r*r+u))/(this.es*Math.sin(2*c)*(r*r+u-2*d*r)/(4*a)+(d-r)*(a*n-2/Math.sin(2*c))-n),Math.abs(s)<=v){i=c;break}a=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=w(this.long0+Math.asin(o*a/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},names:["Polyconic","poly"]};var xi={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){for(var e=t.x,i=t.y-this.lat0,e=e-this.long0,s=i/pt*1e-5,i=e,a=1,n=0,r=1;r<=10;r++)n+=this.A[r]*(a*=s);var o,h=n,l=i,d=1,u=0,c=0,_=0;for(r=1;r<=6;r++)o=u*h+d*l,c=c+this.B_re[r]*(d=d*h-u*l)-this.B_im[r]*(u=o),_=_+this.B_im[r]*d+this.B_re[r]*u;return t.x=_*this.a+this.x0,t.y=c*this.a+this.y0,t},inverse:function(t){var e,i=t.x,s=t.y,i=i-this.x0,a=(s-this.y0)/this.a,n=i/this.a,r=1,o=0,h=0,l=0;for(f=1;f<=6;f++)e=o*a+r*n,h=h+this.C_re[f]*(r=r*a-o*n)-this.C_im[f]*(o=e),l=l+this.C_im[f]*r+this.C_re[f]*o;for(var d=0;d<this.iterations;d++){for(var u,c=h,_=l,p=a,g=n,f=2;f<=6;f++)u=_*h+c*l,c=c*h-_*l,_=u,p+=(f-1)*(this.B_re[f]*c-this.B_im[f]*_),g+=(f-1)*(this.B_im[f]*c+this.B_re[f]*_);var c=1,_=0,m=this.B_re[1],y=this.B_im[1];for(f=2;f<=6;f++)u=_*h+c*l,c=c*h-_*l,_=u,m+=f*(this.B_re[f]*c-this.B_im[f]*_),y+=f*(this.B_im[f]*c+this.B_re[f]*_);var v=m*m+y*y,h=(p*m+g*y)/v,l=(g*m-p*y)/v}var b=h,s=l,M=1,x=0;for(f=1;f<=9;f++)x+=this.D[f]*(M*=b);return i=this.lat0+x*pt*1e5,s=this.long0+s,t.x=s,t.y=i,t},names:["New_Zealand_Map_Grid","nzmg"]};var wi={init:function(){},forward:function(t){var e=t.x,i=t.y,e=w(e-this.long0),e=this.x0+this.a*e,i=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=e,t.y=i,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=w(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},names:["Miller_Cylindrical","mill"]};var Li={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Pe(this.es)},forward:function(t){var e=t.x,i=t.y,e=w(e-this.long0);if(this.sphere){if(this.m)for(var s=this.n*Math.sin(i),a=20;a;--a){var n=(this.m*i+Math.sin(i)-s)/(this.m+Math.cos(i));if(i-=n,Math.abs(n)<v)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;l=this.a*this.C_x*e*(this.m+Math.cos(i)),h=this.a*this.C_y*i}else var r=Math.sin(i),o=Math.cos(i),h=this.a*Oe(i,r,o,this.en),l=this.a*e*o/Math.sqrt(1-this.es*r*r);return t.x=l,t.y=h,t},inverse:function(t){var e,i,s;return t.x-=this.x0,i=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,i/=this.C_x*(this.m+Math.cos(e)),this.m?e=fi((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=fi(Math.sin(e)/this.n)),i=w(i+this.long0),e=ni(e)):(e=Be(t.y/this.a,this.es,this.en),(s=Math.abs(e))<f?(s=Math.sin(e),i=w(this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)))):s-v<f&&(i=this.long0)),t.x=i,t.y=e,t},names:["Sinusoidal","sinu"]};var ki={init:function(){},forward:function(t){for(var e=t.x,i=t.y,e=w(e-this.long0),s=i,a=Math.PI*Math.sin(i);;){var n=-(s+Math.sin(s)-a)/(1+Math.cos(s));if(s+=n,Math.abs(n)<v)break}return s/=2,Math.PI/2-Math.abs(i)<v&&(e=0),i=.900316316158*this.a*e*Math.cos(s)+this.x0,e=1.4142135623731*this.a*Math.sin(s)+this.y0,t.x=i,t.y=e,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0,e=t.y/(1.4142135623731*this.a),.999999999999<Math.abs(e)&&(e=.999999999999),s=Math.asin(e);var e,i=w(this.long0+t.x/(.900316316158*this.a*Math.cos(s))),s=((i=i<-Math.PI?-Math.PI:i)>Math.PI&&(i=Math.PI),e=(2*s+Math.sin(2*s))/Math.PI,1<Math.abs(e)&&(e=1),Math.asin(e));return t.x=i,t.y=s,t},names:["Mollweide","moll"]};var Si={init:function(){Math.abs(this.lat1+this.lat2)<v||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ti(this.es),this.e1=ei(this.es),this.e2=ii(this.es),this.e3=si(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=r(this.e,this.sinphi,this.cosphi),this.ml1=E(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<v?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=r(this.e,this.sinphi,this.cosphi),this.ml2=E(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=E(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e=t.x,i=t.y,e=(i=this.sphere?this.a*(this.g-i):(i=E(this.e0,this.e1,this.e2,this.e3,i),this.a*(this.g-i)),this.ns*w(e-this.long0)),s=this.x0+i*Math.sin(e),i=this.y0+this.rh-i*Math.cos(e);return t.x=s,t.y=i,t},inverse:function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0,e=0<=this.ns?(i=Math.sqrt(t.x*t.x+t.y*t.y),1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),-1);var e,i,s,a,n=0;return 0!==i&&(n=Math.atan2(e*t.x,e*t.y)),this.sphere?(a=w(this.long0+n/this.ns),s=ni(this.g-i/this.a)):(s=ri(this.g-i/this.a,this.e0,this.e1,this.e2,this.e3),a=w(this.long0+n/this.ns)),t.x=a,t.y=s,t},names:["Equidistant_Conic","eqdc"]};var ji={init:function(){this.R=this.a},forward:function(t){var e,i=t.x,s=t.y,i=w(i-this.long0),a=(Math.abs(s)<=v&&(e=this.x0+this.R*i,d=this.y0),fi(2*Math.abs(s/Math.PI))),n=((Math.abs(i)<=v||Math.abs(Math.abs(s)-f)<=v)&&(e=this.x0,d=0<=s?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a)),.5*Math.abs(Math.PI/i-i/Math.PI)),r=n*n,o=Math.sin(a),a=Math.cos(a),h=(o=(a=a/(o+a-1))*(2/o-1))*o,l=Math.PI*this.R*(n*(a-h)+Math.sqrt(r*(a-h)*(a-h)-(h+r)*(a*a-h)))/(h+r),i=(e=this.x0+(l=i<0?-l:l),r+a),l=Math.PI*this.R*(o*i-n*Math.sqrt((h+r)*(1+r)-i*i))/(h+r),d=0<=s?this.y0+l:this.y0-l;return t.x=e,t.y=d,t},inverse:function(t){var e,i,s,a,n,r,o;return t.x-=this.x0,t.y-=this.y0,o=Math.PI*this.R,s=(e=t.x/o)*e+(i=t.y/o)*i,o=3*(i*i/(n=-2*(r=-Math.abs(i)*(1+s))+1+2*i*i+s*s)+(2*(a=r-2*i*i+e*e)*a*a/n/n/n-9*r*a/n/n)/27)/(r=(r-a*a/3/n)/n)/(r=2*Math.sqrt(-r/3)),1<Math.abs(o)&&(o=0<=o?1:-1),o=Math.acos(o)/3,r=0<=t.y?(-r*Math.cos(o+Math.PI/3)-a/3/n)*Math.PI:-(-r*Math.cos(o+Math.PI/3)-a/3/n)*Math.PI,o=Math.abs(e)<v?this.long0:w(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(e*e-i*i)+s*s))/2/e),t.x=o,t.y=r,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var Gi={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,i,s,a,n,r,o,h=t.x,l=t.y,d=Math.sin(t.y),u=Math.cos(t.y),h=w(h-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=v?(t.x=this.x0+this.a*(f-l)*Math.sin(h),t.y=this.y0-this.a*(f-l)*Math.cos(h)):Math.abs(this.sin_p12+1)<=v?(t.x=this.x0+this.a*(f+l)*Math.sin(h),t.y=this.y0+this.a*(f+l)*Math.cos(h)):(a=this.sin_p12*d+this.cos_p12*u*Math.cos(h),r=(a=Math.acos(a))?a/Math.sin(a):1,t.x=this.x0+this.a*r*u*Math.sin(h),t.y=this.y0+this.a*r*(this.cos_p12*d-this.sin_p12*u*Math.cos(h))):(r=ti(this.es),e=ei(this.es),s=ii(this.es),o=si(this.es),Math.abs(this.sin_p12-1)<=v?(n=this.a*E(r,e,s,o,f),i=this.a*E(r,e,s,o,l),t.x=this.x0+(n-i)*Math.sin(h),t.y=this.y0-(n-i)*Math.cos(h)):Math.abs(this.sin_p12+1)<=v?(n=this.a*E(r,e,s,o,f),i=this.a*E(r,e,s,o,l),t.x=this.x0+(n+i)*Math.sin(h),t.y=this.y0+(n+i)*Math.cos(h)):(r=d/u,e=ai(this.a,this.e,this.sin_p12),s=ai(this.a,this.e,d),o=Math.atan((1-this.es)*r+this.es*e*this.sin_p12/(s*u)),n=0===(l=Math.atan2(Math.sin(h),this.cos_p12*Math.tan(o)-this.sin_p12*Math.cos(h)))?Math.asin(this.cos_p12*Math.sin(o)-this.sin_p12*Math.cos(o)):Math.abs(Math.abs(l)-Math.PI)<=v?-Math.asin(this.cos_p12*Math.sin(o)-this.sin_p12*Math.cos(o)):Math.asin(Math.sin(h)*Math.cos(o)/Math.sin(l)),i=this.e*this.sin_p12/Math.sqrt(1-this.es),d=this.e*this.cos_p12*Math.cos(l)/Math.sqrt(1-this.es),t.x=this.x0+(a=e*n*(1-(r=n*n)*(s=d*d)*(1-s)/6+(u=r*n)/8*(h=i*d)*(1-2*s)+(o=u*n)/120*(s*(4-7*s)-3*i*i*(1-7*s))-o*n/48*h))*Math.sin(l),t.y=this.y0+a*Math.cos(l))),t},inverse:function(t){var e,i,s,a,n,r,o,h;return t.x-=this.x0,t.y-=this.y0,this.sphere?(h=Math.sqrt(t.x*t.x+t.y*t.y))>2*f*this.a?void 0:(a=h/this.a,o=Math.sin(a),a=Math.cos(a),e=this.long0,Math.abs(h)<=v?i=this.lat0:(i=fi(a*this.sin_p12+t.y*o*this.cos_p12/h),r=Math.abs(this.lat0)-f,e=Math.abs(r)<=v?0<=this.lat0?w(this.long0+Math.atan2(t.x,-t.y)):w(this.long0-Math.atan2(-t.x,t.y)):w(this.long0+Math.atan2(t.x*o,h*this.cos_p12*a-t.y*this.sin_p12*o))),t.x=e,t.y=i,t):(r=ti(this.es),a=ei(this.es),o=ii(this.es),n=si(this.es),Math.abs(this.sin_p12-1)<=v?(i=ri(((s=this.a*E(r,a,o,n,f))-(h=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,r,a,o,n),e=w(this.long0+Math.atan2(t.x,-1*t.y))):Math.abs(this.sin_p12+1)<=v?(s=this.a*E(r,a,o,n,f),i=ri(((h=Math.sqrt(t.x*t.x+t.y*t.y))-s)/this.a,r,a,o,n),e=w(this.long0+Math.atan2(t.x,t.y))):(h=Math.sqrt(t.x*t.x+t.y*t.y),s=Math.atan2(t.x,t.y),r=ai(this.a,this.e,this.sin_p12),a=Math.cos(s),n=-(o=this.e*this.cos_p12*a)*o/(1-this.es),o=3*this.es*(1-n)*this.sin_p12*this.cos_p12*a/(1-this.es),o=1-n*(r=(h=h/r)-n*(1+n)*Math.pow(h,3)/6-o*(1+3*n)*Math.pow(h,4)/24)*r/2-h*r*r*r/6,n=Math.asin(this.sin_p12*Math.cos(r)+this.cos_p12*Math.sin(r)*a),e=w(this.long0+Math.asin(Math.sin(s)*Math.sin(r)/Math.cos(n))),h=Math.sin(n),i=Math.atan2((h-this.es*o*this.sin_p12)*Math.tan(n),h*(1-this.es))),t.x=e,t.y=i,t)},names:["Azimuthal_Equidistant","aeqd"]};var Ei={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,i,s=t.x,a=t.y,s=w(s-this.long0),n=Math.sin(a),a=Math.cos(a),r=Math.cos(s),o=this.sin_p14*n+this.cos_p14*a*r;return(0<o||Math.abs(o)<=v)&&(e=+this.a*a*Math.sin(s),i=this.y0+ +this.a*(this.cos_p14*n-this.sin_p14*a*r)),t.x=e,t.y=i,t},inverse:function(t){var e,i,s,a,n,r;return t.x-=this.x0,t.y-=this.y0,s=fi((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),i=Math.sin(s),s=Math.cos(s),n=this.long0,Math.abs(e)<=v?(r=this.lat0,t.x=n,t.y=r):(r=fi(s*this.sin_p14+t.y*i*this.cos_p14/e),a=Math.abs(this.lat0)-f,n=Math.abs(a)<=v?0<=this.lat0?w(this.long0+Math.atan2(t.x,-t.y)):w(this.long0-Math.atan2(-t.x,t.y)):w(this.long0+Math.atan2(t.x*i,e*this.cos_p14*s-t.y*this.sin_p14*i)),t.x=n,t.y=r),t},names:["ortho"]},Ai=1,Ci=2,Ni=3,Ti=4,Pi=5,Oi=6,u={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Ii(t,e,i,s){var a;return t<v?(s.value=u.AREA_0,a=0):(a=Math.atan2(e,i),Math.abs(a)<=x?s.value=u.AREA_0:x<a&&a<=f+x?(s.value=u.AREA_1,a-=f):f+x<a||a<=-(f+x)?(s.value=u.AREA_2,a=0<=a?a-d:a+d):(s.value=u.AREA_3,a+=f)),a}function Bi(t,e){t+=e;return t<-d?t+=yt:+d<t&&(t-=yt),t}function zi(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))}var Ui={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=f-x/2?this.face=Pi:this.lat0<=-(f-x/2)?this.face=Oi:Math.abs(this.long0)<=x?this.face=Ai:Math.abs(this.long0)<=f+x?this.face=0<this.long0?Ci:Ti:this.face=Ni,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,i,s,a,n,r,o={x:0,y:0},h={value:0};return t.x-=this.long0,n=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,s=t.x,this.face===Pi?(i=f-n,e=x<=s&&s<=f+x?(h.value=u.AREA_0,s-f):f+x<s||s<=-(f+x)?(h.value=u.AREA_1,0<s?s-d:s+d):-(f+x)<s&&s<=-x?(h.value=u.AREA_2,s+f):(h.value=u.AREA_3,s)):this.face===Oi?(i=f+n,e=x<=s&&s<=f+x?(h.value=u.AREA_0,-s+f):s<x&&-x<=s?(h.value=u.AREA_1,-s):s<-x&&-(f+x)<=s?(h.value=u.AREA_2,-s-f):(h.value=u.AREA_3,0<s?-s+d:-s-d)):(this.face===Ci?s=Bi(s,+f):this.face===Ni?s=Bi(s,+d):this.face===Ti&&(s=Bi(s,-f)),a=Math.sin(n),n=Math.cos(n),r=Math.sin(s),s=n*Math.cos(s),n=n*r,r=a,this.face===Ai?e=Ii(i=Math.acos(s),r,n,h):this.face===Ci?e=Ii(i=Math.acos(n),r,-s,h):this.face===Ni?e=Ii(i=Math.acos(-s),r,-n,h):this.face===Ti?e=Ii(i=Math.acos(-n),r,s,h):(i=e=0,h.value=u.AREA_0)),a=Math.atan(12/d*(e+Math.acos(Math.sin(e)*Math.cos(x))-f)),n=Math.sqrt((1-Math.cos(i))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(e))))),h.value===u.AREA_1?a+=f:h.value===u.AREA_2?a+=d:h.value===u.AREA_3&&(a+=1.5*d),o.x=n*Math.cos(a),o.y=n*Math.sin(a),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,t.x=o.x,t.y=o.y,t},inverse:function(t){var e,i,s,a,n,r={lam:0,phi:0},o={value:0};return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,s=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),0<=t.x&&t.x>=Math.abs(t.y)?o.value=u.AREA_0:0<=t.y&&t.y>=Math.abs(t.x)?(o.value=u.AREA_1,e-=f):t.x<0&&-t.x>=Math.abs(t.y)?(o.value=u.AREA_2,e=e<0?e+d:e-d):(o.value=u.AREA_3,e+=f),n=d/12*Math.tan(e),a=Math.sin(n)/(Math.cos(n)-1/Math.sqrt(2)),a=Math.atan(a),(s=1-(e=Math.cos(e))*e*(e=Math.tan(s))*e*(1-Math.cos(Math.atan(1/Math.cos(a)))))<-1?s=-1:1<s&&(s=1),this.face===Pi?(i=Math.acos(s),r.phi=f-i,o.value===u.AREA_0?r.lam=a+f:o.value===u.AREA_1?r.lam=a<0?a+d:a-d:o.value===u.AREA_2?r.lam=a-f:r.lam=a):this.face===Oi?(i=Math.acos(s),r.phi=i-f,o.value===u.AREA_0?r.lam=-a+f:o.value===u.AREA_1?r.lam=-a:o.value===u.AREA_2?r.lam=-a-f:r.lam=a<0?-a-d:-a+d):(i=1<=(n=(e=s)*e)?0:Math.sqrt(1-n)*Math.sin(a),s=1<=(n+=i*i)?0:Math.sqrt(1-n),o.value===u.AREA_1?(n=s,s=-i,i=n):o.value===u.AREA_2?(s=-s,i=-i):o.value===u.AREA_3&&(n=s,s=i,i=-n),this.face===Ci?(n=e,e=-s,s=n):this.face===Ni?(e=-e,s=-s):this.face===Ti&&(n=e,e=s,s=-n),r.phi=Math.acos(-i)-f,r.lam=Math.atan2(s,e),this.face===Ci?r.lam=Bi(r.lam,-f):this.face===Ni?r.lam=Bi(r.lam,-d):this.face===Ti&&(r.lam=Bi(r.lam,+f))),0!==this.es&&(a=r.phi<0?1:0,o=Math.tan(r.phi),n=this.b/Math.sqrt(o*o+this.one_minus_f_squared),r.phi=Math.atan(Math.sqrt(this.a*this.a-n*n)/(this.one_minus_f*n)),a)&&(r.phi=-r.phi),r.lam+=this.long0,t.x=r.lam,t.y=r.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Ri=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],qi=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Fi=M/5,Di=1/Fi;var Vi={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=w(t.x-this.long0),i=Math.abs(t.y),s=Math.floor(i*Fi),e=(s<0?s=0:18<=s&&(s=17),{x:zi(Ri[s],i=M*(i-Di*s))*e,y:zi(qi[s],i)});return t.y<0&&(e.y=-e.y),e.x=e.x*this.a*.8487+this.x0,e.y=e.y*this.a*1.3523+this.y0,e},inverse:function(t){var e={x:(t.x-this.x0)/(.8487*this.a),y:Math.abs(t.y-this.y0)/(1.3523*this.a)};if(1<=e.y)e.x/=Ri[18][0],e.y=t.y<0?-f:f;else{var i=Math.floor(18*e.y);for(i<0?i=0:18<=i&&(i=17);;)if(qi[i][0]>e.y)--i;else{if(!(qi[i+1][0]<=e.y))break;++i}var s=qi[i],a=function(t,e,i,s){for(var a=e;s;--s){var n=t(a);if(a-=n,Math.abs(n)<i)break}return a}(function(t){return(zi(s,t)-e.y)/(s[1]+t*(2*s[2]+3*t*s[3]))},5*(e.y-s[0])/(qi[i+1][0]-s[0]),v,100);e.x/=zi(Ri[i],a),e.y=(5*i+a)*b,t.y<0&&(e.y=-e.y)}return e.x=w(e.x+this.long0),e},names:["Robinson","robin"]};var $i={init:function(){this.name="geocent"},forward:function(t){return Zt(t,this.es,this.a)},inverse:function(t){return Qt(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},Wi=0,Hi=1,Ji=2,Zi=3,Qi={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};var Ki={init:function(){if(Object.keys(Qi).forEach(function(t){if(void 0===this[t])this[t]=Qi[t].def;else{if(Qi[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Qi[t].num&&(this[t]=parseFloat(this[t]))}Qi[t].degrees&&(this[t]=this[t]*b)}.bind(this)),Math.abs(Math.abs(this.lat0)-f)<v?this.mode=this.lat0<0?Hi:Wi:Math.abs(this.lat0)<v?this.mode=Ji:(this.mode=Zi,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||1e10<this.pn1)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,i,s,a,n=Math.sin(t.y),r=Math.cos(t.y),o=Math.cos(t.x);switch(this.mode){case Zi:i=this.sinph0*n+this.cosph0*r*o;break;case Ji:i=r*o;break;case Hi:i=-n;break;case Wi:i=n}switch(e=(i=this.pn1/(this.p-i))*r*Math.sin(t.x),this.mode){case Zi:i*=this.cosph0*n-this.sinph0*r*o;break;case Ji:i*=n;break;case Wi:i*=-r*o;break;case Hi:i*=r*o}return a=1/((s=i*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-i*this.sg)*this.cw*a,i=s*a,t.x=e*this.a,t.y=i*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e={x:t.x,y:t.y},i=1/(this.pn1-t.y*this.sw),s=this.pn1*t.x*i,i=this.pn1*t.y*this.cw*i,a=(t.x=s*this.cg+i*this.sg,t.y=i*this.cg-s*this.sg,h(t.x,t.y));if(Math.abs(a)<v)e.x=0,e.y=t.y;else{var n,r=1-a*a*this.pfact;switch(r=(this.p-Math.sqrt(r))/(this.pn1/a+a/this.pn1),n=Math.sqrt(1-r*r),this.mode){case Zi:e.y=Math.asin(n*this.sinph0+t.y*r*this.cosph0/a),t.y=(n-this.sinph0*Math.sin(e.y))*a,t.x*=r*this.cosph0;break;case Ji:e.y=Math.asin(t.y*r/a),t.y=n*a,t.x*=r;break;case Wi:e.y=Math.asin(n),t.y=-t.y;break;case Hi:e.y=-Math.asin(n)}e.x=Math.atan2(t.x,t.y)}return t.x=e.x+this.long0,t.y=e.y,t},names:["Tilted_Perspective","tpers"]};var Xi={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||1e10<this.radius_g_1)throw new Error;var t,e;this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es?(e=1/(t=1-this.es),this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"):(this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere"),this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,i=t.x,s=t.y;if(i-=this.long0,"ellipse"===this.shape){var s=Math.atan(this.radius_p2*Math.tan(s)),a=this.radius_p/h(this.radius_p*Math.cos(s),Math.sin(s)),n=a*Math.cos(i)*Math.cos(s),r=a*Math.sin(i)*Math.cos(s),a=a*Math.sin(s);if((this.radius_g-n)*n-r*r-a*a*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-n,this.flip_axis?(t.x=this.radius_g_1*Math.atan(r/h(a,e)),t.y=this.radius_g_1*Math.atan(a/e)):(t.x=this.radius_g_1*Math.atan(r/e),t.y=this.radius_g_1*Math.atan(a/h(r,e)))}else"sphere"===this.shape&&(e=Math.cos(s),n=Math.cos(i)*e,r=Math.sin(i)*e,a=Math.sin(s),e=this.radius_g-n,this.flip_axis?(t.x=this.radius_g_1*Math.atan(r/h(a,e)),t.y=this.radius_g_1*Math.atan(a/e)):(t.x=this.radius_g_1*Math.atan(r/e),t.y=this.radius_g_1*Math.atan(a/h(r,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,i=-1,s=0,a=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),s=Math.tan(t.x/this.radius_g_1)*h(1,a)):(s=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*h(1,s));var n,r,o=a/this.radius_p,o=s*s+o*o+i*i;if((r=(n=2*this.radius_g*i)*n-4*o*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=(-n-Math.sqrt(r))/(2*o),i=this.radius_g+e*i,s*=e,a*=e,t.x=Math.atan2(s,i),t.y=Math.atan(a*Math.cos(t.x)/i),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),s=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+a*a)):(s=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+s*s)),(r=(n=2*this.radius_g*i)*n-4*(o=s*s+a*a+i*i)*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=(-n-Math.sqrt(r))/(2*o),i=this.radius_g+e*i,s*=e,a*=e,t.x=Math.atan2(s,i),t.y=Math.atan(a*Math.cos(t.x)/i)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]},Yi=1.340264,ts=-.081106,es=893e-6,is=.003796,ss=Math.sqrt(3)/2;var as={init:function(){this.es=0,this.long0=void 0!==this.long0?this.long0:0},forward:function(t){var e=w(t.x-this.long0),i=t.y,s=(i=Math.asin(ss*Math.sin(i)))*i,a=s*s*s;return t.x=e*Math.cos(i)/(ss*(Yi+3*ts*s+a*(7*es+9*is*s))),t.y=i*(Yi+ts*s+a*(es+is*s)),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a;for(var e,i,s,a=t.y,n=0;n<12&&(a-=s=(a*(Yi+ts*(e=a*a)+(i=e*e*e)*(es+is*e))-t.y)/(Yi+3*ts*e+i*(7*es+9*is*e)),!(Math.abs(s)<1e-9));++n);return t.x=ss*t.x*(Yi+3*ts*(e=a*a)+(i=e*e*e)*(7*es+9*is*e))/Math.cos(a),t.y=Math.asin(Math.sin(a)/ss),t.x=w(t.x+this.long0),t},names:["eqearth","Equal Earth","Equal_Earth"]};i.defaultDatum="WGS84",i.Proj=j,i.WGS84=new i.Proj("WGS84"),i.Point=Me,i.toPoint=ie,i.defs=n,i.nadgrid=function(t,e){var i=function(t){if(11===t.getInt32(8,!1))return!1;11!==t.getInt32(8,!0)&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian");return!0}(e=new DataView(e)),s=(a=i,{nFields:(s=e).getInt32(8,a),nSubgridFields:s.getInt32(24,a),nSubgrids:s.getInt32(40,a),shiftType:Jt(s,56,64).trim(),fromSemiMajorAxis:s.getFloat64(120,a),fromSemiMinorAxis:s.getFloat64(136,a),toSemiMajorAxis:s.getFloat64(152,a),toSemiMinorAxis:s.getFloat64(168,a)}),a={header:s,subgrids:function(t,e,i){for(var s=176,a=[],n=0;n<e.nSubgrids;n++){var r=function(t,e,i){return{name:Jt(t,e+8,e+16).trim(),parent:Jt(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,i),upperLatitude:t.getFloat64(e+88,i),lowerLongitude:t.getFloat64(e+104,i),upperLongitude:t.getFloat64(e+120,i),latitudeInterval:t.getFloat64(e+136,i),longitudeInterval:t.getFloat64(e+152,i),gridNodeCount:t.getInt32(e+168,i)}}(t,s,i),o=function(t,e,i,s){for(var a=e+176,n=[],r=0;r<i.gridNodeCount;r++){var o={latitudeShift:t.getFloat32(a+16*r,s),longitudeShift:t.getFloat32(a+16*r+4,s),latitudeAccuracy:t.getFloat32(a+16*r+8,s),longitudeAccuracy:t.getFloat32(a+16*r+12,s)};n.push(o)}return n}(t,s,r,i),h=Math.round(1+(r.upperLongitude-r.lowerLongitude)/r.longitudeInterval),l=Math.round(1+(r.upperLatitude-r.lowerLatitude)/r.latitudeInterval);a.push({ll:[Ht(r.lowerLongitude),Ht(r.lowerLatitude)],del:[Ht(r.longitudeInterval),Ht(r.latitudeInterval)],lim:[h,l],count:r.gridNodeCount,cvs:function(t){return t.map(function(t){return[Ht(t.longitudeShift),Ht(t.latitudeShift)]})}(o)}),s+=176+16*r.gridNodeCount}return a}(e,s,i)};return $t[t]=a},i.transform=ae,i.mgrs=e,i.version="__VERSION__",(e=i).Proj.projections.add(ze),e.Proj.projections.add(De),e.Proj.projections.add(Ve),e.Proj.projections.add(He),e.Proj.projections.add(Je),e.Proj.projections.add(Ze),e.Proj.projections.add(Ke),e.Proj.projections.add(Xe),e.Proj.projections.add(Ye),e.Proj.projections.add(oi),e.Proj.projections.add(gi),e.Proj.projections.add(mi),e.Proj.projections.add(yi),e.Proj.projections.add(vi),e.Proj.projections.add(bi),e.Proj.projections.add(Mi),e.Proj.projections.add(xi),e.Proj.projections.add(wi),e.Proj.projections.add(Li),e.Proj.projections.add(ki),e.Proj.projections.add(Si),e.Proj.projections.add(ji),e.Proj.projections.add(Gi),e.Proj.projections.add(Ei),e.Proj.projections.add(Ui),e.Proj.projections.add(Vi),e.Proj.projections.add($i),e.Proj.projections.add(Ki),e.Proj.projections.add(Xi),e.Proj.projections.add(as);var c,ns,rs,os=function(){function s(t){switch(K(this,s),this._params=Object.assign({map_proj:null,ref_lat:null,ref_lon:null,truelat1:null,truelat2:null,stand_lon:null,dx:null,dy:null,e_we:null,e_sn:null},t),this._params.map_proj){case Q:this._proj4="+units=m +proj=lcc +lat_1="+this._params.truelat1+" +lat_2="+this._params.truelat2+" +lat_0="+this._params.ref_lat+" +lon_0="+this._params.stand_lon+" +a="+l+" +b="+l+" +towgs84=0,0,0 +no_defs=True";break;case et:this._proj4="+units=m +proj=merc +lat_ts="+this._params.truelat1+" +lon_0="+this._getValue(this._params.stand_lon,0)+" +a="+l+" +b="+l+" +towgs84=0,0,0 +no_defs=True +nadgrids=null";break;case it:var e=this._params.truelat1<0?-90:90,i=this._params.truelat1;this._proj4="+units=m +proj=stere +lat_0="+e+" +lon_0="+this._params.stand_lon+" +lat_ts="+i+" +a="+l+" +b="+l;break;case Y:this._proj4="+units=m +proj=eqc +lon_0="+this._params.stand_lon+" +a="+l+" +b="+l+" +nadgrids=null +towgs84=0,0,0 +no_defs=True";break;default:throw"Unsupported projection "+this._wps.map_proj}}return a(s,[{key:"_getValue",value:function(t,e){return isNaN(t)||null==t?e:t}},{key:"latlon_to_ij",value:function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid lat-lon coordinates");return i(s._wrf_proj,this._proj4,[e,t])}},{key:"ij_to_latlon",value:function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid IJ coordinates");t=i(this._proj4,s._wrf_proj,[t,e]);return[t[1],t[0]]}}])}(),hs=(t(os,"_wrf_proj","+units=m +proj=longlat +a="+l+" +b="+l+"  +towgs84=0,0,0 +no_defs=True"),function(){return a(function t(e,i,s){if(K(this,t),this._wps=Object.assign({map_proj:null,ref_lat:null,ref_lon:null,truelat1:null,truelat2:null,stand_lon:null,pole_lat:null,pole_lon:null,ref_x:null,ref_y:null,dx:null,dy:null,s_we:1,s_sn:1,e_we:null,e_sn:null,parent_grid_ratio:null,i_parent_start:null,j_parent_start:null},i),s){if(this.parent=s,null===this._wps.parent_grid_ratio)throw new Error("parent_grid_ratio must be specified for nested grids");if(null===this._wps.i_parent_start)throw new Error("i_parent_start must be specified for nested grids");if(null===this._wps.j_parent_start)throw new Error("j_parent_start must be specified for nested grids")}else this.parent=null;this.id="Number"==typeof e?"d".concat(e.toString().padStart("0",2)):e.toString(),this._initialize()},[{key:"wps",get:function(){return this._wps}},{key:"projection",get:function(){return this._projection}},{key:"corners",get:function(){return this._corners}},{key:"parent_grid_ratio",get:function(){return this._wps.parent_grid_ratio}},{key:"i_parent_start",get:function(){return this._wps.i_parent_start}},{key:"j_parent_start",get:function(){return this._wps.j_parent_start}},{key:"e_we",get:function(){return this._wps.e_we}},{key:"e_sn",get:function(){return this._wps.e_sn}},{key:"polygonPath",get:function(){return this._polygonPath||(this._polygonPath=this._initPolygonPath()),this._polygonPath}},{key:"_initialize",value:function(){this._proj_ref_lat=this._wps.ref_lat,this._proj_ref_lon=this._wps.ref_lon,this._proj_truelat1=this._wps.truelat1,this._proj_truelat2=this._wps.truelat2,this._proj_stand_lon=this._wps.stand_lon,this._proj_dx=this._wps.dx,this._proj_dy=this._wps.dy,this._proj_e_we=this._wps.e_we,this._proj_e_sn=this._wps.e_sn;var t=0,e=0,i=null!==this.parent;if(console.debug("Initializing grid ".concat(this.id)),console.debug(" WPS:"),console.debug("  ref_lat: ".concat(this._wps.ref_lat)),console.debug("  ref_lon: ".concat(this._wps.ref_lon)),console.debug("  truelat1: ".concat(this._wps.truelat1)),console.debug("  truelat2: ".concat(this._wps.truelat2)),console.debug("  stand_lon: ".concat(this._wps.stand_lon)),console.debug("  pole_lat: ".concat(this._wps.pole_lat)),console.debug("  pole_lon: ".concat(this._wps.pole_lon)),this._wps.map_proj===Y?(console.debug("  dx: ".concat(this._wps.dx," deg")),console.debug("  dy: ".concat(this._wps.dy," deg"))):(console.debug("  dx: ".concat(this._proj_dx,"m")),console.debug("  dy: ".concat(this._proj_dy,"m"))),console.debug("  e_sn: ".concat(this._wps.e_sn)),console.debug("  e_we: ".concat(this._wps.e_we)),this._wps.map_proj===Y){if(isNaN(this._wps.dx)&&isNaN(this._wps.dy)){var s=360/(this._wps.e_we-this._wps.s_we),a=180/(this._wps.e_sn-this._wps.s_sn);this._proj_ref_lon=this._wps.stand_lon+s/2,this._proj_ref_lat=a/2-90,this._proj_dx=l*Math.PI*2/(this._wps.e_we-this._wps.s_we),this._proj_dy=l*Math.PI/(this._wps.e_sn-this._wps.s_sn)}else if(this._proj_dx=at(this._wps.dx),this._proj_dy=at(this._wps.dy),null===this._wps.ref_lat&&null===this._wps.ref_lon)throw new Error("For lat-lon projection, if dx/dy are specified, a regional domain is assumed, and a ref_lat,ref_lon must also be specified");console.debug("  dx: ".concat(this._proj_dx,"m")),console.debug("  dy: ".concat(this._proj_dy,"m"))}if(i){console.debug(" Nest:"),console.debug("  parent_grid_ratio: ".concat(this.parent_grid_ratio)),console.debug("  i_parent_start: ".concat(this.i_parent_start)),console.debug("  j_parent_start: ".concat(this.j_parent_start));for(var n=1,r=this;null!=r.parent;)n*=r.parent_grid_ratio,t+=(r.i_parent_start-1)*n,e+=(r.j_parent_start-1)*n,r=r.parent;console.debug("  moad_grid_ratio: ".concat(n)),console.debug("  i_moad_start: ".concat(t)),console.debug("  j_moad_start: ".concat(e)),this._proj_dx=this._proj_dx/n,this._proj_dy=this._proj_dy/n,this._proj_e_we=(r.e_we-1)*n+1,this._proj_e_sn=(r.e_sn-1)*n+1,console.debug("  dx: ".concat(this._proj_dx,"m")),console.debug("  dy: ".concat(this._proj_dy,"m")),console.debug("  e_sn: ".concat(this._proj_e_sn)),console.debug("  e_we: ".concat(this._proj_e_we))}this._projection=new os({map_proj:this._wps.map_proj,ref_lat:this._proj_ref_lat,ref_lon:this._proj_ref_lon,truelat1:this._proj_truelat1,truelat2:this._proj_truelat2,stand_lon:this._proj_stand_lon,dx:this._proj_dx,dy:this._proj_dy,e_we:this._proj_e_we,e_sn:this._proj_e_sn});var s=(this._proj_e_we-2)*this._proj_dx,a=(this._proj_e_sn-2)*this._proj_dy,i=(this._proj_e_we-1)*this._proj_dx,o=(this._proj_e_sn-1)*this._proj_dy,h=(console.debug("  unstaggered_grid_size_i: ".concat(i,"m")),console.debug("  unstaggered_grid_size_j: ".concat(o,"m")),this._projection.latlon_to_ij(this._proj_ref_lat,this._proj_ref_lon));console.debug("  grid_center_ij: [".concat(h[0],", ").concat(h[1],"]")),this._mass_offset_i=h[0]-.5*s,this._mass_offset_j=h[1]-.5*a,this._unstaggered_offset_i=h[0]-.5*i+t*this._proj_dx,this._unstaggered_offset_j=h[1]-.5*o+e*this._proj_dy,console.debug("  unstaggered_offset_i: ".concat(this._unstaggered_offset_i,"m")),console.debug("  unstaggered_offset_j: ".concat(this._unstaggered_offset_j,"m")),this._corners={sw:this.unstaggered_ij_to_latlon(0,0),se:this.unstaggered_ij_to_latlon(this._wps.e_we-1,0),ne:this.unstaggered_ij_to_latlon(this._wps.e_we-1,this._wps.e_sn-1),nw:this.unstaggered_ij_to_latlon(0,this._wps.e_sn-1)}}},{key:"_initPolygonPath",value:function(){var t,e,i=[];for(i.push(this._corners.sw),t=5;t<this._wps.e_we-1-5;t+=5)i.push(this.unstaggered_ij_to_latlon(t,0));for(i.push(this._corners.se),e=5;e<this._wps.e_sn-1-5;e+=5)i.push(this.unstaggered_ij_to_latlon(this._wps.e_we-1,e));for(i.push(this._corners.ne),t=this._wps.e_we-1-5;5<t;t-=5)i.push(this.unstaggered_ij_to_latlon(t,this._wps.e_sn-1));for(i.push(this._corners.nw),e=this._wps.e_sn-1-5;5<e;e-=5)i.push(this.unstaggered_ij_to_latlon(0,e));return i.push(this._corners.sw),i}},{key:"latlon_to_unstaggered_ij",value:function(t,e){t=this._projection.latlon_to_ij(t,e);return t[0]=(t[0]-this._unstaggered_offset_i)/this._proj_dx,t[1]=(t[1]-this._unstaggered_offset_j)/this._proj_dy,t}},{key:"unstaggered_ij_to_latlon",value:function(t,e){return this._projection.ij_to_latlon(t*this._proj_dx+this._unstaggered_offset_i,e*this._proj_dy+this._unstaggered_offset_j)}}])}()),tt=L.Polygon.extend({statics:{minNestGridPoints:5,minGridSize:10,defaultGridRatio:3,minPixelsPerGrid:7,IAxisOpt:Object.freeze({I_PARENT_START:0,E_WE:1}),JAxisOpt:Object.freeze({J_PARENT_START:0,E_SN:1})},options:{showTooltip:!0,showGridLines:!1,editable:!0,opacity:.8,weight:2,color:"#FF0000",fillColor:"#FF0000",fillOpacity:.2,className:"wrf-domain-grid"},domain:null,parent:null,id:null,parent_grid_ratio:1,i_parent_start:1,j_parent_start:1,e_we:0,e_sn:0,geog_data_res:"default",_gridLinesLayer:null,_iGridLines:null,_jGridLines:null,_enableGridLines:!0,_createGridLinesPane:function(){return this._map?(this._map.getPane("gridLinesPane")||this._map.createPane("gridLinesPane"),L.layerGroup(null,{pane:"gridLinesPane"})):null},_cornerMarkers:null,_corners:null,_isSelected:!1,nests:null,geogrid:null,_initGeogrid:function(){var t;return new hs(this.id,{map_proj:this.domain.map_proj,ref_lat:this.domain.ref_lat,ref_lon:this.domain.ref_lon,truelat1:this.domain.truelat1,truelat2:this.domain.truelat2,stand_lon:this.domain.stand_lon,dx:this.domain.dx,dy:this.domain.dy,e_we:this.e_we,e_sn:this.e_sn,parent_grid_ratio:this.parent_grid_ratio,i_parent_start:this.i_parent_start,j_parent_start:this.j_parent_start},null==(t=this.parent)?void 0:t.geogrid)},_initCorners:function(){return{sw:L.latLng(this.geogrid.corners.sw),se:L.latLng(this.geogrid.corners.se),ne:L.latLng(this.geogrid.corners.ne),nw:L.latLng(this.geogrid.corners.nw)}},_onMapViewChanged:function(){this._isSelected&&this._updateGridLines()},_getTooltipContent:function(t){var e="<table><thead><tr><th>"+this.name+"</th><th></th></tr></thead>",i=(e+="<tbody>",this.geogrid.latlon_to_unstaggered_ij(t.lat,t.lng));return(e+="<tr><td>i,j</td><td>"+Math.ceil(i[0])+", "+Math.ceil(i[1])+"</td></tr>")+("<tr><td>lat,lon</td><td>"+t.lat.toFixed(2)+", "+t.lng.toFixed(2)+"</td></tr>")+"</tbody>"+"</table>"},_updateTooltip:function(t){var e=this.getTooltip();e&&(e=e.getElement())&&(e.innerHTML=this._getTooltipContent(t.latlng))},_onPolygonClick:function(t){t.originalEvent.ctrlKey?this.unselect():this.select()},_bindTooltip:function(t){this.options.showTooltip&&(this.on("mousemove",this._updateTooltip,this),L.Polygon.prototype.bindTooltip.call(this,t&&t.latlng?this._getTooltipContent(t.latlng):"",{sticky:!0,className:"wrf-domain-grid-tooltip"}))},bindTooltip:function(t){this._bindTooltip(t);for(var e=0;e<this.nests.length;e++)this.nests[e].bindTooltip(t)},_unbindTooltip:function(){L.Polygon.prototype.unbindTooltip.call(this),this.off("mousemove",this._updateTooltip,this)},unbindTooltip:function(){this.getTooltip()&&this._unbindTooltip();for(var t=0;t<this.nests.length;t++)this.nests[t].unbindTooltip()},_resizeContext:null,_resizeEnd:function(t){this.domain.grid.bindTooltip(),this._map.dragging.enable(),this._map.off("mousemove",this._resize,this),this._map.off("mouseup",this._resizeEnd,this),this._map.off("mouseout",this._resizeEnd,this),this._resizeContext.resizeStarted&&(this.showGridLines(),this.parent)&&this.parent.hideGridLines(),this._resizeContext=null},_resizeStart:function(t,e,i){var s,a,n,r,o;for(this._map.once("mouseup",this._resizeEnd,this),this._map.once("mouseout",this._resizeEnd,this),this._map.dragging.disable(),this.domain.grid.unbindTooltip(),o=0;o<this.nests.length;o++)r=0==o?(s=this.nests[o].i_parent_start,a=this.nests[o].j_parent_start,n=this.nests[o].i_delta_end,this.nests[o].j_delta_end):(s=Math.min(s,this.nests[o].i_parent_start),a=Math.min(a,this.nests[o].j_parent_start),n=Math.min(n,this.nests[o].i_delta_end),Math.min(r,this.nests[o].j_delta_end));this._resizeContext={resizeStarted:!1,stand_lon_delta:this.domain.stand_lon-this.domain.ref_lon,truelat1_delta:this.domain.truelat1-this.domain.ref_lat,truelat2_delta:this.domain.truelat2-this.domain.ref_lat,min_e_we:n?this.e_we-n+tt.minNestGridPoints:tt.minGridSize,mine_sn:r?this.e_sn-r+tt.minNestGridPoints:tt.minGridSize,max_e_we:this.parent?(this.i_delta_end-tt.minNestGridPoints)*this.parent_grid_ratio+this.e_we:0,maxe_sn:this.parent?(this.j_delta_end-tt.minNestGridPoints)*this.parent_grid_ratio+this.e_sn:0,min_i_parent_start:this.parent?tt.minNestGridPoints-this.i_parent_start+1:0,min_j_parent_start:this.parent?tt.minNestGridPoints-this.j_parent_start+1:0,max_i_parent_start:s?Math.floor((s-tt.minNestGridPoints-1)/this.parent_grid_ratio):this.parent?Math.floor((this.e_we-tt.minGridSize)/this.parent_grid_ratio):this.e_we-tt.minGridSize,max_j_parent_start:a?Math.floor((a-tt.minNestGridPoints-1)/this.parent_grid_ratio):this.parent?Math.floor((this.e_sn-tt.minGridSize)/this.parent_grid_ratio):this.e_sn-tt.minGridSize,mod_delta_i:0,mod_delta_j:0,iAxisOpt:e,jAxisOpt:i,startLatlng:t.latlng}},_resize:function(t){if(this._resizeContext.resizeStarted){var e,i,s,a,t=this.geogrid.latlon_to_unstaggered_ij(t.latlng.lat,t.latlng.lng),n=st(t[0]),r=st(t[1]);if(this._resizeContext.iAxisOpt==tt.IAxisOpt.E_WE&&(n-=this.e_we-1),this._resizeContext.jAxisOpt==tt.JAxisOpt.E_SN&&(r-=this.e_sn-1),this.parent){if(this._resizeContext.iAxisOpt==tt.IAxisOpt.I_PARENT_START){n+=this._resizeContext.mod_delta_i,this._resizeContext.mod_delta_i=n%this.parent_grid_ratio;var o=(n-this._resizeContext.mod_delta_i)/this.parent_grid_ratio;o>this._resizeContext.max_i_parent_start?(o=this._resizeContext.max_i_parent_start,this._resizeContext.max_i_parent_start=0):this._resizeContext.max_i_parent_start-=o,o<this._resizeContext.min_i_parent_start?(this._resizeContext.max_i_parent_start+=o-this._resizeContext.min_i_parent_start,o=this._resizeContext.min_i_parent_start,this._resizeContext.min_i_parent_start=0):this._resizeContext.min_i_parent_start-=o,this.e_we-=o*this.parent_grid_ratio,this.i_parent_start+=o;for(var h=0;h<this.nests.length;h++)this.nests[h].i_parent_start-=o*this.parent_grid_ratio}else this._resizeContext.iAxisOpt==tt.IAxisOpt.E_WE&&(s=Math.max(this.e_we+n,this._resizeContext.min_e_we),s=Math.min(s,this._resizeContext.max_e_we),this.e_we=s-(s-1)%this.parent_grid_ratio);if(this._resizeContext.jAxisOpt==tt.JAxisOpt.J_PARENT_START){r+=this._resizeContext.mod_delta_j,this._resizeContext.mod_delta_j=r%this.parent_grid_ratio;var l=(r-this._resizeContext.mod_delta_j)/this.parent_grid_ratio;l>this._resizeContext.max_j_parent_start?(l=this._resizeContext.max_j_parent_start,this._resizeContext.max_j_parent_start=0):this._resizeContext.max_j_parent_start-=l,l<this._resizeContext.min_j_parent_start?(this._resizeContext.max_j_parent_start+=l-this._resizeContext.min_j_parent_start,l=this._resizeContext.min_j_parent_start,this._resizeContext.min_j_parent_start=0):this._resizeContext.min_j_parent_start-=l,this.e_sn-=l*this.parent_grid_ratio,this.j_parent_start+=l;for(h=0;h<this.nests.length;h++)this.nests[h].j_parent_start-=l*this.parent_grid_ratio}else this._resizeContext.jAxisOpt==tt.JAxisOpt.E_SN&&(a=Math.max(this.e_sn+r,this._resizeContext.mine_sn),a=Math.min(a,this._resizeContext.maxe_sn),this.e_sn=a-(a-1)%this.parent_grid_ratio);this.update()}else{if(this._resizeContext.iAxisOpt==tt.IAxisOpt.I_PARENT_START?(n>this._resizeContext.max_i_parent_start?(n=this._resizeContext.max_i_parent_start,this._resizeContext.max_i_parent_start=0):this._resizeContext.max_i_parent_start-=n,e=(this.e_we-1+n)/2):this._resizeContext.iAxisOpt==tt.IAxisOpt.E_WE&&(e=((s=Math.max(this.e_we+n,this._resizeContext.min_e_we))-1)/2),this._resizeContext.jAxisOpt==tt.JAxisOpt.J_PARENT_START?(r>this._resizeContext.max_j_parent_start?(r=this._resizeContext.max_j_parent_start,this._resizeContext.max_j_parent_start=0):this._resizeContext.max_j_parent_start-=r,i=(this.e_sn-1+r)/2):this._resizeContext.jAxisOpt==tt.JAxisOpt.E_SN&&(i=((a=Math.max(this.e_sn+r,this._resizeContext.mine_sn))-1)/2),t=this.geogrid.unstaggered_ij_to_latlon(e,i),this.domain.ref_lat=t[0],this.domain.ref_lon=t[1],this._resizeContext.iAxisOpt==tt.IAxisOpt.I_PARENT_START){this.e_we-=n;for(h=0;h<this.nests.length;h++)this.nests[h].i_parent_start-=n}else this._resizeContext.iAxisOpt==tt.IAxisOpt.E_WE&&(this.e_we=s);if(this._resizeContext.jAxisOpt==tt.JAxisOpt.J_PARENT_START){this.e_sn-=r;for(h=0;h<this.nests.length;h++)this.nests[h].j_parent_start-=r}else this._resizeContext.jAxisOpt==tt.JAxisOpt.E_SN&&(this.e_sn=a);this.domain.update()}}else this._resizeContext.resizeStarted=!0,this._enableGridLines=!1,this._iGridLines&&this._removeGridLines(),this.parent&&this.parent.showGridLines()},_log:function(t){t&&console.log(t),console.log("  ref_lat: "+this.domain.ref_lat),console.log("  ref_lon: "+this.domain.ref_lon),console.log("  stand_lon: "+this.domain.stand_lon),console.log("  truelat1: "+this.domain.truelat1),console.log("  truelat2: "+this.domain.truelat2),console.log("  i_parent_start: "+this.i_parent_start),console.log("  j_parent_start: "+this.j_parent_start),console.log("  e_we: "+this.e_we),console.log("  e_sn: "+this.e_sn)},_dragContext:null,_dragEnd:function(t){this.domain.grid.bindTooltip(t),this._map.dragging.enable(),this._map.off("mousemove",this._drag,this),this._map.off("mouseup",this._dragEnd,this),this._map.off("mouseout",this._dragEnd,this),this._enableGridLines=!0,this._dragContext.dragStarted&&(this._drawGridLines(),this.parent)&&this.parent.hideGridLines(),this._dragContext=null},_dragStart:function(t){this._map.once("mouseup",this._dragEnd,this),this._map.once("mouseout",this._dragEnd,this),this._map.dragging.disable(),this.domain.grid.unbindTooltip(),this._dragContext={dragStarted:!1,ref_lat:this.domain.ref_lat,ref_lon:this.domain.ref_lon,stand_lon:this.domain.stand_lon,truelat1:this.domain.truelat1,truelat2:this.domain.truelat2,startLatLng:t.latlng,startIJ:this.geogrid.latlon_to_unstaggered_ij(t.latlng.lat,t.latlng.lng),delta_i:0,delta_j:0,max_delta_i:this.i_delta_end-tt.minNestGridPoints,max_delta_j:this.j_delta_end-tt.minNestGridPoints,min_delta_i:tt.minNestGridPoints-this.i_parent_start+1,min_delta_j:tt.minNestGridPoints-this.j_parent_start+1,i_parent_start:this.i_parent_start,j_parent_start:this.j_parent_start},this._map.on("mousemove",this._drag,this)},_drag:function(t){var e,i;this._dragContext.dragStarted||(this._dragContext.dragStarted=!0,this._enableGridLines=!1,this._iGridLines&&this._removeGridLines(),this.parent&&this.parent.showGridLines()),null==this.parent?(this.domain.ref_lat=t.latlng.lat-this._dragContext.startLatLng.lat+this.domain.ref_lat,this.domain.ref_lon=t.latlng.lng-this._dragContext.startLatLng.lng+this.domain.ref_lon,this.domain.drag(this._dragContext),this._dragContext.startLatLng=t.latlng,this.domain.update()):(e=this.geogrid.latlon_to_unstaggered_ij(t.latlng.lat,t.latlng.lng),this._dragContext.delta_i+=(e[0]-this._dragContext.startIJ[0])/this.parent_grid_ratio,this._dragContext.delta_j+=(e[1]-this._dragContext.startIJ[1])/this.parent_grid_ratio,e=Math.min(st(this._dragContext.delta_i),this._dragContext.max_delta_i),e=Math.max(e,this._dragContext.min_delta_i),i=Math.min(st(this._dragContext.delta_j),this._dragContext.max_delta_j),i=Math.max(i,this._dragContext.min_delta_j),this.i_parent_start=this._dragContext.i_parent_start+e,this.j_parent_start=this._dragContext.j_parent_start+i,this.update(),this._dragContext.startIJ=this.geogrid.latlon_to_unstaggered_ij(t.latlng.lat,t.latlng.lng))},onAdd:function(t){this._gridLinesLayer=this._createGridLinesPane(),L.Polygon.prototype.onAdd.call(this,t),this.geogrid=this._initGeogrid(),this._corners=this._initCorners(),this.setLatLngs(this.geogrid.polygonPath),this._cornerMarkers={sw:L.marker(this._corners.sw,{icon:L.divIcon({className:this.options.editable?"wrf-domain-grid-corner cursor-nesw-resize":"wrf-domain-grid-corner"})}),se:L.marker(this._corners.se,{icon:L.divIcon({className:this.options.editable?"wrf-domain-grid-corner cursor-nwse-resize":"wrf-domain-grid-corner"})}),ne:L.marker(this._corners.ne,{icon:L.divIcon({className:this.options.editable?"wrf-domain-grid-corner cursor-nesw-resize":"wrf-domain-grid-corner"})}),nw:L.marker(this._corners.nw,{icon:L.divIcon({className:this.options.editable?"wrf-domain-grid-corner cursor-nwse-resize":"wrf-domain-grid-corner"})})},this.options.editable&&(this._cornerMarkers.sw.on("mousedown",function(t){this._resizeStart(t,tt.IAxisOpt.I_PARENT_START,tt.JAxisOpt.J_PARENT_START),this._map.on("mousemove",this._resize,this)},this),this._cornerMarkers.se.on("mousedown",function(t){this._resizeStart(t,tt.IAxisOpt.E_WE,tt.JAxisOpt.J_PARENT_START),this._map.on("mousemove",this._resize,this)},this),this._cornerMarkers.ne.on("mousedown",function(t){this._resizeStart(t,tt.IAxisOpt.E_WE,tt.JAxisOpt.E_SN),this._map.on("mousemove",this._resize,this)},this),this._cornerMarkers.nw.on("mousedown",function(t){this._resizeStart(t,tt.IAxisOpt.I_PARENT_START,tt.JAxisOpt.E_SN),this._map.on("mousemove",this._resize,this)},this)),this._map.on("zoomend moveend",this._onMapViewChanged,this),this._bindTooltip(),this.on("click",this._onPolygonClick,this);for(var e=0;e<this.nests.length;e++)this.nests[e].addTo(t)},getBounds:function(){return this._corners&&this._projection||(this.geogrid=this._initGeogrid(),this._corners=this._initCorners(),this.setLatLngs(this.geogrid.polygonPath)),L.Polygon.prototype.getBounds.call(this)},onRemove:function(t){this._map.off("viewreset",this._onMapViewChanged,this),this.options.showTooltip&&this._unbindTooltip(),this.off("click",this._onPolygonClick,this),this._isSelected&&this.unselect();for(var e=0;e<this.nests.length;e++)this.nests[e].remove();L.Polygon.prototype.onRemove.call(this,t),this.fire("wps:remove")},initialize:function(t,e,i,s,a){if(L.Util.setOptions(this,a),this.domain=t,this.parent=e,this.id=i,this.nests=[],this.e_we=tt.minGridSize,this.e_sn=tt.minGridSize,s){if(this.parent_grid_ratio=s.geogrid.parent_grid_ratio[i-1],this.i_parent_start=s.geogrid.i_parent_start[i-1],this.j_parent_start=s.geogrid.j_parent_start[i-1],this.e_we=s.geogrid.e_we[i-1],this.e_sn=s.geogrid.e_sn[i-1],this.geog_data_res=s.geogrid.geog_data_res[i-1],this.geog_data_res||(this.geog_data_res="default"),(this.e_we-1)%this.parent_grid_ratio!=0)throw"invalid e_we value";if((this.e_sn-1)%this.parent_grid_ratio!=0)throw"invalid e_sn value";for(var n=i;n<s.geogrid.parent_id.length;n++)i===s.geogrid.parent_id[n]&&this.nests.push(new tt(t,this,n+1,s,a))}L.Polygon.prototype.initialize.call(this,[])},update:function(){this.geogrid=this._initGeogrid(),this._corners=this._initCorners(),this.setLatLngs(this.geogrid.polygonPath),this._cornerMarkers.sw.setLatLng(this._corners.sw),this._cornerMarkers.se.setLatLng(this._corners.se),this._cornerMarkers.ne.setLatLng(this._corners.ne),this._cornerMarkers.nw.setLatLng(this._corners.nw),this._iGridLines&&this._removeGridLines(),this._isSelected&&this._drawGridLines();for(var t=0;t<this.nests.length;t++)this.nests[t].update();this.fire("wps:change")},addToNamelist:function(t){t.geogrid.parent_id.push(this.parent?this.parent.id:1),t.geogrid.parent_grid_ratio.push(this.parent_grid_ratio),t.geogrid.i_parent_start.push(this.i_parent_start),t.geogrid.j_parent_start.push(this.j_parent_start),t.geogrid.e_we.push(this.e_we),t.geogrid.e_sn.push(this.e_sn),t.geogrid.geog_data_res.push(this.geog_data_res);for(var e=0;e<this.nests.length;e++)this.nests[e].addToNamelist(t)},unselectAll:function(){if(this._isSelected)this.unselect();else for(var t=0;t<this.nests.length;t++)this.nests[t].unselectAll()},unselect:function(){this._cornerMarkers.sw.remove(),this._cornerMarkers.se.remove(),this._cornerMarkers.ne.remove(),this._cornerMarkers.nw.remove(),this._isSelected=!1,this._isSelected&&this.options.editable&&this.off("mousedown",this._dragStart,this),this.hideGridLines(),this.fire("wps:unselect")},select:function(){this._isSelected||(this.domain.grid.unselectAll(),this._isSelected=!0,this._cornerMarkers.sw.addTo(this._map),this._cornerMarkers.se.addTo(this._map),this._cornerMarkers.ne.addTo(this._map),this._cornerMarkers.nw.addTo(this._map),this.options.editable&&this.on("mousedown",this._dragStart,this),this.showGridLines(),this.fire("wps:select"),this.domain.setSelectedGrid(this))},updateId:function(t){this.id!=t&&(this.id=t,this.fire("wps:id-change"));for(var e=0;e<this.nests.length;e++)this.nests[e].updateId(this.id+1)},removeNest:function(t){t.remove();t=this.nests.indexOf(t);if(-1==t)throw"Cannot remove a nest which is not a nest of this grid";this.nests.splice(t,1),this.domain.grid.updateId(1),this.fire("wps:removenest")},createNest:function(){var t=new tt(this.domain,this,this.domain.max_dom+1,null,this.options);try{t.parent_grid_ratio=tt.defaultGridRatio,t.i_parent_start=1+tt.minNestGridPoints,t.j_parent_start=1+tt.minNestGridPoints,t.e_we=Math.floor((t.parent.e_we-tt.minNestGridPoints-t.i_parent_start)*t.parent_grid_ratio+1),t.e_sn=Math.floor((t.parent.e_sn-tt.minNestGridPoints-t.j_parent_start)*t.parent_grid_ratio+1)}catch(t){throw"Unable to add a nest grid ("+t+")"}return this.nests.push(t),this.fire("wps:addnest"),this._map&&t.addTo(this._map),t},findGrid:function(t){var e,i;if(this.id==t)return this;if(this.nests&&0<this.nests.length)for(i=0;i<this.nests.length;i++)if(e=this.nests[i].findGrid(t))return e;return e}}),ls=(Object.defineProperties(tt.prototype,{projection:{get:function(){return this._projection}},name:{get:function(){return"d"+this.id.toString().padStart(2,"0")}},selected:{get:function(){return this._isSelected}},iPixels:{get:function(){return this.parent?this.parent.iPixels/this.parent_grid_ratio:Math.round(this.domain.dxPixelsMul*Math.pow(2,this._map.getZoom()))}},i_delta_end:{get:function(){return this.parent?this.parent.e_we-(this.e_we-1)/this.parent_grid_ratio-this.i_parent_start:0}},j_delta_end:{get:function(){return this.parent?this.parent.e_sn-(this.e_sn-1)/this.parent_grid_ratio-this.j_parent_start:0}},depth:{get:function(){for(var t=this.parent;t;)t=t.parent;return 0}},count:{get:function(){for(var t=1,e=0;e<this.nests.length;e++)t+=this.nests[e].count;return t}},corners:{get:function(){return this._corners}}}),tt.prototype._getGridLinesBounds=function(){var t=this._map.getBounds(),e=t.getSouthWest(),t=t.getNorthEast(),i=this.geogrid.latlon_to_unstaggered_ij(e.lat,e.lng),s=this.geogrid.latlon_to_unstaggered_ij(t.lat,t.lng),a=this.geogrid.latlon_to_unstaggered_ij(e.lat,t.lng),t=this.geogrid.latlon_to_unstaggered_ij(t.lat,e.lng);return{iLinesStart:Math.max(0,Math.min(Math.floor(i[0]),Math.floor(t[0]),this.e_we-1)),jLinesStart:Math.max(0,Math.min(Math.floor(i[1]),Math.floor(a[1]),this.e_sn-1)),iLinesEnd:Math.min(this.e_we-1,Math.max(Math.ceil(s[0]),Math.ceil(a[0]),0)),jLinesEnd:Math.min(this.e_sn-1,Math.max(Math.ceil(s[1]),Math.ceil(t[1]),0))}},tt.prototype._createGridLinePolyline=function(t){t=L.polyline(t,{pane:"gridLinesPane",color:"grey",weight:1,opacity:.5});return this._gridLinesLayer.addLayer(t),t},tt.prototype._updateGridLines=function(){if(this._iGridLines)if(this.iPixels<tt.minPixelsPerGrid)this._gridLinesLayer.remove();else{var t,e,i,s,a,n,r,o,h;if(this._map.hasLayer(this._gridLinesLayer)||this._gridLinesLayer.addTo(this._map),((i=this._getGridLinesBounds()).iLinesEnd<this._gridLinesBounds.iLinesStart||i.iLinesStart>this._gridLinesBounds.iLinesEnd||i.jLinesEnd<this._gridLinesBounds.jLinesStart||i.jLinesStart>this._gridLinesBounds.jLinesEnd)&&(this._removeGridLines(),this._drawGridLines(i)),i.iLinesStart<this._gridLinesBounds.iLinesStart){for(n=[],h=new Array(this._gridLinesBounds.jLinesEnd-this._gridLinesBounds.jLinesStart+1),t=i.iLinesStart;t<this._gridLinesBounds.iLinesStart;t++){for(s=[],e=this._gridLinesBounds.jLinesStart;e<=this._gridLinesBounds.jLinesEnd;e++)a=this.geogrid.unstaggered_ij_to_latlon(t,e),s.push(a),t==i.iLinesStart&&(h[e-this._gridLinesBounds.jLinesStart]=new Array),h[e-this._gridLinesBounds.jLinesStart].push(a),t==this._gridLinesBounds.iLinesStart-1&&this._jGridLines[e-this._gridLinesBounds.jLinesStart].setLatLngs(h[e-this._gridLinesBounds.jLinesStart].concat(this._jGridLines[e-this._gridLinesBounds.jLinesStart].getLatLngs()));n.push(this._createGridLinePolyline(s))}this._iGridLines=n.concat(this._iGridLines),this._gridLinesBounds.iLinesStart=i.iLinesStart}if(i.jLinesStart<this._gridLinesBounds.jLinesStart){for(r=[],o=new Array(this._gridLinesBounds.iLinesEnd-this._gridLinesBounds.iLinesStart+1),e=i.jLinesStart;e<this._gridLinesBounds.jLinesStart;e++){for(s=[],t=this._gridLinesBounds.iLinesStart;t<=this._gridLinesBounds.iLinesEnd;t++)a=this.geogrid.unstaggered_ij_to_latlon(t,e),s.push(a),e==i.jLinesStart&&(o[t-this._gridLinesBounds.iLinesStart]=new Array),o[t-this._gridLinesBounds.iLinesStart].push(a),e==this._gridLinesBounds.jLinesStart-1&&this._iGridLines[t-this._gridLinesBounds.iLinesStart].setLatLngs(o[t-this._gridLinesBounds.iLinesStart].concat(this._iGridLines[t-this._gridLinesBounds.iLinesStart].getLatLngs()));r.push(this._createGridLinePolyline(s))}this._jGridLines=r.concat(this._jGridLines),this._gridLinesBounds.jLinesStart=i.jLinesStart}if(i.iLinesEnd>this._gridLinesBounds.iLinesEnd){for(t=this._gridLinesBounds.iLinesEnd+1;t<=i.iLinesEnd;t++){for(s=[],e=this._gridLinesBounds.jLinesStart;e<=this._gridLinesBounds.jLinesEnd;e++)a=this.geogrid.unstaggered_ij_to_latlon(t,e),s.push(a),this._jGridLines[e-this._gridLinesBounds.jLinesStart].addLatLng(a);this._iGridLines.push(this._createGridLinePolyline(s))}this._gridLinesBounds.iLinesEnd=i.iLinesEnd}if(i.jLinesEnd>this._gridLinesBounds.jLinesEnd){for(e=this._gridLinesBounds.jLinesEnd+1;e<=i.jLinesEnd;e++){for(s=[],t=this._gridLinesBounds.iLinesStart;t<=this._gridLinesBounds.iLinesEnd;t++)a=this.geogrid.unstaggered_ij_to_latlon(t,e),s.push(a),this._iGridLines[t-this._gridLinesBounds.iLinesStart].addLatLng(a);this._jGridLines.push(this._createGridLinePolyline(s))}this._gridLinesBounds.jLinesEnd=i.jLinesEnd}}else this._drawGridLines()},tt.prototype._drawGridLines=function(t){if(this.iPixels>=tt.minPixelsPerGrid&&this._enableGridLines){var e,i,s,a,n;for(this._gridLinesBounds=t||this._getGridLinesBounds(),this._iGridLines=[],this._jGridLines=[],n=new Array(this._gridLinesBounds.jLinesEnd-this._gridLinesBounds.jLinesStart+1),e=this._gridLinesBounds.iLinesStart;e<=this._gridLinesBounds.iLinesEnd;e++){for(s=[],i=this._gridLinesBounds.jLinesStart;i<=this._gridLinesBounds.jLinesEnd;i++)a=this.geogrid.unstaggered_ij_to_latlon(e,i),s.push(a),e==this._gridLinesBounds.iLinesStart&&(n[i-this._gridLinesBounds.jLinesStart]=new Array(this._gridLinesBounds.iLinesEnd-this._gridLinesBounds.iLinesStart+1)),n[i-this._gridLinesBounds.jLinesStart][e-this._gridLinesBounds.iLinesStart]=a,e==this._gridLinesBounds.iLinesEnd&&this._jGridLines.push(this._createGridLinePolyline(n[i-this._gridLinesBounds.jLinesStart]));this._iGridLines.push(this._createGridLinePolyline(s))}this._map.hasLayer(this._gridLinesLayer)||this._gridLinesLayer.addTo(this._map)}},tt.prototype._removeGridLines=function(){this._gridLinesLayer.clearLayers(),this._iGridLines=null,this._jGridLines=null,this._gridLinesLayer.remove()},tt.prototype.hideGridLines=function(){this._gridLinesLayer.remove(),this._enableGridLines=!1},tt.prototype.showGridLines=function(){this._enableGridLines=!0,this._updateGridLines()},a(function t(e){K(this,t),this.options={jsonBaseUrl:"json"},e&&(this.options=Object.assign(this.options,e));var s,u,i,a,c,n,_,r,p=this,o="".concat(this.options.jsonBaseUrl,"/geog.json");function h(){var t,e,i,s,a,n,r,o,h,l,d={};for(p.geog_data_res.match(/(\w+)/g).forEach(function(t){d[t]=t}),c.body.empty(),t=0;t<u.categories.length;t++){for(i=$("<tr/>"),s=u.categories[t],i.append("<td>"+s.name+"</td>"),a=$('<select class=""></select>'),i.append($("<td />").append(a)),i.append("<td>"+s.default+"</td>"),n=$("<td/>"),i.append(n),c.body.append(i),h=[],r=!(o={}),e=0;e<s.options.length;e++)"default"!==s.options[e].id&&h.push(s.options[e].id),l=null!=d[s.options[e].id],o[s.options[e].id]=$(new Option(s.options[e].id,s.options[e].id,l,l)).data("dirname",s.options[e].dirname),l&&(n.text(s.options[e].dirname),r=!0);r||n.text(o.default.data("dirname")),a.append(o.default),0<h.length?h.sort().forEach(function(t){a.append(o[t])}):a.prop("disabled",!0),a.on("change",{cellFilename:n,selectCategoryOption:a},function(t){var i,s=t.data.selectCategoryOption.val(),a=[],n={};t.data.cellFilename.text($("option:selected",t.data.selectCategoryOption).data("dirname")),$('select option[value="'+s+'"]',c.body).parents().has('option[value="default"]:selected').each(function(t,e){(i=$(e)).val(s),$("td:last-child",i.closest("tr")).text($("option:selected",i).data("dirname"))}),$("select",c.body).each(function(t,e){i=$(e),"default"!=(s=i.val())&&void 0===n[s]&&(n[s]=s,a.push(s))}),0==a.length?_.val("default"):_.val(a.join("+"))})}}i=$("div.modal#geog-data-res-dialog"),e=$("div.modal-header",i),r=$("div.modal-body",i),a=$("div.modal-footer",i),(c=$("table",r)).header=$("thead",c),c.body=$("tbody",c),n=$("select",e),_=$("input",r),e=$("button#button-geog-save",a),r=$("button#button-geog-reset",a),this.show=function(t,e){this.saveHandler=e,this.geog_data_res=t=t||"default",_.val(t),void 0===s?$.getJSON(o,function(t){var e,i;for(s=t,e=0;e<s.geog.length;e++)for(i=0;i<s.geog[e].categories.length;i++)if("HGT_M"==s.geog[e].categories[i].name){s.geog[e].categories[i].options.push({id:"srtm_30m",dirname:"srtm_30m"}),s.geog[e].categories[i].options.push({id:"srtm_90m",dirname:"srtm_90m"});break}for(n.empty(),e=0;e<s.geog.length;e++)n.append('<option value="'+s.geog[e].version+'">'+s.geog[e].version+"</option>");n.on("change",function(t){for(e=0;e<s.geog.length;e++)if(n.val()==s.geog[e].version){u=s.geog[e],h();break}}),u=s.geog[0],n.val(u.version),h()}):h(),i.modal()},r.on("click",function(){_.val("default"),$("select",c.body).each(function(){var t=$(this);t.val("default"),$("td:last-child",t.closest("tr")).text(t.find(":selected").data("dirname"))})}),e.on("click",function(t){t.geog_data_res=_.val(),"function"==typeof p.saveHandler&&p.saveHandler.call(this,t)})})),ds=a(function i(s,u,a,t){var c,e,n,r,_,p,g,f,m,o,h,l,d,y,v,b=this,M=(K(this,i),this);function x(){(h=$('<i class="fas fa-vector-square mx-1"></i>')).insertBefore(r)}u.domain,this.options={minGridDistanceMeters:100,minGridDistanceDegrees:0},t&&(this.options=Object.assign(this.options,t)),null===i._geogDataResDialog&&(i._geogDataResDialog=new ls(t)),null==i.Template&&(i.Template=$("#grid_template",s).html(),$("#grid_template",s).remove()),c=$('<div class="container-grid"></div>').append(i.Template),t=$('button[data-action="remove-nest"]',c),e=$('button[data-action="add-nest"]',c),n=$('button[data-action="geog-data-res-edit"]',c),r=$("label.grid-label",c),_=$('input[name="parent_grid_ratio"]',c),p=$('input[name="i_parent_start"]',c),g=$('input[name="j_parent_start"]',c),f=$('input[name="e_we"]',c),m=$('input[name="e_sn"]',c),o=$('span[data-name="geog_data_res"]',c),v=$("table tbody tr:nth-child(1) td:nth-child(2)",c),y=$("table tbody tr:nth-child(1) td:nth-child(3)",c),l=$("table tbody tr:nth-child(2) td:nth-child(2)",c),d=$("table tbody tr:nth-child(2) td:nth-child(3)",c),s.append(c),$("[title]",c).tooltip(),$("input[name]",c).on("change blur keyup",function(t){M.validate()}),n.on("click",function(t){i._geogDataResDialog.show(u.geog_data_res,function(t){u.geog_data_res=t.geog_data_res,o.text(t.geog_data_res),o.attr("title",t.geog_data_res)})}),u.on("wps:remove",function(t){c.remove()}),u.on("wps:change",k),u.on("wps:id-change",L),u.on("wps:select",function(){h||x()}),u.on("wps:unselect",function(){h&&(h.remove(),h=null)}),$("button[title]",c).on("click",function(t){$(this).tooltip("hide")}),t.on("click",function(t){u.parent.removeNest(u)}),e.on("click",function(t){var e=null;if("localhost"===location.hostname)(e=u.createNest()).gridPanel=new i(s,e,a);else try{(e=u.createNest()).gridPanel=new i(s,e,a)}catch(t){!function(t){"function"==typeof a&&a.call(this,{error:t})}(t)}}),u.parent?(p.prop("min",tt.minNestGridPoints),g.prop("min",tt.minNestGridPoints)):(t.remove(),_.prop("disabled",!0),_.removeAttr("required"),p.prop("disabled",!0),p.removeAttr("required"),g.prop("disabled",!0),g.removeAttr("required"));for(var w=0;w<u.nests.length;w++)u.nests[w].gridPanel=new i(s,u.nests[w],a);function L(){u.parent?r.text(u.name+" (parent: d"+u.parent.id.toString().padStart(2,"0")+")"):r.text(u.name)}function k(){_.val(u.parent_grid_ratio),p.val(u.i_parent_start),g.val(u.j_parent_start),f.val(u.e_we),m.val(u.e_sn),o.text(u.geog_data_res),o.attr("title",u.geog_data_res),o.tooltip(),l.text(u.corners.sw.lat.toFixed(3)+", "+u.corners.sw.lng.toFixed(3)),d.text(u.corners.se.lat.toFixed(3)+", "+u.corners.se.lng.toFixed(3)),y.text(u.corners.ne.lat.toFixed(3)+", "+u.corners.ne.lng.toFixed(3)),v.text(u.corners.nw.lat.toFixed(3)+", "+u.corners.nw.lng.toFixed(3)),M.validate()}function S(){var t,e,i,s,a;1<u.id&&(t=parseInt(_.val(),10),s=parseInt(p.val(),10),a=parseInt(g.val(),10),e=tt.minNestGridPoints*t+1,i=tt.minNestGridPoints*t+1,s=Math.floor((u.parent.e_we-tt.minNestGridPoints-s)*t+1),a=Math.floor((u.parent.e_sn-tt.minNestGridPoints-a)*t+1),f.prop("min",e),m.prop("min",i),f.prop("max",s),m.prop("max",a),f.prop("step",t),m.prop("step",t),p.prop("min",tt.minNestGridPoints+1),g.prop("min",tt.minNestGridPoints+1),p.prop("max",u.parent.e_we-2*tt.minNestGridPoints),g.prop("max",u.parent.e_sn-2*tt.minNestGridPoints))}function j(t,e){$('div[data-val-for="'+t.prop("name")+'"]',c).show().append("<p>"+e+"</p>"),t.addClass(".is-invalid")}function G(t){return!!t[0].checkValidity()||(j(t,t[0].validationMessage.replace(/[v,V]alue|(this field)/,t.prop("name"))),!1)}_.on("change",function(t){var e,i,s=parseInt(_.val());isNaN(s)||(e=(u.e_we-1)/u.parent_grid_ratio,i=(u.e_sn-1)/u.parent_grid_ratio,S(),f.val(e*s+1),m.val(i*s+1),b.validate())}),this.validate=function(){var t,e,i,s,a,n,r,o,h,l=!0;null!=u.parent&&($(".invalid-feedback",c).hide().empty(),$(".is-invalid, .is-valid",c).removeClass(".is-invalid").removeClass(".is-valid"),S(),l=G(_),l=G(p)&&l,l=G(g)&&l,l=G(f)&&l,l=G(m)&&l)&&(t=parseInt(_.val(),10),e=parseInt(p.val(),10),i=parseInt(g.val(),10),s=parseInt(f.val(),10),a=parseInt(m.val(),10),n=u.parent.e_we,r=u.parent.e_sn,e<tt.minNestGridPoints&&(j(p,"Min i_parent_start = "+tt.minNestGridPoints+". "),l=!1),i<tt.minNestGridPoints&&(j(g,"Min j_parent_start = "+tt.minNestGridPoints+". "),l=!1),e>n-tt.minNestGridPoints&&(j(p,"Max i_parent_start = "+(n-tt.minNestGridPoints)+". "),l=!1),i>r-tt.minNestGridPoints&&(j(g,"Max j_parent_start = "+(r-tt.minNestGridPoints)+". "),l=!1),(s-1)%t!=0&&(j(f,"e_we must be one greater than an integer multiple of the nest's parent_grid_ratio (e_we = n*parent_grid_ratio + 1)."),l=!1),(a-1)%t!=0&&(j(m,"e_sn must be one greater than an integer multiple of the nest's parent_grid_ratio (e_sn = n*parent_grid_ratio + 1)."),l=!1),o=Math.floor((n-tt.minNestGridPoints-e)*t+1),h=Math.floor((r-tt.minNestGridPoints-i)*t+1),(o<s||h<a)&&(j(m,"Nest edge outside of parent. "),l=!1),o<s&&(o=Math.floor((n-e-tt.minNestGridPoints)*t+1),j(f,"Max e_we = "+o+". "),l=!1),h<a)&&(h=Math.floor((r-i-tt.minNestGridPoints)*t+1),j(m,"Max e_sn = "+h+". "),l=!1);for(var d=0;d<u.nests.length;d++)l=l&&u.nests[d].gridPanel.validate();return l},this.setGridValues=function(){u.parent_grid_ratio=parseInt(_.val(),10),u.i_parent_start=parseInt(p.val(),10),u.j_parent_start=parseInt(g.val(),10),u.e_we=parseInt(f.val(),10),u.e_sn=parseInt(m.val(),10),u.geog_data_res=o.val();for(var t=0;t<u.nests.length;t++)u.nests[t].gridPanel.setGridValues()},L(),k(),u.selected&&x()}),us=(t(ds,"_geogDataResDialog",null),ds.Template=null,L.Layer.extend({options:{editable:!0,showTooltip:!0},_map:null,_mainGrid:null,_selectedGrid:null,setSelectedGrid:function(t){this._selectedGrid=t},map_proj:null,truelat1:null,truelat2:null,stand_lon:null,ref_lat:null,ref_lon:null,pole_lat:null,pole_lon:null,dx:null,dy:null,_centerMarker:null,_gridsByDepth:null,_orderGrids:function(t){var e,i;for(this._gridsByDepth&&!t||(this._gridsByDepth=[],this._walkGrids(this._mainGrid,function(t){this._gridsByDepth[t.depth]?this._gridsByDepth[t.depth].push(t):this._gridsByDepth[t.depth]=[t]},this)),e=0;e<this._gridsByDepth.length;e++)for(i=0;i<this._gridsByDepth[e].length;i++)this._gridsByDepth[e][i].bringToFront()},_walkGrids:function(t,e,i){if(e.call(i,t),t.nests&&0<t.nests.length)for(var s=0;s<t.nests.length;s++)this._walkGrids(t.nests[s],e,i)},getGrid:function(t){return this._mainGrid.findGrid(t)},_dragContext:null,_onCenterMarkerDrag:function(t){this.ref_lat=t.latlng.lat,this.ref_lon=t.latlng.lng,this.drag(this._dragContext),this.update()},drag:function(t){switch(this.map_proj){case Q:this.stand_lon=this.ref_lon+t.stand_lon-t.ref_lon,this.truelat1=this.ref_lat+t.truelat1-t.ref_lat,this.truelat2=this.ref_lat+t.truelat2-t.ref_lat;break;case et:this.stand_lon=0,this.truelat1=this.ref_lat+t.truelat1-t.ref_lat;break;case it:this.stand_lon=this.ref_lon+t.stand_lon-t.ref_lon,this.truelat1=this.ref_lat+t.truelat1-t.ref_lat;break;case Y:this._setDefaultProjValues()}},_onMapClick:function(t){this._map.getContainer()==t.originalEvent.target&&this._selectedGrid&&(this._selectedGrid.unselect(),this._selectedGrid=null)},onAdd:function(t){this._map=t,this._map.on("click",this._onMapClick,this),this._centerMarker=L.marker([this.ref_lat,this.ref_lon],{draggable:this.options.editable,title:"Domain Center"}).addTo(t),this._mainGrid.addTo(t),this._orderGrids(),this.options.editable&&(this._centerMarker.on("dragstart",function(t){this._dragContext={ref_lat:this.ref_lat,ref_lon:this.ref_lon,truelat1:this.truelat1,truelat2:this.truelat2,stand_lon:this.stand_lon,pole_lat:this.pole_lat,pole_lon:this.pole_lon},this._mainGrid.unbindTooltip(),this._selectedGrid&&this._selectedGrid.hideGridLines()},this),this._centerMarker.on("drag",this._onCenterMarkerDrag,this),this._centerMarker.on("dragend",function(t){t.latlng=this._centerMarker.getLatLng(),this._onCenterMarkerDrag(t),this._mainGrid.bindTooltip(),this._selectedGrid&&this._selectedGrid.showGridLines()},this))},onRemove:function(t){this._centerMarker&&(this._centerMarker.off(),this._centerMarker.remove()),this._map.off("click",this._onMapClick,this),this._mainGrid.remove()},update:function(){this._centerMarker.setLatLng(L.latLng(this.ref_lat,this.ref_lon)),this._mainGrid.update(),this.fire("wps:change")},_setDefaultProjValues:function(){switch(this.map_proj){case Q:this.truelat1=this.ref_lat,this.truelat2=this.ref_lat,this.stand_lon=this.ref_lon;break;case et:this.truelat1=this.ref_lat,this.stand_lon=0;break;case it:this.truelat1=this.ref_lat,this.stand_lon=this.ref_lon;break;case Y:this.ref_lat<0?(this.pole_lat=90+this.ref_lat,this.pole_lon=0,this.stand_lon=180-this.ref_lon):(this.pole_lat=90-this.ref_lat,this.pole_lon=180,this.stand_lon=-this.ref_lon)}},setDefaultValues:function(t,e){this.ref_lat=t,this.ref_lon=e,this._setDefaultProjValues()},initialize:function(t,e){L.Util.setOptions(this,e),void 0!==t&&(this.map_proj=t.geogrid.map_proj,this.truelat1=t.geogrid.truelat1,this.truelat2=t.geogrid.truelat2,this.stand_lon=t.geogrid.stand_lon,this.ref_lat=t.geogrid.ref_lat,this.ref_lon=t.geogrid.ref_lon,this.dx=t.geogrid.dx,this.dy=t.geogrid.dy,this.pole_lat=t.geogrid.pole_lat,this.pole_lon=t.geogrid.pole_lon,this.ref_x=t.geogrid.ref_x,this.ref_y=t.geogrid.ref_y,this._mainGrid=new tt(this,null,1,t,this.options))},getWPSNamelist:function(){var t=new Z;switch(t.share.max_dom=this.max_dom,t.geogrid.map_proj=this.map_proj,t.geogrid.dx=this.dx,t.geogrid.dy=this.dy,t.geogrid.ref_lat=this.ref_lat,t.geogrid.ref_lon=this.ref_lon,this.map_proj){case Q:t.geogrid.truelat1=this.truelat1,t.geogrid.truelat2=this.truelat2,t.geogrid.stand_lon=this.stand_lon;break;case et:t.geogrid.truelat1=this.truelat1;break;case it:t.geogrid.truelat1=this.truelat1,t.geogrid.stand_lon=this.stand_lon;break;case Y:t.geogrid.pole_lat=this.pole_lat,t.geogrid.pole_lon=this.pole_lon,t.geogrid.stand_lon=this.stand_lon}return t.geogrid.parent_id=[],t.geogrid.parent_grid_ratio=[],t.geogrid.i_parent_start=[],t.geogrid.j_parent_start=[],t.geogrid.e_we=[],t.geogrid.e_sn=[],t.geogrid.geog_data_res=[],this.grid.addToNamelist(t),t},createMainGrid:function(){this._mainGrid&&this._mainGrid.remove(),this._mainGrid=new tt(this,null,1),this._mainGrid.parent_grid_ratio=1,this._mainGrid.i_parent_start=1,this._mainGrid.j_parent_start=1,this._mainGrid.e_we=tt.minGridSize,this._mainGrid.e_sn=tt.minGridSize}})),cs=(Object.defineProperties(us.prototype,{grid:{get:function(){return this._mainGrid}},max_dom:{get:function(){return this._mainGrid.count}},dxPixelsMul:{get:function(){return this.dxInMeters/156543.03392/Math.cos(this.ref_lat*Math.PI/180)}},dxInMeters:{get:function(){return nt(this.map_proj,this.dx)}},dyInMeters:{get:function(){return nt(this.map_proj,this.dy)}}}),us.prototype.addMainGrid=function(){var t,e,i,s,a;t=new tt(this,null,1),this._mainGrid.parent_grid_ratio=3,this._mainGrid.i_parent_start=tt.minNestGridPoints+1,this._mainGrid.j_parent_start=tt.minNestGridPoints+1,0!=(e=(this._mainGrid.e_we-1)%this._mainGrid.parent_grid_ratio)&&(this._mainGrid.e_we+=this._mainGrid.parent_grid_ratio-e),0!=(i=(this._mainGrid.e_sn-1)%this._mainGrid.parent_grid_ratio)&&(this._mainGrid.e_sn+=this._mainGrid.parent_grid_ratio-i),0==e&&0==i||(e=this.stand_lon-this.ref_lon,i=this.truelat1-this.ref_lat,s=this.truelat2-this.ref_lat,a=this._mainGrid.projection.unstaggered_ij_to_latlon((this._mainGrid.e_we-1)/2,(this._mainGrid.e_sn-1)/2),this.ref_lat=a[0],this.ref_lon=a[1],this.stand_lon=this.ref_lon+e,this.truelat1=this.ref_lat+i,this.truelat2=this.ref_lat+s),this.dx=this.dx*this._mainGrid.parent_grid_ratio,this.dy=this.dy*this._mainGrid.parent_grid_ratio,t.parent_grid_ratio=1,t.i_parent_start=1,t.j_parent_start=1,t.e_we=2*tt.minNestGridPoints+(this._mainGrid.e_we-1)/this._mainGrid.parent_grid_ratio+1,t.e_sn=2*tt.minNestGridPoints+(this._mainGrid.e_sn-1)/this._mainGrid.parent_grid_ratio+1,(this._mainGrid.parent=t).nests.push(this._mainGrid),function t(e){e.id++;for(var i=0;i<e.nests.length;i++)t(e.nests[i])}((this._mainGrid=t).nests[0]),t.addTo(this._map),this._orderGrids(!0),this.update()},us.prototype.removeMainGrid=function(){if(1<this._mainGrid.nests.length)throw"Cannot remove top most grid with multiple nests";var t,e,i,s;0!=this._mainGrid.nests.length&&(t=this._mainGrid.domain.stand_lon-this._mainGrid.domain.ref_lon,e=this._mainGrid.domain.truelat1-this._mainGrid.domain.ref_lat,i=this._mainGrid.domain.truelat2-this._mainGrid.domain.ref_lat,s=this._mainGrid.nests[0].projection.unstaggered_ij_to_latlon((this._mainGrid.nests[0].e_we-1)/2,(this._mainGrid.nests[0].e_sn-1)/2),this.ref_lat=s[0],this.ref_lon=s[1],this.stand_lon=this.ref_lon+t,this.truelat1=this.ref_lat+e,this.truelat2=this.ref_lat+i,this.dx=this.dx/this._mainGrid.nests[0].parent_grid_ratio,this.dy=this.dy/this._mainGrid.nests[0].parent_grid_ratio,this._mainGrid.remove(!0),this._mainGrid.nests[0].parent=null,this._mainGrid.nests[0].parent_grid_ratio=1,this._mainGrid.nests[0].i_parent_start=1,this._mainGrid.nests[0].j_parent_start=1,this._mainGrid=this._mainGrid.nests[0],this._mainGrid.updateId(1),this._mainGrid.addTo(this._map))},a(function I(e,t){K(this,I);var n,s,i,a,r,o,h,l,d,u,c,_,p,g,B,f,m,y,v,b,M,x,z=this,w=!1,L="wrf_domain_wizard_wps_panel";function U(){i.height(r.parent().offset().top-i.offset().top-10)}function R(){n.map_proj=p.val(),n.ref_lat=parseFloat(g.val()),n.ref_lon=parseFloat(B.val()),n.truelat1=parseFloat(f.val()),n.truelat2=parseFloat(m.val()),n.stand_lon=parseFloat(y.val()),n.pole_lat=parseFloat(M.val()),n.pole_lon=parseFloat(x.val()),n.map_proj===Y?(n.dx=parseFloat(v.val()),n.dy=parseFloat(b.val())):(n.dx=parseInt(v.val(),10),n.dy=parseInt(b.val(),10)),n.grid.gridPanel.setGridValues(),n.update()}function k(t){t.attr("min",z.options.minGridDistanceMeters),t.attr("step",1)}function S(t){t.attr("min",0),t.attr("step",.001)}function j(t,i){t=t.parent();t.show(),t.find("input").each(function(t,e){!0===i?(e.required=!0,e.disabled=!1):(e.required=!1,e.disabled=!0)})}function G(t){t=t.parent();t.hide(),t.find("input").each(function(t,e){e.required=!1})}function E(t){j(y,t),!0===t?(h.prop("disabled",!1),o.prop("disabled",!1)):(h.prop("disabled",!0),o.prop("disabled",!0))}function q(){switch(j(g,!0),G(f),G(m),G(y),G(M),p.val()){case"lambert":j(f,!0),j(m,!0),E(!0),k(v),k(b);break;case"mercator":j(f,!0),E(!1),k(v),k(b);break;case"polar":j(f,!0),E(!0),k(v),k(b);break;case"lat-lon":E(!0,T(n.stand_lon)),j(M),M[0].disabled=!0,x[0].disabled=!0,S(v),S(b)}}function F(){var t=p.find("option:selected").data("title");p.attr("title",t),p.tooltip("dispose"),p.tooltip()}function D(t){var e=parseFloat(y.val()),i=0<n.ref_lat?5:-5;-180<e-(i=t?i:-i)&&(n.stand_lon=e-i),n.update()}this.options={minGridDistanceMeters:100,minGridDistanceDegrees:0},t&&(this.options=Object.assign(this.options,t)),s=$("form",e),i=$("#grids",s),a=$("div#grids-header",s),r=$("#update-domain",e),t=$('button[data-action="add-moad"]',s),_=$('button[data-action="remove-moad"]',s),p=$('select[name="map_proj"]',s),J(),g=$('input[name="ref_lat"]',s),B=$('input[name="ref_lon"]',s),f=$('input[name="truelat1"]',s),m=$('input[name="truelat2"]',s),y=$('input[name="stand_lon"]',s),v=$('input[name="dx"]',s),b=$('input[name="dy"]',s),M=$('input[name="pole_lat"]',s),x=$('input[name="pole_lon"]',s),o=$("#stan-lon-minus",s),h=$("#stan-lon-plus",s),l=$("#div-2",s),d=$("#div-3",s),u=$("#mul-2",s),c=$("#mul-3",s),r.off(),p.off(),o.off(),h.off(),l.off(),d.off(),u.off(),c.off(),$("[title]",s).tooltip(),$("button[title]",s).on("click",function(t){$(this).tooltip("hide")}),$(window).on("resize",U),t.on("click",function(t){n.addMainGrid(),i.empty(),O()}),_.on("click",function(t){n.removeMainGrid(),i.empty(),O(),n.update()}),r.on("click",function(t){var e,i;s.removeClass("was-validated"),e=s[0].checkValidity(),i=n.grid.gridPanel.validate(),e&&i?R():s.addClass("was-validated")}),p.on("change",function(t){null!=n?(q(),R()):Z(p.val()),F()}),F(),o.on("click",function(t){D(!0)}),h.on("click",function(t){D(!1)});var A=Object.freeze({MUL:0,DIV:1});function C(t,e,i){return e==A.DIV?t/i:e==A.MUL?t*i:void 0}function V(t,e,i){t===Y?(v.val(T(e)),b.val(T(i))):(v.val(Math.round(e)),b.val(Math.round(i)))}function N(t,h){var l,e,i,s=p.val(),a=s===Y?(i=parseFloat(v.val()),e=parseFloat(b.val()),Math.min(at(i),at(e))):(i=parseInt(v.val()),e=parseInt(b.val()),Math.min(i,e));isNaN(i)||isNaN(e)||t==A.DIV&&a<100||(a=C(i,t,h),i=C(e,t,h),null==n?V(s,a,i):(l=t==A.DIV?A.MUL:A.DIV,(e=Q()).createMainGrid(),function t(e,i){var s=!0;if(1==e.id){if(i.i_parent_start=1,i.j_parent_start=1,i.parent_grid_ratio=1,i.e_we=Math.floor(C(e.e_we,l,h)),i.e_sn=Math.floor(C(e.e_sn,l,h)),i.e_we<tt.minGridSize||i.e_sn<tt.minGridSize)return!1}else{i.parent_grid_ratio=e.parent_grid_ratio,i.i_parent_start=Math.max(Math.floor(C(e.i_parent_start,l,h)),tt.minNestGridPoints),i.j_parent_start=Math.max(Math.floor(C(e.j_parent_start,l,h)),tt.minNestGridPoints);var a=Math.max(Math.floor(C(e.i_delta_end,l,h)),tt.minNestGridPoints),n=Math.max(Math.floor(C(e.j_delta_end,l,h)),tt.minNestGridPoints);if(i.e_we=Math.floor((i.parent.e_we-a-i.i_parent_start)*e.parent_grid_ratio+1),i.e_sn=Math.floor((i.parent.e_sn-n-i.j_parent_start)*e.parent_grid_ratio+1),i.e_we<tt.minGridSize||i.e_sn<tt.minGridSize)return!1}for(var r=0;r<e.nests.length;r++){var o=new tt(i.domain,i,e.nests[r].id);i.nests.push(o),s=s&&t(e.nests[r],o)}return s}(n.grid,e.grid)&&(t=function t(e,i){e.i_parent_start=i.i_parent_start,e.j_parent_start=i.j_parent_start,e.e_we=i.e_we,e.e_sn=i.e_sn;for(var s=0;s<e.nests.length;s++)t(e.nests[s],i.nests[s])},V(s,n.dx=a,n.dy=i),t(n.grid,e.grid),n.update())))}function T(t,e){return t.toFixed(e=e||3)}function P(t,e,i){null!=e?t.val(T(e,i)):t.val(null)}function W(){p.val(n.map_proj),P(g,n.ref_lat),P(B,n.ref_lon),P(f,n.truelat1),P(m,n.truelat2),P(y,n.stand_lon),V(n.map_proj,n.dx,n.dy),P(M,n.pole_lat),P(x,n.pole_lon)}function H(){_.prop("disabled",1!=n.grid.nests.length)}function O(){n.grid.gridPanel=new ds(i,n.grid,function(t){X("Error",t.error)},z.options),n.grid.on("wps:addnest",H),n.grid.on("wps:removenest",H),H()}function J(){p.attr("disabled","disabled")}function Z(t){t===Y?(S(v),S(b),v.val(localStorage.getItem(L+"dx.lat-lon")||.1),b.val(localStorage.getItem(L+"dy.lat-lon")||.1)):(k(v),k(b),v.val(localStorage.getItem(L+"dx")||12e3),b.val(localStorage.getItem(L+"dy")||12e3))}function Q(){var t=new us;return t.map_proj=p.val(),t}l.on("click",function(){N(A.DIV,2)}),d.on("click",function(){N(A.DIV,3)}),u.on("click",function(){N(A.MUL,2)}),c.on("click",function(){N(A.MUL,3)}),this.showNewDomain=function(){n=null,w=!1,r.parent().hide(),G(g),G(y),G(f),G(m),G(M),a.hide(),p.removeAttr("disabled");var t=localStorage.getItem(L+"map_proj")||"lambert";p.val(t),Z(t),e.show(),U()},this.validateNewDomain=function(){return p[0].checkValidity()&&v[0].checkValidity()&&b[0].checkValidity()},this.createNewDomain=function(){return J(),n=Q(),localStorage.setItem(L+"map_proj",n.map_proj),n.map_proj===Y?(n.dx=parseFloat(v.val()),n.dy=parseFloat(b.val()),localStorage.setItem(L+"dx.lat-lon",n.dx),localStorage.setItem(L+"dy.lat-lon",n.dy),n.pole_lat=90,n.pole_lon=0):(n.dx=parseInt(v.val(),10),n.dy=parseInt(b.val(),10),localStorage.setItem(L+"dx",n.dx),localStorage.setItem(L+"dy",n.dy)),n.createMainGrid(),n},this.show=function(t){t&&t!=n&&(n=t,w=!1),w||(O(),n.on("wps:change",W),n.on("remove",function(){z.hide()}),n.on("add",function(){O()}),J(),W(),q(),w=!0),r.parent().show(),a.show(),e.show(),U()},this.hide=function(){e.hide()}})),_s=function(){return a(function t(){var i=this,e=(K(this,t),this._container=$("div.modal#wps-save-dialog"),$("div.modal-body",this._container)),s=$("div.modal-footer",this._container),a=$("button#button-copy",s),s=$("button#button-download",s);this._wpsContent=$("textarea",e),a.on("click",function(t){navigator.clipboard.writeText(i._wpsContent.text())}),s.on("click",function(t){var e=new Blob([i._wpsContent.val()],{type:"text/plain;charset=utf-8"});saveAs(e,"namelist.wps",{autoBom:!0})})},[{key:"show",value:function(t){this._wpsContent.text(t.getWPSNamelist().toString()),this._container.modal()}}])}(),ps={mass:{sw:0,nw:1,ne:2,se:3},u:{sw:4,nw:5,ne:6,se:7},v:{sw:8,nw:9,ne:10,se:11},unstaggered:{sw:12,nw:13,ne:14,se:15}},Ve="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},He={exports:{}};function gs(t,e,i){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="blob",s.onload=function(){rs(s.response,e,i)},s.onerror=function(){console.error("could not download file")},s.send()}function fs(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&e.status<=299}function ms(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(i)}}Je=He,c="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof Ve&&Ve.global===Ve?Ve:void 0,ns=c.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),rs=c.saveAs||("object"!=typeof window||window!==c?function(){}:"download"in HTMLAnchorElement.prototype&&!ns?function(t,e,i){var s=c.URL||c.webkitURL,a=document.createElement("a");e=e||t.name||"download",a.download=e,a.rel="noopener","string"==typeof t?(a.href=t,a.origin===location.origin?ms(a):fs(a.href)?gs(t,e,i):ms(a,a.target="_blank")):(a.href=s.createObjectURL(t),setTimeout(function(){s.revokeObjectURL(a.href)},4e4),setTimeout(function(){ms(a)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,i){var s,a,n;e=e||t.name||"download","string"!=typeof t?navigator.msSaveOrOpenBlob((a=t,void 0===(n=i)?n={autoBom:!1}:"object"!=typeof n&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\ufeff",a],{type:a.type}):a),e):fs(t)?gs(t,e,i):((s=document.createElement("a")).href=t,s.target="_blank",setTimeout(function(){ms(s)}))}:function(t,e,i,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof t)return gs(t,e,i);var a,n,r,e="application/octet-stream"===t.type,i=/constructor/i.test(c.HTMLElement)||c.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);(o||e&&i||ns)&&"undefined"!=typeof FileReader?((a=new FileReader).onloadend=function(){var t=a.result,t=o?t:t.replace(/^data:[^;]*;/,"data:attachment/file;");s?s.location.href=t:location=t,s=null},a.readAsDataURL(t)):(n=c.URL||c.webkitURL,r=n.createObjectURL(t),s?s.location=r:location.href=r,s=null,setTimeout(function(){n.revokeObjectURL(r)},4e4))}),c.saveAs=rs.saveAs=rs,Je.exports=rs;var ys=He.exports;function A(t){return t?t.replace(/[\u00A0-\u9999<>\&]/g,function(t){return"&#"+t.charCodeAt(0)+";"}):""}function vs(){return Intl.DateTimeFormat().resolvedOptions().timeZone}var bs=function(){function s(t,e){K(this,s),this._options={onChange:null,valueUtc:null,displayTimeZone:null},e&&(this._options=Object.assign(this._options,e)),this._options.displayTimeZone||(this._options.displayTimeZone=vs()),this._input=t.querySelector("input"),this._widget=t,this._init(t)}return a(s,[{key:"_init",value:function(t){var e=this,i=(this._dateTimePicker=$(t).datetimepicker({allowInputToggle:!0,showClose:!0,showClear:!0,showTodayButton:!0,format:s._format,timeZone:this.displayTimeZone,useCurrent:!0,icons:{date:"far fa-calendar-alt",time:"far fa-clock",clear:"far fa-trash-alt",close:"fas fa-times",today:"far fa-calendar-check"}}),this);this._dateTimePicker.on("dp.change",function(t){"function"==typeof i._options.onChange&&i._options.onChange.call(e,{sender:i,valueUtc:i.valueUtc})}),null!==this._options.valueUtc&&(this.valueUtc=this._options.valueUtc)}},{key:"show",value:function(){this._dateTimePickerObject.show()}},{key:"input",get:function(){return this._input}},{key:"widget",get:function(){return this._widget}},{key:"_dateTimePickerObject",get:function(){return this._dateTimePicker.data("DateTimePicker")}},{key:"_momentValueUtc",get:function(){return moment.tz(this._input.value,s._format,this.displayTimeZone).tz(s._utc)}},{key:"formatUtc",value:function(){return this._momentValueUtc.format(s._format)}},{key:"valueUtc",get:function(){return this._momentToNsDate(this._momentValueUtc)},set:function(t){var e=null,e="string"==typeof t?moment.tz(t,s._format,s._utc):moment.tz([t.year,t.month-1,t.day,t.hour,t.minute,t.second],s._utc);this._input.value=e.tz(this.displayTimeZone).format(s._format)}},{key:"displayTimeZone",get:function(){return this._options.displayTimeZone},set:function(t){var e=this.valueUtc;this._options.displayTimeZone=t,this._dateTimePickerObject.timeZone(t),this.valueUtc=e}},{key:"_momentToNsDate",value:function(t){t=t.toArray();return{year:t[0],month:t[1]+1,day:t[2],hour:t[3],minute:t[4],second:t[5]}}}])}(),Ms=(t(bs,"_format","YYYY-MM-DD_HH:mm:ss"),t(bs,"_utc","UTC"),function(){function I(t,e){K(this,I),this.options={jsonBaseUrl:"json",change:null,floatDigits:3,timeZone:null,onInitialize:null},e&&(this.options=Object.assign(this.options,e)),this.container=t,this.variables=null,this._ignoreVariables=null,this._variableSubstitutes={},this.readOnly={},this.userGuideLinks={},this.namelist=null;e=localStorage.getItem("".concat(I._localStorageKey,"_view"));this.view=e?JSON.parse(e):{groups:{}},this._dateTimePickers={}}return a(I,[{key:"max_dom",get:function(){var t;return null!=(t=null==(t=this.namelist.domains)?void 0:t.max_dom)?t:1}},{key:"timeZone",get:function(){return this.options.timeZone},set:function(e){this.options.timeZone=e;for(var t=0,i=Object.values(this._dateTimePickers);t<i.length;t++)for(var s=i[t],a=0,n=Object.values(s);a<n.length;a++)n[a].forEach(function(t){t.displayTimeZone=e})}},{key:"openNamelistWpsAsync",value:(s=G(B().mark(function t(e,i){var s,a,n;return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(this._empty(),this.namelist=null!=(s=this.namelist)?s:{},this._setReadOnlyNamelistValue("domains","max_dom",e.share.max_dom),this._setReadOnlyNamelistValue("domains","e_we",e.geogrid.e_we),this._setReadOnlyNamelistValue("domains","e_sn",e.geogrid.e_sn),this._setReadOnlyNamelistValue("domains","dx",nt(e.geogrid.map_proj,e.geogrid.dx)),this._setReadOnlyNamelistValue("domains","dy",nt(e.geogrid.map_proj,e.geogrid.dy)),a=[],n=1;n<=e.share.max_dom;n++)a.push(n);return this._setReadOnlyNamelistValue("domains","grid_id",a),this._setReadOnlyNamelistValue("domains","parent_id",e.geogrid.parent_id),this._setReadOnlyNamelistValue("domains","i_parent_start",e.geogrid.i_parent_start),this._setReadOnlyNamelistValue("domains","j_parent_start",e.geogrid.j_parent_start),this._setReadOnlyNamelistValue("domains","parent_grid_ratio",e.geogrid.parent_grid_ratio),t.next=16,this._initVariablesAsync();case 16:this._empty(),this._initEditorFields(i);case 18:case"end":return t.stop()}},t,this)})),function(t,e){return s.apply(this,arguments)})},{key:"openNamelistInputAsync",value:(i=G(B().mark(function t(e,i){var s,a,n,r,o,h,l,d,u,c,_,p,g,f;return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=[],this._empty(),t.next=4,this._initVariablesAsync();case 4:if(void 0===(a=new m(e)).domains)return result.errors.push("domains variable group not found in namelist"),t.abrupt("return");t.next=8;break;case 8:if(void 0===a.domains.max_dom)return result.errors.push("variable 'max_dom' not found in namelist"),t.abrupt("return");t.next=11;break;case 11:if(n=parseInt(a.domains.max_dom),isNaN(n))return s.push("variable 'max_dom' is not a valid integer"),t.abrupt("return");t.next=15;break;case 15:r=0,o=Object.keys(a);case 16:if(r<o.length){if(h=o[r],void 0===(l=this.variables[h]))return s.push("Unknown variable group ".concat(h)),t.abrupt("continue",42);t.next=22}else t.next=45;break;case 22:d=0,u=Object.keys(a[h]);case 23:if(d<u.length){if(c=u[d],void 0===(_=l[c]))return s.push("Unknown variable ".concat(c," in group ").concat(h)),t.abrupt("continue",39);t.next=29}else t.next=42;break;case 29:t.t0=_.entries,t.next=t.t0===I.entries.maxDom?32:t.t0===I.entries.maxEta?35:t.t0===I.entries.single?37:39;break;case 32:for(m.convertToArray(a[h],c);a[h][c].length<n;)a[h][c].push(a[h][c][0]);return t.abrupt("break",39);case 35:return m.convertToArray(a[h],c),t.abrupt("break",39);case 37:return Array.isArray(a[h][c])&&(a[h][c]=a[h][c][0]),t.abrupt("break",39);case 39:d++,t.next=23;break;case 42:r++,t.next=16;break;case 45:for(this.namelist=a,p=0,g=s;p<g.length;p++)f=g[p],console.warn(f);return this._initEditorFields(i),t.abrupt("return",{errors:0<s.length?s:null,hasErrors:0<s.length});case 49:case"end":return t.stop()}},t,this)})),function(t,e){return i.apply(this,arguments)})},{key:"toText",value:function(){for(var r=this,o="",h=0,l=Object.entries(this.variables);h<l.length;h++)!function(){for(var t=z(l[h],2),e=t[0],t=t[1],i=[],s=0,a=Object.keys(t);s<a.length;s++){var n=a[s];!0===r._isNamelistValueSet(e,n)&&i.push(n)}if(0===i.length)return;t=i.map(function(t){return r.namelist[e][t]}),t=m.formatSection(e,i,t);o+=t}();return o}},{key:"goToTop",value:function(){this.clearHighlight(),this.container.scrollIntoView()}},{key:"goToGroup",value:function(t){this.clearHighlight();t=this.container.querySelector('div.namelist-input-group[data-group="'.concat(t,'"]'));t&&(t.classList.add("namelist-input-group-highlight"),this._expandGroup(t),t.scrollIntoView())}},{key:"_expandGroup",value:function(t){this._toggleGroupHideUnset(t,!1),this._toggleGroupCollapse(t.querySelector("div.namelist-input-variables"),I.collpaseCommands.show),this._toggleGroupVariableHideUnset(t,!1)}},{key:"clearHighlight",value:function(){this.container.querySelectorAll("div.namelist-input-variable.namelist-input-variable-highlight").forEach(function(t){t.classList.remove("namelist-input-variable-highlight")}),this.container.querySelectorAll("div.namelist-input-group.namelist-input-group-highlight").forEach(function(t){t.classList.remove("namelist-input-group-highlight")})}},{key:"goToVariable",value:function(t){this.clearHighlight(),t in this._variableSubstitutes&&(t=this._variableSubstitutes[t]);var e,i,s=this.container.querySelector('div.namelist-input-variable[data-variable="'.concat(t,'"]'));s&&(s.classList.add("namelist-input-variable-highlight"),t=s.closest("div.namelist-input-variables.collapse"),e=s.closest("div.namelist-input-group"),!1===(i=t.classList.contains("show"))&&$(t).one("shown.bs.collapse",function(t){s.scrollIntoView()}),this._expandGroup(e),!0===i)&&s.scrollIntoView()}},{key:"collapseGroups",value:function(){this._toggleAllGroupsCollapse(I.collpaseCommands.hide)}},{key:"expandGroups",value:function(t){this._toggleAllGroupsCollapse(I.collpaseCommands.show)}},{key:"hideUnsetVariables",value:function(){this._toggleVariableHideUnset(!0)}},{key:"showUnsetVariables",value:function(){this._toggleVariableHideUnset(!1)}},{key:"hideUnsetGroups",value:function(){this._toggleAllGroupsHideUnset(!0)}},{key:"showUnsetGroups",value:function(){this._toggleAllGroupsHideUnset(!1)}},{key:"_toggleGroupCollapse",value:function(t,e){$(t).collapse(e);var i=t.previousSibling.querySelector('button[data-toggle="collapse"] i');switch(e){case I.collpaseCommands.hide:i.classList.remove(I.iconClass.open),i.classList.add(I.iconClass.collapsed);break;case I.collpaseCommands.show:i.classList.remove(I.iconClass.collapsed),i.classList.add(I.iconClass.open)}}},{key:"_toggleAllGroupsCollapse",value:function(e){var t,i=this;for(t in this.container.querySelectorAll("div.namelist-input-variables.collapse").forEach(function(t){i._toggleGroupCollapse(t,e)}),this.view.groups)this.view.groups[t].collapse=e===I.collpaseCommands.hide;this._storeView()}},{key:"_toggleGroupHideUnset",value:function(t,e){!0===e?t.classList.add("namelist-input-hide-unset"):t.classList.remove("namelist-input-hide-unset")}},{key:"_toggleAllGroupsHideUnset",value:function(e){var i=this;this.container.querySelectorAll("div.namelist-input-group").forEach(function(t){i._toggleGroupHideUnset(t,e)}),this.view.hideUnsetGroups=e,this._storeView()}},{key:"_toggleGroupVariableHideUnset",value:function(t,e){var i=t.querySelector(".namelist-input-variables");!0===e?i.classList.add("namelist-input-hide-unset"):i.classList.remove("namelist-input-hide-unset"),t.querySelector(".namelist-input-group-header").querySelector('input[name="switch-hide-unset"]').checked=e}},{key:"_toggleVariableHideUnset",value:function(e){var t,i=this;for(t in this.container.querySelectorAll("div.namelist-input-group").forEach(function(t){i._toggleGroupVariableHideUnset(t,e)}),this.view.groups)this.view.groups[t].hideUnsetVariables=e;this._storeView()}},{key:"_isNamelistValueSet",value:function(t,e){return void 0!==this.namelist[t]&&void 0!==this.namelist[t][e]&&null!==this.namelist[t][e]}},{key:"_setNamelistValue",value:function(t,e,i){var s;this.namelist[t]=null!=(s=this.namelist[t])?s:{},this.namelist[t][e]=i}},{key:"_setReadOnlyNamelistValue",value:function(t,e,i){this._setNamelistValue(t,e,i),this.readOnly[t]=null!=(i=this.readOnly[t])?i:{},this.readOnly[t][e]=!0}},{key:"_isReadOnly",value:function(t,e){return void 0!==this.readOnly[t]&&!0===this.readOnly[t][e]}},{key:"_empty",value:function(){for(this._dateTimePickers={};this.container.firstChild&&this.container.removeChild(this.container.firstChild););}},{key:"_initVariablesAsync",value:(t=G(B().mark(function t(){var e,i,s,a,n,r,o,h,l,d,u,c,_,p,g,f,m,y,v,b,M,x,w,L,k,S,j,G,E,A,C,N,T,P,O=this;return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==this.variables)return t.abrupt("return");t.next=2;break;case 2:return this.variables={},t.next=5,this._loadJsonAsync("namelist.input.select.values.json");case 5:return e=t.sent,t.next=8,this._loadJsonAsync("namelist.input.users.guide.json");case 8:return i=t.sent,t.next=11,this._loadJsonAsync("namelist.input.registry.json");case 11:return s=t.sent,t.next=14,this._loadJsonAsync("namelist.input.readme.json");case 14:return a=t.sent,t.next=17,this._loadJsonAsync("namelist.input.manual.json");case 17:n=t.sent,t.t0=B().keys(s);case 19:if((t.t1=t.t0()).done){t.next=61;break}r=t.t1.value,this.variables[r]={},t.t2=B().keys(s[r]);case 23:(t.t3=t.t2()).done?t.next=59:(o=t.t3.value,h=null,(l=i[r]&&i[r][o])&&i[r][o].description?h=i[r][o].description:o.comments&&0<o.comments.length&&(h=o.comments.join("; ")),d=s[r][o].defaultValue,u=null,t.t4=s[r][o].entries,t.next="max_domains"===t.t4?33:t.t4===I.entries.single||t.t4===I.entries.maxEta||t.t4===I.entries.maxDom||t.t4===I.entries.maxBogus||t.t4===I.entries.maxMoves||t.t4===I.entries.maxOcean||t.t4===I.entries.maxPressureLevels||t.t4===I.entries.maxZLevels?35:37);break;case 33:return u=I.entries.maxDom,t.abrupt("break",39);case 35:return u=s[r][o].entries,t.abrupt("break",39);case 37:return console.warn("Unknown variable ".concat(o," number entries value ").concat(s[r][o].entries)),t.abrupt("continue",23);case 39:l&&i[r][o].entries!==u?(t.t5=o,t.next="dx"===t.t5||"dy"===t.t5?43:"eta_levels"===t.t5?45:"nssl_alphah"===t.t5||"nssl_alphahl"===t.t5||"nssl_cnoh"===t.t5||"nssl_cnohl"===t.t5||"nssl_cnor"===t.t5||"nssl_cnos"===t.t5||"nssl_rho_qh"===t.t5||"nssl_rho_qs"===t.t5?47:"topo_wind"===t.t5||"gph"===t.t5?49:"max_obs"===t.t5?51:53):t.next=54;break;case 43:return u=I.entries.single,t.abrupt("break",54);case 45:return u=I.entries.maxEta,t.abrupt("break",54);case 47:return u=I.entries.single,t.abrupt("break",54);case 49:return u=I.entries.maxDom,t.abrupt("break",54);case 51:return u=I.entries.single,t.abrupt("break",54);case 53:console.warn("Variable ".concat(o," number of entries differ between registry ").concat(u," and users guide ").concat(i[r][o].entries));case 54:this.variables[r][o]={type:s[r][o].type,defaultValue:d,description:h,entries:u},e[r]&&e[r][o]&&e[r][o].values&&(this.variables[r][o].type=I.variableTypes.selection,this.variables[r][o].values=e[r][o].values),r in I._dateTimePickers&&o in I._dateTimePickers[r]&&(this.variables[r][o].type=I.variableTypes.datetime),t.next=23;break;case 59:t.next=19;break;case 61:for(c in n)for(p in this.variables[c]=null!=(_=this.variables[c])?_:{},n[c])this.variables[c][p]=n[c][p];for(g={},f=0,m=Object.entries(this.variables);f<m.length;f++)(y=z(m[f],2))[0],y=y[1],Object.keys(y).forEach(function(t){g[t]=null});t.t6=B().keys(a);case 65:if((t.t7=t.t6()).done){t.next=84;break}(v=t.t7.value)in this.variables||console.warn("README.namelist group ".concat(v," not found in WRF registry files")),t.t8=B().keys(a[v]);case 69:(t.t9=t.t8()).done?t.next=82:(b=t.t9.value,t.t10=b,t.next="io_style_emiss"===t.t10?74:"inputout_begin_mo"===t.t10||"inputout_end_mo"===t.t10?75:"ntiedtke_dx_opt"===t.t10?76:77);break;case 74:case 75:case 76:return t.abrupt("continue",69);case 77:if(b in g){t.next=80;break}return console.warn("README.namelist variable ".concat(b," not found in WRF registry files")),t.abrupt("continue",69);case 80:t.next=69;break;case 82:t.next=65;break;case 84:for(M in this._setDefaultValue("domains","time_step",60),i)this.userGuideLinks[M]="https://www2.mmm.ucar.edu/wrf/users/wrf_users_guide/build/html/namelist_variables.html#".concat(M.replace("_","-"));this._ignoreVariables={},x=q(I._ignoreVariables);try{for(x.s();!(w=x.n()).done;)(L=w.value)in this._ignoreVariables||(this._ignoreVariables[L]=null)}catch(t){x.e(t)}finally{x.f()}for(this._variableSubstitutes={},k=0,S=Object.values(I._dateTimePickers);k<S.length;k++)for(j=S[k],G=0,E=Object.entries(j);G<E.length;G++)for(C=z(E[G],2),A=C[0],C=C[1],N=0,T=Object.values(C.variables);N<T.length;N++)"string"!=typeof(P=T[N])||P in this._ignoreVariables||P===A||(this._ignoreVariables[P]=null,this._variableSubstitutes[P]=A);"function"==typeof this.options.onInitialize&&this.options.onInitialize.call(this,{sender:this,variables:this.variables}),this.dependencyMap={},this.dependencyMap.physics={},this.dependencyMap.physics.sf_urban_physics={updates:["num_urban_ndm","num_urban_ng","num_urban_nwr","num_urban_nz","num_urban_ngb","num_urban_nf","num_urban_nbui"]},this.variables.physics.num_urban_ndm.defaultValue=function(){var t=O.getValue("physics","sf_urban_physics")[0];return 2===t||3===t?2:1},this.variables.physics.num_urban_ng.defaultValue=function(){var t=O.getValue("physics","sf_urban_physics")[0];return 2===t||3===t?10:1},this.variables.physics.num_urban_nwr.defaultValue=function(){var t=O.getValue("physics","sf_urban_physics")[0];return 2===t||3===t?10:1},this.variables.physics.num_urban_nz.defaultValue=function(){var t=O.getValue("physics","sf_urban_physics")[0];return 2===t||3===t?18:1},this.variables.physics.num_urban_ngb.defaultValue=function(){var t=O.getValue("physics","sf_urban_physics")[0];return 2===t||3===t?10:1},this.variables.physics.num_urban_nf.defaultValue=function(){var t=O.getValue("physics","sf_urban_physics")[0];return 2===t||3===t?10:1},this.variables.physics.num_urban_nbui.defaultValue=function(){var t=O.getValue("physics","sf_urban_physics")[0];return 2===t||3===t?15:1};case 102:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"_loadJsonAsync",value:(e=G(B().mark(function t(e){var i;return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i="".concat(this.options.jsonBaseUrl,"/").concat(e),t.next=3,fetch(i);case 3:return i=t.sent,t.next=6,i.json();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"_setDefaultValue",value:function(t,e,i){this.variables[t][e].defaultValue=i}},{key:"_getDefaultValue",value:function(t,e){return"function"!==P(this.variables[t][e].defaultValue)?this.variables[t][e].defaultValue:this.variables[t][e].defaultValue.call(this)}},{key:"_initEditorFields",value:function(t){var e={};"boolean"==typeof(e=t?Object.assign(e,t):e).hideUnsetGroups?this.view.hideUnsetGroups=e.hideUnsetGroups:this.view.hideUnsetGroups=null==(t=this.view.hideUnsetGroups)||t;for(var i=0,s=Object.entries(this.variables);i<s.length;i++){var a=z(s[i],2),n=a[0],a=a[1];0!==Object.keys(a).length&&this._initVariableGroup(n,a,e)}$(this.container).find("*[title]").tooltip(),this._storeView(),this._updateGroupView()}},{key:"_initVariableGroup",value:function(t,e,i){var s=this,a=this._append(this.container,"div"),i=(a.classList.add("namelist-input-group"),!0===this.view.hideUnsetGroups&&a.classList.add("namelist-input-hide-unset"),a.dataset.group=t,this.view.groups=null!=(n=this.view.groups)?n:{},this.view.groups[t]=null!=(n=this.view.groups[t])?n:{},"boolean"==typeof i.collapseGroups?this.view.groups[t].collapse=i.collapseGroups:this.view.groups[t].collapse=null!=(n=this.view.groups[t].collapse)&&n,"boolean"==typeof i.hideUnsetVariables?this.view.groups[t].hideUnsetVariables=i.hideUnsetVariables:this.view.groups[t].hideUnsetVariables=null==(n=this.view.groups[t].hideUnsetVariables)||n,!0===this.view.groups[t].collapse?I.iconClass.collapsed:I.iconClass.open),n=this._append(a,"div"),r=(n.classList.add("namelist-input-group-header"),""),r=(r+='<button class="btn btn-sm" type="button" data-toggle="collapse" data-target="#'.concat(t,'" aria-expanded="false" aria-controls="').concat(t,'"><i class="fas ').concat(i,'"></i></button>'))+"<h5>".concat(A(t),"</h5>")+'<span class="badge badge-pill namelist-input-set-variable-count" style="display: none;" title="Number of variables set in this group"></span>';t in this.userGuideLinks&&(r+='<a href="'.concat(A(this.userGuideLinks[t]),'" target="_blank" class="namelist-input-variables-user-guide-link ml-3" title="Open WRF User\'s Guide page for this group in a new tab"><i class="fas fa-info-circle"></i></a>')),r=(r+='<div class="namelist-input-group-header-switch"><label class="switch ml-2">')+'<input type="checkbox" name="switch-hide-unset" id="switch-hide-unset-'.concat(A(t),'"'),!0===this.view.groups[t].hideUnsetVariables&&(r+=" checked"),n.innerHTML=r=(r=r+'><span class="slider round"></span>'+"</label>")+"<span>Hide Unset</span>"+"</div>",n.querySelector('button[data-toggle="collapse"]').addEventListener("click",function(t){var e=t.currentTarget.querySelector("i"),t=t.currentTarget.dataset.target.replace("#","");e.classList.contains(I.iconClass.open)?(e.classList.remove(I.iconClass.open),e.classList.add(I.iconClass.collapsed),s.view.groups[t].collapse=!0):(e.classList.remove(I.iconClass.collapsed),e.classList.add(I.iconClass.open),s.view.groups[t].collapse=!1),s._storeView()}),n.querySelector("input#switch-hide-unset-".concat(t)).addEventListener("change",function(t){var e=t.currentTarget.closest(".namelist-input-group"),i=e.dataset.group,e=e.querySelector("div.namelist-input-variables");s.view.groups[i].hideUnsetVariables=t.currentTarget.checked,!0===t.currentTarget.checked?e.classList.add("namelist-input-hide-unset"):e.classList.remove("namelist-input-hide-unset"),s._storeView()}),this.namelist[t]=null!=(i=this.namelist[t])?i:{},this._appendGroupVariableFields(a,t,e)}},{key:"_updateGroupView",value:function(){this.container.querySelectorAll("div.namelist-input-group").forEach(function(t){var e=t.querySelectorAll("div.namelist-input-variable:not(.namelist-input-variable-unset)").length,i=t.querySelector("div.namelist-input-group-header span.namelist-input-set-variable-count");0<e?(i.innerText=e,i.style.display=null,t.classList.remove("namelist-input-group-unset")):(i.innerText="0",i.style.display="none",t.classList.add("namelist-input-group-unset"))})}},{key:"_storeView",value:function(){localStorage.setItem("".concat(I._localStorageKey,"_view"),JSON.stringify(this.view))}},{key:"_appendGroupVariableFields",value:function(t,e,i){var s=this._append(t,"div");s.classList.add("namelist-input-variables"),s.classList.add("collapse"),!1===this.view.groups[e].collapse&&s.classList.add("show"),this.view.groups[e].hideUnsetVariables&&s.classList.add("namelist-input-hide-unset"),s.id=e;for(var a=0,n=Object.entries(i);a<n.length;a++){var r=z(n[a],2),o=r[0],r=r[1];this._appendVariableField(s,e,o,r)}}},{key:"_appendVariableField",value:function(t,i,s,e){var r=this;if(s in this._ignoreVariables)console.debug("Skipping ignored variable ".concat(s));else{console.debug("Creating variable ".concat(s," input"));var a=this._append(t,"div"),n=(a.classList.add("namelist-input-variable"),a.dataset.default=this._getDefaultValue(i,s),a.dataset.variable=s,this._isNamelistValueSet(i,s)),o=this._isReadOnly(i,s),h=this.namelist[i],l=(!1===n&&a.classList.add("namelist-input-variable-unset"),"");switch(l+='<button class="btn btn-sm btn-outline-secondary btn-namelist-input-erase" type="button"',!0===o&&(a.classList.add("namelist-input-variable-readonly"),l+=" disabled"),l=l+'><i class="fas fa-eraser"></i></button>'+'<div class="namelist-input-variable-name">',e.type===I.variableTypes.datetime?I._dateTimePickers[i][s].title&&(l+=A(I._dateTimePickers[i][s].title)):l+=A(s),l+="</div>",e.entries){case I.entries.maxDom:for(var d=0;d<this.max_dom;d++)l+=this._getInputFieldHtml(s,e,n?h[s][d]:this._getDefaultValue(i,s),o,d);break;case I.entries.single:l+=this._getInputFieldHtml(s,e,n?h[s]:this._getDefaultValue(i,s),o,null);break;case I.entries.maxEta:}if(e.type===I.variableTypes.datetime?I._dateTimePickers[i][s].description&&(l=(l=(l+='<div class="namelist-input-variable-description">')+A(I._dateTimePickers[i][s].description))+" (".concat(Object.values(I._dateTimePickers[i][s].variables).join(", "),")")+"</div>"):e.description&&(l=(l+='<div class="namelist-input-variable-description">')+A(e.description)+"</div>"),a.innerHTML=l+="</div>",!0!==o)switch(a.querySelector("button.btn-namelist-input-erase").addEventListener("click",function(t){var t=t.currentTarget.closest("div.namelist-input-variable"),i=t.closest("div.namelist-input-group").dataset.group,s=t.dataset.variable;if(t.classList.add("namelist-input-variable-unset"),r.variables[i][s].type===I.variableTypes.datetime){for(var e in I._dateTimePickers[i][s].variables)r.namelist[i][I._dateTimePickers[i][s].variables[e]]=null;r._dateTimePickers[i][s].forEach(function(t,e){t.valueUtc=r._getNamelistDateTimeValueUtc(i,I._dateTimePickers[i][s].variables,e)})}else r.namelist[i][s]=null,r._updateVariableFieldValue(i,s),r._updateDependentVariables(i,s);r._fireChange(i,s)}),e.type){case I.variableTypes.selection:this._addVariableFieldListeners(a,"select",s,"change",function(t){return parseInt(t.value)});break;case I.variableTypes.logical:this._addVariableFieldListeners(a,"input",s,"change",function(t){return t.checked});break;case I.variableTypes.integer:this._addVariableFieldListeners(a,"input",s,"change",function(t){return parseInt(t.value)});break;case I.variableTypes.real:this._addVariableFieldListeners(a,"input",s,"change",function(t){return parseFloat(t.value)});break;case I.variableTypes.character:this._addVariableFieldListeners(a,"input",s,"change",function(t){return t.value});break;case I.variableTypes.datetime:a.querySelectorAll("div.namelist-input-datetime-picker").forEach(function(t,e){t=new bs(t,{onChange:function(t){var t=t.sender.widget.closest("div.namelist-input-variable"),e=t.dataset.variable,i=t.closest("div.namelist-input-group").dataset.group;switch(t.classList.remove("namelist-input-variable-unset"),r.variables[i][e].entries){case I.entries.single:var s=r._dateTimePickers[i][e][0].valueUtc;for(a in I._dateTimePickers[i][e].variables)r._setNamelistValue(i,I._dateTimePickers[i][e].variables[a],s[a]);break;case I.entries.maxDom:var a,n=r._dateTimePickers[i][e].map(function(t){return t.valueUtc});for(a in I._dateTimePickers[i][e].variables)r._setNamelistValue(i,I._dateTimePickers[i][e].variables[a],n.map(function(t){return t[a]}))}r._fireChange(i,e)},displayTimeZone:r.options.timeZone,valueUtc:r._getNamelistDateTimeValueUtc(i,I._dateTimePickers[i][s].variables,e)});r._dateTimePickers[i]=null!=(e=r._dateTimePickers[i])?e:{},r._dateTimePickers[i][s]=null!=(e=r._dateTimePickers[i][s])?e:[],r._dateTimePickers[i][s].push(t)})}}}},{key:"_getNamelistDateTimeValueUtc",value:function(t,e,i){return{year:this._getNamelistVariableValue(t,e.year,this.variables[t][e.year],i),month:this._getNamelistVariableValue(t,e.month,this.variables[t][e.month],i),day:this._getNamelistVariableValue(t,e.day,this.variables[t][e.day],i),hour:this._getNamelistVariableValue(t,e.hour,this.variables[t][e.hour],i),minute:this._getNamelistVariableValue(t,e.minute,this.variables[t][e.minute],i),second:e.second?this._getNamelistVariableValue(t,e.second,this.variables[t][e.second],i):null}}},{key:"_getNamelistVariableValue",value:function(t,e,i,s){if(!0===this._isNamelistValueSet(t,e))switch(i.entries){case I.entries.maxDom:return this.namelist[t][e][s];case I.entries.single:return this.namelist[t][e]}return this._getDefaultValue(t,e)}},{key:"getValue",value:function(t,e){return!0===this._isNamelistValueSet(t,e)?this.namelist[t][e]:this._getDefaultValue(t,e)}},{key:"_updateVariableFieldValue",value:function(t,e){var i=this.variables[t][e],s=this._isNamelistValueSet(t,e);switch(i.entries){case I.entries.maxDom:for(var a=0;a<this.max_dom;a++)this._setInputFieldValue(t,e,i,s?this.namelist[t][e][a]:this._getDefaultValue(t,e),a);break;case I.entries.single:this._setInputFieldValue(t,e,i,s?this.namelist[t][e]:this._getDefaultValue(t,e),null);break;case I.entries.maxEta:}}},{key:"_setInputFieldValue",value:function(t,e,i,s,a){var n=this._getInputFieldId(e,a);switch(i.type){case I.variableTypes.selection:document.querySelector("select#".concat(n)).value=s;break;case I.variableTypes.logical:document.querySelector("input#".concat(n)).checked=s;break;case I.variableTypes.integer:case I.variableTypes.real:case I.variableTypes.character:document.querySelector("input#".concat(n)).value=s;break;case I.variableTypes.datetime:this._dateTimePickers[t][e][null!=a?a:0].valueUtc=this._getNamelistDateTimeValueUtc(t,I._dateTimePickers[t][e].variables,a)}}},{key:"_addVariableFieldListeners",value:function(t,a,e,i,n){var r=this;t.querySelectorAll("".concat(a,'[name="').concat(e,'"]')).forEach(function(t){t.addEventListener(i,function(t){var e=t.currentTarget.name,i=document.querySelector('div.namelist-input-variable[data-variable="'.concat(e,'"]')),s=i.closest("div.namelist-input-group").dataset.group;switch(i.classList.remove("namelist-input-variable-unset"),r.variables[s][e].entries){case I.entries.single:r._setNamelistValue(s,e,n.call(r,t.currentTarget));break;case I.entries.maxDom:r._setNamelistValue(s,e,r._listVariableFields(s,e,a).map(function(t){return n.call(r,t)}))}r._updateDependentVariables(s,e),r._fireChange(s,e)})})}},{key:"_updateDependentVariables",value:function(e,t){var i=this;e in this.dependencyMap&&t in this.dependencyMap[e]&&Array.isArray(this.dependencyMap[e][t].updates)&&this.dependencyMap[e][t].updates.forEach(function(t){i._updateVariableFieldValue(e,t)})}},{key:"_fireChange",value:function(t,e){"function"==typeof this.options.change&&this.options.change.call(this,{group:t,variable:e}),this._updateGroupView()}},{key:"_listVariableFields",value:function(t,e,i){var s=[];return document.querySelectorAll('div.namelist-input-group[data-group="'.concat(t,'"] div.namelist-input-variable[data-variable="').concat(e,'"] ').concat(i,"[name=").concat(e,"]")).forEach(function(t){s.push(t)}),s}},{key:"_getInputFieldId",value:function(t,e){return null!==e?"".concat(t,"_").concat(e):t}},{key:"_getInputFieldHtml",value:function(t,e,i,s,a){if(null==i)throw new Error("Variable ".concat(t," value is not defined"));var n='<div class="namelist-input-variable-value">',r=A(this._getInputFieldId(t,a)),o=A(t);switch(e.type){case I.variableTypes.selection:n+='<select class="form-control form-control-sm" id="'.concat(r,'" name="').concat(o,'"').concat(s?" readonly":""," required>");for(var h=0,l=Object.entries(e.values);h<l.length;h++){var d=z(l[h],2),u=d[0],d=d[1];n+='<option value="'.concat(u,'"'),null!==d&&u.toString()===d.toString()&&(n+=" selected"),n+=">".concat(u,": ").concat(d,"</option>")}n+="<select/>";break;case I.variableTypes.logical:n=(n=n+'<div class="namelist-input-variable-check">'+'<div class="form-check">')+'<input class="form-check-input" type="checkbox" id="'.concat(r,'" name="').concat(o,'"'),!0===s&&(n+=" readonly"),!0===i&&(n+=" checked"),n=(n+="/>")+"</div>"+"</div>";break;case I.variableTypes.integer:n=(n+='<input type="number" class="form-control form-control-sm" id="'.concat(r,'" name="').concat(o,'"'))+' value="'.concat(parseInt(i),'"'),!0===s&&(n+=" readonly"),n+=' step="1" required/>';break;case I.variableTypes.real:n=(n+='<input type="number" class="form-control form-control-sm" id="'.concat(r,'" name="').concat(o,'"'))+' value="'.concat(i.toFixed(this.options.floatDigits),'"'),!0===s&&(n+=" readonly"),n+=' step="0.001" required/>';break;case I.variableTypes.character:n+='<input type="text" class="form-control form-control-sm" id="'.concat(r,'" name="').concat(o,'"'),null!==i&&(n+=' value="'.concat(A(i),'"')),!0===s&&(n+=" readonly"),n+=" required />";break;case I.variableTypes.datetime:n=(n=(n=(n=(n+='<div class="input-group input-group-sm namelist-input-datetime-picker">')+'<input type="text" class="form-control" id="'.concat(r,'"')+">")+'<div class="input-group-addon input-group-append">'+'<div class="input-group-text">')+'<i class="far fa-calendar-alt"></i>'+"</div>")+"</div>"+"</div>";break;default:throw new Error("Unknown variable data type ".concat(e.type))}return n+"</div>"}},{key:"_append",value:function(t,e){e=document.createElement(e);return t.append(e),e}}]);var e,t,i,s}()),xs=(t(Ms,"entries",t(t(t({maxDom:"max_dom",single:"1",maxEta:"max_eta",maxBogus:"max_bogus",maxMoves:"max_moves",maxOcean:"max_ocean"},"maxOcean","max_ocean"),"maxPressureLevels","max_plevs"),"maxZLevels","max_zlevs")),t(Ms,"variableTypes",{integer:"integer",logical:"logical",real:"real",character:"character",selection:"selection",datetime:"datetime"}),t(Ms,"_localStorageKey","_wrf_domain_wizard_namelist_input_editor"),t(Ms,"_dateTimePickers",{time_control:{start_year:{variables:{year:"start_year",month:"start_month",day:"start_day",hour:"start_hour",minute:"start_minute",second:"start_second"},description:"start time",title:"start time"},end_year:{variables:{year:"end_year",month:"end_month",day:"end_day",hour:"end_hour",minute:"end_minute",second:"end_second"},description:"end time",title:"end time"}}}),t(Ms,"_ignoreVariables",["julyr","julday","gmt"]),t(Ms,"collpaseCommands",{hide:"hide",show:"show"}),t(Ms,"iconClass",{collapsed:"fa-chevron-right",open:"fa-chevron-down"}),function(){function e(t){var v=this,t=(K(this,e),this.modal=document.getElementById("namelist-input-dialog"),this.header=this.modal.querySelector("div.modal-header"),this.body=this.modal.querySelector("div.modal-body"),this.footer=this.modal.querySelector("div.modal-footer"),this.editor=new Ms(this.body.querySelector("div#namelist-input-container"),Object.assign({change:function(t){v._updateText()},timeZone:null,onInitialize:function(t){for(var e=v.header.querySelector("select#go-to-group"),i=v.header.querySelector("select#go-to-variable"),s=[],a=[],n=0,r=Object.keys(t.variables);n<r.length;n++){var o=r[n];s.push(o);for(var h=0,l=Object.keys(t.variables[o]);h<l.length;h++){var d=l[h];a.push(d)}}s.sort(),a.sort();for(var u=0,c=s;u<c.length;u++){var _=c[u],p=document.createElement("option");p.value=_,p.innerText=_,e.append(p)}for(var g=0,f=a;g<f.length;g++){var m=f[g],y=document.createElement("option");y.value=m,y.innerText=m,i.append(y)}$(e).on("changed.bs.select",function(t){v.editor.goToGroup(e.value),i.value=null,$(i).selectpicker("refresh")}),$(e).selectpicker(),$(i).on("changed.bs.select",function(t){v.editor.goToVariable(i.value),e.value=null,$(e).selectpicker("refresh")}),$(i).selectpicker()}},t)),this.header.querySelector("button#go-to-top").addEventListener("click",function(t){v.editor.clearHighlight(),v._scrollToTop()}),this.text=this.body.querySelector("div#pane-namelist-input-text textarea"),this.original=this.body.querySelector("div#pane-namelist-input-original textarea"),this.footer.querySelector("#button-copy").addEventListener("click",function(t){navigator.clipboard.writeText(v.editor.toText())}),this.footer.querySelector("#button-save").addEventListener("click",function(t){var e=new Blob([v.editor.toText()],{type:"text/plain;charset=utf-8"});saveAs(e,"namelist.input",{autoBom:!0})}),this.tabErrors=document.getElementById("tab-namelist-input-errors").parentNode,this.tabOriginal=document.getElementById("tab-namelist-input-original").parentNode,localStorage.getItem("".concat(e._localStorageKey,"_view"))),s=(this.view=t?JSON.parse(t):{collapseGroups:!1,hideUnsetGroups:!0,hideUnsetVariables:!0},this.viewActions={collapseGroups:this.header.querySelector("#view-group-collapse-all"),expandGroups:this.header.querySelector("#view-group-expand-all"),showUnsetGroups:this.header.querySelector("#view-group-show-unset"),hideUnsetGroups:this.header.querySelector("#view-group-hide-unset"),showUnsetVariables:this.header.querySelector("#view-variables-show-unset"),hideUnsetVariables:this.header.querySelector("#view-variables-hide-unset")},this.viewActions.collapseGroups.addEventListener("click",function(t){v.view.collapseGroups=!0,v.editor.collapseGroups(),v._updateViewMenu()}),this.viewActions.expandGroups.addEventListener("click",function(t){v.view.collapseGroups=!1,v.editor.expandGroups(),v._updateViewMenu()}),this.viewActions.showUnsetGroups.addEventListener("click",function(t){v.view.hideUnsetGroups=!1,v.editor.showUnsetGroups(),v._updateViewMenu()}),this.viewActions.hideUnsetGroups.addEventListener("click",function(t){v.view.hideUnsetGroups=!0,v.editor.hideUnsetGroups(),v._updateViewMenu()}),this.viewActions.showUnsetVariables.addEventListener("click",function(t){v.view.hideUnsetVariables=!1,v.editor.showUnsetVariables(),v._updateViewMenu()}),this.viewActions.hideUnsetGroups.addEventListener("click",function(t){v.view.hideUnsetVariables=!0,v.editor.hideUnsetVariables(),v._updateViewMenu()}),this._updateViewMenu(),this.header.querySelector("#view-all").addEventListener("click",function(t){v.viewActions.expandGroups.click(),v.viewActions.showUnsetGroups.click(),v.viewActions.showUnsetVariables.click()}),this.header.querySelector("#view-min").addEventListener("click",function(t){v.viewActions.collapseGroups.click(),v.viewActions.hideUnsetGroups.click(),v.viewActions.hideUnsetVariables.click()}),this.header.querySelector("#view-compact").addEventListener("click",function(t){v.viewActions.expandGroups.click(),v.viewActions.hideUnsetGroups.click(),v.viewActions.hideUnsetVariables.click()}),this.header.querySelector("select#select-timezone"));moment.tz.names().forEach(function(t){var e=vs(),i=document.createElement("option");i.value=t,(i.innerText=t)==e&&(i.selected=!0),s.append(i)}),$(s).on("changed.bs.select",function(t){v.editor.timeZone=s.value})}return a(e,[{key:"_scrollToTop",value:function(){this.body.scrollTop=0}},{key:"_storeView",value:function(){localStorage.setItem("".concat(e._localStorageKey,"_view"),JSON.stringify(this.view))}},{key:"_updateViewMenu",value:function(){!0===this.view.collapseGroups?(this.viewActions.collapseGroups.classList.add("dropdown-selected"),this.viewActions.expandGroups.classList.remove("dropdown-selected")):(this.viewActions.collapseGroups.classList.remove("dropdown-selected"),this.viewActions.expandGroups.classList.add("dropdown-selected")),!0===this.view.hideUnsetGroups?(this.viewActions.hideUnsetGroups.classList.add("dropdown-selected"),this.viewActions.showUnsetGroups.classList.remove("dropdown-selected")):(this.viewActions.hideUnsetGroups.classList.remove("dropdown-selected"),this.viewActions.showUnsetGroups.classList.add("dropdown-selected")),!0===this.view.hideUnsetVariables?(this.viewActions.hideUnsetVariables.classList.add("dropdown-selected"),this.viewActions.showUnsetVariables.classList.remove("dropdown-selected")):(this.viewActions.hideUnsetVariables.classList.remove("dropdown-selected"),this.viewActions.showUnsetVariables.classList.add("dropdown-selected")),this._storeView()}},{key:"_openDialog",value:function(){$(this.modal).modal("show"),this._scrollToTop()}},{key:"openNamelistWpsAsync",value:(s=G(B().mark(function t(e){return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._resetTabs(),t.next=3,this.editor.openNamelistWpsAsync(e);case 3:this._updateText(),this._openDialog();case 5:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"openNamelistInputAsync",value:(i=G(B().mark(function t(e){var i;return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._resetTabs(),this.original.value=e,this.tabOriginal.style.display=null,t.next=5,this.editor.openNamelistInputAsync(e,this.view);case 5:i=t.sent,this._openDialog(),this._updateText(),i.hasErrors&&this._showErrors(i.errors);case 9:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"_resetTabs",value:function(){this.tabErrors.style.display="none",this.tabOriginal.style.display="none",$("#tab-namelist-input-editor").tab("show")}},{key:"_updateText",value:function(){this.text.value=this.editor.toText()}},{key:"_showErrors",value:function(t){this.tabErrors.style.display=null,this.tabErrors.querySelector("button").innerHTML='<span class="mr-1">Errors</span><span class="badge rounded-pill bg-danger text-white">'.concat(t.length,"</span>");var i=document.getElementById("pane-namelist-input-errors").querySelector("ul");i.innerHTML="",t.forEach(function(t){var e=document.createElement("li");e.classList.add("list-group-item"),e.innerHTML='<i class="fas fa-exclamation-circle text-danger"></i><span class="ml-1">'.concat(t,"</span>"),i.append(e)})}}]);var i,s}()),ws=(t(xs,"_localStorageKey","_wrf_domain_wizard_namelist_input_dialog"),function(){return a(function t(o,e,i){var s,a,h,n,r,l,d,u,c,_=this,p=(K(this,t),this.map=o,this),g=(this.options={jsonBaseUrl:"json",sampleBaseUrl:"samples",allowAnyFilename:!0,autoImageView:!1},i&&(this.options=Object.assign({},this.options,i)),s=$("#domains",e.getContainer()),n=new cs($("#container-wps-form",s),this.options),l=$("button#button-wps-new",s),i=$("button#button-wps-save",s),M=$("button#reset-domain",s),d=$("button#button-wps-open",s),$("button#save-png",s));function f(t){w(),(h=new us(a)).addTo(o),n.show(h),h.grid.select(),t&&(t=m(),o.fitBounds(h.grid.getBounds(),{paddingTopLeft:L.point(s.width()+s.offset().left,t.x),paddingBottomRight:L.point(t.x,t.y)}))}function m(){var t=o.getContainer();return L.point(.01*t.offsetWidth,.01*t.offsetHeight)}u=$("input#file-open",s),c=$("#capture-image-dialog"),M.on("click",function(t){f(!1)}),d.on("click",function(t){j(),u.click()});var y,v,b=new _s,M=(i.on("click",function(t){b.show(h)}),u.on("change",function(t){var e,i;t.target.files&&0!=t.target.files.length&&(!0!==_.options.allowAnyFilename&&"namelist.wps"!=t.target.files[0].name&&"wrfsi.nl"!=t.target.files[0].name?X("File Open Error",'Only files with the name "namelist.wps" or "wrfsi.nl" can be opened!'):(e=new FileReader,i=t.target.files[0].name,e.onerror=function(t){X("File Open Error","Unable to read file!")},e.onload=function(t){a="wrfsi.nl"==i?Z.converFromWRFSIString(t.target.result):new Z(t.target.result),f(!0)},e.readAsText(t.target.files[0]),u.val(null)))}),g.on("click",function(t){if(null!==h){c.modal("show");for(var e=o.getContainer(),i=o.getCenter(),s=o.getZoom(),a=e.getElementsByClassName("leaflet-control"),n=[],r=0;r<a.length;r++)!1===a[r].hidden&&(n.push(a[r]),a[r].hidden=!0);!0===_.options.autoImageView&&o.fitBounds(h.grid.getBounds(),{padding:m()}),htmlToImage.toBlob(e).then(function(t){ys.saveAs(t,"domains.png")}).catch(function(t){X("Create Image","Error creating an image")}).finally(function(){n.forEach(function(t){return t.hidden=!1}),!0===_.options.autoImageView&&o.setView(i,s),c.modal("hide")})}}),s[0].querySelector("button#button-namelist-input")),x=new xs({jsonBaseUrl:this.options.jsonBaseUrl});function w(){h&&(h.remove(),r=h=null,0<p._geogridCornerMarkerGroups.length)&&p._geogridCornerMarkerGroups.forEach(function(t){t.remove()})}function k(t){n.validateNewDomain()&&(o.dragging.disable(),o.on("mousemove",S,this),o.on("mouseup",j,this),o.on("mouseout",j,this),r={startLatlng:t.latlng,startMarker:L.marker(t.latlng,{icon:L.divIcon({className:"grid-corner-icon"})}).addTo(o),endMarker:L.marker(t.latlng,{icon:L.divIcon({className:"grid-corner-icon"})}).addTo(o),drawPolygon:null,domainOnMap:!1},h=n.createNewDomain())}function S(t){var e=L.latLngBounds(r.startLatlng,t.latlng);null==r.drawPolygon?r.drawPolygon=L.polygon([e.getSouthWest(),e.getSouthEast(),e.getNorthEast(),e.getNorthWest()],{stroke:!0,color:"#3388ff",weight:1,opacity:1,dashArray:"3",fill:!1}).addTo(o):r.drawPolygon.setLatLngs([e.getSouthWest(),e.getSouthEast(),e.getNorthEast(),e.getNorthWest()]),r.endMarker.setLatLng(t.latlng),e=e.getCenter(),h.setDefaultValues(e.lat,e.lng),e=Math.round(o.distance(r.startLatlng,[r.startLatlng.lat,t.latlng.lng])/h.dxInMeters),t=Math.round(o.distance(r.startLatlng,[t.latlng.lat,r.startLatlng.lng])/h.dyInMeters),e<tt.minGridSize||t<tt.minGridSize?(h.remove(),n.hide(),r.domainOnMap=!1):(h.grid.e_we=e,h.grid.e_sn=t,r.domainOnMap?h.update():(h.addTo(o),r.domainOnMap=!0,n.show()))}function j(t){o.dragging.enable(),o.off("mousedown",k,this),o.off("mousemove",S,this),o.off("mouseup",j,this),o.off("mouseout",j,this),l.prop("disabled",!1),r?(null!=r.drawPolygon&&r.drawPolygon.remove(),r.startMarker.remove(),r.endMarker.remove(),r.domainOnMap?a=h.getWPSNamelist():h=a=null):n.hide()}M.addEventListener("click",G(B().mark(function t(){return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.openNamelistWpsAsync(h.getWPSNamelist());case 2:case"end":return t.stop()}},t)}))),l.on("click",function(t){!function(){w(),l.prop("disabled",!0),o.on("mousedown",k,this),n.showNewDomain()}()}),this._geogridCornerMarkerGroups=[],location.hash&&(y=location.hash.substring(1),v="".concat(this.options.sampleBaseUrl,"/").concat(y,"/namelist.wps"),$.get(v,function(t){a=new Z(t),e.open("domains"),f(!0),_._addGeogridCorners(y)},"text").fail(function(){X("File Load Error","Unable to load "+v)}))},[{key:"_addGeogridCorners",value:function(t){this._addGeogridGridCorners(t,1)}},{key:"_addGeogridGridCorners",value:function(t,e){var i=this,s="".concat(this.options.sampleBaseUrl,"/").concat(t,"/geo_em.d").concat(e.toString().padStart(2,"0"),".nc.json"),a=!1;return fetch(s).then(function(t){if(!0===t.ok)return t.json();throw new Error("Geogrid JSON file ".concat(s," not found"))}).then(function(t){a=!0;t=L.featureGroup([i._createGeogridCornerMarker(t,"sw"),i._createGeogridCornerMarker(t,"nw"),i._createGeogridCornerMarker(t,"ne"),i._createGeogridCornerMarker(t,"se")]);t.addTo(i.map),i._geogridCornerMarkerGroups.push(t)}).then(function(){i._addGeogridGridCorners(t,e+1)}).catch(function(t){!0===a?console.error(t):console.debug(t)}),a}},{key:"_createGeogridCornerMarker",value:function(t,e){return L.marker(L.latLng(t.corner_lats[ps.unstaggered[e]],t.corner_lons[ps.unstaggered[e]]),{icon:L.divIcon({className:"geogrid-corner-icon",iconSize:8}),zIndexOffset:100})}}])}());var Ls=L.Control.Layers.extend({_localStorageKey:"_leaflet_persistent_layers",_layers:null,_currentBaseLayer:null,_overlays:null,_map:null,getCurrentLayer:function(){if(!this._currentBaseLayer){if(!this._layers)return null;var t=localStorage.getItem(this._localStorageKey+"_layer");t&&(this._currentBaseLayer=this._layers[t]),this._currentBaseLayer||(this._currentBaseLayer=this._getDefaultLayer())}return this._currentBaseLayer},_getDefaultLayer:function(){for(var t in this._layers)if(this._layers.hasOwnProperty(t))return this._layers[t];return null},_configZoom:function(){var t,e,i;this._currentBaseLayer&&(t=this._map.getZoom(),e=this._currentBaseLayer.options.minZoom||1,i=this._currentBaseLayer.options.maxZoom||13,this._map.setMinZoom(e),this._map.setMaxZoom(i),t<e?this._map.setZoom(e):i<t&&this._map.setZoom(i))},onAdd:function(t){var e=this;return(this._map=t).on("baselayerchange",function(t){localStorage.setItem(e._localStorageKey+"_layer",t.name),e._currentBaseLayer=e._layers[t.name],e._configZoom()}),this._configZoom(),L.Control.Layers.prototype.onAdd.call(this,t)},onRemove:function(t){t.off("baselayerchange")},initialize:function(t,e,i){this._layers=t,this._overlays=e,this._currentBaseLayer=this.getCurrentLayer(),L.Control.Layers.prototype.initialize.call(this,t,e,i)}});var C=L.GeoJSON.extend({getFeatureFilename:function(t){return t.properties.filename},getDownloadUrl:function(t,e){return e},data:null,_downloadedLayers:null,clearDownloaded:function(){null!=this._downloadedLayers&&($.each(this._downloadedLayers,function(){this.feature.downloaded=!1,this.setStyle({fillColor:null,fillOpacity:C.FillOpacity})}),this._downloadedLayers=null)},onAdd:function(t){var e,i;null==t.spin?this.addData(this.data):(t.spin(!0),setTimeout((e=this,i=t,function(){e.addData(e.data),i.spin(!1)}),1))},onRemove:function(t){this.clearLayers(this.data)},initialize:function(t,e){var n=this;null==e&&(C.CurrentColor>=C.Colors.length&&(C.CurrentColor=0),e=C.Colors[C.CurrentColor],C.CurrentColor++),L.setOptions(this,{style:{weight:C.Weight,fillOpacity:C.FillOpacity,color:e},onEachFeature:function(e,i){var t,s,a;i.on("mouseover",function(t){e.downloaded?i.setStyle({weight:3*C.Weight}):i.setStyle({weight:3*C.Weight,fillOpacity:3*C.FillOpacity})}),i.on("mouseout",function(t){e.downloaded?i.setStyle({weight:C.Weight}):i.setStyle({weight:C.Weight,fillOpacity:C.FillOpacity})}),e.downloaded&&i.setStyle({fillColor:C.ColorDownloaded,fillOpacity:3*C.FillOpacity}),(s=n.getFeatureFilename(e))&&(a=n.getDownloadUrl(e,s),i.bindTooltip(s,{sticky:!0,className:"tooltip-srtm"}),t='<div class="popup-elevation-data"><table>',null!=n.options.attribution&&(t+="<tr><td>Source:</td><td>"+n.options.attribution+"</td></tr>"),void 0!==n.registrationUrl&&(t+='<tr><td>Registration:</td><td><i class="fas fa-shield-alt text-danger"></i> <a href="'+n.registrationUrl+'" target="_blank">'+n.registrationUrl+"</a></td></tr>"),i.bindPopup(t=t+("<tr><td>Filename:</td><td>"+s+"</td></tr>")+('</table><a class="btn btn-outline-secondary btn-sm" role="button" href="'+a+'" target="_blank">Download</a></div>')),i.on("popupopen",function(t){$("div.popup-elevation-data a",t.popup.getElement()).on("click",{popup:t.popup,layer:t.sourceTarget,downloadUrl:a,feature:e},function(t){t.data.feature.downloaded=!0,t.data.layer.setStyle({fillColor:C.ColorDownloaded,fillOpacity:3*C.FillOpacity}),null==n._downloadedLayers&&(n._downloadedLayers=[]),t.data.layer.feature=t.data.feature,n._downloadedLayers.push(t.data.layer),t.data.layer.closePopup(),t.data.layer.fire("elevationDataDownload",{downloadUrl:a,filename:s,feature:t.data.feature,layer:t.data.layer,source:n},!0)})}))}}),L.GeoJSON.prototype.initialize.call(this,null,this.options),$.getJSON(t,function(t){n.data=t})}}),ks=(C.Colors=["#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],C.ColorDownloaded="#e41a1c",C.CurrentColor=0,C.Weight=1,C.FillOpacity=.1,C.extend({attribution:'Provided by Japan Aerospace Exploration Agency (JAXA), product <a href="https://www.eorc.jaxa.jp/ALOS/en/aw3d30/" target="_blank">aw3d30</a>.',downloadBaseUrl:"ftp://ftp.eorc.jaxa.jp/",registrationUrl:"https://www.eorc.jaxa.jp/ALOS/en/aw3d30/registration.htm",getFeatureFilename:function(t){return t.properties.filename},getDownloadUrl:function(t,e){return this.downloadBaseUrl+t.properties.path+"/"+e},initialize:function(t,e){L.setOptions(this,{attribution:this.attribution}),C.prototype.initialize.call(this,t,e)}}));var Ss=C.extend({attribution:'Jarvis A., H.I. Reuter, A. Nelson, E. Guevara, 2008, Hole-filled seamless SRTM data V4, International Centre for Tropical Agriculture (CIAT), available from <a href="http://srtm.csi.cgiar.org" target="_blank">http://srtm.csi.cgiar.org</a>.',downloadBaseUrl:"http://srtm.csi.cgiar.org/wp-content/uploads/files/",downloadFolderByTileSize:{5:"srtm_5x5",30:"srtm_30x30"},downloadFolderByType:{TIFF:"TIFF",ASCII:"ASCII"},getFeatureFilename:function(t){return t.properties.SUFF_NAME&&"_"==t.properties.SUFF_NAME[0]?t.properties.SUFF_NAME.substring(1):t.properties.SUFF_NAME},getDownloadUrl:function(t,e){return this.downloadBaseUrl+e},initialize:function(t,e,i,s){if(e=e.toUpperCase().trim(),!this.downloadFolderByTileSize[i])throw"Invalid SRTM-CSI tile size";if(this.downloadBaseUrl+=this.downloadFolderByTileSize[i]+"/",!this.downloadFolderByType[e])throw"Invalid SRTM-CSI type";this.downloadBaseUrl+=this.downloadFolderByType[e]+"/",L.setOptions(this,{attribution:this.attribution}),C.prototype.initialize.call(this,t,s)}});function js(t,e,i,s){return new Ss(t,e,i,s)}var Gs=C.extend({downloadBaseUrl:"https://e4ftl01.cr.usgs.gov/MEASURES/",registrationUrl:"https://urs.earthdata.nasa.gov/",getDownloadUrl:function(t,e){return this.downloadBaseUrl+e},initialize:function(t,e,i){var s;switch(e){case 1:s="SRTMGL1.003",L.setOptions(this,{attribution:'NASA JPL.NASA Shuttle Radar Topography Mission Global 1 arc second. 2013, distributed by NASA EOSDIS Land Processes DAAC, <a href="https://doi.org/10.5067/MEaSUREs/SRTM/SRTMGL1.003" target="_blank">https://doi.org/10.5067/MEaSUREs/SRTM/SRTMGL1.003</a>.'});break;case 3:s="SRTMGL3.003",L.setOptions(this,{attribution:'NASA JPL.NASA Shuttle Radar Topography Mission Global 3 arc second. 2013, distributed by NASA EOSDIS Land Processes DAAC, <a href="https://doi.org/10.5067/MEaSUREs/SRTM/SRTMGL3.003" target="_blank">https://doi.org/10.5067/MEaSUREs/SRTM/SRTMGL3.003</a>.'});break;default:throw"Invalid arc second dimension. Allowed values are 1 and 3"}this.downloadBaseUrl=this.downloadBaseUrl+s+"/2000.02.11/",C.prototype.initialize.call(this,t,i)}});function Es(t,e,i){return new Gs(t,e,i)}var As=L.Control.extend({options:{position:"bottomleft",precision:4,contextMenu:!1},initialize:function(t){L.Control.prototype.initialize.call(this,t)},onAdd:function(e){var t=L.DomUtil.create("div","leaflet-bar leaflet-touch leaflet-control leaflet-control-coordinates"),i=(this.latElement=L.DomUtil.create("div",null,t),this.lngElement=L.DomUtil.create("div",null,t),this);return e.on("mousemove",function(t){i.setCoordinates(t.latlng)}),!0===this.options.contextMenu&&e.on("contextmenu",function(t){i.popup&&i.popup.isOpen()&&i.popup.remove(),i.popup=L.popup().setLatLng(t.latlng).setContent("lat/lon: "+t.latlng.lat.toFixed(i.options.precision)+", "+t.latlng.lng.toFixed(i.options.precision)).openOn(e)}),i.setCoordinates(e.getCenter()),t},_addText:function(t,e){return t},setCoordinates:function(t){L.DomUtil.get(this.latElement).innerHTML="<span>lat: </span>"+t.lat.toFixed(this.options.precision),L.DomUtil.get(this.lngElement).innerHTML="<span>lon: </span>"+t.lng.toFixed(this.options.precision)}});Ze=a(function t(e){K(this,t);e=Object.assign({},{div:null,jsonBaseUrl:"json"},e);if(!e.div||!e.div.length||1!=e.div.length)throw"invalid div option";var i,s,a={noWrap:!0,bounds:L.latLngBounds([-90,-180],[90,180])},a=(a={"Esri World Topo":L.tileLayer.provider("Esri.WorldTopoMap",a),"Esri World Street":L.tileLayer.provider("Esri.WorldStreetMap",a),"Esri NatGeo":L.tileLayer.provider("Esri.NatGeoWorldMap",a),"Esri World Imagery":L.tileLayer.provider("Esri.WorldImagery",a),"Open Topo Map":L.tileLayer.provider("OpenTopoMap",a),"Open Street Map":L.tileLayer.provider("OpenStreetMap",a)},new Ls(a,null,{position:"topright"})),n=L.map(e.div[0],{layers:[a.getCurrentLayer()],center:[0,0],zoomControl:!1,zoom:Math.max(a.getCurrentLayer().options.minZoom,3)}),a=(a.addTo(n),L.control.sidebar({autopan:!1,closeButton:!1,container:"sidebar",position:"left",open:!0}).addTo(n)),r=$('ul[role="tablist"] li',a.getContainer());r.tooltip(),a.on("content",function(t){r.tooltip("hide")}),a.domains=(i={jsonBaseUrl:e.jsonBaseUrl,sampleBaseUrl:e.sampleBaseUrl},new ws(n,a,i)),a.settings=(i={jsonBaseUrl:e.jsonBaseUrl},new V(n,a,i)),a.waypoints=new J(n,a),a.elevation=new F(n,a),a.elevation.addElevationDataOverlay("SRTM-CSI 90m (5x5,TIFF)",js("".concat(e.jsonBaseUrl,"/srtm/csi/srtm30_5x5.json"),"TIFF",5)),a.elevation.addElevationDataOverlay("SRTM-CSI 90m (30x30,TIFF)",js("".concat(e.jsonBaseUrl,"/srtm/csi/srtm30_30x30.json"),"TIFF",30)),a.elevation.addElevationDataOverlay("SRTM NASA v3, 1 arc second (~30m)",Es("".concat(e.jsonBaseUrl,"/srtm/nasa/SRTMGL1.003.json"),1)),a.elevation.addElevationDataOverlay("SRTM NASA v3, 3 arc second (~90m)",Es("".concat(e.jsonBaseUrl,"/srtm/nasa/SRTMGL3.003.json"),3)),a.elevation.addElevationDataOverlay("ALOS World 3D - 30m (AW3D30)",(i="".concat(e.jsonBaseUrl,"/srtm/alos/AW3D30.json"),new ks(i,s))),a.open("domains"),L.control.zoom({position:"topright"}).addTo(n),L.control.scale({maxWidth:240,metric:!0,imperial:!0,position:"bottomright"}).addTo(n),new As({position:"bottomright"}).addTo(n),L.DomUtil.addClass(n._container,"cursor-crosshair")}),Ke=function(){return a(function t(e){var i=this;K(this,t),this.loader=document.getElementById("page-loader"),this.dialog=new xs(e),this.githubExampleList=document.getElementById("github-examples"),this.buttonOpen=document.getElementById("button-open"),this.buttonOpen.addEventListener("click",function(t){i.inputFile.value=null,i.inputFile.click()}),this.inputFile=document.getElementById("file-open"),this.inputFile.addEventListener("change",function(t){var e;t.target.files&&0!=t.target.files.length&&((e=new FileReader).onload=function(){var e=G(B().mark(function t(e){return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.dialog.openNamelistInputAsync(e.target.result);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),X("Error","Error opening namelist.input file '".concat(e.target.files[0],"'."));case 8:case"end":return t.stop()}},t,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}(),e.readAsText(t.target.files[0]),i.inputFile.value=null)})},[{key:"loadGitHubExamplesAsync",value:(t=G(B().mark(function t(){var e,i,s,a,n,r,o=this;return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loader.style.display="block",this.githubExampleList.style.display="none",this.githubExampleList.querySelectorAll("button").forEach(function(t){return t.remove()}),t.next=6,fetch("https://api.github.com/repos/wrf-model/WRF/git/trees/master?recursive=1");case 6:return e=t.sent,t.next=9,e.json();case 9:e=t.sent,i=0,s=q(e.tree),t.prev=12,s.s();case 14:if((a=s.n()).done){t.next=32;break}if(void 0!==(a=a.value).type&&void 0!==a.path&&"blob"===a.type.toLowerCase()&&a.path.toLowerCase().startsWith("test/em_real/namelist.input")){t.next=18;break}return t.abrupt("continue",30);case 18:n=document.createElement("button"),this.githubExampleList.append(n),n.type="button",n.dataset.path=a.path,n.dataset.file=a.path.substring(a.path.lastIndexOf("/")+1).toLowerCase(),n.dataset.url=a.url,n.innerText=a.path,n.classList.add("list-group-item"),n.classList.add("list-group-item-action"),i%2!=0&&n.classList.add("list-group-item-secondary"),i+=1,n.addEventListener("click",function(){var e=G(B().mark(function t(e){var i,s,a,n;return B().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=null!=(i=e.currentTarget)?i:e.target,void 0===(s=i.dataset.content))return a=i.dataset.url,t.next=6,fetch(a);t.next=12;break;case 6:return a=t.sent,t.next=9,a.json();case 9:n=t.sent,s=n.content,i.dataset.content=s;case 12:return t.prev=12,t.next=15,o.dialog.openNamelistInputAsync(atob(s));case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(12),console.error(t.t0),X("Error","Error opening example namelist.input file '".concat(i.dataset.path,"'."));case 21:case"end":return t.stop()}},t,null,[[12,17]])}));return function(t){return e.apply(this,arguments)}}());case 30:t.next=14;break;case 32:t.next=37;break;case 34:t.prev=34,t.t0=t.catch(12),s.e(t.t0);case 37:return t.prev=37,s.f(),t.finish(37);case 40:this.githubExampleList.style.display="block",this.loader.style.display="none",(r=null==(n=location.hash)?void 0:n.toLowerCase())&&r.startsWith("#namelist.")&&null!=(r=this.githubExampleList.querySelector('button[data-file="'.concat(r.substring(1),'"]')))&&r.click();case 44:case"end":return t.stop()}},t,this,[[12,34,37,40]])})),function(){return t.apply(this,arguments)})}]);var t}();N.DomainWizard=Ze,N.NamelistDateTimePicker=bs,N.NamelistInputPage=Ke,N.enableGlobalErrorHandler=function(){window.onerror=function(t,e,i,s,a){var n;t&&e&&a&&a.stack&&!e.toLowerCase().includes("/lib/")&&(n=document.getElementById("message-box-dialog-templates").querySelector('div[template="'.concat("global-error",'"]')),H.empty().title("Unexpected Error",W.types.error).html(n.innerHTML),n=(n="")+"Error: ".concat(t,"\n"),n=(n+="Timestamp: ".concat((new Date).toISOString(),"\n"))+"Source: ".concat(e,"\n"),n=(n=n+"Line: ".concat(i,"\n")+"Stack:\n")+"".concat(a.stack),H.dialogBody.querySelector("textarea").value=n,a="Error: "+t+" @ "+e+":"+i,H.dialogBody.querySelector("a#create-github-issue").href="https://github.com/JiriRichter/WRFDomainWizard/issues/new?labels=bug&title=".concat(encodeURI(a),"&body=").concat(encodeURI(n)),H.open())}},N.errorMessageBox=X});