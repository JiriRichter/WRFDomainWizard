!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).WRF=t.WRF||{})}(this,function(s){"use strict";function T(t){t=function(t,i){if("object"!=typeof t||!t)return t;var s=t[Symbol.toPrimitive];if(void 0===s)return("string"===i?String:Number)(t);if("object"!=typeof(s=s.call(t,i||"default")))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}function F(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function O(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,T(e.key),e)}}function t(t,i,s){return i&&O(t.prototype,i),s&&O(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function z(t,i,s){(i=T(i))in t?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s}var B=t(function t(e,i){F(this,t);var a,n=[],r=[],h=0;this.addElevationDataOverlay=function(t,i){var s="elevation-data-overlay-"+h;r.push({name:t,overlay:i}),h++,t=$('<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="'+s+'" data-overlay-name="'+t+'"><label class="custom-control-label" for="'+s+'">'+t+'</label><div class="elevation-data-history" style="display:none;"></div></div>'),a.append(t),i.downloadHistory=$("div.elevation-data-history",t),$("input#"+s,t).on("click",{overlay:i,map:e},function(t){this.checked?t.data.overlay.addTo(t.data.map):t.data.overlay.remove()}),i.on("elevationDataDownload",function(t){var i,s;i=t.source.downloadHistory,s=t.filename,t=t.downloadUrl,n.includes(t)||(n.push(t),i.append('<div><a href="'+t+'" title="'+t+'" target="_blank">'+s+"</a></div>"),i.show())})},i=$("#elevation-data",i.getContainer()),a=$("div.elevation-data-overlays",i),$("button",i).on("click",function(t){$.each(r,function(){this.overlay.clearDownloaded(),this.overlay.downloadHistory.empty()})})});var R=L.Class.extend({_map:null,_container:null,initialize:function(t,i){this._map=t,this._container=$("#settings",i.getContainer())}});var U=function(){function e(){F(this,e),this.container=$("div.modal#message-box-dialog"),this.dialogBody=$("div.modal-body",this.container),this.dialogTitle=$("div.modal-header h5.modal-title",this.container)}return t(e,[{key:"show",value:function(t,i,s){this.dialogTitle.empty(),s===e.types.error&&this.dialogTitle.html('<i class="fas fa-exclamation-circle text-danger"></i>'),s===e.types.info&&this.dialogTitle.html('<i class="fas fa-info-circle text-info"></i>'),s===e.types.warning&&this.dialogTitle.html('<i class="fas fa-exclamation-triangle text-warning"></i>'),this.dialogTitle.append(t),this.dialogBody.text(i),this.container.modal()}}]),e}(),W=(z(U,"types",{error:0,info:1,warning:2}),new U);function D(t,i){W.show(t,i,U.types.error)}function J(a,t){var i,s,n,r,h={},o=0;t=$("#waypoints",t.getContainer()),i=$("button#button-waypoints-add",t),s=$("button#button-waypoints-remove",t),n=$("input#file-waypoints",t),r=$("#waypoints-layers",t),i.on("click",function(t){n.click()}),s.on("click",function(t){object.keys(h).forEach(function(t){h[t].remove()}),h={},r.empty()}),n.on("change",function(t){var i,e;t.target.files&&0!=t.target.files.length&&(t.target.files[0].name.endsWith(".wpt")||t.target.files[0].name.endsWith(".cup")||t.target.files[0].name.endsWith(".gpx")?(i=new FileReader,e=t.target.files[0].name,i.onerror=function(t){D("File Open Error","Unable to read file!")},i.onload=function(t){var i=e,t=t.target.result,s="waypoints-layer-"+o;if(void 0!==h[i])D("File Open Error","File name "+i+" already loaded");else{try{h[i]=L.waypoints(L.Waypoints.parse(t)).addTo(a),a.fitBounds(h[i].getBounds())}catch(t){return void D("File Open Error","Unable to parse file "+i+": "+t)}o++,r.append($('<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="'+s+'" data-filename="'+i+'" checked><label class="custom-control-label" for="'+s+'">'+i+"</label></div>")),$("input#"+s,r).on("click",{layer:h[i],map:a},function(t){this.checked?t.data.layer.addTo(t.data.map):t.data.layer.remove()})}},i.readAsText(t.target.files[0]),n.val(null)):D("File Open Error","Only files with extensions .wpt, .cup and .gpx are allowed!"))})}var Q=function(){function h(t){F(this,h);for(var i,s,e=this._parse(t),a=null,n=null,r=0;r<e.length;r++)i=e[r].name,s=e[r].value,"group"==i?a=s.match(/^end$/i)?null:this[s]={}:"object"==i?n=s.toLowerCase():"character"!=i&&"integer"!=i&&"real"!=i&&"logical"!=i||(null==a[n]?a[n]=s:(Array.isArray(a[n])||(a[n]=[a[n]]),a[n].push(s)))}return t(h,[{key:"_parse",value:function(t){var i,s,a=[];function e(t,i,s,e){a.push({pos:t,name:i,value:s,index:3<arguments.length&&void 0!==e?e:null})}for(var n,r="initial",h=0,o=/(!.*)\n\s*/,l=/(?:&|\$)\s*([a-zA-Z_][\w]*)\s*/,d=/([a-zA-Z_][\w]*)\s*(\(\s*((\s*:\s*(\-|\+)?\d*){1,2}|((\-|\+)?\d+(\s*:\s*(\-|\+)?\d*){0,2}))(\s*,\s*(((\-|\+)?\d*(\s*:\s*(\-|\+)?\d*){0,2})))*\s*\)(\s*\(\s*(:\s*\d*|\d+(\s*:\s*\d*)?)\s*\))?)\s*=\s*/,_=/([a-zA-Z_][\w]*)\s*=\s*/,u=/([0-9]+)\s*\*\s*/,c=/\(\s*/,p=/\)\s*,?\s*/,g=/('((?:[^']+|'')*)'|"((?:[^"]+|"")*)")\s*,?\s*/,f=/([^'"\*\s,\/!&\$(=%\.][^\*\s,\/!&\$(=%\.]*)\s*,?\s*/,m=/(\d+[^\*\s\d,\/!&\$\(=%\.][^\s,\/!&\$\(=%\.]*)\s*,?\s*/,M=/(((\-|\+)?\d*\.\d*([eEdDqQ](\-|\+)?\d+)?)|((\-|\+)?\d+[eEdDqQ](\-|\+)?\d+))\s*,?\s*/,y=/((\-|\+)?\d+)\b\s*,?\s*/,x=/([tT][rR][uU][eE]|[tT]|[fF][aA][lL][sS][eE]|[fF])\s*,?\s*/,v=/(\.(([tT][rR][uU][eE]|[[fF][aA][lL][sS][eE])\.?|[tTfF]\w*))\s*,?\s*/,w=/\s*\b|\s*,\s*/,b=/[^&]*/;h<t.length;)if(i=t[h],s=t.substr(h),i.match(/!/)){if(!(n=o.exec(s))||0!=n.index)break;e(h,"comment",n[1]),h+=n[0].length,r="comment"}else if(i.match(/['"]/)){if(!(n=g.exec(s))||0!=n.index)break;e(h,"character",n[2]),h+=n[0].length,r="character"}else if(i.match(/\//))"object"==r&&e(h-1,"null",""),e(h,"group","end"),h++,r="group_end";else if(i.match(/[$&]/)){if(!(n=l.exec(s))||0!=n.index)break;r=n[1].match(/^end$/i)?("object"==r&&e(h-1,"null",""),"group_end"):"group_start",e(h,"group",n[1]),h+=n[0].length}else if(i.match(/\./))if((n=v.exec(s))&&0==n.index)e(h,"logical",n[1]),h+=n[0].length,r="logical";else{if(!(n=M.exec(s))||0!=n.index)break;e(h,"real",parseFloat(n[1])),h+=n[0].length,r="real"}else if(i.match(/[[a-zA-Z_]/))"group_end"==r||"initial"==r?(n=b.exec(s))&&0==n.index&&(e(h,"orphan",n[0]),h+=n[0].length,r="orphan"):(n=_.exec(s))&&0==n.index?("object"==r&&e(h-1,"null",""),e(h,"object",n[1]),h+=n[0].length,r="object"):(n=d.exec(s))&&0==n.index?(e(h,"array",n[1],n[2]),h+=n[0].length,r="array"):(n=x.exec(s))&&0==n.index?(e(h,"logical",n[1]),h+=n[0].length,r="logical"):(n=f.exec(s))&&0==n.index?(e(h,"nondelimited",n[1]),h+=n[0].length,r="nondelimited"):(e(h,"unknown",null),h++);else if(i.match(/\(/)){if(!(n=c.exec(s))||0!=n.index)break;e(h,"complex","start"),h+=n[0].length,r="complex_start"}else if(i.match(/\)/)){if(!(n=p.exec(s))||0!=n.index)break;e(h,"complex","end"),h+=n[0].length,r="complex_end"}else if(i.match(/[\+\-]/))if((n=M.exec(s))&&0==n.index)e(h,"real",parseFloat(n[1])),h+=n[0].length,r="real";else{if(!(n=y.exec(s))||0!=n.index)break;e(h,"integer",parseInt(n[1],10)),h+=n[0].length,r="integer"}else if(i.match(/[\d]/))if((n=u.exec(s))&&0==n.index)e(h,"repeat",n[1]),h+=n[0].length,r="repeat";else if((n=M.exec(s))&&0==n.index)e(h,"real",parseFloat(n[1])),h+=n[0].length,r="real";else if((n=y.exec(s))&&0==n.index)e(h,"integer",parseInt(n[1],10)),h+=n[0].length,r="integer";else{if(!(n=m.exec(s))||0!=n.index)break;e(h,"nondelimited",n[1]),h+=n[0].length,r="nondelimited"}else(n=w.exec(s))&&0==n.index?(e(h,"null",""),h+=n[0].length,r="null"):h++;return a}}]),h}(),V=function(){function n(t){F(this,n),this.share={wrf_core:"ARW",max_dom:1,start_year:null,start_month:null,start_day:null,start_hour:null,end_year:null,end_month:null,end_day:null,end_hour:null,start_date:null,end_date:null,interval_seconds:null,active_grid:!0,io_form_geogrid:2,output_from_geogrid:null,debug_level:0},this.geogrid={parent_id:1,parent_grid_ratio:null,i_parent_start:null,j_parent_start:null,s_we:1,e_we:null,s_sn:1,e_sn:null,geog_data_res:"default",dx:null,dy:null,map_proj:"lambert",ref_lat:null,ref_lon:null,ref_x:null,ref_y:null,truelat1:null,truelat2:null,stand_lon:null,pole_lat:90,pole_lon:0,geog_data_path:null,opt_geogrid_tbl_path:"./geogrid/"},this.ungrib={out_format:"WPS",prefix:"FILE",add_lvls:!1,interp_type:0,new_plvl:null,pmin:100},this.metgrid={fg_name:null,constants_name:null,io_form_metgrid:2,opt_output_from_metgrid_path:null,opt_metgrid_tbl_path:"./metgrid",process_only_bdy:0},"string"==typeof t&&("hgridspec"in(t=new Q(t))?this._createWRFSI(t):this._create(t))}return t(n,[{key:"_create",value:function(t){"share"in t&&(Object.assign(this.share,t.share),n._convertToArray(this.geogrid,"start_year"),n._convertToArray(this.geogrid,"start_month"),n._convertToArray(this.geogrid,"start_day"),n._convertToArray(this.geogrid,"start_hour"),n._convertToArray(this.geogrid,"end_year"),n._convertToArray(this.geogrid,"end_month"),n._convertToArray(this.geogrid,"end_day"),n._convertToArray(this.geogrid,"end_hour"),n._convertToArray(this.geogrid,"start_date"),n._convertToArray(this.geogrid,"end_date"),n._convertToArray(this.geogrid,"active_grid")),"geogrid"in t&&(Object.assign(this.geogrid,t.geogrid),n._convertToArray(this.geogrid,"parent_id"),n._convertToArray(this.geogrid,"parent_grid_ratio"),n._convertToArray(this.geogrid,"i_parent_start"),n._convertToArray(this.geogrid,"J_parent_start"),n._convertToArray(this.geogrid,"s_we"),n._convertToArray(this.geogrid,"e_we"),n._convertToArray(this.geogrid,"s_sn"),n._convertToArray(this.geogrid,"e_sn"),n._convertToArray(this.geogrid,"geog_data_res"),n._convertToArray(this.geogrid,"e_we")),"ungrib"in t&&Object.assign(this.ungrib,t.ungrib),"metgrid"in t&&Object.assign(this.metgrid,t.metgrid)}},{key:"_createWRFSI",value:function(t){this.share.wrf_core="AWR",this.share.max_dom=t.hgridspec.num_domains;var i=new Date,s=new Date(i);s.setDate(s.getDate()+1),this.share.start_date=[],this.share.end_date=[];for(var e=0;e<this.share.max_dom;e++)this.share.start_date.push(i.getFullYear().toString()+"-"+i.getMonth().toString().padStart(2,"0")+"-"+i.getDate().toString().padStart(2,"0")+"_03:00:00"),this.share.end_date.push(s.getFullYear().toString()+"-"+s.getMonth().toString().padStart(2,"0")+"-"+s.getDate().toString().padStart(2,"0")+"_03:00:00");this.geogrid.parent_id=[],this.geogrid.parent_grid_ratio=[],this.geogrid.i_parent_start=[],this.geogrid.j_parent_start=[],this.geogrid.e_we=[],this.geogrid.e_sn=[],this.geogrid.geog_data_res=[];for(e=0;e<this.share.max_dom;e++){this.geogrid.parent_id.push(t.hgridspec.parent_id[e]),this.geogrid.parent_grid_ratio.push(t.hgridspec.ratio_to_parent[e]),this.geogrid.i_parent_start.push(t.hgridspec.domain_origin_lli[e]),this.geogrid.j_parent_start.push(t.hgridspec.domain_origin_llj[e]);var a=(t.hgridspec.domain_origin_uri[e]-t.hgridspec.domain_origin_lli[e])*t.hgridspec.ratio_to_parent[e]+1,n=(t.hgridspec.domain_origin_urj[e]-t.hgridspec.domain_origin_llj[e])*t.hgridspec.ratio_to_parent[e]+1;this.geogrid.e_we.push(a),this.geogrid.e_sn.push(n),this.geogrid.geog_data_res.push("default")}this.geogrid.dx=t.hgridspec.moad_delta_x,this.geogrid.dy=t.hgridspec.moad_delta_y,this.geogrid.map_proj=t.hgridspec.map_proj_name,this.geogrid.ref_lat=t.hgridspec.moad_known_lat,this.geogrid.ref_lon=t.hgridspec.moad_known_lon,Array.isArray(t.hgridspec.moad_stand_lats)?(this.geogrid.truelat1=t.hgridspec.moad_stand_lats[0],this.geogrid.truelat2=t.hgridspec.moad_stand_lats[1]):(this.geogrid.truelat1=t.hgridspec.moad_stand_lats,this.geogrid.truelat2=0),Array.isArray(t.hgridspec.moad_stand_lons)?this.geogrid.stand_lon=t.hgridspec.moad_stand_lons[0]:this.geogrid.stand_lon=t.hgridspec.moad_stand_lons,this.geogrid.geog_data_path="/home/wrf/geog",this.share.interval_seconds=10800,this.share.io_form_geogrid=2,this.ungrib.out_format="WPS",this.ungrib.prefix="UNGRIB",this.metgrid.fg_name="UNGRIB",this.metgrid.io_form_metgrid=2,this.metgrid.opt_metgrid_tbl_path="/home/wrf"}},{key:"_setDefaults",value:function(){if(!this.share.start_date||!this.share.end_date){var t=new Date,i=n._formarDate(t)+"_03:00:00",s=n._formarDate(t)+"_18:00:00";for(this.share.start_date=[],this.share.end_date=[];this.share.start_date.length<this.share.max_dom;)this.share.start_date.push(i),this.share.end_date.push(s)}null===this.share.interval_seconds&&(this.share.interval_seconds=21600),null===this.share.debug_level&&(this.share.debug_level=0),null===this.geogrid.geog_data_path&&(this.geogrid.geog_data_path="geog"),null===this.geogrid.opt_geogrid_tbl_path&&(this.geogrid.opt_geogrid_tbl_path="geogrid"),null===this.metgrid.fg_name&&(this.metgrid.fg_name="FILE")}},{key:"toString",value:function(){this._setDefaults();var t="";return(t+=n._formatSection("share",["wrf_core","max_dom","start_date","end_date","interval_seconds","io_form_geogrid","debug_level"],[this.share.wrf_core,this.share.max_dom,this.share.start_date,this.share.end_date,this.share.interval_seconds,this.share.io_form_geogrid,this.share.debug_level]))+n._formatSection("geogrid",["parent_id","parent_grid_ratio","i_parent_start","j_parent_start","e_we","e_sn","geog_data_res","dx","dy","map_proj","ref_lat","ref_lon","truelat1","truelat2","stand_lon","geog_data_path","opt_geogrid_tbl_path"],[this.geogrid.parent_id,this.geogrid.parent_grid_ratio,this.geogrid.i_parent_start,this.geogrid.j_parent_start,this.geogrid.e_we,this.geogrid.e_sn,this.geogrid.geog_data_res,this.geogrid.dx,this.geogrid.dy,this.geogrid.map_proj,this.geogrid.ref_lat,this.geogrid.ref_lon,this.geogrid.truelat1,this.geogrid.truelat2,this.geogrid.stand_lon,this.geogrid.geog_data_path,this.geogrid.opt_geogrid_tbl_path])+n._formatSection("ungrib",["out_format","prefix"],[this.ungrib.out_format,this.ungrib.prefix])+n._formatSection("metgrid",["fg_name","io_form_metgrid","opt_metgrid_tbl_path"],[this.metgrid.fg_name,this.metgrid.io_form_metgrid,this.metgrid.opt_metgrid_tbl_path])}}],[{key:"_convertToArray",value:function(t,i){t[i]&&!Array.isArray(t[i])&&(t[i]=[].concat(t[i]))}},{key:"_isInteger",value:function(t){return"number"==typeof t&&isFinite(t)&&-9007199254740992<t&&t<9007199254740992&&Math.floor(t)===t}},{key:"_formatValue",value:function(t){if(Array.isArray(t)){for(var i=n._formatValue(t[0]),s=1;s<t.length;s++)i+=", "+n._formatValue(t[s]);return i}return"string"==typeof t?"'"+t+"'":"boolean"==typeof t?t?".true.":".false.":n._isInteger(t)?t.toString():t.toFixed(3)}},{key:"_formarDate",value:function(t){return t.getFullYear().toString()+"-"+t.getMonth().toString().padStart(2,"0")+"-"+t.getDay().toString().padStart(2,"0")}},{key:"_formatSection",value:function(t,i,s){for(var e="&"+t+"\n",a=0;a<i.length;a++){if(null===s[a])throw new Error("Property value ".concat(i[a]," is not set"));if(void 0===s[a])throw new Error("Property ".concat(i[a]," is not defined"));e+=" "+i[a].padEnd(20)+" = "+n._formatValue(s[a])+"\n"}return e+"/\n\n"}}]),n}(),l=637e4,H="lambert",Z="mercator",X="polar",K="lat-lon";function Y(t){return t<0?Math.ceil(t):Math.floor(t)}function tt(t){return t*l*Math.PI*2/360}var g=1,f=2,m=3,it=4,st=5,et=6378137,at=6356752.314,nt=.0066943799901413165,rt=484813681109536e-20,M=Math.PI/2,ht=.16666666666666666,ot=.04722222222222222,lt=.022156084656084655,y=1e-10,x=.017453292519943295,v=57.29577951308232,w=Math.PI/4,dt=2*Math.PI,d=3.14159265359,_t={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},ut={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},ct=/[\s_\-\/\(\)]/g;function b(t,i){if(t[i])return t[i];for(var s,e=Object.keys(t),a=i.toLowerCase().replace(ct,""),n=-1;++n<e.length;)if((s=e[n]).toLowerCase().replace(ct,"")===a)return t[s]}function pt(t){var i,s,e,a={},n=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,i){i=i.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t},{}),r={proj:"projName",datum:"datumCode",rf:function(t){a.rf=parseFloat(t)},lat_0:function(t){a.lat0=t*x},lat_1:function(t){a.lat1=t*x},lat_2:function(t){a.lat2=t*x},lat_ts:function(t){a.lat_ts=t*x},lon_0:function(t){a.long0=t*x},lon_1:function(t){a.long1=t*x},lon_2:function(t){a.long2=t*x},alpha:function(t){a.alpha=parseFloat(t)*x},gamma:function(t){a.rectified_grid_angle=parseFloat(t)},lonc:function(t){a.longc=t*x},x_0:function(t){a.x0=parseFloat(t)},y_0:function(t){a.y0=parseFloat(t)},k_0:function(t){a.k0=parseFloat(t)},k:function(t){a.k0=parseFloat(t)},a:function(t){a.a=parseFloat(t)},b:function(t){a.b=parseFloat(t)},r_a:function(){a.R_A=!0},zone:function(t){a.zone=parseInt(t,10)},south:function(){a.utmSouth=!0},towgs84:function(t){a.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){a.to_meter=parseFloat(t)},units:function(t){t=b(ut,a.units=t);t&&(a.to_meter=t.to_meter)},from_greenwich:function(t){a.from_greenwich=t*x},pm:function(t){var i=b(_t,t);a.from_greenwich=(i||parseFloat(t))*x},nadgrids:function(t){"@null"===t?a.datumCode="none":a.nadgrids=t},axis:function(t){var i="ewnsud";3===t.length&&-1!==i.indexOf(t.substr(0,1))&&-1!==i.indexOf(t.substr(1,1))&&-1!==i.indexOf(t.substr(2,1))&&(a.axis=t)},approx:function(){a.approx=!0}};for(i in n)s=n[i],i in r?"function"==typeof(e=r[i])?e(s):a[e]=s:a[i]=s;return"string"==typeof a.datumCode&&"WGS84"!==a.datumCode&&(a.datumCode=a.datumCode.toLowerCase()),a}var gt=/\s/,ft=/[A-Za-z]/,mt=/[A-Za-z84_]/,Mt=/[,\]]/,yt=/[\d\.E\-\+]/;function e(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function xt(t,i,s){Array.isArray(i)&&(s.unshift(i),i=null);s=s.reduce(function(t,i){return a(i,t),t},i?{}:t);i&&(t[i]=s)}function a(t,i){if(Array.isArray(t)){var s,e=t.shift();if("PARAMETER"===e&&(e=t.shift()),1===t.length)return Array.isArray(t[0])?(i[e]={},void a(t[0],i[e])):void(i[e]=t[0]);if(t.length)if("TOWGS84"===e)i[e]=t;else if("AXIS"===e)e in i||(i[e]=[]),i[e].push(t);else switch(Array.isArray(e)||(i[e]={}),e){case"UNIT":case"PRIMEM":case"VERT_DATUM":return i[e]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&a(t[2],i[e]));case"SPHEROID":case"ELLIPSOID":return i[e]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&a(t[3],i[e]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void xt(i,e,t);default:for(s=-1;++s<t.length;)if(!Array.isArray(t[s]))return a(t,i[e]);return xt(i,e,t)}else i[e]=!0}else i[t]=!0}e.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;gt.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case 1:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},e.prototype.afterquote=function(t){if('"'===t)this.word+='"',this.state=4;else{if(!Mt.test(t))throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place);this.word=this.word.trim(),this.afterItem(t)}},e.prototype.afterItem=function(t){","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,this.state=1):"]"===t&&(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),this.currentObject||(this.state=-1))},e.prototype.number=function(t){if(yt.test(t))this.word+=t;else{if(!Mt.test(t))throw new Error("havn't handled \""+t+'" in number yet, index '+this.place);this.word=parseFloat(this.word),this.afterItem(t)}},e.prototype.quoted=function(t){'"'===t?this.state=5:this.word+=t},e.prototype.keyword=function(t){var i;if(mt.test(t))this.word+=t;else if("["===t)(i=[]).push(this.word),this.level++,null===this.root?this.root=i:this.currentObject.push(i),this.stack.push(this.currentObject),this.currentObject=i,this.state=1;else{if(!Mt.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},e.prototype.neutral=function(t){if(ft.test(t))this.word=t,this.state=2;else if('"'===t)this.word="",this.state=4;else if(yt.test(t))this.word=t,this.state=3;else{if(!Mt.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)}},e.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function h(t){return.017453292519943295*t}function vt(a){if("GEOGCS"===a.type?a.projName="longlat":"LOCAL_CS"===a.type?(a.projName="identity",a.local=!0):"object"==typeof a.PROJECTION?a.projName=Object.keys(a.PROJECTION)[0]:a.projName=a.PROJECTION,a.AXIS){for(var t="",i=0,s=a.AXIS.length;i<s;++i){var e=[a.AXIS[i][0].toLowerCase(),a.AXIS[i][1].toLowerCase()];-1!==e[0].indexOf("north")||("y"===e[0]||"lat"===e[0])&&"north"===e[1]?t+="n":-1!==e[0].indexOf("south")||("y"===e[0]||"lat"===e[0])&&"south"===e[1]?t+="s":-1!==e[0].indexOf("east")||("x"===e[0]||"lon"===e[0])&&"east"===e[1]?t+="e":-1===e[0].indexOf("west")&&("x"!==e[0]&&"lon"!==e[0]||"west"!==e[1])||(t+="w")}2===t.length&&(t+="u"),3===t.length&&(a.axis=t)}a.UNIT&&(a.units=a.UNIT.name.toLowerCase(),"metre"===a.units&&(a.units="meter"),a.UNIT.convert)&&("GEOGCS"===a.type?a.DATUM&&a.DATUM.SPHEROID&&(a.to_meter=a.UNIT.convert*a.DATUM.SPHEROID.a):a.to_meter=a.UNIT.convert);var n=a.GEOGCS;function r(t){return t*(a.to_meter||1)}(n="GEOGCS"===a.type?a:n)&&(n.DATUM?a.datumCode=n.DATUM.name.toLowerCase():a.datumCode=n.name.toLowerCase(),"d_"===a.datumCode.slice(0,2)&&(a.datumCode=a.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==a.datumCode&&"new_zealand_1949"!==a.datumCode||(a.datumCode="nzgd49"),"wgs_1984"!==a.datumCode&&"world_geodetic_system_1984"!==a.datumCode||("Mercator_Auxiliary_Sphere"===a.PROJECTION&&(a.sphere=!0),a.datumCode="wgs84"),"_ferro"===a.datumCode.slice(-6)&&(a.datumCode=a.datumCode.slice(0,-6)),"_jakarta"===a.datumCode.slice(-8)&&(a.datumCode=a.datumCode.slice(0,-8)),~a.datumCode.indexOf("belge")&&(a.datumCode="rnb72"),n.DATUM&&n.DATUM.SPHEROID&&(a.ellps=n.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===a.ellps.toLowerCase().slice(0,13)&&(a.ellps="intl"),a.a=n.DATUM.SPHEROID.a,a.rf=parseFloat(n.DATUM.SPHEROID.rf,10)),n.DATUM&&n.DATUM.TOWGS84&&(a.datum_params=n.DATUM.TOWGS84),~a.datumCode.indexOf("osgb_1936")&&(a.datumCode="osgb36"),~a.datumCode.indexOf("osni_1952")&&(a.datumCode="osni52"),(~a.datumCode.indexOf("tm65")||~a.datumCode.indexOf("geodetic_datum_of_1965"))&&(a.datumCode="ire65"),"ch1903+"===a.datumCode&&(a.datumCode="ch1903"),~a.datumCode.indexOf("israel"))&&(a.datumCode="isr93"),a.b&&!isFinite(a.b)&&(a.b=a.a);[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",h],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",h],["x0","false_easting",r],["y0","false_northing",r],["long0","central_meridian",h],["lat0","latitude_of_origin",h],["lat0","standard_parallel_1",h],["lat1","standard_parallel_1",h],["lat2","standard_parallel_2",h],["azimuth","Azimuth"],["alpha","azimuth",h],["srsCode","name"]].forEach(function(t){var i,s,e;i=a,s=(t=t)[0],e=t[1],!(s in i)&&e in i&&(i[s]=i[e],3===t.length)&&(i[s]=t[2](i[s]))}),a.long0||!a.longc||"Albers_Conic_Equal_Area"!==a.projName&&"Lambert_Azimuthal_Equal_Area"!==a.projName||(a.long0=a.longc),a.lat_ts||!a.lat1||"Stereographic_South_Pole"!==a.projName&&"Polar Stereographic (variant B)"!==a.projName?!a.lat_ts&&a.lat0&&"Polar_Stereographic"===a.projName&&(a.lat_ts=a.lat0,a.lat0=h(0<a.lat0?90:-90)):(a.lat0=h(0<a.lat1?90:-90),a.lat_ts=a.lat1)}function wt(t){var t=new e(t).output(),i=t.shift(),s=t.shift(),s=(t.unshift(["name",s]),t.unshift(["type",i]),{});return a(t,s),vt(s),s}function n(t){var i=this;if(2===arguments.length){var s=arguments[1];"string"==typeof s?"+"===s.charAt(0)?n[t]=pt(arguments[1]):n[t]=wt(arguments[1]):n[t]=s}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?n.apply(i,t):n(t)});if("string"==typeof t){if(t in n)return n[t]}else"EPSG"in t?n["EPSG:"+t.EPSG]=t:"ESRI"in t?n["ESRI:"+t.ESRI]=t:"IAU2000"in t?n["IAU2000:"+t.IAU2000]=t:console.log(t)}}(i=n)("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"];var bt=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var Lt=["3857","900913","3785","102113"];function jt(t){var i,s,e;return"string"==typeof t?t in n?n[t]:(e=t,bt.some(function(t){return-1<e.indexOf(t)})?function(t){if(t=b(t,"authority"))return(t=b(t,"epsg"))&&-1<Lt.indexOf(t)}(i=wt(t))?n["EPSG:3857"]:(s=function(t){if(t=b(t,"extension"))return b(t,"proj4")}(i))?pt(s):i:"+"===t[0]?pt(t):void 0):t}function St(t,i){var s,e;if(t=t||{},i)for(e in i)void 0!==(s=i[e])&&(t[e]=s)}function r(t,i,s){t*=i;return s/Math.sqrt(1-t*t)}function Ct(t){return t<0?-1:1}function j(t){return Math.abs(t)<=d?t:t-Ct(t)*dt}function S(t,i,s){s*=t,s=Math.pow((1-s)/(1+s),.5*t);return Math.tan(.5*(M-i))/s}function Gt(t,i){for(var s,e=.5*t,a=M-2*Math.atan(i),n=0;n<=15;n++)if(s=t*Math.sin(a),a+=s=M-2*Math.atan(i*Math.pow((1-s)/(1+s),e))-a,Math.abs(s)<=1e-10)return a;return-9999}function At(t){return t}var Nt=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var i,s,e=t.x,a=t.y;return 90<a*v&&a*v<-90&&180<e*v&&e*v<-180||Math.abs(Math.abs(a)-M)<=y?null:(s=this.sphere?(i=this.x0+this.a*this.k0*j(e-this.long0),this.y0+this.a*this.k0*Math.log(Math.tan(w+.5*a))):(s=Math.sin(a),a=S(this.e,a,s),i=this.x0+this.a*this.k0*j(e-this.long0),this.y0-this.a*this.k0*Math.log(a)),t.x=i,t.y=s,t)},inverse:function(t){var i=t.x-this.x0,s=t.y-this.y0;if(this.sphere)e=M-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var e,s=Math.exp(-s/(this.a*this.k0));if(-9999===(e=Gt(this.e,s)))return null}return s=j(this.long0+i/(this.a*this.k0)),t.x=s,t.y=e,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:At,inverse:At,names:["longlat","identity"]}],Et={},kt=[];function Pt(t,i){var s=kt.length;return t.names?((kt[s]=t).names.forEach(function(t){Et[t.toLowerCase()]=s}),this):(console.log(i),!0)}var i={start:function(){Nt.forEach(Pt)},add:Pt,get:function(t){return!!t&&(t=t.toLowerCase(),void 0!==Et[t]&&kt[Et[t]]?kt[Et[t]]:void 0)}},It={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},Tt=It.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};It.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var C={};C.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},C.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},C.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},C.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},C.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},C.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},C.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},C.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},C.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},C.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},C.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},C.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},C.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},C.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},C.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},C.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},C.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},C.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var Ot={};function zt(t){var i;return 0===t.length?null:"null"===(t=(i="@"===t[0])?t.slice(1):t)?{name:"null",mandatory:!i,grid:null,isNull:!0}:{name:t,mandatory:!i,grid:Ot[t]||null,isNull:!1}}function _(t){return t/3600*Math.PI/180}function Bt(t,i,s){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(i,s)))}function G(t,i){if(!(this instanceof G))return new G(t);i=i||function(t){if(t)throw t};var s,e,a,n,r,h,o,l,d,_,u,c,p=jt(t);"object"==typeof p&&(s=G.projections.get(p.projName))?(p.datumCode&&"none"!==p.datumCode&&(e=b(C,p.datumCode))&&(p.datum_params=p.datum_params||(e.towgs84?e.towgs84.split(","):null),p.ellps=e.ellipse,p.datumName=e.datumName||p.datumCode),p.k0=p.k0||1,p.axis=p.axis||"enu",p.ellps=p.ellps||"wgs84",p.lat1=p.lat1||p.lat0,e=p.a,n=p.b,h=p.rf,a=p.ellps,o=p.sphere,e||(e=(a=(a=b(It,a))||Tt).a,n=a.b,h=a.rf),h&&!n&&(n=(1-1/h)*e),(0===h||Math.abs(e-n)<y)&&(o=!0,n=e),n=(a={a:e,b:n,rf:h,sphere:o}).a,h=a.b,o=p.R_A,l=((r=n*n)-(h=h*h))/r,u=0,o?(r=(n*=1-l*(ht+l*(ot+l*lt)))*n,l=0):u=Math.sqrt(l),n={es:l,e:u,ep2:o=(r-h)/h},u=void 0===(l=p.nadgrids)?null:l.split(",").map(zt),r=p.datum||(r=p.datumCode,h=p.datum_params,o=a.a,l=a.b,d=n.es,_=n.ep2,u=u,(c={}).datum_type=void 0===r||"none"===r?st:it,h&&(c.datum_params=h.map(parseFloat),0===c.datum_params[0]&&0===c.datum_params[1]&&0===c.datum_params[2]||(c.datum_type=g),3<c.datum_params.length)&&(0===c.datum_params[3]&&0===c.datum_params[4]&&0===c.datum_params[5]&&0===c.datum_params[6]||(c.datum_type=f,c.datum_params[3]*=rt,c.datum_params[4]*=rt,c.datum_params[5]*=rt,c.datum_params[6]=c.datum_params[6]/1e6+1)),u&&(c.datum_type=m,c.grids=u),c.a=o,c.b=l,c.es=d,c.ep2=_,c),St(this,p),St(this,s),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=n.es,this.e=n.e,this.ep2=n.ep2,this.datum=r,this.init(),i(null,this)):i(t)}function Rt(t,i,s){var e=t.x,a=t.y,n=t.z||0;if(a<-M&&-1.001*M<a)a=-M;else if(M<a&&a<1.001*M)a=M;else{if(a<-M)return{x:-1/0,y:-1/0,z:t.z};if(M<a)return{x:1/0,y:1/0,z:t.z}}return e>Math.PI&&(e-=2*Math.PI),t=Math.sin(a),a=Math.cos(a),{x:((s=s/Math.sqrt(1-i*(t*t)))+n)*a*Math.cos(e),y:(s+n)*a*Math.sin(e),z:(s*(1-i)+n)*t}}function Ft(t,i,s,e){var a,n,r,h,o,l,d,_,u,c,p,g=1e-12,f=t.x,m=t.y,M=t.z||0,y=Math.sqrt(f*f+m*m),x=Math.sqrt(f*f+m*m+M*M);if(y/s<g){if(c=0,x/s<g)return p=-e,{x:t.x,y:t.y,z:t.z}}else c=Math.atan2(m,f);for(a=M/x,h=(n=y/x)*(1-i)*(r=1/Math.sqrt(1-i*(2-i)*n*n)),o=a*r,u=0;u++,_=i*(_=s/Math.sqrt(1-i*o*o))/(_+(p=y*h+M*o-_*(1-i*o*o))),_=(d=a*(r=1/Math.sqrt(1-_*(2-_)*n*n)))*h-(l=n*(1-_)*r)*o,h=l,o=d,1e-24<_*_&&u<30;);return{x:c,y:Math.atan(d/Math.abs(l)),z:p}}function Dt(t){return t===g||t===f}function qt(t,i,s){if((a=i,(e=t).datum_type!==a.datum_type||e.a!==a.a||5e-11<Math.abs(e.es-a.es)||(e.datum_type===g?e.datum_params[0]!==a.datum_params[0]||e.datum_params[1]!==a.datum_params[1]||e.datum_params[2]!==a.datum_params[2]:e.datum_type===f&&(e.datum_params[0]!==a.datum_params[0]||e.datum_params[1]!==a.datum_params[1]||e.datum_params[2]!==a.datum_params[2]||e.datum_params[3]!==a.datum_params[3]||e.datum_params[4]!==a.datum_params[4]||e.datum_params[5]!==a.datum_params[5]||e.datum_params[6]!==a.datum_params[6])))&&(t.datum_type!==st&&i.datum_type!==st)){var e=t.a,a=t.es;if(t.datum_type===m){if(0!==$t(t,!1,s))return;e=et,a=nt}var n,r,h,o,l,d=i.a,_=i.b,u=i.es;if(i.datum_type===m&&(d=et,_=at,u=nt),a!==u||e!==d||Dt(t.datum_type)||Dt(i.datum_type))if(s=Rt(s,a,e),Dt(t.datum_type)&&(a=s,e=t.datum_type,t=t.datum_params,s=e===g?{x:a.x+t[0],y:a.y+t[1],z:a.z+t[2]}:e===f?(e=t[0],r=t[1],l=t[2],o=t[3],h=t[4],n=t[5],{x:(t=t[6])*(a.x-n*a.y+h*a.z)+e,y:t*(n*a.x+a.y-o*a.z)+r,z:t*(-h*a.x+o*a.y+a.z)+l}):void 0),Dt(i.datum_type)&&(e=s,n=i.datum_type,r=i.datum_params,s=n===g?{x:e.x-r[0],y:e.y-r[1],z:e.z-r[2]}:n===f?(n=r[0],t=r[1],h=r[2],o=r[3],a=r[4],l=r[5],r=r[6],{x:(n=(e.x-n)/r)+l*(t=(e.y-t)/r)-a*(e=(e.z-h)/r),y:-l*n+t+o*e,z:a*n-o*t+e}):void 0),s=Ft(s,u,d,_),i.datum_type===m)if(0!==$t(i,!0,s))return}return s}function $t(t,i,s){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;var e={x:-s.x,y:s.y},a={x:Number.NaN,y:Number.NaN},n=[];t:for(var r=0;r<t.grids.length;r++){var h=t.grids[r];if(n.push(h.name),h.isNull){a=e;break}if(h.mandatory,null===h.grid){if(h.mandatory)return console.log("Unable to find mandatory grid '"+h.name+"'"),-1}else for(var o=h.grid.subgrids,l=0,d=o.length;l<d;l++){var _=o[l],u=(Math.abs(_.del[1])+Math.abs(_.del[0]))/1e4,c=_.ll[0]-u,p=_.ll[1]-u,g=_.ll[0]+(_.lim[0]-1)*_.del[0]+u,u=_.ll[1]+(_.lim[1]-1)*_.del[1]+u;if(!(e.y<p||e.x<c||u<e.y||g<e.x)&&(a=function(t,i,s){var e={x:Number.NaN,y:Number.NaN};if(!isNaN(t.x)){var a={x:t.x,y:t.y},n=(a.x-=s.ll[0],a.y-=s.ll[1],a.x=j(a.x-Math.PI)+Math.PI,Ut(a,s));if(i){if(isNaN(n.x))return e;n.x=a.x-n.x,n.y=a.y-n.y;var r,h=9;do{if(r=Ut(n,s),isNaN(r.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}}while(r={x:a.x-(r.x+n.x),y:a.y-(r.y+n.y)},n.x+=r.x,n.y+=r.y,h--&&1e-12<Math.abs(r.x)&&1e-12<Math.abs(r.y));if(h<0)return console.log("Inverse grid shift iterator failed to converge."),e;e.x=j(n.x+s.ll[0]),e.y=n.y+s.ll[1]}else isNaN(n.x)||(e.x=t.x+n.x,e.y=t.y+n.y)}return e}(e,i,_),!isNaN(a.x)))break t}}return isNaN(a.x)?(console.log("Failed to find a grid shift table for location '"+-e.x*v+" "+e.y*v+" tried: '"+n+"'"),-1):(s.x=-a.x,s.y=a.y,0)}function Ut(t,i){var s,e,a,n,r,h,t={x:t.x/i.del[0],y:t.y/i.del[1]},o=Math.floor(t.x),l=Math.floor(t.y),d=t.x-+o,t=t.y-+l,_={x:Number.NaN,y:Number.NaN};return o<0||o>=i.lim[0]||l<0||l>=i.lim[1]||(l=l*i.lim[0]+o,o=i.cvs[l][0],s=i.cvs[l][1],h=i.cvs[++l][0],e=i.cvs[l][1],l+=i.lim[0],a=i.cvs[l][0],n=i.cvs[l][1],r=i.cvs[--l][0],i=i.cvs[l][1],_.x=(l=(1-d)*(1-t))*o+(o=d*(1-t))*h+(h=(1-d)*t)*r+(r=d*t)*a,_.y=l*s+o*e+h*i+r*n),_}function Wt(t,i,s){for(var e,a,n=s.x,r=s.y,h=s.z||0,o={},l=0;l<3;l++)if(!i||2!==l||void 0!==s.z)switch(a=0===l?(e=n,-1!=="ew".indexOf(t.axis[l])?"x":"y"):1===l?(e=r,-1!=="ns".indexOf(t.axis[l])?"y":"x"):(e=h,"z"),t.axis[l]){case"e":o[a]=e;break;case"w":o[a]=-e;break;case"n":o[a]=e;break;case"s":o[a]=-e;break;case"u":void 0!==s[a]&&(o.z=e);break;case"d":void 0!==s[a]&&(o.z=-e);break;default:return null}return o}function Jt(t){var i={x:t[0],y:t[1]};return 2<t.length&&(i.z=t[2]),3<t.length&&(i.m=t[3]),i}function Qt(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Vt(t,i,s,e){var a,n,r=void 0!==(s=Array.isArray(s)?Jt(s):{x:s.x,y:s.y,z:s.z,m:s.m}).z;if(Qt((n=s).x),Qt(n.y),t.datum&&i.datum&&(n=i,((a=t).datum.datum_type===g||a.datum.datum_type===f||a.datum.datum_type===m)&&"WGS84"!==n.datumCode||(n.datum.datum_type===g||n.datum.datum_type===f||n.datum.datum_type===m)&&"WGS84"!==a.datumCode)&&(s=Vt(t,n=new G("WGS84"),s,e),t=n),e&&"enu"!==t.axis&&(s=Wt(t,!1,s)),"longlat"===t.projName)s={x:s.x*x,y:s.y*x,z:s.z||0};else if(t.to_meter&&(s={x:s.x*t.to_meter,y:s.y*t.to_meter,z:s.z||0}),!(s=t.inverse(s)))return;if(t.from_greenwich&&(s.x+=t.from_greenwich),s=qt(t.datum,i.datum,s))return i.from_greenwich&&(s={x:s.x-i.from_greenwich,y:s.y,z:s.z||0}),"longlat"===i.projName?s={x:s.x*v,y:s.y*v,z:s.z||0}:(s=i.forward(s),i.to_meter&&(s={x:s.x/i.to_meter,y:s.y/i.to_meter,z:s.z||0})),e&&"enu"!==i.axis?Wt(i,!0,s):(s&&!r&&delete s.z,s)}(G.projections=i).start();var Ht=G("WGS84");function Zt(i,s,e,t){var a,n;return Array.isArray(e)?(n=Vt(i,s,e,t)||{x:NaN,y:NaN},2<e.length?void 0!==i.name&&"geocent"===i.name||void 0!==s.name&&"geocent"===s.name?("number"==typeof n.z?[n.x,n.y,n.z]:[n.x,n.y,e[2]]).concat(e.splice(3)):[n.x,n.y].concat(e.splice(2)):[n.x,n.y]):(a=Vt(i,s,e,t),2!==(n=Object.keys(e)).length&&n.forEach(function(t){if(void 0!==i.name&&"geocent"===i.name||void 0!==s.name&&"geocent"===s.name){if("x"===t||"y"===t||"z"===t)return}else if("x"===t||"y"===t)return;a[t]=e[t]}),a)}function Xt(t){return t instanceof G?t:t.oProj||G(t)}function o(s,e,t){s=Xt(s);var i=!1;return void 0===e?(e=s,s=Ht,i=!0):void 0===e.x&&!Array.isArray(e)||(t=e,e=s,s=Ht,i=!0),e=Xt(e),t?Zt(s,e,t):(t={forward:function(t,i){return Zt(s,e,t,i)},inverse:function(t,i){return Zt(e,s,t,i)}},i&&(t.oProj=e),t)}var Kt=6,Yt="AJSAJS",ti="AFAFAF",c=65,p=73,A=79,ii=86,si=90,i={forward:ei,inverse:function(t){t=hi(li(t.toUpperCase()));if(t.lat&&t.lon)return[t.lon,t.lat,t.lon,t.lat];return[t.left,t.bottom,t.right,t.top]},toPoint:ai};function ei(t,i){return i=i||5,t=function(t){var i,s,e,a,n,r=t.lat,t=t.lon,h=.00669438,o=ni(r),l=ni(t);n=Math.floor((t+180)/6)+1,180===t&&(n=60);56<=r&&r<64&&3<=t&&t<12&&(n=32);72<=r&&r<84&&(0<=t&&t<9?n=31:9<=t&&t<21?n=33:21<=t&&t<33?n=35:33<=t&&t<42&&(n=37));t=ni(6*(n-1)-180+3),i=h/(1-h),s=6378137/Math.sqrt(1-h*Math.sin(o)*Math.sin(o)),e=Math.tan(o)*Math.tan(o),a=i*Math.cos(o)*Math.cos(o),l=Math.cos(o)*(l-t),t=6378137*(.9983242984503243*o-.002514607064228144*Math.sin(2*o)+2639046602129982e-21*Math.sin(4*o)-35*h*h*h/3072*Math.sin(6*o));h=.9996*s*(l+(1-e+a)*l*l*l/6+(5-18*e+e*e+72*a-58*i)*l*l*l*l*l/120)+5e5,t=.9996*(t+s*Math.tan(o)*(l*l/2+(5-e+9*a+4*a*a)*l*l*l*l/24+(61-58*e+e*e+600*a-330*i)*l*l*l*l*l*l/720));r<0&&(t+=1e7);return{northing:Math.round(t),easting:Math.round(h),zoneNumber:n,zoneLetter:function(t){var i="Z";t<=84&&72<=t?i="X":t<72&&64<=t?i="W":t<64&&56<=t?i="V":t<56&&48<=t?i="U":t<48&&40<=t?i="T":t<40&&32<=t?i="S":t<32&&24<=t?i="R":t<24&&16<=t?i="Q":t<16&&8<=t?i="P":t<8&&0<=t?i="N":t<0&&-8<=t?i="M":t<-8&&-16<=t?i="L":t<-16&&-24<=t?i="K":t<-24&&-32<=t?i="J":t<-32&&-40<=t?i="H":t<-40&&-48<=t?i="G":t<-48&&-56<=t?i="F":t<-56&&-64<=t?i="E":t<-64&&-72<=t?i="D":t<-72&&-80<=t&&(i="C");return i}(r)}}({lat:t[1],lon:t[0]}),i=i,s="00000"+t.easting,e="00000"+t.northing,t.zoneNumber+t.zoneLetter+function(t,i,s){s=oi(s),t=Math.floor(t/1e5),i=Math.floor(i/1e5)%20;return function(t,i,s){var s=s-1,e=Yt.charCodeAt(s),s=ti.charCodeAt(s),t=e+t-1,i=s+i,a=!1;si<t&&(t=t-si+c-1,a=!0);(t===p||e<p&&p<t||(p<t||e<p)&&a)&&t++;(t===A||e<A&&A<t||(A<t||e<A)&&a)&&++t===p&&t++;si<t&&(t=t-si+c-1);a=ii<i&&(i=i-ii+c-1,!0);(i===p||s<p&&p<i||(p<i||s<p)&&a)&&i++;(i===A||s<A&&A<i||(A<i||s<A)&&a)&&++i===p&&i++;ii<i&&(i=i-ii+c-1);return String.fromCharCode(t)+String.fromCharCode(i)}(t,i,s)}(t.easting,t.northing,t.zoneNumber)+s.substr(s.length-5,i)+e.substr(e.length-5,i);var s,e}function ai(t){t=hi(li(t.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function ni(t){return t*(Math.PI/180)}function ri(t){return t/Math.PI*180}function hi(t){var i,s,e,a,n,r=t.northing,h=t.easting,o=t.zoneLetter,l=t.zoneNumber;return l<0||60<l?null:(n=6378137,h=h-5e5,r=r,o<"N"&&(r-=1e7),o=6*(l-1)-180+3,i=(l=.00669438)/(1-l),s=(r=r/.9996/6367449.145945056)+(3*(s=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)))/2-27*s*s*s/32)*Math.sin(2*r)+(21*s*s/16-55*s*s*s*s/32)*Math.sin(4*r)+151*s*s*s/96*Math.sin(6*r),r=n/Math.sqrt(1-l*Math.sin(s)*Math.sin(s)),e=Math.tan(s)*Math.tan(s),a=i*Math.cos(s)*Math.cos(s),n=n*(1-l)/Math.pow(1-l*Math.sin(s)*Math.sin(s),1.5),l=h/(.9996*r),h=ri(h=s-r*Math.tan(s)/n*(l*l/2-(5+3*e+10*a-4*a*a-9*i)*l*l*l*l/24+(61+90*e+298*a+45*e*e-252*i-3*a*a)*l*l*l*l*l*l/720)),r=o+ri(r=(l-(1+2*e+a)*l*l*l/6+(5-2*a+28*e-3*a*a+8*i+24*e*e)*l*l*l*l*l/120)/Math.cos(s)),t.accuracy?{top:(n=hi({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber})).lat,right:n.lon,bottom:h,left:r}:{lat:h,lon:r})}function oi(t){t%=Kt;return t=0===t?Kt:t}function li(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var i,s=t.length,e=null,a="",n=0;!/[A-Z]/.test(i=t.charAt(n));){if(2<=n)throw"MGRSPoint bad conversion from: "+t;a+=i,n++}var r=parseInt(a,10);if(0===n||s<n+3)throw"MGRSPoint bad conversion from: "+t;var h=t.charAt(n++);if(h<="A"||"B"===h||"Y"===h||"Z"<=h||"I"===h||"O"===h)throw"MGRSPoint zone letter "+h+" not handled: "+t;for(var e=t.substring(n,n+=2),o=oi(r),l=function(t,i){var s=Yt.charCodeAt(i-1),e=1e5,a=!1;for(;s!==t.charCodeAt(0);){if(++s===p&&s++,s===A&&s++,si<s){if(a)throw"Bad character: "+t;s=c,a=!0}e+=1e5}return e}(e.charAt(0),o),d=function(t,i){if("V"<t)throw"MGRSPoint given invalid Northing "+t;var s=ti.charCodeAt(i-1),e=0,a=!1;for(;s!==t.charCodeAt(0);){if(++s===p&&s++,s===A&&s++,ii<s){if(a)throw"Bad character: "+t;s=c,a=!0}e+=1e5}return e}(e.charAt(1),o);d<function(t){var i;switch(t){case"C":i=11e5;break;case"D":i=2e6;break;case"E":i=28e5;break;case"F":i=37e5;break;case"G":i=46e5;break;case"H":i=55e5;break;case"J":i=64e5;break;case"K":i=73e5;break;case"L":i=82e5;break;case"M":i=91e5;break;case"N":i=0;break;case"P":i=8e5;break;case"Q":i=17e5;break;case"R":i=26e5;break;case"S":i=35e5;break;case"T":i=44e5;break;case"U":i=53e5;break;case"V":i=62e5;break;case"W":i=7e6;break;case"X":i=79e5;break;default:i=-1}{if(0<=i)return i;throw"Invalid zone letter: "+t}}(h);)d+=2e6;e=s-n;if(e%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var _,u,o=e/2,s=0,e=0;return 0<o&&(_=1e5/Math.pow(10,o),u=t.substring(n,n+o),s=parseFloat(u)*_,u=t.substring(n+o),e=parseFloat(u)*_),{easting:s+l,northing:e+d,zoneLetter:h,zoneNumber:r,accuracy:_}}function di(t,i,s){if(!(this instanceof di))return new di(t,i,s);var e;Array.isArray(t)?(this.x=t[0],this.y=t[1],this.z=t[2]||0):"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z||0):"string"==typeof t&&void 0===i?(e=t.split(","),this.x=parseFloat(e[0],10),this.y=parseFloat(e[1],10),this.z=parseFloat(e[2],10)||0):(this.x=t,this.y=i,this.z=s||0),console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}di.fromMGRS=function(t){return new di(ai(t))},di.prototype.toMGRS=function(t){return ei([this.x,this.y],t)};var _i=1,ui=.25,ci=.046875,pi=.01953125,gi=.01068115234375,fi=.75,mi=.46875,Mi=.013020833333333334,yi=.007120768229166667,xi=.3645833333333333,vi=.005696614583333333,wi=.3076171875;function bi(t){var i=[],s=(i[0]=_i-t*(ui+t*(ci+t*(pi+t*gi))),i[1]=t*(fi-t*(ci+t*(pi+t*gi))),t*t);return i[2]=s*(mi-t*(Mi+t*yi)),i[3]=(s*=t)*(xi-t*vi),i[4]=s*t*wi,i}function Li(t,i,s,e){return e[0]*t-(s*=i)*(e[1]+(i*=i)*(e[2]+i*(e[3]+i*e[4])))}var ji=20;function Si(t,i,s){for(var e=1/(1-i),a=t,n=ji;n;--n){var r=Math.sin(a),h=1-i*r*r;if(a-=h=(Li(a,r,Math.cos(a),s)-t)*(h*Math.sqrt(h))*e,Math.abs(h)<y)return a}return a}var Ci={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=bi(this.es),this.ml0=Li(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var i=t.x,s=t.y,i=j(i-this.long0),e=Math.sin(s),a=Math.cos(s);if(this.es)var n=a*i,r=Math.pow(n,2),h=this.ep2*Math.pow(a,2),o=Math.pow(h,2),l=Math.abs(a)>y?Math.tan(s):0,l=Math.pow(l,2),d=Math.pow(l,2),_=1-this.es*Math.pow(e,2),_=(n/=Math.sqrt(_),Li(s,e,a,this.en)),u=this.a*(this.k0*n*(1+r/6*(1-l+h+r/20*(5-18*l+d+14*h-58*l*h+r/42*(61+179*d-d*l-479*l)))))+this.x0,_=this.a*(this.k0*(_-this.ml0+e*i*n/2*(1+r/12*(5-l+9*h+4*o+r/30*(61+d-58*l+270*h-330*l*h+r/56*(1385+543*d-d*l-3111*l))))))+this.y0;else{e=a*Math.sin(i);if(Math.abs(Math.abs(e)-1)<y)return 93;if(u=.5*this.a*this.k0*Math.log((1+e)/(1-e))+this.x0,_=a*Math.cos(i)/Math.sqrt(1-Math.pow(e,2)),1<=(e=Math.abs(_))){if(y<e-1)return 93;_=0}else _=Math.acos(_);_=this.a*this.k0*((_=s<0?-_:_)-this.lat0)+this.y0}return t.x=u,t.y=_,t},inverse:function(t){var i,s,e,a,n,r,h,o,l,d=(t.x-this.x0)*(1/this.a),_=(t.y-this.y0)*(1/this.a);return e=this.es?(h=Si(o=this.ml0+_/this.k0,this.es,this.en),Math.abs(h)<M?(n=Math.sin(h),i=Math.cos(h),l=Math.abs(i)>y?Math.tan(h):0,r=this.ep2*Math.pow(i,2),a=Math.pow(r,2),s=Math.pow(l,2),e=Math.pow(s,2),o=1-this.es*Math.pow(n,2),n=d*Math.sqrt(o)/this.k0,l=h-(o*=l)*(h=Math.pow(n,2))/(1-this.es)*.5*(1-h/12*(5+3*s-9*r*s+r-4*a-h/30*(61+90*s-252*r*s+45*e+46*r-h/56*(1385+3633*s+4095*e+1574*e*s)))),j(this.long0+n*(1-h/6*(1+2*s+r-h/20*(5+28*s+24*e+8*r*s+6*r-h/42*(61+662*s+1320*e+720*e*s))))/i)):(l=M*Ct(_),0)):(n=.5*((a=Math.exp(d/this.k0))-1/a),r=this.lat0+_/this.k0,h=Math.cos(r),o=Math.sqrt((1-Math.pow(h,2))/(1+Math.pow(n,2))),l=Math.asin(o),_<0&&(l=-l),0==n&&0===h?0:j(Math.atan2(n,h)+this.long0)),t.x=e,t.y=l,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function Gi(t){t=Math.exp(t);return(t-1/t)/2}function u(t,i){t=Math.abs(t),i=Math.abs(i);var s=Math.max(t,i),t=Math.min(t,i)/(s||1);return s*Math.sqrt(1+Math.pow(t,2))}function Ai(t){var i,s,e,a=Math.abs(t);return i=a*(1+a/(u(1,a)+1)),a=0==(e=(s=1+i)-1)?i:i*Math.log(s)/e,t<0?-a:a}function Ni(t,i){for(var s,e=2*Math.cos(2*i),a=t.length-1,n=t[a],r=0;0<=--a;)s=e*n-r+t[a],r=n,n=s;return i+s*Math.sin(2*i)}function Ei(t,i,s){for(var e,a,n=Math.sin(i),i=Math.cos(i),r=Gi(s),s=(s=s,((s=Math.exp(s))+1/s)/2),h=2*i*s,o=-2*n*r,l=t.length-1,d=t[l],_=0,u=0,c=0;0<=--l;)e=u,a=_,d=h*(u=d)-e-o*(_=c)+t[l],c=o*u-a+h*_;return[(h=n*s)*d-(o=i*r)*c,h*c+o*d]}var ki={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ci.init.apply(this),this.forward=Ci.forward,this.inverse=Ci.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=i=(i=this.es/(1+Math.sqrt(1-this.es)))/(2-i),i=(this.cgb[0]=i*(2+i*(-2/3+i*(i*(116/45+i*(26/45+-2854/675*i))-2))),this.cbg[0]=i*(i*(2/3+i*(4/3+i*(-82/45+i*(32/45+4642/4725*i))))-2),this.cgb[1]=(t*=i)*(7/3+i*(i*(-227/45+i*(2704/315+2323/945*i))-1.6)),this.cbg[1]=t*(5/3+i*(-16/15+i*(-13/9+i*(904/315+-1522/945*i)))),this.cgb[2]=(t*=i)*(56/15+i*(-136/35+i*(-1262/105+73814/2835*i))),this.cbg[2]=t*(-26/15+i*(34/21+i*(1.6+-12686/2835*i))),this.cgb[3]=(t*=i)*(4279/630+i*(-332/35+-399572/14175*i)),this.cbg[3]=t*(1237/630+i*(-24832/14175*i-2.4)),this.cgb[4]=(t*=i)*(4174/315+-144838/6237*i),this.cbg[4]=t*(-734/315+109598/31185*i),this.cgb[5]=601676/22275*(t*=i),this.cbg[5]=444337/155925*t,t=Math.pow(i,2),this.Qn=this.k0/(1+i)*(1+t*(.25+t*(1/64+t/256))),this.utg[0]=i*(i*(2/3+i*(-37/96+i*(1/360+i*(81/512+-96199/604800*i))))-.5),this.gtu[0]=i*(.5+i*(-2/3+i*(5/16+i*(41/180+i*(-127/288+7891/37800*i))))),this.utg[1]=t*(-1/48+i*(-1/15+i*(437/1440+i*(-46/105+1118711/3870720*i)))),this.gtu[1]=t*(13/48+i*(i*(557/1440+i*(281/630+-1983433/1935360*i))-.6)),this.utg[2]=(t*=i)*(-17/480+i*(37/840+i*(209/4480+-5569/90720*i))),this.gtu[2]=t*(61/240+i*(-103/140+i*(15061/26880+167603/181440*i))),this.utg[3]=(t*=i)*(-4397/161280+i*(11/504+830251/7257600*i)),this.gtu[3]=t*(49561/161280+i*(-179/168+6601661/7257600*i)),this.utg[4]=(t*=i)*(-4583/161280+108847/3991680*i),this.gtu[4]=t*(34729/80640+-3418889/1995840*i),this.utg[5]=-.03233083094085698*(t*=i),this.gtu[5]=.6650675310896665*t,Ni(this.cbg,this.lat0));this.Zb=-this.Qn*(i+function(t,i){for(var s,e=2*Math.cos(i),a=t.length-1,n=t[a],r=0;0<=--a;)s=e*n-r+t[a],r=n,n=s;return Math.sin(i)*s}(this.gtu,2*i))},forward:function(t){var i,s=j(t.x-this.long0),e=t.y,e=Ni(this.cbg,e),a=Math.sin(e),n=Math.cos(e),r=Math.sin(s),h=Math.cos(s),r=(e=Math.atan2(a,h*n),s=Math.atan2(r*n,u(a,n*h)),s=Ai(Math.tan(s)),Ei(this.gtu,2*e,2*s));return e+=r[0],s+=r[1],a=Math.abs(s)<=2.623395162778?(i=this.a*(this.Qn*s)+this.x0,this.a*(this.Qn*e+this.Zb)+this.y0):i=1/0,t.x=i,t.y=a,t},inverse:function(t){var i,s,e,a,n=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);return r=(r-this.Zb)/this.Qn,n/=this.Qn,a=Math.abs(n)<=2.623395162778?(r+=(e=Ei(this.utg,2*r,2*n))[0],n+=e[1],n=Math.atan(Gi(n)),e=Math.sin(r),i=Math.cos(r),a=Math.sin(n),s=Math.cos(n),r=Math.atan2(e*s,u(a,s*i)),e=j((n=Math.atan2(a,s*i))+this.long0),Ni(this.cgb,r)):e=1/0,t.x=e,t.y=a,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]};var Pi={init:function(){var t=function(t,i){if(void 0===t){if((t=Math.floor(30*(j(i)+Math.PI)/Math.PI)+1)<0)return 0;if(60<t)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*x,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,ki.init.apply(this),this.forward=ki.forward,this.inverse=ki.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Ii(t,i){return Math.pow((1-t)/(1+t),i)}var Ti={init:function(){var t=Math.sin(this.lat0),i=Math.cos(this.lat0);i*=i,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*i*i/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+w)/(Math.pow(Math.tan(.5*this.lat0+w),this.C)*Ii(this.e*t,this.ratexp))},forward:function(t){var i=t.x,s=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*s+w),this.C)*Ii(this.e*Math.sin(s),this.ratexp))-M,t.x=this.C*i,t},inverse:function(t){for(var i=t.x/this.C,s=t.y,e=Math.pow(Math.tan(.5*s+w)/this.K,1/this.C),a=20;0<a&&(s=2*Math.atan(e*Ii(this.e*Math.sin(t.y),-.5*this.e))-M,!(Math.abs(s-t.y)<1e-14));--a)t.y=s;return a?(t.x=i,t.y=s,t):null},names:["gauss"]};var Oi={init:function(){Ti.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var i,s,e,a;return t.x=j(t.x-this.long0),Ti.forward.apply(this,[t]),i=Math.sin(t.y),s=Math.cos(t.y),e=Math.cos(t.x),a=this.k0*this.R2/(1+this.sinc0*i+this.cosc0*s*e),t.x=a*s*Math.sin(t.x),t.y=a*(this.cosc0*i-this.sinc0*s*e),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var i,s,e,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=(a=u(t.x,t.y))?(s=2*Math.atan2(a,this.R2),i=Math.sin(s),s=Math.cos(s),e=Math.asin(s*this.sinc0+t.y*i*this.cosc0/a),Math.atan2(t.x*i,a*this.cosc0*s-t.y*this.sinc0*i)):(e=this.phic0,0),t.x=a,t.y=e,Ti.inverse.apply(this,[t]),t.x=j(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var zi={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=y&&(this.k0=.5*(1+Ct(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=y&&(0<this.lat0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=y&&Math.abs(Math.cos(this.lat_ts))>y&&(this.k0=.5*this.cons*r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/S(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=r(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-M,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var i,s,e=t.x,a=t.y,n=Math.sin(a),r=Math.cos(a),h=j(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=y&&Math.abs(a+this.lat0)<=y?(t.x=NaN,t.y=NaN):this.sphere?(i=2*this.k0/(1+this.sinlat0*n+this.coslat0*r*Math.cos(h)),t.x=this.a*i*r*Math.sin(h)+this.x0,t.y=this.a*i*(this.coslat0*n-this.sinlat0*r*Math.cos(h))+this.y0):(r=2*Math.atan(this.ssfn_(a,n,this.e))-M,s=Math.cos(r),r=Math.sin(r),Math.abs(this.coslat0)<=y?(a=S(this.e,a*this.con,this.con*n),n=2*this.a*this.k0*a/this.cons,t.x=this.x0+n*Math.sin(e-this.long0),t.y=this.y0-this.con*n*Math.cos(e-this.long0)):(Math.abs(this.sinlat0)<y?(i=2*this.a*this.k0/(1+s*Math.cos(h)),t.y=i*r):(i=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*s*Math.cos(h))),t.y=i*(this.cosX0*r-this.sinX0*s*Math.cos(h))+this.y0),t.x=i*s*Math.sin(h)+this.x0)),t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var i,s,e,a,n=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere)s=2*Math.atan(n/(2*this.a*this.k0)),e=this.long0,a=this.lat0,n<=y||(a=Math.asin(Math.cos(s)*this.sinlat0+t.y*Math.sin(s)*this.coslat0/n),e=Math.abs(this.coslat0)<y?0<this.lat0?j(this.long0+Math.atan2(t.x,-1*t.y)):j(this.long0+Math.atan2(t.x,t.y)):j(this.long0+Math.atan2(t.x*Math.sin(s),n*this.coslat0*Math.cos(s)-t.y*this.sinlat0*Math.sin(s))));else if(Math.abs(this.coslat0)<=y){if(n<=y)return a=this.lat0,e=this.long0,t.x=e,t.y=a,t;t.x*=this.con,t.y*=this.con,s=n*this.cons/(2*this.a*this.k0),a=this.con*Gt(this.e,s),e=this.con*j(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else s=2*Math.atan(n*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,n<=y?i=this.X0:(i=Math.asin(Math.cos(s)*this.sinX0+t.y*Math.sin(s)*this.cosX0/n),e=j(this.long0+Math.atan2(t.x*Math.sin(s),n*this.cosX0*Math.cos(s)-t.y*this.sinX0*Math.sin(s)))),a=-1*Gt(this.e,Math.tan(.5*(M+i)));return t.x=e,t.y=a,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(t,i,s){return i*=s,Math.tan(.5*(M+t))*Math.pow((1-i)/(1+i),.5*s)}};var Bi={init:function(){var t=this.lat0,i=(this.lambda0=this.long0,Math.sin(t)),s=this.a,e=2*(e=1/this.rf)-Math.pow(e,2),a=this.e=Math.sqrt(e),s=(this.R=this.k0*s*Math.sqrt(1-e)/(1-e*Math.pow(i,2)),this.alpha=Math.sqrt(1+e/(1-e)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(i/this.alpha),Math.log(Math.tan(Math.PI/4+this.b0/2))),e=Math.log(Math.tan(Math.PI/4+t/2)),t=Math.log((1+a*i)/(1-a*i));this.K=s-this.alpha*e+this.alpha*a/2*t},forward:function(t){var i=Math.log(Math.tan(Math.PI/4-t.y/2)),s=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),i=-this.alpha*(i+s)+this.K,s=2*(Math.atan(Math.exp(i))-Math.PI/4),i=this.alpha*(t.x-this.lambda0),e=Math.atan(Math.sin(i)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(i))),s=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(i));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*e+this.x0,t},inverse:function(t){for(var i,s=t.x-this.x0,e=t.y-this.y0,s=s/this.R,e=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(e)+Math.sin(this.b0)*Math.cos(e)*Math.cos(s)),s=Math.atan(Math.sin(s)/(Math.cos(this.b0)*Math.cos(s)-Math.sin(this.b0)*Math.tan(e))),e=this.lambda0+s/this.alpha,n=a,r=-1e3,h=0;1e-7<Math.abs(n-r);){if(20<++h)return;i=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(n))/2)),r=n,n=2*Math.atan(Math.exp(i))-Math.PI/2}return t.x=e,t.y=n,t},names:["somerc"]},Ri=1e-7;var Fi={init:function(){var t,i,s,e,a,n=0,r=0,h=0,o=0,l=0,d=0,_=0,u=(this.no_off=(c="object"==typeof(u=this).PROJECTION?Object.keys(u.PROJECTION)[0]:u.PROJECTION,"no_uoff"in u||"no_off"in u||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(c)),this.no_rot="no_rot"in this,!1),c=("alpha"in this&&(u=!0),!1);if("rectified_grid_angle"in this&&(c=!0),u&&(_=this.alpha),c&&(n=this.rectified_grid_angle*x),u||c)r=this.longc;else if(h=this.long1,l=this.lat1,o=this.long2,d=this.lat2,Math.abs(l-d)<=Ri||(t=Math.abs(l))<=Ri||Math.abs(t-M)<=Ri||Math.abs(Math.abs(this.lat0)-M)<=Ri||Math.abs(Math.abs(d)-M)<=Ri)throw new Error;var p=1-this.es,g=Math.sqrt(p);Math.abs(this.lat0)>y?(e=Math.sin(this.lat0),i=Math.cos(this.lat0),t=1-this.es*e*e,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/p),this.A=this.B*this.k0*g/t,(s=(i=this.B*g/(i*Math.sqrt(t)))*i-1)<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=i,this.E*=Math.pow(S(this.e,this.lat0,e),this.B)):(this.B=1/g,this.A=this.k0,this.E=i=s=1),u||c?(u?(a=Math.asin(Math.sin(_)/i),c||(n=_)):(a=n,_=Math.asin(i*Math.sin(a))),this.lam0=r-Math.asin(.5*(s-1/s)*Math.tan(a))/this.B):(p=Math.pow(S(this.e,l,Math.sin(l)),this.B),e=Math.pow(S(this.e,d,Math.sin(d)),this.B),s=this.E/p,g=(e-p)/(e+p),u=this.E*this.E,(t=h-o)<-Math.pi?o-=dt:t>Math.pi&&(o+=dt),this.lam0=j(.5*(h+o)-Math.atan((u-e*p)/(u+e*p)*Math.tan(.5*this.B*(h-o))/g)/this.B),a=Math.atan(2*Math.sin(this.B*j(h-this.lam0))/(s-1/s)),n=_=Math.asin(i*Math.sin(a))),this.singam=Math.sin(a),this.cosgam=Math.cos(a),this.sinrot=Math.sin(n),this.cosrot=Math.cos(n),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(_))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*a,this.v_pole_n=this.ArB*Math.log(Math.tan(w-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(w+s))},forward:function(t){var i,s,e,a,n={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-M)>y){if(e=.5*((a=this.E/Math.pow(S(this.e,t.y,Math.sin(t.y)),this.B))-(s=1/a)),a=.5*(a+s),i=Math.sin(this.B*t.x),a=(e*this.singam-i*this.cosgam)/a,Math.abs(Math.abs(a)-1)<y)throw new Error;a=.5*this.ArB*Math.log((1-a)/(1+a)),s=Math.cos(this.B*t.x),e=Math.abs(s)<Ri?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+i*this.singam,s)}else a=0<t.y?this.v_pole_n:this.v_pole_s,e=this.ArB*t.y;return this.no_rot?(n.x=e,n.y=a):(e-=this.u_0,n.x=a*this.cosrot+e*this.sinrot,n.y=e*this.cosrot-a*this.sinrot),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n},inverse:function(t){var i,s,e,a={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),t=this.no_rot?(e=t.y,t.x):(e=t.x*this.cosrot-t.y*this.sinrot,t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=.5*((e=Math.exp(-this.BrA*e))-1/e),e=.5*(e+1/e),e=((s=Math.sin(this.BrA*t))*this.cosgam+i*this.singam)/e,Math.abs(Math.abs(e)-1)<y)a.x=0,a.y=e<0?-M:M;else{if(a.y=this.E/Math.sqrt((1+e)/(1-e)),a.y=Gt(this.e,Math.pow(a.y,1/this.B)),a.y===1/0)throw new Error;a.x=-this.rB*Math.atan2(i*this.cosgam-s*this.singam,Math.cos(this.BrA*t))}return a.x+=this.lam0,a},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};var Di={init:function(){var t,i,s,e,a,n;this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,Math.abs(this.lat1+this.lat2)<y||(t=this.b/this.a,this.e=Math.sqrt(1-t*t),t=Math.sin(this.lat1),i=Math.cos(this.lat1),i=r(this.e,t,i),s=S(this.e,this.lat1,t),a=Math.sin(this.lat2),e=Math.cos(this.lat2),e=r(this.e,a,e),a=S(this.e,this.lat2,a),n=S(this.e,this.lat0,Math.sin(this.lat0)),Math.abs(this.lat1-this.lat2)>y?this.ns=Math.log(i/e)/Math.log(s/a):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=i/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(n,this.ns),this.title)||(this.title="Lambert Conformal Conic")},forward:function(t){var i,s=t.x,e=t.y,a=(Math.abs(2*Math.abs(e)-Math.PI)<=y&&(e=Ct(e)*(M-2*y)),Math.abs(Math.abs(e)-M));if(y<a)a=S(this.e,e,Math.sin(e)),i=this.a*this.f0*Math.pow(a,this.ns);else{if(e*this.ns<=0)return null;i=0}return a=this.ns*j(s-this.long0),t.x=this.k0*(i*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-i*Math.cos(a))+this.y0,t},inverse:function(t){var i,s,e=(t.x-this.x0)/this.k0,a=this.rh-(t.y-this.y0)/this.k0,n=0<this.ns?(i=Math.sqrt(e*e+a*a),1):(i=-Math.sqrt(e*e+a*a),-1),r=0;if(0!==i&&(r=Math.atan2(n*e,n*a)),0!==i||0<this.ns){if(n=1/this.ns,e=Math.pow(i/(this.a*this.f0),n),-9999===(s=Gt(this.e,e)))return null}else s=-M;return a=j(r/this.ns+this.long0),t.x=a,t.y=s,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]};var qi={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var i=t.x,s=t.y,i=j(i-this.long0),e=Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.alfa*this.e/2),s=2*(Math.atan(this.k*Math.pow(Math.tan(s/2+this.s45),this.alfa)/e)-this.s45),e=-i*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(s)+Math.sin(this.ad)*Math.cos(s)*Math.cos(e)),s=Math.asin(Math.cos(s)*Math.sin(e)/Math.cos(i)),e=this.n*s,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n);return t.y=s*Math.cos(e),t.x=s*Math.sin(e),this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){for(var i,s,e,a,n=t.x,r=(t.x=t.y,t.y=n,this.czech||(t.y*=-1,t.x*=-1),n=Math.sqrt(t.x*t.x+t.y*t.y),s=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/n,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),i=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(s)),n=Math.asin(Math.cos(n)*Math.sin(s)/Math.cos(i)),t.x=this.long0-n/this.alfa,e=i,a=0);t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(i/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(e))/(1-this.e*Math.sin(e)),this.e/2))-this.s45),Math.abs(e-t.y)<1e-10&&(a=1),e=t.y,r+=1,0===a&&r<15;);return 15<=r?null:t},names:["Krovak","krovak"]};function N(t,i,s,e,a){return t*a-i*Math.sin(2*a)+s*Math.sin(4*a)-e*Math.sin(6*a)}function $i(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Ui(t){return.375*t*(1+.25*t*(1+.46875*t))}function Wi(t){return.05859375*t*t*(1+.75*t)}function Ji(t){return t*t*t*(35/3072)}function Qi(t,i,s){i*=s;return t/Math.sqrt(1-i*i)}function Vi(t){return Math.abs(t)<M?t:t-Ct(t)*Math.PI}function Hi(t,i,s,e,a){for(var n,r=t/i,h=0;h<15;h++)if(r+=n=(t-(i*r-s*Math.sin(2*r)+e*Math.sin(4*r)-a*Math.sin(6*r)))/(i-2*s*Math.cos(2*r)+4*e*Math.cos(4*r)-6*a*Math.cos(6*r)),Math.abs(n)<=1e-10)return r;return NaN}var Zi={init:function(){this.sphere||(this.e0=$i(this.es),this.e1=Ui(this.es),this.e2=Wi(this.es),this.e3=Ji(this.es),this.ml0=this.a*N(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var i,s,e,a,n,r,h=t.x,o=t.y,h=j(h-this.long0);return o=this.sphere?(r=this.a*Math.asin(Math.cos(o)*Math.sin(h)),this.a*(Math.atan2(Math.tan(o),Math.cos(h))-this.lat0)):(i=Math.sin(o),s=Math.cos(o),e=Qi(this.a,this.e,i),a=Math.tan(o)*Math.tan(o),r=e*(h=h*Math.cos(o))*(1-(h=h*h)*a*(1/6-(8-a+8*(n=this.es*s*s/(1-this.es)))*h/120)),this.a*N(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+e*i/s*h*(.5+(5-a+6*n)*h/24)),t.x=r+this.x0,t.y=o+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var i=t.x/this.a,s=t.y/this.a;if(this.sphere)var e=s+this.lat0,a=Math.asin(Math.sin(e)*Math.cos(i)),e=Math.atan2(Math.tan(i),Math.cos(e));else{var n=Hi(this.ml0/this.a+s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(n)-M)<=y)return t.x=this.long0,t.y=M,s<0&&(t.y*=-1),t;var s=Qi(this.a,this.e,Math.sin(n)),r=s*s*s/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(n),2),i=i*this.a/s,o=i*i;a=n-s*Math.tan(n)/r*i*i*(.5-(1+3*h)*i*i/24),e=i*(1-o*(h/3+(1+3*h)*h*o/15))/Math.cos(n)}return t.x=j(e+this.long0),t.y=Vi(a),t},names:["Cassini","Cassini_Soldner","cass"]};function E(t,i){var s;return 1e-7<t?(1-t*t)*(i/(1-(s=t*i)*s)-.5/t*Math.log((1-s)/(1+s))):2*i}var Xi=.3333333333333333,Ki=.17222222222222222,Yi=.10257936507936508,ts=.06388888888888888,is=.0664021164021164,ss=.016415012942191543;var es={init:function(){var t,i,s,e=Math.abs(this.lat0);if(Math.abs(e-M)<y?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<y?this.mode=this.EQUIT:this.mode=this.OBLIQ,0<this.es)switch(this.qp=E(this.e,1),this.mmf=.5/(1-this.es),this.apa=(e=this.es,(s=[])[0]=e*Xi,s[0]+=(i=e*e)*Ki,s[1]=i*ts,s[0]+=(i*=e)*Yi,s[1]+=i*is,s[2]=i*ss,s),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=E(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var i,s,e,a,n,r,h,o,l,d,_=t.x,u=t.y,_=j(_-this.long0);if(this.sphere){if(n=Math.sin(u),d=Math.cos(u),e=Math.cos(_),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((s=this.mode===this.EQUIT?1+d*e:1+this.sinph0*n+this.cosph0*d*e)<=y)return null;i=(s=Math.sqrt(2/s))*d*Math.sin(_),s*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*d*e}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),Math.abs(u+this.lat0)<y)return null;s=w-.5*u,i=(s=2*(this.mode===this.S_POLE?Math.cos(s):Math.sin(s)))*Math.sin(_),s*=e}}else{switch(l=o=h=0,e=Math.cos(_),a=Math.sin(_),n=Math.sin(u),r=E(this.e,n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(h=r/this.qp,o=Math.sqrt(1-h*h)),this.mode){case this.OBLIQ:l=1+this.sinb1*h+this.cosb1*o*e;break;case this.EQUIT:l=1+o*e;break;case this.N_POLE:l=M+u,r=this.qp-r;break;case this.S_POLE:l=u-M,r=this.qp+r}if(Math.abs(l)<y)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),s=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*h-this.sinb1*o*e):(l=Math.sqrt(2/(1+o*e)))*h*this.ymf,i=this.xmf*l*o*a;break;case this.N_POLE:case this.S_POLE:0<=r?(i=(l=Math.sqrt(r))*a,s=e*(this.mode===this.S_POLE?l:-l)):i=s=0}}return t.x=this.a*i+this.x0,t.y=this.a*s+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var i,s,e,a,n,r,h=t.x/this.a,o=t.y/this.a;if(this.sphere){var l,d=0,_=0,u=Math.sqrt(h*h+o*o);if(1<(l=.5*u))return null;switch(l=2*Math.asin(l),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(_=Math.sin(l),d=Math.cos(l)),this.mode){case this.EQUIT:l=Math.abs(u)<=y?0:Math.asin(o*_/u),h*=_,o=d*u;break;case this.OBLIQ:l=Math.abs(u)<=y?this.lat0:Math.asin(d*this.sinph0+o*_*this.cosph0/u),h*=_*this.cosph0,o=(d-Math.sin(l)*this.sinph0)*u;break;case this.N_POLE:o=-o,l=M-l;break;case this.S_POLE:l-=M}i=0!==o||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(h,o):0}else{if(e=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(h/=this.dd,o*=this.dd,(n=Math.sqrt(h*h+o*o))<y)return t.x=this.long0,t.y=this.lat0,t;a=2*Math.asin(.5*n/this.rq),r=Math.cos(a),h*=a=Math.sin(a),o=this.mode===this.OBLIQ?(e=r*this.sinb1+o*a*this.cosb1/n,s=this.qp*e,n*this.cosb1*r-o*this.sinb1*a):(s=this.qp*(e=o*a/n),n*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(!(s=h*h+(o=this.mode===this.N_POLE?-o:o)*o))return t.x=this.long0,t.y=this.lat0,t;e=1-s/this.qp,this.mode===this.S_POLE&&(e=-e)}i=Math.atan2(h,o),a=Math.asin(e),n=this.apa,r=a+a,l=a+n[0]*Math.sin(r)+n[1]*Math.sin(r+r)+n[2]*Math.sin(r+r+r)}return t.x=j(this.long0+i),t.y=l,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function k(t){return 1<Math.abs(t)&&(t=1<t?1:-1),Math.asin(t)}var as={init:function(){Math.abs(this.lat1+this.lat2)<y||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=r(this.e3,this.sin_po,this.cos_po),this.qs1=E(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=r(this.e3,this.sin_po,this.cos_po),this.qs2=E(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=E(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>y?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var i=t.x,s=t.y,s=(this.sin_phi=Math.sin(s),this.cos_phi=Math.cos(s),E(this.e3,this.sin_phi)),s=this.a*Math.sqrt(this.c-this.ns0*s)/this.ns0,i=this.ns0*j(i-this.long0),e=s*Math.sin(i)+this.x0,s=this.rh-s*Math.cos(i)+this.y0;return t.x=e,t.y=s,t},inverse:function(t){var i,s,e;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,e=0<=this.ns0?(s=Math.sqrt(t.x*t.x+t.y*t.y),1):(s=-Math.sqrt(t.x*t.x+t.y*t.y),-1),(i=0)!==s&&(i=Math.atan2(e*t.x,e*t.y)),e=s*this.ns0/this.a,e=this.sphere?Math.asin((this.c-e*e)/(2*this.ns0)):(s=(this.c-e*e)/this.ns0,this.phi1z(this.e3,s)),s=j(i/this.ns0+this.long0),t.x=s,t.y=e,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,i){var s,e,a,n=k(.5*i);if(t<y)return n;for(var r=t*t,h=1;h<=25;h++)if(n+=a=.5*(e=1-(s=t*(a=Math.sin(n)))*s)*e/Math.cos(n)*(i/(1-r)-a/e+.5/t*Math.log((1-s)/(1+s))),Math.abs(a)<=1e-7)return n;return null}};var ns={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var i,s=t.x,e=t.y,s=j(s-this.long0),a=Math.sin(e),e=Math.cos(e),n=Math.cos(s),r=0<(r=this.sin_p14*a+this.cos_p14*e*n)||Math.abs(r)<=y?(i=this.x0+ +this.a*e*Math.sin(s)/r,this.y0+ +this.a*(this.cos_p14*a-this.sin_p14*e*n)/r):(i=this.x0+this.infinity_dist*e*Math.sin(s),this.y0+this.infinity_dist*(this.cos_p14*a-this.sin_p14*e*n));return t.x=i,t.y=r,t},inverse:function(t){var i,s,e,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,e=(i=Math.sqrt(t.x*t.x+t.y*t.y))?(e=Math.atan2(i,this.rc),s=Math.sin(e),a=k((e=Math.cos(e))*this.sin_p14+t.y*s*this.cos_p14/i),e=Math.atan2(t.x*s,i*this.cos_p14*e-t.y*this.sin_p14*s),j(this.long0+e)):(a=this.phic0,0),t.x=e,t.y=a,t},names:["gnom"]};var rs={init:function(){this.sphere||(this.k0=r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var i,s=t.x,e=t.y,s=j(s-this.long0);return s=this.sphere?(i=this.x0+this.a*s*Math.cos(this.lat_ts),this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts)):(e=E(this.e,Math.sin(e)),i=this.x0+this.a*this.k0*s,this.y0+this.a*e*.5/this.k0),t.x=i,t.y=s,t},inverse:function(t){var i,s;return t.x-=this.x0,t.y-=this.y0,this.sphere?(i=j(this.long0+t.x/this.a/Math.cos(this.lat_ts)),s=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(s=function(t,i){var s=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(i)-s)<1e-6)return i<0?-1*M:M;for(var e,a,n,r=Math.asin(.5*i),h=0;h<30;h++)if(e=Math.sin(r),a=Math.cos(r),n=t*e,r+=a=Math.pow(1-n*n,2)/(2*a)*(i/(1-t*t)-e/(1-n*n)+.5/t*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-10)return r;return NaN}(this.e,2*t.y*this.k0/this.a),i=j(this.long0+t.x/(this.a*this.k0))),t.x=i,t.y=s,t},names:["cea"]};var hs={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var i=t.x,s=t.y,i=j(i-this.long0),s=Vi(s-this.lat0);return t.x=this.x0+this.a*i*this.rc,t.y=this.y0+this.a*s,t},inverse:function(t){var i=t.x,s=t.y;return t.x=j(this.long0+(i-this.x0)/(this.a*this.rc)),t.y=Vi(this.lat0+(s-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var os={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=$i(this.es),this.e1=Ui(this.es),this.e2=Wi(this.es),this.e3=Ji(this.es),this.ml0=this.a*N(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var i,s=t.x,e=t.y,a=(s=j(s-this.long0))*Math.sin(e);return e=this.sphere?Math.abs(e)<=y?(i=this.a*s,-1*this.a*this.lat0):(i=this.a*Math.sin(a)/Math.tan(e),this.a*(Vi(e-this.lat0)+(1-Math.cos(a))/Math.tan(e))):Math.abs(e)<=y?(i=this.a*s,-1*this.ml0):(i=(s=Qi(this.a,this.e,Math.sin(e))/Math.tan(e))*Math.sin(a),this.a*N(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+s*(1-Math.cos(a))),t.x=i+this.x0,t.y=e+this.y0,t},inverse:function(t){var i,s,e,a,n,r,h=t.x-this.x0,o=t.y-this.y0;if(this.sphere)if(Math.abs(o+this.a*this.lat0)<=y)i=j(h/this.a+this.long0),s=0;else{for(var l,d=this.lat0+o/this.a,_=h*h/this.a/this.a+d*d,u=d,c=20;c;--c)if(u+=e=-1*(d*(u*(l=Math.tan(u))+1)-u-.5*(u*u+_)*l)/((u-d)/l-1),Math.abs(e)<=y){s=u;break}i=j(this.long0+Math.asin(h*Math.tan(u)/this.a)/Math.sin(s))}else if(Math.abs(o+this.ml0)<=y)s=0,i=j(this.long0+h/this.a);else{for(d=(this.ml0+o)/this.a,_=h*h/this.a/this.a+d*d,u=d,c=20;c;--c)if(r=this.e*Math.sin(u),a=Math.sqrt(1-r*r)*Math.tan(u),r=this.a*N(this.e0,this.e1,this.e2,this.e3,u),n=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),u-=e=(d*(a*(r=r/this.a)+1)-r-.5*a*(r*r+_))/(this.es*Math.sin(2*u)*(r*r+_-2*d*r)/(4*a)+(d-r)*(a*n-2/Math.sin(2*u))-n),Math.abs(e)<=y){s=u;break}a=Math.sqrt(1-this.es*Math.pow(Math.sin(s),2))*Math.tan(s),i=j(this.long0+Math.asin(h*a/this.a)/Math.sin(s))}return t.x=i,t.y=s,t},names:["Polyconic","poly"]};var ls={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){for(var i=t.x,s=t.y-this.lat0,i=i-this.long0,e=s/rt*1e-5,s=i,a=1,n=0,r=1;r<=10;r++)n+=this.A[r]*(a*=e);var h,o=n,l=s,d=1,_=0,u=0,c=0;for(r=1;r<=6;r++)h=_*o+d*l,u=u+this.B_re[r]*(d=d*o-_*l)-this.B_im[r]*(_=h),c=c+this.B_im[r]*d+this.B_re[r]*_;return t.x=c*this.a+this.x0,t.y=u*this.a+this.y0,t},inverse:function(t){var i,s=t.x,e=t.y,s=s-this.x0,a=(e-this.y0)/this.a,n=s/this.a,r=1,h=0,o=0,l=0;for(f=1;f<=6;f++)i=h*a+r*n,o=o+this.C_re[f]*(r=r*a-h*n)-this.C_im[f]*(h=i),l=l+this.C_im[f]*r+this.C_re[f]*h;for(var d=0;d<this.iterations;d++){for(var _,u=o,c=l,p=a,g=n,f=2;f<=6;f++)_=c*o+u*l,u=u*o-c*l,c=_,p+=(f-1)*(this.B_re[f]*u-this.B_im[f]*c),g+=(f-1)*(this.B_im[f]*u+this.B_re[f]*c);var u=1,c=0,m=this.B_re[1],M=this.B_im[1];for(f=2;f<=6;f++)_=c*o+u*l,u=u*o-c*l,c=_,m+=f*(this.B_re[f]*u-this.B_im[f]*c),M+=f*(this.B_im[f]*u+this.B_re[f]*c);var y=m*m+M*M,o=(p*m+g*M)/y,l=(g*m-p*M)/y}var x=o,e=l,v=1,w=0;for(f=1;f<=9;f++)w+=this.D[f]*(v*=x);return s=this.lat0+w*rt*1e5,e=this.long0+e,t.x=e,t.y=s,t},names:["New_Zealand_Map_Grid","nzmg"]};var ds={init:function(){},forward:function(t){var i=t.x,s=t.y,i=j(i-this.long0),i=this.x0+this.a*i,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+s/2.5))*1.25;return t.x=i,t.y=s,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var i=j(this.long0+t.x/this.a),s=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=i,t.y=s,t},names:["Miller_Cylindrical","mill"]};var _s={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=bi(this.es)},forward:function(t){var i=t.x,s=t.y,i=j(i-this.long0);if(this.sphere){if(this.m)for(var e=this.n*Math.sin(s),a=20;a;--a){var n=(this.m*s+Math.sin(s)-e)/(this.m+Math.cos(s));if(s-=n,Math.abs(n)<y)break}else s=1!==this.n?Math.asin(this.n*Math.sin(s)):s;l=this.a*this.C_x*i*(this.m+Math.cos(s)),o=this.a*this.C_y*s}else var r=Math.sin(s),h=Math.cos(s),o=this.a*Li(s,r,h,this.en),l=this.a*i*h/Math.sqrt(1-this.es*r*r);return t.x=l,t.y=o,t},inverse:function(t){var i,s,e;return t.x-=this.x0,s=t.x/this.a,t.y-=this.y0,i=t.y/this.a,this.sphere?(i/=this.C_y,s/=this.C_x*(this.m+Math.cos(i)),this.m?i=k((this.m*i+Math.sin(i))/this.n):1!==this.n&&(i=k(Math.sin(i)/this.n)),s=j(s+this.long0),i=Vi(i)):(i=Si(t.y/this.a,this.es,this.en),(e=Math.abs(i))<M?(e=Math.sin(i),s=j(this.long0+t.x*Math.sqrt(1-this.es*e*e)/(this.a*Math.cos(i)))):e-y<M&&(s=this.long0)),t.x=s,t.y=i,t},names:["Sinusoidal","sinu"]};var us={init:function(){},forward:function(t){for(var i=t.x,s=t.y,i=j(i-this.long0),e=s,a=Math.PI*Math.sin(s);;){var n=-(e+Math.sin(e)-a)/(1+Math.cos(e));if(e+=n,Math.abs(n)<y)break}return e/=2,Math.PI/2-Math.abs(s)<y&&(i=0),s=.900316316158*this.a*i*Math.cos(e)+this.x0,i=1.4142135623731*this.a*Math.sin(e)+this.y0,t.x=s,t.y=i,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),.999999999999<Math.abs(i)&&(i=.999999999999),e=Math.asin(i);var i,s=j(this.long0+t.x/(.900316316158*this.a*Math.cos(e))),e=((s=s<-Math.PI?-Math.PI:s)>Math.PI&&(s=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,1<Math.abs(i)&&(i=1),Math.asin(i));return t.x=s,t.y=e,t},names:["Mollweide","moll"]};var cs={init:function(){Math.abs(this.lat1+this.lat2)<y||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=$i(this.es),this.e1=Ui(this.es),this.e2=Wi(this.es),this.e3=Ji(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=r(this.e,this.sinphi,this.cosphi),this.ml1=N(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<y?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=r(this.e,this.sinphi,this.cosphi),this.ml2=N(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=N(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var i=t.x,s=t.y,i=(s=this.sphere?this.a*(this.g-s):(s=N(this.e0,this.e1,this.e2,this.e3,s),this.a*(this.g-s)),this.ns*j(i-this.long0)),e=this.x0+s*Math.sin(i),s=this.y0+this.rh-s*Math.cos(i);return t.x=e,t.y=s,t},inverse:function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0,i=0<=this.ns?(s=Math.sqrt(t.x*t.x+t.y*t.y),1):(s=-Math.sqrt(t.x*t.x+t.y*t.y),-1);var i,s,e,a,n=0;return 0!==s&&(n=Math.atan2(i*t.x,i*t.y)),this.sphere?(a=j(this.long0+n/this.ns),e=Vi(this.g-s/this.a)):(e=Hi(this.g-s/this.a,this.e0,this.e1,this.e2,this.e3),a=j(this.long0+n/this.ns)),t.x=a,t.y=e,t},names:["Equidistant_Conic","eqdc"]};var ps={init:function(){this.R=this.a},forward:function(t){var i,s=t.x,e=t.y,s=j(s-this.long0),a=(Math.abs(e)<=y&&(i=this.x0+this.R*s,d=this.y0),k(2*Math.abs(e/Math.PI))),n=((Math.abs(s)<=y||Math.abs(Math.abs(e)-M)<=y)&&(i=this.x0,d=0<=e?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a)),.5*Math.abs(Math.PI/s-s/Math.PI)),r=n*n,h=Math.sin(a),a=Math.cos(a),o=(h=(a=a/(h+a-1))*(2/h-1))*h,l=Math.PI*this.R*(n*(a-o)+Math.sqrt(r*(a-o)*(a-o)-(o+r)*(a*a-o)))/(o+r),s=(i=this.x0+(l=s<0?-l:l),r+a),l=Math.PI*this.R*(h*s-n*Math.sqrt((o+r)*(1+r)-s*s))/(o+r),d=0<=e?this.y0+l:this.y0-l;return t.x=i,t.y=d,t},inverse:function(t){var i,s,e,a,n,r,h;return t.x-=this.x0,t.y-=this.y0,h=Math.PI*this.R,e=(i=t.x/h)*i+(s=t.y/h)*s,h=3*(s*s/(n=-2*(r=-Math.abs(s)*(1+e))+1+2*s*s+e*e)+(2*(a=r-2*s*s+i*i)*a*a/n/n/n-9*r*a/n/n)/27)/(r=(r-a*a/3/n)/n)/(r=2*Math.sqrt(-r/3)),1<Math.abs(h)&&(h=0<=h?1:-1),h=Math.acos(h)/3,r=0<=t.y?(-r*Math.cos(h+Math.PI/3)-a/3/n)*Math.PI:-(-r*Math.cos(h+Math.PI/3)-a/3/n)*Math.PI,h=Math.abs(i)<y?this.long0:j(this.long0+Math.PI*(e-1+Math.sqrt(1+2*(i*i-s*s)+e*e))/2/i),t.x=h,t.y=r,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var gs={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var i,s,e,a,n,r,h,o=t.x,l=t.y,d=Math.sin(t.y),_=Math.cos(t.y),o=j(o-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=y?(t.x=this.x0+this.a*(M-l)*Math.sin(o),t.y=this.y0-this.a*(M-l)*Math.cos(o)):Math.abs(this.sin_p12+1)<=y?(t.x=this.x0+this.a*(M+l)*Math.sin(o),t.y=this.y0+this.a*(M+l)*Math.cos(o)):(a=this.sin_p12*d+this.cos_p12*_*Math.cos(o),r=(a=Math.acos(a))?a/Math.sin(a):1,t.x=this.x0+this.a*r*_*Math.sin(o),t.y=this.y0+this.a*r*(this.cos_p12*d-this.sin_p12*_*Math.cos(o))):(r=$i(this.es),i=Ui(this.es),e=Wi(this.es),h=Ji(this.es),Math.abs(this.sin_p12-1)<=y?(n=this.a*N(r,i,e,h,M),s=this.a*N(r,i,e,h,l),t.x=this.x0+(n-s)*Math.sin(o),t.y=this.y0-(n-s)*Math.cos(o)):Math.abs(this.sin_p12+1)<=y?(n=this.a*N(r,i,e,h,M),s=this.a*N(r,i,e,h,l),t.x=this.x0+(n+s)*Math.sin(o),t.y=this.y0+(n+s)*Math.cos(o)):(r=d/_,i=Qi(this.a,this.e,this.sin_p12),e=Qi(this.a,this.e,d),h=Math.atan((1-this.es)*r+this.es*i*this.sin_p12/(e*_)),n=0===(l=Math.atan2(Math.sin(o),this.cos_p12*Math.tan(h)-this.sin_p12*Math.cos(o)))?Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.abs(Math.abs(l)-Math.PI)<=y?-Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.asin(Math.sin(o)*Math.cos(h)/Math.sin(l)),s=this.e*this.sin_p12/Math.sqrt(1-this.es),d=this.e*this.cos_p12*Math.cos(l)/Math.sqrt(1-this.es),t.x=this.x0+(a=i*n*(1-(r=n*n)*(e=d*d)*(1-e)/6+(_=r*n)/8*(o=s*d)*(1-2*e)+(h=_*n)/120*(e*(4-7*e)-3*s*s*(1-7*e))-h*n/48*o))*Math.sin(l),t.y=this.y0+a*Math.cos(l))),t},inverse:function(t){var i,s,e,a,n,r,h,o;return t.x-=this.x0,t.y-=this.y0,this.sphere?(o=Math.sqrt(t.x*t.x+t.y*t.y))>2*M*this.a?void 0:(a=o/this.a,h=Math.sin(a),a=Math.cos(a),i=this.long0,Math.abs(o)<=y?s=this.lat0:(s=k(a*this.sin_p12+t.y*h*this.cos_p12/o),r=Math.abs(this.lat0)-M,i=Math.abs(r)<=y?0<=this.lat0?j(this.long0+Math.atan2(t.x,-t.y)):j(this.long0-Math.atan2(-t.x,t.y)):j(this.long0+Math.atan2(t.x*h,o*this.cos_p12*a-t.y*this.sin_p12*h))),t.x=i,t.y=s,t):(r=$i(this.es),a=Ui(this.es),h=Wi(this.es),n=Ji(this.es),Math.abs(this.sin_p12-1)<=y?(s=Hi(((e=this.a*N(r,a,h,n,M))-(o=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,r,a,h,n),i=j(this.long0+Math.atan2(t.x,-1*t.y))):Math.abs(this.sin_p12+1)<=y?(e=this.a*N(r,a,h,n,M),s=Hi(((o=Math.sqrt(t.x*t.x+t.y*t.y))-e)/this.a,r,a,h,n),i=j(this.long0+Math.atan2(t.x,t.y))):(o=Math.sqrt(t.x*t.x+t.y*t.y),e=Math.atan2(t.x,t.y),r=Qi(this.a,this.e,this.sin_p12),a=Math.cos(e),n=-(h=this.e*this.cos_p12*a)*h/(1-this.es),h=3*this.es*(1-n)*this.sin_p12*this.cos_p12*a/(1-this.es),h=1-n*(r=(o=o/r)-n*(1+n)*Math.pow(o,3)/6-h*(1+3*n)*Math.pow(o,4)/24)*r/2-o*r*r*r/6,n=Math.asin(this.sin_p12*Math.cos(r)+this.cos_p12*Math.sin(r)*a),i=j(this.long0+Math.asin(Math.sin(e)*Math.sin(r)/Math.cos(n))),o=Math.sin(n),s=Math.atan2((o-this.es*h*this.sin_p12)*Math.tan(n),o*(1-this.es))),t.x=i,t.y=s,t)},names:["Azimuthal_Equidistant","aeqd"]};var fs={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var i,s,e=t.x,a=t.y,e=j(e-this.long0),n=Math.sin(a),a=Math.cos(a),r=Math.cos(e),h=this.sin_p14*n+this.cos_p14*a*r;return(0<h||Math.abs(h)<=y)&&(i=+this.a*a*Math.sin(e),s=this.y0+ +this.a*(this.cos_p14*n-this.sin_p14*a*r)),t.x=i,t.y=s,t},inverse:function(t){var i,s,e,a,n,r;return t.x-=this.x0,t.y-=this.y0,e=k((i=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),s=Math.sin(e),e=Math.cos(e),n=this.long0,Math.abs(i)<=y?(r=this.lat0,t.x=n,t.y=r):(r=k(e*this.sin_p14+t.y*s*this.cos_p14/i),a=Math.abs(this.lat0)-M,n=Math.abs(a)<=y?0<=this.lat0?j(this.long0+Math.atan2(t.x,-t.y)):j(this.long0-Math.atan2(-t.x,t.y)):j(this.long0+Math.atan2(t.x*s,i*this.cos_p14*e-t.y*this.sin_p14*s)),t.x=n,t.y=r),t},names:["ortho"]},ms=1,Ms=2,ys=3,xs=4,vs=5,ws=6,P={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function bs(t,i,s,e){var a;return t<y?(e.value=P.AREA_0,a=0):(a=Math.atan2(i,s),Math.abs(a)<=w?e.value=P.AREA_0:w<a&&a<=M+w?(e.value=P.AREA_1,a-=M):M+w<a||a<=-(M+w)?(e.value=P.AREA_2,a=0<=a?a-d:a+d):(e.value=P.AREA_3,a+=M)),a}function Ls(t,i){t+=i;return t<-d?t+=dt:+d<t&&(t-=dt),t}function js(t,i){return t[0]+i*(t[1]+i*(t[2]+i*t[3]))}var Ss={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=M-w/2?this.face=vs:this.lat0<=-(M-w/2)?this.face=ws:Math.abs(this.long0)<=w?this.face=ms:Math.abs(this.long0)<=M+w?this.face=0<this.long0?Ms:xs:this.face=ys,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var i,s,e,a,n,r,h={x:0,y:0},o={value:0};return t.x-=this.long0,n=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,e=t.x,this.face===vs?(s=M-n,i=w<=e&&e<=M+w?(o.value=P.AREA_0,e-M):M+w<e||e<=-(M+w)?(o.value=P.AREA_1,0<e?e-d:e+d):-(M+w)<e&&e<=-w?(o.value=P.AREA_2,e+M):(o.value=P.AREA_3,e)):this.face===ws?(s=M+n,i=w<=e&&e<=M+w?(o.value=P.AREA_0,-e+M):e<w&&-w<=e?(o.value=P.AREA_1,-e):e<-w&&-(M+w)<=e?(o.value=P.AREA_2,-e-M):(o.value=P.AREA_3,0<e?-e+d:-e-d)):(this.face===Ms?e=Ls(e,+M):this.face===ys?e=Ls(e,+d):this.face===xs&&(e=Ls(e,-M)),a=Math.sin(n),n=Math.cos(n),r=Math.sin(e),e=n*Math.cos(e),n=n*r,r=a,this.face===ms?i=bs(s=Math.acos(e),r,n,o):this.face===Ms?i=bs(s=Math.acos(n),r,-e,o):this.face===ys?i=bs(s=Math.acos(-e),r,-n,o):this.face===xs?i=bs(s=Math.acos(-n),r,e,o):(s=i=0,o.value=P.AREA_0)),a=Math.atan(12/d*(i+Math.acos(Math.sin(i)*Math.cos(w))-M)),n=Math.sqrt((1-Math.cos(s))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(i))))),o.value===P.AREA_1?a+=M:o.value===P.AREA_2?a+=d:o.value===P.AREA_3&&(a+=1.5*d),h.x=n*Math.cos(a),h.y=n*Math.sin(a),h.x=h.x*this.a+this.x0,h.y=h.y*this.a+this.y0,t.x=h.x,t.y=h.y,t},inverse:function(t){var i,s,e,a,n,r={lam:0,phi:0},h={value:0};return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,e=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),i=Math.atan2(t.y,t.x),0<=t.x&&t.x>=Math.abs(t.y)?h.value=P.AREA_0:0<=t.y&&t.y>=Math.abs(t.x)?(h.value=P.AREA_1,i-=M):t.x<0&&-t.x>=Math.abs(t.y)?(h.value=P.AREA_2,i=i<0?i+d:i-d):(h.value=P.AREA_3,i+=M),n=d/12*Math.tan(i),a=Math.sin(n)/(Math.cos(n)-1/Math.sqrt(2)),a=Math.atan(a),(e=1-(i=Math.cos(i))*i*(i=Math.tan(e))*i*(1-Math.cos(Math.atan(1/Math.cos(a)))))<-1?e=-1:1<e&&(e=1),this.face===vs?(s=Math.acos(e),r.phi=M-s,h.value===P.AREA_0?r.lam=a+M:h.value===P.AREA_1?r.lam=a<0?a+d:a-d:h.value===P.AREA_2?r.lam=a-M:r.lam=a):this.face===ws?(s=Math.acos(e),r.phi=s-M,h.value===P.AREA_0?r.lam=-a+M:h.value===P.AREA_1?r.lam=-a:h.value===P.AREA_2?r.lam=-a-M:r.lam=a<0?-a-d:-a+d):(s=1<=(n=(i=e)*i)?0:Math.sqrt(1-n)*Math.sin(a),e=1<=(n+=s*s)?0:Math.sqrt(1-n),h.value===P.AREA_1?(n=e,e=-s,s=n):h.value===P.AREA_2?(e=-e,s=-s):h.value===P.AREA_3&&(n=e,e=s,s=-n),this.face===Ms?(n=i,i=-e,e=n):this.face===ys?(i=-i,e=-e):this.face===xs&&(n=i,i=e,e=-n),r.phi=Math.acos(-s)-M,r.lam=Math.atan2(e,i),this.face===Ms?r.lam=Ls(r.lam,-M):this.face===ys?r.lam=Ls(r.lam,-d):this.face===xs&&(r.lam=Ls(r.lam,+M))),0!==this.es&&(a=r.phi<0?1:0,h=Math.tan(r.phi),n=this.b/Math.sqrt(h*h+this.one_minus_f_squared),r.phi=Math.atan(Math.sqrt(this.a*this.a-n*n)/(this.one_minus_f*n)),a)&&(r.phi=-r.phi),r.lam+=this.long0,t.x=r.lam,t.y=r.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Cs=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Gs=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],As=v/5,Ns=1/As;var Es={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var i=j(t.x-this.long0),s=Math.abs(t.y),e=Math.floor(s*As),i=(e<0?e=0:18<=e&&(e=17),{x:js(Cs[e],s=v*(s-Ns*e))*i,y:js(Gs[e],s)});return t.y<0&&(i.y=-i.y),i.x=i.x*this.a*.8487+this.x0,i.y=i.y*this.a*1.3523+this.y0,i},inverse:function(t){var i={x:(t.x-this.x0)/(.8487*this.a),y:Math.abs(t.y-this.y0)/(1.3523*this.a)};if(1<=i.y)i.x/=Cs[18][0],i.y=t.y<0?-M:M;else{var s=Math.floor(18*i.y);for(s<0?s=0:18<=s&&(s=17);;)if(Gs[s][0]>i.y)--s;else{if(!(Gs[s+1][0]<=i.y))break;++s}var e=Gs[s],a=function(t,i,s,e){for(var a=i;e;--e){var n=t(a);if(a-=n,Math.abs(n)<s)break}return a}(function(t){return(js(e,t)-i.y)/(e[1]+t*(2*e[2]+3*t*e[3]))},5*(i.y-e[0])/(Gs[s+1][0]-e[0]),y,100);i.x/=js(Cs[s],a),i.y=(5*s+a)*x,t.y<0&&(i.y=-i.y)}return i.x=j(i.x+this.long0),i},names:["Robinson","robin"]};var ks={init:function(){this.name="geocent"},forward:function(t){return Rt(t,this.es,this.a)},inverse:function(t){return Ft(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},Ps=0,Is=1,Ts=2,Os=3,zs={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};var Bs={init:function(){if(Object.keys(zs).forEach(function(t){if(void 0===this[t])this[t]=zs[t].def;else{if(zs[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);zs[t].num&&(this[t]=parseFloat(this[t]))}zs[t].degrees&&(this[t]=this[t]*x)}.bind(this)),Math.abs(Math.abs(this.lat0)-M)<y?this.mode=this.lat0<0?Is:Ps:Math.abs(this.lat0)<y?this.mode=Ts:(this.mode=Os,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||1e10<this.pn1)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,i=this.azi;this.cg=Math.cos(i),this.sg=Math.sin(i),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var i,s,e,a,n=Math.sin(t.y),r=Math.cos(t.y),h=Math.cos(t.x);switch(this.mode){case Os:s=this.sinph0*n+this.cosph0*r*h;break;case Ts:s=r*h;break;case Is:s=-n;break;case Ps:s=n}switch(i=(s=this.pn1/(this.p-s))*r*Math.sin(t.x),this.mode){case Os:s*=this.cosph0*n-this.sinph0*r*h;break;case Ts:s*=n;break;case Ps:s*=-r*h;break;case Is:s*=r*h}return a=1/((e=s*this.cg+i*this.sg)*this.sw*this.h1+this.cw),i=(i*this.cg-s*this.sg)*this.cw*a,s=e*a,t.x=i*this.a,t.y=s*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var i={x:t.x,y:t.y},s=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*s,s=this.pn1*t.y*this.cw*s,a=(t.x=e*this.cg+s*this.sg,t.y=s*this.cg-e*this.sg,u(t.x,t.y));if(Math.abs(a)<y)i.x=0,i.y=t.y;else{var n,r=1-a*a*this.pfact;switch(r=(this.p-Math.sqrt(r))/(this.pn1/a+a/this.pn1),n=Math.sqrt(1-r*r),this.mode){case Os:i.y=Math.asin(n*this.sinph0+t.y*r*this.cosph0/a),t.y=(n-this.sinph0*Math.sin(i.y))*a,t.x*=r*this.cosph0;break;case Ts:i.y=Math.asin(t.y*r/a),t.y=n*a,t.x*=r;break;case Ps:i.y=Math.asin(n),t.y=-t.y;break;case Is:i.y=-Math.asin(n)}i.x=Math.atan2(t.x,t.y)}return t.x=i.x+this.long0,t.y=i.y,t},names:["Tilted_Perspective","tpers"]};var Rs={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||1e10<this.radius_g_1)throw new Error;var t,i;this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es?(i=1/(t=1-this.es),this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=i,this.shape="ellipse"):(this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere"),this.title||(this.title="Geostationary Satellite View")},forward:function(t){var i,s=t.x,e=t.y;if(s-=this.long0,"ellipse"===this.shape){var e=Math.atan(this.radius_p2*Math.tan(e)),a=this.radius_p/u(this.radius_p*Math.cos(e),Math.sin(e)),n=a*Math.cos(s)*Math.cos(e),r=a*Math.sin(s)*Math.cos(e),a=a*Math.sin(e);if((this.radius_g-n)*n-r*r-a*a*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=this.radius_g-n,this.flip_axis?(t.x=this.radius_g_1*Math.atan(r/u(a,i)),t.y=this.radius_g_1*Math.atan(a/i)):(t.x=this.radius_g_1*Math.atan(r/i),t.y=this.radius_g_1*Math.atan(a/u(r,i)))}else"sphere"===this.shape&&(i=Math.cos(e),n=Math.cos(s)*i,r=Math.sin(s)*i,a=Math.sin(e),i=this.radius_g-n,this.flip_axis?(t.x=this.radius_g_1*Math.atan(r/u(a,i)),t.y=this.radius_g_1*Math.atan(a/i)):(t.x=this.radius_g_1*Math.atan(r/i),t.y=this.radius_g_1*Math.atan(a/u(r,i))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var i,s=-1,e=0,a=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),e=Math.tan(t.x/this.radius_g_1)*u(1,a)):(e=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*u(1,e));var n,r,h=a/this.radius_p,h=e*e+h*h+s*s;if((r=(n=2*this.radius_g*s)*n-4*h*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-n-Math.sqrt(r))/(2*h),s=this.radius_g+i*s,e*=i,a*=i,t.x=Math.atan2(e,s),t.y=Math.atan(a*Math.cos(t.x)/s),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),e=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+a*a)):(e=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+e*e)),(r=(n=2*this.radius_g*s)*n-4*(h=e*e+a*a+s*s)*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-n-Math.sqrt(r))/(2*h),s=this.radius_g+i*s,e*=i,a*=i,t.x=Math.atan2(e,s),t.y=Math.atan(a*Math.cos(t.x)/s)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};o.defaultDatum="WGS84",o.Proj=G,o.WGS84=new o.Proj("WGS84"),o.Point=di,o.toPoint=Jt,o.defs=n,o.nadgrid=function(t,i){var s=function(t){if(11===t.getInt32(8,!1))return!1;11!==t.getInt32(8,!0)&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian");return!0}(i=new DataView(i)),e=(a=s,{nFields:(e=i).getInt32(8,a),nSubgridFields:e.getInt32(24,a),nSubgrids:e.getInt32(40,a),shiftType:Bt(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,a),fromSemiMinorAxis:e.getFloat64(136,a),toSemiMajorAxis:e.getFloat64(152,a),toSemiMinorAxis:e.getFloat64(168,a)}),a={header:e,subgrids:function(t,i,s){for(var e=176,a=[],n=0;n<i.nSubgrids;n++){var r=function(t,i,s){return{name:Bt(t,i+8,i+16).trim(),parent:Bt(t,i+24,i+24+8).trim(),lowerLatitude:t.getFloat64(i+72,s),upperLatitude:t.getFloat64(i+88,s),lowerLongitude:t.getFloat64(i+104,s),upperLongitude:t.getFloat64(i+120,s),latitudeInterval:t.getFloat64(i+136,s),longitudeInterval:t.getFloat64(i+152,s),gridNodeCount:t.getInt32(i+168,s)}}(t,e,s),h=function(t,i,s,e){for(var a=i+176,n=[],r=0;r<s.gridNodeCount;r++){var h={latitudeShift:t.getFloat32(a+16*r,e),longitudeShift:t.getFloat32(a+16*r+4,e),latitudeAccuracy:t.getFloat32(a+16*r+8,e),longitudeAccuracy:t.getFloat32(a+16*r+12,e)};n.push(h)}return n}(t,e,r,s),o=Math.round(1+(r.upperLongitude-r.lowerLongitude)/r.longitudeInterval),l=Math.round(1+(r.upperLatitude-r.lowerLatitude)/r.latitudeInterval);a.push({ll:[_(r.lowerLongitude),_(r.lowerLatitude)],del:[_(r.longitudeInterval),_(r.latitudeInterval)],lim:[o,l],count:r.gridNodeCount,cvs:function(t){return t.map(function(t){return[_(t.longitudeShift),_(t.latitudeShift)]})}(h)}),e+=176+16*r.gridNodeCount}return a}(i,e,s)};return Ot[t]=a},o.transform=Vt,o.mgrs=i,o.version="__VERSION__",(i=o).Proj.projections.add(Ci),i.Proj.projections.add(ki),i.Proj.projections.add(Pi),i.Proj.projections.add(Oi),i.Proj.projections.add(zi),i.Proj.projections.add(Bi),i.Proj.projections.add(Fi),i.Proj.projections.add(Di),i.Proj.projections.add(qi),i.Proj.projections.add(Zi),i.Proj.projections.add(es),i.Proj.projections.add(as),i.Proj.projections.add(ns),i.Proj.projections.add(rs),i.Proj.projections.add(hs),i.Proj.projections.add(os),i.Proj.projections.add(ls),i.Proj.projections.add(ds),i.Proj.projections.add(_s),i.Proj.projections.add(us),i.Proj.projections.add(cs),i.Proj.projections.add(ps),i.Proj.projections.add(gs),i.Proj.projections.add(fs),i.Proj.projections.add(Ss),i.Proj.projections.add(Es),i.Proj.projections.add(ks),i.Proj.projections.add(Bs),i.Proj.projections.add(Rs);var Fs=function(){function s(t){if(F(this,s),this._params=Object.assign({map_proj:null,ref_lat:null,ref_lon:null,truelat1:null,truelat2:null,stand_lon:null,dx:null,dy:null,e_we:null,e_sn:null},t),this._params.map_proj===H)this._proj4="+units=m +proj=lcc +lat_1="+this._params.truelat1+" +lat_2="+this._params.truelat2+" +lat_0="+this._params.ref_lat+" +lon_0="+this._params.stand_lon+" +a="+l+" +b="+l+" +towgs84=0,0,0 +no_defs=True";else if(this._params.map_proj===Z)this._proj4="+units=m +proj=merc +lat_ts="+this._params.truelat1+" +lon_0="+this._params.stand_lon+" +a="+l+" +b="+l+" +towgs84=0,0,0 +no_defs=True +nadgrids=null";else if(this._params.map_proj===X){var t=this._params.truelat1<0?-90:90,i=this._params.truelat1;this._proj4="+units=m +proj=stere +lat_0="+t+" +lon_0="+this._params.stand_lon+" +lat_ts="+i+" +a="+l+" +b="+l}else{if(this._params.map_proj!==K)throw"Unsupported projection "+this._wps.map_proj;this._proj4="+units=m +proj=eqc +lon_0="+this._params.stand_lon+" +a="+l+" +b="+l+" +nadgrids=null +towgs84=0,0,0 +no_defs=True"}}return t(s,[{key:"latlon_to_ij",value:function(t,i){if(isNaN(t)||isNaN(i))throw new Error("Invalid lat-lon coordinates");return o(s._wrf_proj,this._proj4,[i,t])}},{key:"ij_to_latlon",value:function(t,i){if(isNaN(t)||isNaN(i))throw new Error("Invalid IJ coordinates");t=o(this._proj4,s._wrf_proj,[t,i]);return[t[1],t[0]]}}]),s}(),Ds=(z(Fs,"earth_radius",637e4),z(Fs,"_wrf_proj","+units=m +proj=longlat +a="+l+" +b="+l+"  +towgs84=0,0,0 +no_defs=True"),function(){function e(t,i,s){if(F(this,e),this._wps=Object.assign({map_proj:null,ref_lat:null,ref_lon:null,truelat1:null,truelat2:null,stand_lon:null,dx:null,dy:null,s_we:1,s_sn:1,e_we:null,e_sn:null,parent_grid_ratio:null,i_parent_start:null,j_parent_start:null},i),s){if(this.parent=s,null===this._wps.parent_grid_ratio)throw new Error("parent_grid_ratio must be specified for nested grids");if(null===this._wps.i_parent_start)throw new Error("i_parent_start must be specified for nested grids");if(null===this._wps.j_parent_start)throw new Error("j_parent_start must be specified for nested grids")}else this.parent=null;this.id="Number"==typeof t?"d".concat(t.toString().padStart("0",2)):t.toString(),this._initialize()}return t(e,[{key:"wps",get:function(){return this._wps}},{key:"projection",get:function(){return this._projection}},{key:"corners",get:function(){return this._corners}},{key:"parent_grid_ratio",get:function(){return this._wps.parent_grid_ratio}},{key:"i_parent_start",get:function(){return this._wps.i_parent_start}},{key:"j_parent_start",get:function(){return this._wps.j_parent_start}},{key:"e_we",get:function(){return this._wps.e_we}},{key:"e_sn",get:function(){return this._wps.e_sn}},{key:"polygonPath",get:function(){return this._polygonPath||(this._polygonPath=this._initPolygonPath()),this._polygonPath}},{key:"_initialize",value:function(){this._proj_ref_lat=this._wps.ref_lat,this._proj_ref_lon=this._wps.ref_lon,this._proj_truelat1=this._wps.truelat1,this._proj_truelat2=this._wps.truelat2,this._proj_stand_lon=this._wps.stand_lon,this._proj_dx=this._wps.dx,this._proj_dy=this._wps.dy,this._proj_e_we=this._wps.e_we,this._proj_e_sn=this._wps.e_sn;var t=0,i=0,s=null!==this.parent;if(console.debug("Initializing grid ".concat(this.id)),console.debug(" WPS:"),this._wps.map_proj===K?(console.debug("  dx: ".concat(this._wps.dx," deg")),console.debug("  dy: ".concat(this._wps.dy," deg"))):(console.debug("  dx: ".concat(this._proj_dx,"m")),console.debug("  dy: ".concat(this._proj_dy,"m"))),console.debug("  e_sn: ".concat(this._wps.e_sn)),console.debug("  e_we: ".concat(this._wps.e_we)),this._wps.map_proj===K){if(isNaN(this._wps.dx)&&isNaN(this._wps.dy)){var e=360/(this._wps.e_we-this._wps.s_we),a=180/(this._wps.e_sn-this._wps.s_sn);this._proj_ref_lon=this._wps.stand_lon+e/2,this._proj_ref_lat=a/2-90,this._proj_dx=l*Math.PI*2/(this._wps.e_we-this._wps.s_we),this._proj_dy=l*Math.PI/(this._wps.e_sn-this._wps.s_sn)}else if(this._proj_dx=tt(this._wps.dx),this._proj_dy=tt(this._wps.dy),null===this._wps.ref_lat&&null===this._wps.ref_lon)throw new Error("For lat-lon projection, if dx/dy are specified, a regional domain is assumed, and a ref_lat,ref_lon must also be specified");console.debug("  dx: ".concat(this._proj_dx,"m")),console.debug("  dy: ".concat(this._proj_dy,"m"))}if(s){console.debug(" Nest:"),console.debug("  parent_grid_ratio: ".concat(this.parent_grid_ratio)),console.debug("  i_parent_start: ".concat(this.i_parent_start)),console.debug("  j_parent_start: ".concat(this.j_parent_start));for(var n=1,r=this;null!=r.parent;)n*=r.parent_grid_ratio,t+=(r.i_parent_start-1)*n,i+=(r.j_parent_start-1)*n,r=r.parent;console.debug("  moad_grid_ratio: ".concat(n)),console.debug("  i_moad_start: ".concat(t)),console.debug("  j_moad_start: ".concat(i)),this._proj_dx=this._proj_dx/n,this._proj_dy=this._proj_dy/n,this._proj_e_we=(r.e_we-1)*n+1,this._proj_e_sn=(r.e_sn-1)*n+1,console.debug("  dx: ".concat(this._proj_dx,"m")),console.debug("  dy: ".concat(this._proj_dy,"m")),console.debug("  e_sn: ".concat(this._proj_e_sn)),console.debug("  e_we: ".concat(this._proj_e_we))}this._projection=new Fs({map_proj:this._wps.map_proj,ref_lat:this._proj_ref_lat,ref_lon:this._proj_ref_lon,truelat1:this._proj_truelat1,truelat2:this._proj_truelat2,stand_lon:this._proj_stand_lon,dx:this._proj_dx,dy:this._proj_dy,e_we:this._proj_e_we,e_sn:this._proj_e_sn});var e=(this._proj_e_we-2)*this._proj_dx,a=(this._proj_e_sn-2)*this._proj_dy,s=(this._proj_e_we-1)*this._proj_dx,h=(this._proj_e_sn-1)*this._proj_dy,o=(console.debug("  unstaggered_grid_size_i: ".concat(s,"m")),console.debug("  unstaggered_grid_size_j: ".concat(h,"m")),this._projection.latlon_to_ij(this._proj_ref_lat,this._proj_ref_lon));console.debug("  grid_center_ij: [".concat(o[0],", ").concat(o[1],"]")),this._mass_offset_i=o[0]-.5*e,this._mass_offset_j=o[1]-.5*a,this._unstaggered_offset_i=o[0]-.5*s+t*this._proj_dx,this._unstaggered_offset_j=o[1]-.5*h+i*this._proj_dy,console.debug("  unstaggered_offset_i: ".concat(this._unstaggered_offset_i,"m")),console.debug("  unstaggered_offset_j: ".concat(this._unstaggered_offset_j,"m")),this._corners={sw:this.unstaggered_ij_to_latlon(0,0),se:this.unstaggered_ij_to_latlon(this._wps.e_we-1,0),ne:this.unstaggered_ij_to_latlon(this._wps.e_we-1,this._wps.e_sn-1),nw:this.unstaggered_ij_to_latlon(0,this._wps.e_sn-1)}}},{key:"_initPolygonPath",value:function(){var t,i,s=[];for(s.push(this._corners.sw),t=5;t<this._wps.e_we-1-5;t+=5)s.push(this.unstaggered_ij_to_latlon(t,0));for(s.push(this._corners.se),i=5;i<this._wps.e_sn-1-5;i+=5)s.push(this.unstaggered_ij_to_latlon(this._wps.e_we-1,i));for(s.push(this._corners.ne),t=this._wps.e_we-1-5;5<t;t-=5)s.push(this.unstaggered_ij_to_latlon(t,this._wps.e_sn-1));for(s.push(this._corners.nw),i=this._wps.e_sn-1-5;5<i;i-=5)s.push(this.unstaggered_ij_to_latlon(0,i));return s.push(this._corners.sw),s}},{key:"latlon_to_unstaggered_ij",value:function(t,i){t=this._projection.latlon_to_ij(t,i);return t[0]=(t[0]-this._unstaggered_offset_i)/this._proj_dx,t[1]=(t[1]-this._unstaggered_offset_j)/this._proj_dy,t}},{key:"unstaggered_ij_to_latlon",value:function(t,i){return this._projection.ij_to_latlon(t*this._proj_dx+this._unstaggered_offset_i,i*this._proj_dy+this._unstaggered_offset_j)}}]),e}()),q=L.Polygon.extend({statics:{minNestGridPoints:5,minGridSize:10,defaultGridRatio:3,minPixelsPerGrid:7,IAxisOpt:Object.freeze({I_PARENT_START:0,E_WE:1}),JAxisOpt:Object.freeze({J_PARENT_START:0,E_SN:1})},options:{showTooltip:!0,showGridLines:!1,editable:!0,opacity:.8,weight:2,color:"#FF0000",fillColor:"#FF0000",fillOpacity:.2,className:"wrf-domain-grid"},domain:null,parent:null,id:null,parent_grid_ratio:1,i_parent_start:1,j_parent_start:1,e_we:0,e_sn:0,geog_data_res:"default",_gridLinesLayer:null,_iGridLines:null,_jGridLines:null,_enableGridLines:!0,_createGridLinesPane:function(){return this._map?(this._map.getPane("gridLinesPane")||this._map.createPane("gridLinesPane"),L.layerGroup(null,{pane:"gridLinesPane"})):null},_cornerMarkers:null,_corners:null,_isSelected:!1,nests:null,geogrid:null,_initGeogrid:function(){var t;return new Ds(this.id,{map_proj:this.domain.map_proj,ref_lat:this.domain.ref_lat,ref_lon:this.domain.ref_lon,truelat1:this.domain.truelat1,truelat2:this.domain.truelat2,stand_lon:this.domain.stand_lon,dx:this.domain.dx,dy:this.domain.dy,e_we:this.e_we,e_sn:this.e_sn,parent_grid_ratio:this.parent_grid_ratio,i_parent_start:this.i_parent_start,j_parent_start:this.j_parent_start},null==(t=this.parent)?void 0:t.geogrid)},_initCorners:function(){return{sw:L.latLng(this.geogrid.corners.sw),se:L.latLng(this.geogrid.corners.se),ne:L.latLng(this.geogrid.corners.ne),nw:L.latLng(this.geogrid.corners.nw)}},_onMapViewChanged:function(){this._isSelected&&this._updateGridLines()},_getTooltipContent:function(t){var i="<table><thead><tr><th>"+this.name+"</th><th></th></tr></thead>",s=(i+="<tbody>",this.geogrid.latlon_to_unstaggered_ij(t.lat,t.lng));return(i+="<tr><td>i,j</td><td>"+Math.ceil(s[0])+", "+Math.ceil(s[1])+"</td></tr>")+("<tr><td>lat,lon</td><td>"+t.lat.toFixed(2)+", "+t.lng.toFixed(2)+"</td></tr>")+"</tbody>"+"</table>"},_updateTooltip:function(t){var i=this.getTooltip();i&&(i=i.getElement())&&(i.innerHTML=this._getTooltipContent(t.latlng))},_onPolygonClick:function(t){t.originalEvent.ctrlKey?this.unselect():this.select()},_bindTooltip:function(t){this.options.showTooltip&&(this.on("mousemove",this._updateTooltip,this),L.Polygon.prototype.bindTooltip.call(this,t&&t.latlng?this._getTooltipContent(t.latlng):"",{sticky:!0,className:"wrf-domain-grid-tooltip"}))},bindTooltip:function(t){this._bindTooltip(t);for(var i=0;i<this.nests.length;i++)this.nests[i].bindTooltip(t)},_unbindTooltip:function(){L.Polygon.prototype.unbindTooltip.call(this),this.off("mousemove",this._updateTooltip,this)},unbindTooltip:function(){this.getTooltip()&&this._unbindTooltip();for(var t=0;t<this.nests.length;t++)this.nests[t].unbindTooltip()},_resizeContext:null,_resizeEnd:function(t){this.domain.grid.bindTooltip(),this._map.dragging.enable(),this._map.off("mousemove",this._resize,this),this._map.off("mouseup",this._resizeEnd,this),this._map.off("mouseout",this._resizeEnd,this),this._resizeContext.resizeStarted&&(this.showGridLines(),this.parent)&&this.parent.hideGridLines(),this._resizeContext=null},_resizeStart:function(t,i,s){var e,a,n,r,h;for(this._map.once("mouseup",this._resizeEnd,this),this._map.once("mouseout",this._resizeEnd,this),this._map.dragging.disable(),this.domain.grid.unbindTooltip(),h=0;h<this.nests.length;h++)r=0==h?(e=this.nests[h].i_parent_start,a=this.nests[h].j_parent_start,n=this.nests[h].i_delta_end,this.nests[h].j_delta_end):(e=Math.min(e,this.nests[h].i_parent_start),a=Math.min(a,this.nests[h].j_parent_start),n=Math.min(n,this.nests[h].i_delta_end),Math.min(r,this.nests[h].j_delta_end));this._resizeContext={resizeStarted:!1,stand_lon_delta:this.domain.stand_lon-this.domain.ref_lon,truelat1_delta:this.domain.truelat1-this.domain.ref_lat,truelat2_delta:this.domain.truelat2-this.domain.ref_lat,min_e_we:n?this.e_we-n+q.minNestGridPoints:q.minGridSize,mine_sn:r?this.e_sn-r+q.minNestGridPoints:q.minGridSize,max_e_we:this.parent?(this.i_delta_end-q.minNestGridPoints)*this.parent_grid_ratio+this.e_we:0,maxe_sn:this.parent?(this.j_delta_end-q.minNestGridPoints)*this.parent_grid_ratio+this.e_sn:0,min_i_parent_start:this.parent?q.minNestGridPoints-this.i_parent_start+1:0,min_j_parent_start:this.parent?q.minNestGridPoints-this.j_parent_start+1:0,max_i_parent_start:e?Math.floor((e-q.minNestGridPoints-1)/this.parent_grid_ratio):this.parent?Math.floor((this.e_we-q.minGridSize)/this.parent_grid_ratio):this.e_we-q.minGridSize,max_j_parent_start:a?Math.floor((a-q.minNestGridPoints-1)/this.parent_grid_ratio):this.parent?Math.floor((this.e_sn-q.minGridSize)/this.parent_grid_ratio):this.e_sn-q.minGridSize,mod_delta_i:0,mod_delta_j:0,iAxisOpt:i,jAxisOpt:s,startLatlng:t.latlng}},_resize:function(t){if(this._resizeContext.resizeStarted){var i,s,e,a,t=this.geogrid.latlon_to_unstaggered_ij(t.latlng.lat,t.latlng.lng),n=Y(t[0]),r=Y(t[1]);if(this._resizeContext.iAxisOpt==q.IAxisOpt.E_WE&&(n-=this.e_we-1),this._resizeContext.jAxisOpt==q.JAxisOpt.E_SN&&(r-=this.e_sn-1),this.parent){if(this._resizeContext.iAxisOpt==q.IAxisOpt.I_PARENT_START){n+=this._resizeContext.mod_delta_i,this._resizeContext.mod_delta_i=n%this.parent_grid_ratio;var h=(n-this._resizeContext.mod_delta_i)/this.parent_grid_ratio;h>this._resizeContext.max_i_parent_start?(h=this._resizeContext.max_i_parent_start,this._resizeContext.max_i_parent_start=0):this._resizeContext.max_i_parent_start-=h,h<this._resizeContext.min_i_parent_start?(this._resizeContext.max_i_parent_start+=h-this._resizeContext.min_i_parent_start,h=this._resizeContext.min_i_parent_start,this._resizeContext.min_i_parent_start=0):this._resizeContext.min_i_parent_start-=h,this.e_we-=h*this.parent_grid_ratio,this.i_parent_start+=h;for(var o=0;o<this.nests.length;o++)this.nests[o].i_parent_start-=h*this.parent_grid_ratio}else this._resizeContext.iAxisOpt==q.IAxisOpt.E_WE&&(e=Math.max(this.e_we+n,this._resizeContext.min_e_we),e=Math.min(e,this._resizeContext.max_e_we),this.e_we=e-(e-1)%this.parent_grid_ratio);if(this._resizeContext.jAxisOpt==q.JAxisOpt.J_PARENT_START){r+=this._resizeContext.mod_delta_j,this._resizeContext.mod_delta_j=r%this.parent_grid_ratio;var l=(r-this._resizeContext.mod_delta_j)/this.parent_grid_ratio;l>this._resizeContext.max_j_parent_start?(l=this._resizeContext.max_j_parent_start,this._resizeContext.max_j_parent_start=0):this._resizeContext.max_j_parent_start-=l,l<this._resizeContext.min_j_parent_start?(this._resizeContext.max_j_parent_start+=l-this._resizeContext.min_j_parent_start,l=this._resizeContext.min_j_parent_start,this._resizeContext.min_j_parent_start=0):this._resizeContext.min_j_parent_start-=l,this.e_sn-=l*this.parent_grid_ratio,this.j_parent_start+=l;for(o=0;o<this.nests.length;o++)this.nests[o].j_parent_start-=l*this.parent_grid_ratio}else this._resizeContext.jAxisOpt==q.JAxisOpt.E_SN&&(a=Math.max(this.e_sn+r,this._resizeContext.mine_sn),a=Math.min(a,this._resizeContext.maxe_sn),this.e_sn=a-(a-1)%this.parent_grid_ratio);this.update()}else{if(this._resizeContext.iAxisOpt==q.IAxisOpt.I_PARENT_START?(n>this._resizeContext.max_i_parent_start?(n=this._resizeContext.max_i_parent_start,this._resizeContext.max_i_parent_start=0):this._resizeContext.max_i_parent_start-=n,i=(this.e_we-1+n)/2):this._resizeContext.iAxisOpt==q.IAxisOpt.E_WE&&(i=((e=Math.max(this.e_we+n,this._resizeContext.min_e_we))-1)/2),this._resizeContext.jAxisOpt==q.JAxisOpt.J_PARENT_START?(r>this._resizeContext.max_j_parent_start?(r=this._resizeContext.max_j_parent_start,this._resizeContext.max_j_parent_start=0):this._resizeContext.max_j_parent_start-=r,s=(this.e_sn-1+r)/2):this._resizeContext.jAxisOpt==q.JAxisOpt.E_SN&&(s=((a=Math.max(this.e_sn+r,this._resizeContext.mine_sn))-1)/2),t=this.geogrid.unstaggered_ij_to_latlon(i,s),this.domain.ref_lat=t[0],this.domain.ref_lon=t[1],this._resizeContext.iAxisOpt==q.IAxisOpt.I_PARENT_START){this.e_we-=n;for(o=0;o<this.nests.length;o++)this.nests[o].i_parent_start-=n}else this._resizeContext.iAxisOpt==q.IAxisOpt.E_WE&&(this.e_we=e);if(this._resizeContext.jAxisOpt==q.JAxisOpt.J_PARENT_START){this.e_sn-=r;for(o=0;o<this.nests.length;o++)this.nests[o].j_parent_start-=r}else this._resizeContext.jAxisOpt==q.JAxisOpt.E_SN&&(this.e_sn=a);this.domain.update()}}else this._resizeContext.resizeStarted=!0,this._enableGridLines=!1,this._iGridLines&&this._removeGridLines(),this.parent&&this.parent.showGridLines()},_log:function(t){t&&console.log(t),console.log("  ref_lat: "+this.domain.ref_lat),console.log("  ref_lon: "+this.domain.ref_lon),console.log("  stand_lon: "+this.domain.stand_lon),console.log("  truelat1: "+this.domain.truelat1),console.log("  truelat2: "+this.domain.truelat2),console.log("  i_parent_start: "+this.i_parent_start),console.log("  j_parent_start: "+this.j_parent_start),console.log("  e_we: "+this.e_we),console.log("  e_sn: "+this.e_sn)},_dragContext:null,_dragEnd:function(t){this.domain.grid.bindTooltip(t),this._map.dragging.enable(),this._map.off("mousemove",this._drag,this),this._map.off("mouseup",this._dragEnd,this),this._map.off("mouseout",this._dragEnd,this),this._enableGridLines=!0,this._dragContext.dragStarted&&(this._drawGridLines(),this.parent)&&this.parent.hideGridLines(),this._dragContext=null},_dragStart:function(t){this._map.once("mouseup",this._dragEnd,this),this._map.once("mouseout",this._dragEnd,this),this._map.dragging.disable(),this.domain.grid.unbindTooltip(),this._dragContext={dragStarted:!1,stand_lon_delta:this.domain.stand_lon-this.domain.ref_lon,truelat1_delta:this.domain.truelat1-this.domain.ref_lat,truelat2_delta:this.domain.truelat2-this.domain.ref_lat,startLatLng:t.latlng,startIJ:this.geogrid.latlon_to_unstaggered_ij(t.latlng.lat,t.latlng.lng),delta_i:0,delta_j:0,max_delta_i:this.i_delta_end-q.minNestGridPoints,max_delta_j:this.j_delta_end-q.minNestGridPoints,min_delta_i:q.minNestGridPoints-this.i_parent_start+1,min_delta_j:q.minNestGridPoints-this.j_parent_start+1,i_parent_start:this.i_parent_start,j_parent_start:this.j_parent_start},this._map.on("mousemove",this._drag,this)},_drag:function(t){var i,s;this._dragContext.dragStarted||(this._dragContext.dragStarted=!0,this._enableGridLines=!1,this._iGridLines&&this._removeGridLines(),this.parent&&this.parent.showGridLines()),null==this.parent?(this.domain.ref_lat=t.latlng.lat-this._dragContext.startLatLng.lat+this.domain.ref_lat,this.domain.ref_lon=t.latlng.lng-this._dragContext.startLatLng.lng+this.domain.ref_lon,this.domain.stand_lon=this.domain.ref_lon+this._dragContext.stand_lon_delta,this.domain.truelat1=this.domain.ref_lat+this._dragContext.truelat1_delta,this.domain.truelat2=this.domain.ref_lat+this._dragContext.truelat2_delta,this._dragContext.startLatLng=t.latlng,this.domain.update()):(i=this.geogrid.latlon_to_unstaggered_ij(t.latlng.lat,t.latlng.lng),this._dragContext.delta_i+=(i[0]-this._dragContext.startIJ[0])/this.parent_grid_ratio,this._dragContext.delta_j+=(i[1]-this._dragContext.startIJ[1])/this.parent_grid_ratio,i=Math.min(Y(this._dragContext.delta_i),this._dragContext.max_delta_i),i=Math.max(i,this._dragContext.min_delta_i),s=Math.min(Y(this._dragContext.delta_j),this._dragContext.max_delta_j),s=Math.max(s,this._dragContext.min_delta_j),this.i_parent_start=this._dragContext.i_parent_start+i,this.j_parent_start=this._dragContext.j_parent_start+s,this.update(),this._dragContext.startIJ=this.geogrid.latlon_to_unstaggered_ij(t.latlng.lat,t.latlng.lng))},onAdd:function(t){this._gridLinesLayer=this._createGridLinesPane(),L.Polygon.prototype.onAdd.call(this,t),this.geogrid=this._initGeogrid(),this._corners=this._initCorners(),this.setLatLngs(this.geogrid.polygonPath),this._cornerMarkers={sw:L.marker(this._corners.sw,{icon:L.divIcon({className:this.options.editable?"wrf-domain-grid-corner cursor-nesw-resize":"wrf-domain-grid-corner"})}),se:L.marker(this._corners.se,{icon:L.divIcon({className:this.options.editable?"wrf-domain-grid-corner cursor-nwse-resize":"wrf-domain-grid-corner"})}),ne:L.marker(this._corners.ne,{icon:L.divIcon({className:this.options.editable?"wrf-domain-grid-corner cursor-nesw-resize":"wrf-domain-grid-corner"})}),nw:L.marker(this._corners.nw,{icon:L.divIcon({className:this.options.editable?"wrf-domain-grid-corner cursor-nwse-resize":"wrf-domain-grid-corner"})})},this.options.editable&&(this._cornerMarkers.sw.on("mousedown",function(t){this._resizeStart(t,q.IAxisOpt.I_PARENT_START,q.JAxisOpt.J_PARENT_START),this._map.on("mousemove",this._resize,this)},this),this._cornerMarkers.se.on("mousedown",function(t){this._resizeStart(t,q.IAxisOpt.E_WE,q.JAxisOpt.J_PARENT_START),this._map.on("mousemove",this._resize,this)},this),this._cornerMarkers.ne.on("mousedown",function(t){this._resizeStart(t,q.IAxisOpt.E_WE,q.JAxisOpt.E_SN),this._map.on("mousemove",this._resize,this)},this),this._cornerMarkers.nw.on("mousedown",function(t){this._resizeStart(t,q.IAxisOpt.I_PARENT_START,q.JAxisOpt.E_SN),this._map.on("mousemove",this._resize,this)},this)),this._map.on("zoomend moveend",this._onMapViewChanged,this),this._bindTooltip(),this.on("click",this._onPolygonClick,this);for(var i=0;i<this.nests.length;i++)this.nests[i].addTo(t)},getBounds:function(){return this._corners&&this._projection||(this.geogrid=this._initGeogrid(),this._corners=this._initCorners(),this.setLatLngs(this.geogrid.polygonPath)),L.Polygon.prototype.getBounds.call(this)},onRemove:function(t){this._map.off("viewreset",this._onMapViewChanged,this),this.options.showTooltip&&this._unbindTooltip(),this.off("click",this._onPolygonClick,this),this._isSelected&&this.unselect();for(var i=0;i<this.nests.length;i++)this.nests[i].remove();L.Polygon.prototype.onRemove.call(this,t),this.fire("wps:remove")},initialize:function(t,i,s,e,a){if(L.Util.setOptions(this,a),this.domain=t,this.parent=i,this.id=s,this.nests=[],this.e_we=q.minGridSize,this.e_sn=q.minGridSize,e){if(this.parent_grid_ratio=e.geogrid.parent_grid_ratio[s-1],this.i_parent_start=e.geogrid.i_parent_start[s-1],this.j_parent_start=e.geogrid.j_parent_start[s-1],this.e_we=e.geogrid.e_we[s-1],this.e_sn=e.geogrid.e_sn[s-1],this.geog_data_res=e.geogrid.geog_data_res[s-1],this.geog_data_res||(this.geog_data_res="default"),(this.e_we-1)%this.parent_grid_ratio!=0)throw"invalid e_we value";if((this.e_sn-1)%this.parent_grid_ratio!=0)throw"invalid e_sn value";for(var n=s;n<e.geogrid.parent_id.length;n++)s===e.geogrid.parent_id[n]&&this.nests.push(new q(t,this,n+1,e,a))}L.Polygon.prototype.initialize.call(this,[])},update:function(){this.geogrid=this._initGeogrid(),this._corners=this._initCorners(),this.setLatLngs(this.geogrid.polygonPath),this._cornerMarkers.sw.setLatLng(this._corners.sw),this._cornerMarkers.se.setLatLng(this._corners.se),this._cornerMarkers.ne.setLatLng(this._corners.ne),this._cornerMarkers.nw.setLatLng(this._corners.nw),this._iGridLines&&this._removeGridLines(),this._isSelected&&this._drawGridLines();for(var t=0;t<this.nests.length;t++)this.nests[t].update();this.fire("wps:change")},addToNamelist:function(t){t.geogrid.parent_id.push(this.parent?this.parent.id:1),t.geogrid.parent_grid_ratio.push(this.parent_grid_ratio),t.geogrid.i_parent_start.push(this.i_parent_start),t.geogrid.j_parent_start.push(this.j_parent_start),t.geogrid.e_we.push(this.e_we),t.geogrid.e_sn.push(this.e_sn),t.geogrid.geog_data_res.push(this.geog_data_res);for(var i=0;i<this.nests.length;i++)this.nests[i].addToNamelist(t)},unselectAll:function(){if(this._isSelected)this.unselect();else for(var t=0;t<this.nests.length;t++)this.nests[t].unselectAll()},unselect:function(){this._cornerMarkers.sw.remove(),this._cornerMarkers.se.remove(),this._cornerMarkers.ne.remove(),this._cornerMarkers.nw.remove(),this._isSelected=!1,this._isSelected&&this.options.editable&&this.off("mousedown",this._dragStart,this),this.hideGridLines(),this.fire("wps:unselect")},select:function(){this._isSelected||(this.domain.grid.unselectAll(),this._isSelected=!0,this._cornerMarkers.sw.addTo(this._map),this._cornerMarkers.se.addTo(this._map),this._cornerMarkers.ne.addTo(this._map),this._cornerMarkers.nw.addTo(this._map),this.options.editable&&this.on("mousedown",this._dragStart,this),this.showGridLines(),this.fire("wps:select"),this.domain.setSelectedGrid(this))},updateId:function(t){this.id!=t&&(this.id=t,this.fire("wps:id-change"));for(var i=0;i<this.nests.length;i++)this.nests[i].updateId(this.id+1)},removeNest:function(t){t.remove();t=this.nests.indexOf(t);if(-1==t)throw"Cannot remove a nest which is not a nest of this grid";this.nests.splice(t,1),this.domain.grid.updateId(1),this.fire("wps:removenest")},createNest:function(){var t=new q(this.domain,this,this.domain.max_dom+1,null,this.options);try{t.parent_grid_ratio=q.defaultGridRatio,t.i_parent_start=1+q.minNestGridPoints,t.j_parent_start=1+q.minNestGridPoints,t.e_we=Math.floor((t.parent.e_we-q.minNestGridPoints-t.i_parent_start)*t.parent_grid_ratio+1),t.e_sn=Math.floor((t.parent.e_sn-q.minNestGridPoints-t.j_parent_start)*t.parent_grid_ratio+1)}catch(t){throw"Unable to add a nest grid ("+t+")"}return this.nests.push(t),this.fire("wps:addnest"),this._map&&t.addTo(this._map),t},findGrid:function(t){var i,s;if(this.id==t)return this;if(this.nests&&0<this.nests.length)for(s=0;s<this.nests.length;s++)if(i=this.nests[s].findGrid(t))return i;return i}}),qs=(Object.defineProperties(q.prototype,{projection:{get:function(){return this._projection}},name:{get:function(){return"d"+this.id.toString().padStart(2,"0")}},selected:{get:function(){return this._isSelected}},iPixels:{get:function(){return this.parent?this.parent.iPixels/this.parent_grid_ratio:Math.round(this.domain.dxPixelsMul*Math.pow(2,this._map.getZoom()))}},i_delta_end:{get:function(){return this.parent?this.parent.e_we-(this.e_we-1)/this.parent_grid_ratio-this.i_parent_start:0}},j_delta_end:{get:function(){return this.parent?this.parent.e_sn-(this.e_sn-1)/this.parent_grid_ratio-this.j_parent_start:0}},depth:{get:function(){for(var t=this.parent;t;)t=t.parent;return 0}},count:{get:function(){for(var t=1,i=0;i<this.nests.length;i++)t+=this.nests[i].count;return t}},corners:{get:function(){return this._corners}}}),q.prototype._getGridLinesBounds=function(){var t=this._map.getBounds(),i=t.getSouthWest(),t=t.getNorthEast(),s=this.geogrid.latlon_to_unstaggered_ij(i.lat,i.lng),e=this.geogrid.latlon_to_unstaggered_ij(t.lat,t.lng),a=this.geogrid.latlon_to_unstaggered_ij(i.lat,t.lng),t=this.geogrid.latlon_to_unstaggered_ij(t.lat,i.lng);return{iLinesStart:Math.max(0,Math.min(Math.floor(s[0]),Math.floor(t[0]),this.e_we-1)),jLinesStart:Math.max(0,Math.min(Math.floor(s[1]),Math.floor(a[1]),this.e_sn-1)),iLinesEnd:Math.min(this.e_we-1,Math.max(Math.ceil(e[0]),Math.ceil(a[0]),0)),jLinesEnd:Math.min(this.e_sn-1,Math.max(Math.ceil(e[1]),Math.ceil(t[1]),0))}},q.prototype._createGridLinePolyline=function(t){t=L.polyline(t,{pane:"gridLinesPane",color:"grey",weight:1,opacity:.5});return this._gridLinesLayer.addLayer(t),t},q.prototype._updateGridLines=function(){if(this._iGridLines)if(this.iPixels<q.minPixelsPerGrid)this._gridLinesLayer.remove();else{var t,i,s,e,a,n,r,h,o;if(this._map.hasLayer(this._gridLinesLayer)||this._gridLinesLayer.addTo(this._map),((s=this._getGridLinesBounds()).iLinesEnd<this._gridLinesBounds.iLinesStart||s.iLinesStart>this._gridLinesBounds.iLinesEnd||s.jLinesEnd<this._gridLinesBounds.jLinesStart||s.jLinesStart>this._gridLinesBounds.jLinesEnd)&&(this._removeGridLines(),this._drawGridLines(s)),s.iLinesStart<this._gridLinesBounds.iLinesStart){for(n=[],o=new Array(this._gridLinesBounds.jLinesEnd-this._gridLinesBounds.jLinesStart+1),t=s.iLinesStart;t<this._gridLinesBounds.iLinesStart;t++){for(e=[],i=this._gridLinesBounds.jLinesStart;i<=this._gridLinesBounds.jLinesEnd;i++)a=this.geogrid.unstaggered_ij_to_latlon(t,i),e.push(a),t==s.iLinesStart&&(o[i-this._gridLinesBounds.jLinesStart]=new Array),o[i-this._gridLinesBounds.jLinesStart].push(a),t==this._gridLinesBounds.iLinesStart-1&&this._jGridLines[i-this._gridLinesBounds.jLinesStart].setLatLngs(o[i-this._gridLinesBounds.jLinesStart].concat(this._jGridLines[i-this._gridLinesBounds.jLinesStart].getLatLngs()));n.push(this._createGridLinePolyline(e))}this._iGridLines=n.concat(this._iGridLines),this._gridLinesBounds.iLinesStart=s.iLinesStart}if(s.jLinesStart<this._gridLinesBounds.jLinesStart){for(r=[],h=new Array(this._gridLinesBounds.iLinesEnd-this._gridLinesBounds.iLinesStart+1),i=s.jLinesStart;i<this._gridLinesBounds.jLinesStart;i++){for(e=[],t=this._gridLinesBounds.iLinesStart;t<=this._gridLinesBounds.iLinesEnd;t++)a=this.geogrid.unstaggered_ij_to_latlon(t,i),e.push(a),i==s.jLinesStart&&(h[t-this._gridLinesBounds.iLinesStart]=new Array),h[t-this._gridLinesBounds.iLinesStart].push(a),i==this._gridLinesBounds.jLinesStart-1&&this._iGridLines[t-this._gridLinesBounds.iLinesStart].setLatLngs(h[t-this._gridLinesBounds.iLinesStart].concat(this._iGridLines[t-this._gridLinesBounds.iLinesStart].getLatLngs()));r.push(this._createGridLinePolyline(e))}this._jGridLines=r.concat(this._jGridLines),this._gridLinesBounds.jLinesStart=s.jLinesStart}if(s.iLinesEnd>this._gridLinesBounds.iLinesEnd){for(t=this._gridLinesBounds.iLinesEnd+1;t<=s.iLinesEnd;t++){for(e=[],i=this._gridLinesBounds.jLinesStart;i<=this._gridLinesBounds.jLinesEnd;i++)a=this.geogrid.unstaggered_ij_to_latlon(t,i),e.push(a),this._jGridLines[i-this._gridLinesBounds.jLinesStart].addLatLng(a);this._iGridLines.push(this._createGridLinePolyline(e))}this._gridLinesBounds.iLinesEnd=s.iLinesEnd}if(s.jLinesEnd>this._gridLinesBounds.jLinesEnd){for(i=this._gridLinesBounds.jLinesEnd+1;i<=s.jLinesEnd;i++){for(e=[],t=this._gridLinesBounds.iLinesStart;t<=this._gridLinesBounds.iLinesEnd;t++)a=this.geogrid.unstaggered_ij_to_latlon(t,i),e.push(a),this._iGridLines[t-this._gridLinesBounds.iLinesStart].addLatLng(a);this._jGridLines.push(this._createGridLinePolyline(e))}this._gridLinesBounds.jLinesEnd=s.jLinesEnd}}else this._drawGridLines()},q.prototype._drawGridLines=function(t){if(this.iPixels>=q.minPixelsPerGrid&&this._enableGridLines){var i,s,e,a,n;for(this._gridLinesBounds=t||this._getGridLinesBounds(),this._iGridLines=[],this._jGridLines=[],n=new Array(this._gridLinesBounds.jLinesEnd-this._gridLinesBounds.jLinesStart+1),i=this._gridLinesBounds.iLinesStart;i<=this._gridLinesBounds.iLinesEnd;i++){for(e=[],s=this._gridLinesBounds.jLinesStart;s<=this._gridLinesBounds.jLinesEnd;s++)a=this.geogrid.unstaggered_ij_to_latlon(i,s),e.push(a),i==this._gridLinesBounds.iLinesStart&&(n[s-this._gridLinesBounds.jLinesStart]=new Array(this._gridLinesBounds.iLinesEnd-this._gridLinesBounds.iLinesStart+1)),n[s-this._gridLinesBounds.jLinesStart][i-this._gridLinesBounds.iLinesStart]=a,i==this._gridLinesBounds.iLinesEnd&&this._jGridLines.push(this._createGridLinePolyline(n[s-this._gridLinesBounds.jLinesStart]));this._iGridLines.push(this._createGridLinePolyline(e))}this._map.hasLayer(this._gridLinesLayer)||this._gridLinesLayer.addTo(this._map)}},q.prototype._removeGridLines=function(){this._gridLinesLayer.clearLayers(),this._iGridLines=null,this._jGridLines=null,this._gridLinesLayer.remove()},q.prototype.hideGridLines=function(){this._gridLinesLayer.remove(),this._enableGridLines=!1},q.prototype.showGridLines=function(){this._enableGridLines=!0,this._updateGridLines()},function(){function s(t,i){return F(this,s),void 0===s.dialog&&(s.dialog=new s.Dialog),this.show=function(){return s.dialog.show(t,i),this},this}return t(s,null,[{key:"Dialog",value:function(){var e,_,s,t,i,u,a,c,n,p=this,r="demo/json/geog.json";function h(){var t,i,s,e,a,n,r,h,o,l,d={};for(p.geog_data_res.match(/(\w+)/g).forEach(function(t){d[t]=t}),u.body.empty(),t=0;t<_.categories.length;t++){for(s=$("<tr/>"),e=_.categories[t],s.append("<td>"+e.name+"</td>"),a=$('<select class=""></select>'),s.append($("<td />").append(a)),s.append("<td>"+e.default+"</td>"),n=$("<td/>"),s.append(n),u.body.append(s),o=[],r=!(h={}),i=0;i<e.options.length;i++)"default"!==e.options[i].id&&o.push(e.options[i].id),l=null!=d[e.options[i].id],h[e.options[i].id]=$(new Option(e.options[i].id,e.options[i].id,l,l)).data("dirname",e.options[i].dirname),l&&(n.text(e.options[i].dirname),r=!0);r||n.text(h.default.data("dirname")),a.append(h.default),0<o.length?o.sort().forEach(function(t){a.append(h[t])}):a.prop("disabled",!0),a.on("change",{cellFilename:n,selectCategoryOption:a},function(t){var s,e=t.data.selectCategoryOption.val(),a=[],n={};t.data.cellFilename.text($("option:selected",t.data.selectCategoryOption).data("dirname")),$('select option[value="'+e+'"]',u.body).parents().has('option[value="default"]:selected').each(function(t,i){(s=$(i)).val(e),$("td:last-child",s.closest("tr")).text($("option:selected",s).data("dirname"))}),$("select",u.body).each(function(t,i){s=$(i),"default"!=(e=s.val())&&void 0===n[e]&&(n[e]=e,a.push(e))}),0==a.length?c.val("default"):c.val(a.join("+"))})}}s=$("div.modal#geog-data-res-dialog"),n=$("div.modal-header",s),t=$("div.modal-body",s),i=$("div.modal-footer",s),(u=$("table",t)).header=$("thead",u),u.body=$("tbody",u),a=$("select",n),c=$("input",t),n=$("button#button-geog-save",i),$("button#button-geog-reset",i).on("click",function(){c.val("default"),$("select",u.body).each(function(){var t=$(this);t.val("default"),$("td:last-child",t.closest("tr")).text(t.find(":selected").data("dirname"))})}),n.on("click",function(t){t.geog_data_res=c.val(),"function"==typeof p.saveHandler&&p.saveHandler.call(this,t)}),this.show=function(t,i){this.saveHandler=i,this.geog_data_res=t=t||"default",c.val(t),void 0===e?$.getJSON(r,function(t){var i,s;for(e=t,i=0;i<e.geog.length;i++)for(s=0;s<e.geog[i].categories.length;s++)if("HGT_M"==e.geog[i].categories[s].name){e.geog[i].categories[s].options.push({id:"srtm_30m",dirname:"srtm_30m"}),e.geog[i].categories[s].options.push({id:"srtm_90m",dirname:"srtm_90m"});break}for(a.empty(),i=0;i<e.geog.length;i++)a.append('<option value="'+e.geog[i].version+'">'+e.geog[i].version+"</option>");a.on("change",function(t){for(i=0;i<e.geog.length;i++)if(a.val()==e.geog[i].version){_=e.geog[i],h();break}}),_=e.geog[0],a.val(_.version),h()}):h(),s.modal()}}}]),s}());var $s=t(function s(e,_,a){F(this,s);var u,t,i,n,r,c,p,g,f,m,h,o,l,d,M,y,x=this;function v(){(o=$('<i class="fas fa-vector-square mx-1"></i>')).insertBefore(r)}_.domain,null==s.Template&&(s.Template=$("#grid_template",e).html(),$("#grid_template",e).remove()),u=$('<div class="container-grid"></div>').append(s.Template),t=$('button[data-action="remove-nest"]',u),i=$('button[data-action="add-nest"]',u),n=$('button[data-action="geog-data-res-edit"]',u),r=$("label.grid-label",u),c=$('input[name="parent_grid_ratio"]',u),p=$('input[name="i_parent_start"]',u),g=$('input[name="j_parent_start"]',u),f=$('input[name="e_we"]',u),m=$('input[name="e_sn"]',u),h=$('span[data-name="geog_data_res"]',u),y=$("table tbody tr:nth-child(1) td:nth-child(2)",u),M=$("table tbody tr:nth-child(1) td:nth-child(3)",u),l=$("table tbody tr:nth-child(2) td:nth-child(2)",u),d=$("table tbody tr:nth-child(2) td:nth-child(3)",u),e.append(u),$("[title]",u).tooltip(),$("input[name]",u).on("change blur keyup",function(t){x.validate()}),n.on("click",function(t){var i;i=_.geog_data_res,new qs(i,function(t){_.geog_data_res=t.geog_data_res,h.text(t.geog_data_res),h.attr("title",t.geog_data_res)}).show()}),_.on("wps:remove",function(t){u.remove()}),_.on("wps:change",L),_.on("wps:id-change",b),_.on("wps:select",function(){o||v()}),_.on("wps:unselect",function(){o&&(o.remove(),o=null)}),$("button[title]",u).on("click",function(t){$(this).tooltip("hide")}),t.on("click",function(t){_.parent.removeNest(_)}),i.on("click",function(t){var i=null;if("localhost"===location.hostname)(i=_.createNest()).gridPanel=new s(e,i,a);else try{(i=_.createNest()).gridPanel=new s(e,i,a)}catch(t){!function(t){"function"==typeof a&&a.call(this,{error:t})}(t)}}),_.parent?(p.prop("min",q.minNestGridPoints),g.prop("min",q.minNestGridPoints)):(t.remove(),c.prop("disabled",!0),c.removeAttr("required"),p.prop("disabled",!0),p.removeAttr("required"),g.prop("disabled",!0),g.removeAttr("required"));for(var w=0;w<_.nests.length;w++)_.nests[w].gridPanel=new s(e,_.nests[w],a);function b(){_.parent?r.text(_.name+" (parent: d"+_.parent.id.toString().padStart(2,"0")+")"):r.text(_.name)}function L(){c.val(_.parent_grid_ratio),p.val(_.i_parent_start),g.val(_.j_parent_start),f.val(_.e_we),m.val(_.e_sn),h.text(_.geog_data_res),h.attr("title",_.geog_data_res),h.tooltip(),l.text(_.corners.sw.lat.toFixed(3)+", "+_.corners.sw.lng.toFixed(3)),d.text(_.corners.se.lat.toFixed(3)+", "+_.corners.se.lng.toFixed(3)),M.text(_.corners.ne.lat.toFixed(3)+", "+_.corners.ne.lng.toFixed(3)),y.text(_.corners.nw.lat.toFixed(3)+", "+_.corners.nw.lng.toFixed(3)),x.validate()}function j(t,i){$('div[data-val-for="'+t.prop("name")+'"]',u).show().append("<p>"+i+"</p>"),t.addClass(".is-invalid")}function S(t){return!!t[0].checkValidity()||(j(t,t[0].validationMessage.replace(/[v,V]alue|(this field)/,t.prop("name"))),!1)}this.validate=function(){var t,i,s,e,a,n,r,h,o,l=!0;null!=_.parent&&($(".invalid-feedback",u).hide().empty(),$(".is-invalid, .is-valid",u).removeClass(".is-invalid").removeClass(".is-valid"),1<_.id&&(a=parseInt(c.val(),10),h=parseInt(p.val(),10),o=parseInt(g.val(),10),n=_.parent.e_we,r=_.parent.e_sn,h=Math.floor((n-q.minNestGridPoints-h)*a+1),o=Math.floor((r-q.minNestGridPoints-o)*a+1),f.prop("max",h),m.prop("max",o),f.prop("step",a),m.prop("step",a),p.prop("min",q.minNestGridPoints+1),g.prop("min",q.minNestGridPoints+1),p.prop("max",n-2*q.minNestGridPoints),g.prop("max",r-2*q.minNestGridPoints)),l=S(c),l=S(p)&&l,l=S(g)&&l,l=S(f)&&l,l=S(m)&&l)&&(h=parseInt(c.val(),10),o=parseInt(p.val(),10),a=parseInt(g.val(),10),n=parseInt(f.val(),10),r=parseInt(m.val(),10),t=_.parent.e_we,i=_.parent.e_sn,o<q.minNestGridPoints&&(j(p,"Min i_parent_start = "+q.minNestGridPoints+". "),l=!1),a<q.minNestGridPoints&&(j(g,"Min j_parent_start = "+q.minNestGridPoints+". "),l=!1),o>t-q.minNestGridPoints&&(j(p,"Max i_parent_start = "+(t-q.minNestGridPoints)+". "),l=!1),a>i-q.minNestGridPoints&&(j(g,"Max j_parent_start = "+(i-q.minNestGridPoints)+". "),l=!1),(n-1)%h!=0&&(j(f,"e_we must be one greater than an integer multiple of the nest's parent_grid_ratio (e_we = n*parent_grid_ratio + 1)."),l=!1),(r-1)%h!=0&&(j(m,"e_sn must be one greater than an integer multiple of the nest's parent_grid_ratio (e_sn = n*parent_grid_ratio + 1)."),l=!1),s=Math.floor((t-q.minNestGridPoints-o)*h+1),e=Math.floor((i-q.minNestGridPoints-a)*h+1),(s<n||e<r)&&(j(m,"Nest edge outside of parent. "),l=!1),s<n&&(s=Math.floor((t-o-q.minNestGridPoints)*h+1),j(f,"Max e_we = "+s+". "),l=!1),e<r)&&(e=Math.floor((i-a-q.minNestGridPoints)*h+1),j(m,"Max e_sn = "+e+". "),l=!1);for(var d=0;d<_.nests.length;d++)l=l&&_.nests[d].gridPanel.validate();return l},this.setGridValues=function(){_.parent_grid_ratio=parseInt(c.val(),10),_.i_parent_start=parseInt(p.val(),10),_.j_parent_start=parseInt(g.val(),10),_.e_we=parseInt(f.val(),10),_.e_sn=parseInt(m.val(),10),_.geog_data_res=h.val();for(var t=0;t<_.nests.length;t++)_.nests[t].gridPanel.setGridValues()},b(),L(),_.selected&&v()}),Us=($s.Template=null,L.Layer.extend({options:{editable:!0,showTooltip:!0},_map:null,_mainGrid:null,_selectedGrid:null,setSelectedGrid:function(t){this._selectedGrid=t},map_proj:null,truelat1:null,truelat2:null,stand_lon:null,ref_lat:null,ref_lon:null,pole_lat:null,pole_lon:null,dx:null,dy:null,_centerMarker:null,_gridsByDepth:null,_orderGrids:function(t){var i,s;for(this._gridsByDepth&&!t||(this._gridsByDepth=[],this._walkGrids(this._mainGrid,function(t){this._gridsByDepth[t.depth]?this._gridsByDepth[t.depth].push(t):this._gridsByDepth[t.depth]=[t]},this)),i=0;i<this._gridsByDepth.length;i++)for(s=0;s<this._gridsByDepth[i].length;s++)this._gridsByDepth[i][s].bringToFront()},_walkGrids:function(t,i,s){if(i.call(s,t),t.nests&&0<t.nests.length)for(var e=0;e<t.nests.length;e++)this._walkGrids(t.nests[e],i,s)},getGrid:function(t){return this._mainGrid.findGrid(t)},_dragContext:null,_onCenterMarkerDrag:function(t){this.ref_lat=t.latlng.lat,this.ref_lon=t.latlng.lng,this.stand_lon=this.ref_lon+this._dragContext.stand_lon_delta,this.truelat1=this.ref_lat+this._dragContext.truelat1_delta,this.truelat2=this.ref_lat+this._dragContext.truelat2_delta,this.update()},_onMapClick:function(t){this._map.getContainer()==t.originalEvent.target&&this._selectedGrid&&(this._selectedGrid.unselect(),this._selectedGrid=null)},onAdd:function(t){this._map=t,this._map.on("click",this._onMapClick,this),this._centerMarker=L.marker([this.ref_lat,this.ref_lon],{draggable:this.options.editable,title:"Domain Center"}).addTo(t),this._mainGrid.addTo(t),this._orderGrids(),this.options.editable&&(this._centerMarker.on("dragstart",function(t){this._dragContext={stand_lon_delta:this.stand_lon-this.ref_lon,truelat1_delta:this.truelat1-this.ref_lat,truelat2_delta:this.truelat2-this.ref_lat},this._mainGrid.unbindTooltip(),this._selectedGrid&&this._selectedGrid.hideGridLines()},this),this._centerMarker.on("drag",this._onCenterMarkerDrag,this),this._centerMarker.on("dragend",function(t){t.latlng=this._centerMarker.getLatLng(),this._onCenterMarkerDrag(t),this._mainGrid.bindTooltip(),this._selectedGrid&&this._selectedGrid.showGridLines()},this))},onRemove:function(t){this._centerMarker&&(this._centerMarker.off(),this._centerMarker.remove()),this._map.off("click",this._onMapClick,this),this._mainGrid.remove()},update:function(){this._centerMarker.setLatLng(L.latLng(this.ref_lat,this.ref_lon)),this._mainGrid.update(),this.fire("wps:change")},initialize:function(t,i){L.Util.setOptions(this,i),void 0!==t&&(this.map_proj=t.geogrid.map_proj,this.truelat1=t.geogrid.truelat1,this.truelat2=t.geogrid.truelat2,this.stand_lon=t.geogrid.stand_lon,this.ref_lat=t.geogrid.ref_lat,this.ref_lon=t.geogrid.ref_lon,this.dx=t.geogrid.dx,this.dy=t.geogrid.dy,this._mainGrid=new q(this,null,1,t,this.options))},getWPSNamelist:function(){var t=new V;return t.share.max_dom=this.max_dom,t.geogrid.map_proj=this.map_proj,t.geogrid.truelat1=this.truelat1,t.geogrid.truelat2=this.truelat2,t.geogrid.stand_lon=this.stand_lon,t.geogrid.ref_lat=this.ref_lat,t.geogrid.ref_lon=this.ref_lon,t.geogrid.dx=this.dx,t.geogrid.dy=this.dy,t.geogrid.parent_id=[],t.geogrid.parent_grid_ratio=[],t.geogrid.i_parent_start=[],t.geogrid.j_parent_start=[],t.geogrid.e_we=[],t.geogrid.e_sn=[],t.geogrid.geog_data_res=[],this.grid.addToNamelist(t),t},createMainGrid:function(){this._mainGrid&&this._mainGrid.remove(),this._mainGrid=new q(this,null,1),this._mainGrid.parent_grid_ratio=1,this._mainGrid.i_parent_start=1,this._mainGrid.j_parent_start=1,this._mainGrid.e_we=q.minGridSize,this._mainGrid.e_sn=q.minGridSize}})),Ws=(Object.defineProperties(Us.prototype,{grid:{get:function(){return this._mainGrid}},max_dom:{get:function(){return this._mainGrid.count}},dxPixelsMul:{get:function(){return this.dxInMeters/156543.03392/Math.cos(this.ref_lat*Math.PI/180)}},dxInMeters:{get:function(){return this.map_proj===K?tt(this.dx):this.dx}},dyInMeters:{get:function(){return this.map_proj===K?tt(this.dy):this.dy}}}),Us.prototype.addMainGrid=function(){var t,i,s,e,a;t=new q(this,null,1),this._mainGrid.parent_grid_ratio=3,this._mainGrid.i_parent_start=q.minNestGridPoints+1,this._mainGrid.j_parent_start=q.minNestGridPoints+1,0!=(i=(this._mainGrid.e_we-1)%this._mainGrid.parent_grid_ratio)&&(this._mainGrid.e_we+=this._mainGrid.parent_grid_ratio-i),0!=(s=(this._mainGrid.e_sn-1)%this._mainGrid.parent_grid_ratio)&&(this._mainGrid.e_sn+=this._mainGrid.parent_grid_ratio-s),0==i&&0==s||(i=this.stand_lon-this.ref_lon,s=this.truelat1-this.ref_lat,e=this.truelat2-this.ref_lat,a=this._mainGrid.projection.unstaggered_ij_to_latlon((this._mainGrid.e_we-1)/2,(this._mainGrid.e_sn-1)/2),this.ref_lat=a[0],this.ref_lon=a[1],this.stand_lon=this.ref_lon+i,this.truelat1=this.ref_lat+s,this.truelat2=this.ref_lat+e),this.dx=this.dx*this._mainGrid.parent_grid_ratio,this.dy=this.dy*this._mainGrid.parent_grid_ratio,t.parent_grid_ratio=1,t.i_parent_start=1,t.j_parent_start=1,t.e_we=2*q.minNestGridPoints+(this._mainGrid.e_we-1)/this._mainGrid.parent_grid_ratio+1,t.e_sn=2*q.minNestGridPoints+(this._mainGrid.e_sn-1)/this._mainGrid.parent_grid_ratio+1,(this._mainGrid.parent=t).nests.push(this._mainGrid),function t(i){i.id++;for(var s=0;s<i.nests.length;s++)t(i.nests[s])}((this._mainGrid=t).nests[0]),t.addTo(this._map),this._orderGrids(!0),this.update()},Us.prototype.removeMainGrid=function(){if(1<this._mainGrid.nests.length)throw"Cannot remove top most grid with multiple nests";var t,i,s,e;0!=this._mainGrid.nests.length&&(t=this._mainGrid.domain.stand_lon-this._mainGrid.domain.ref_lon,i=this._mainGrid.domain.truelat1-this._mainGrid.domain.ref_lat,s=this._mainGrid.domain.truelat2-this._mainGrid.domain.ref_lat,e=this._mainGrid.nests[0].projection.unstaggered_ij_to_latlon((this._mainGrid.nests[0].e_we-1)/2,(this._mainGrid.nests[0].e_sn-1)/2),this.ref_lat=e[0],this.ref_lon=e[1],this.stand_lon=this.ref_lon+t,this.truelat1=this.ref_lat+i,this.truelat2=this.ref_lat+s,this.dx=this.dx/this._mainGrid.nests[0].parent_grid_ratio,this.dy=this.dy/this._mainGrid.nests[0].parent_grid_ratio,this._mainGrid.remove(!0),this._mainGrid.nests[0].parent=null,this._mainGrid.nests[0].parent_grid_ratio=1,this._mainGrid.nests[0].i_parent_start=1,this._mainGrid.nests[0].j_parent_start=1,this._mainGrid=this._mainGrid.nests[0],this._mainGrid.updateId(1),this._mainGrid.addTo(this._map))},t(function O(i,t){F(this,O);var e,a,s,n,r,h,o,l,d,_,u,c,p,g,f,m,M,y,x,v,w,b,L=this,j=!1,S="wrf_domain_wizard_wps_panel";function C(){s.height(r.parent().offset().top-s.offset().top-10)}function G(){e.map_proj=p.val(),e.ref_lat=parseFloat(g.val()),e.ref_lon=parseFloat(f.val()),e.truelat1=parseFloat(m.val()),e.truelat2=parseFloat(M.val()),e.stand_lon=parseFloat(y.val()),e.dx=parseInt(x.val(),10),e.dy=parseInt(v.val(),10),e.pole_lat=parseFloat(w.val()),e.pole_lon=parseFloat(b.val()),e.grid.gridPanel.setGridValues(),e.update()}function A(){switch(w.parent().hide(),p.val()){case"lambert":M.val(e.truelat2.toFixed(3)),M.prop("disabled",!1),y.val(e.stand_lon.toFixed(3)),y.prop("disabled",!1),o.prop("disabled",!1),h.prop("disabled",!1),x.attr("min",L.options.minGridDistanceMeters),v.attr("min",L.options.minGridDistanceMeters);break;case"mercator":M.val("0"),M.prop("disabled",!0),y.val("0"),y.prop("disabled",!0),o.prop("disabled",!0),h.prop("disabled",!0),x.attr("min",L.options.minGridDistanceMeters),v.attr("min",L.options.minGridDistanceMeters);break;case"polar":M.val(e.truelat1<0?"-90":"90"),M.prop("disabled",!0),x.attr("min",L.options.minGridDistanceMeters),v.attr("min",L.options.minGridDistanceMeters);break;case"lat-lon":M.val(e.ref_lat.toFixed(3)),M.prop("disabled",!1),w.parent().show(),x.attr("min",L.options.minGridDistanceDegrees),v.attr("min",L.options.minGridDistanceDegrees)}}function N(){var t=p.find("option:selected").data("title");p.attr("title",t),p.tooltip("dispose"),p.tooltip()}function z(t){var i=parseFloat(y.val()),s=0<e.ref_lat?5:-5;-180<i-(s=t?s:-s)&&(e.stand_lon=i-s),e.update()}this.options={minGridDistanceMeters:100,minGridDistanceDegrees:0},t&&(this.options=Object.assign(this.options,t)),a=$("form",i),s=$("#grids",a),n=$("div#grids-header",a),r=$("#update-domain",i),t=$('button[data-action="add-moad"]',a),c=$('button[data-action="remove-moad"]',a),p=$('select[name="map_proj"]',a),g=$('input[name="ref_lat"]',a),f=$('input[name="ref_lon"]',a),m=$('input[name="truelat1"]',a),M=$('input[name="truelat2"]',a),y=$('input[name="stand_lon"]',a),x=$('input[name="dx"]',a),v=$('input[name="dy"]',a),w=$('input[name="pole_lat"]',a),b=$('input[name="pole_lon"]',a),h=$("#stan-lon-minus",a),o=$("#stan-lon-plus",a),l=$("#div-2",a),d=$("#div-3",a),_=$("#mul-2",a),u=$("#mul-3",a),r.off(),p.off(),h.off(),o.off(),l.off(),d.off(),_.off(),u.off(),$("[title]",a).tooltip(),$("button[title]",a).on("click",function(t){$(this).tooltip("hide")}),$(window).on("resize",C),t.on("click",function(t){e.addMainGrid(),s.empty(),T()}),c.on("click",function(t){e.removeMainGrid(),s.empty(),T(),e.update()}),r.on("click",function(t){var i,s;a.removeClass("was-validated"),i=a[0].checkValidity(),s=e.grid.gridPanel.validate(),i&&s?G():a.addClass("was-validated")}),p.on("change",function(t){null!=e&&(A(),G()),N()}),N(),h.on("click",function(t){z(!0)}),o.on("click",function(t){z(!1)});var E=Object.freeze({MUL:0,DIV:1});function k(t,i,s){return i==E.DIV?t/s:i==E.MUL?t*s:void 0}function P(t,o){var l,i,s;t==E.DIV&&(x.val()<100||v.val()<100)||(null==e?(x.val(Math.round(k(parseInt(x.val(),10),t,o))),v.val(Math.round(k(parseInt(v.val(),10),t,o)))):(l=t==E.DIV?E.MUL:E.DIV,(i=new Us).createMainGrid(),function t(i,s){var e=!0;if(1==i.id){if(s.i_parent_start=1,s.j_parent_start=1,s.parent_grid_ratio=1,s.e_we=Math.floor(k(i.e_we,l,o)),s.e_sn=Math.floor(k(i.e_sn,l,o)),s.e_we<q.minGridSize||s.e_sn<q.minGridSize)return!1}else{s.parent_grid_ratio=i.parent_grid_ratio,s.i_parent_start=Math.max(Math.floor(k(i.i_parent_start,l,o)),q.minNestGridPoints),s.j_parent_start=Math.max(Math.floor(k(i.j_parent_start,l,o)),q.minNestGridPoints);var a=Math.max(Math.floor(k(i.i_delta_end,l,o)),q.minNestGridPoints),n=Math.max(Math.floor(k(i.j_delta_end,l,o)),q.minNestGridPoints);if(s.e_we=Math.floor((s.parent.e_we-a-s.i_parent_start)*i.parent_grid_ratio+1),s.e_sn=Math.floor((s.parent.e_sn-n-s.j_parent_start)*i.parent_grid_ratio+1),s.e_we<q.minGridSize||s.e_sn<q.minGridSize)return!1}for(var r=0;r<i.nests.length;r++){var h=new q(s.domain,s,i.nests[r].id);s.nests.push(h),e=e&&t(i.nests[r],h)}return e}(e.grid,i.grid)&&(s=function t(i,s){i.i_parent_start=s.i_parent_start,i.j_parent_start=s.j_parent_start,i.e_we=s.e_we,i.e_sn=s.e_sn;for(var e=0;e<i.nests.length;e++)t(i.nests[e],s.nests[e])},e.dx=Math.round(k(parseInt(x.val(),10),t,o)),e.dy=Math.round(k(parseInt(v.val(),10),t,o)),x.val(e.dx.toString()),v.val(e.dy.toString()),s(e.grid,i.grid),e.update())))}function B(t,i){i?t.val(i.toFixed(3)):t.val(null)}function R(){p.val(e.map_proj),g.val(e.ref_lat.toFixed(3)),f.val(e.ref_lon.toFixed(3)),m.val(e.truelat1.toFixed(3)),M.val(e.truelat2.toFixed(3)),y.val(e.stand_lon.toFixed(3)),x.val(Math.trunc(e.dx).toString()),v.val(Math.trunc(e.dy).toString()),B(w,e.pole_lat),B(b,e.pole_lon)}function I(){c.prop("disabled",1!=e.grid.nests.length)}function T(){e.grid.gridPanel=new $s(s,e.grid,function(t){D("Error",t.error)}),e.grid.on("wps:addnest",I),e.grid.on("wps:removenest",I),I()}l.on("click",function(){P(E.DIV,2)}),d.on("click",function(){P(E.DIV,3)}),_.on("click",function(){P(E.MUL,2)}),u.on("click",function(){P(E.MUL,3)}),this.showNewDomain=function(){e=null,j=!1,r.parent().hide(),g.parent().hide(),y.parent().hide(),m.parent().hide(),M.parent().hide(),w.parent().hide(),n.hide(),p.val(localStorage.getItem(S+"map_proj")||"lambert"),x.val(localStorage.getItem(S+"dx")||12e3),v.val(localStorage.getItem(S+"dy")||12e3),i.show(),C()},this.validateNewDomain=function(){return p[0].checkValidity()&&x[0].checkValidity()&&v[0].checkValidity()},this.createNewDomain=function(){return(e=new Us).map_proj=p.val(),e.dx=parseInt(x.val(),10),e.dy=parseInt(v.val(),10),localStorage.setItem(S+"map_proj",e.map_proj),localStorage.setItem(S+"dx",e.dx),localStorage.setItem(S+"dy",e.dy),e.createMainGrid(),e},this.show=function(t){t&&t!=e&&(e=t,j=!1),j||(T(),e.on("wps:change",R),e.on("remove",function(){L.hide()}),e.on("add",function(){T()}),R(),A(),j=!0),r.parent().show(),g.parent().show(),y.parent().show(),m.parent().show(),M.parent().show(),n.show(),i.show(),C()},this.hide=function(){i.hide()}})),Js=function(){function i(t){return F(this,i),void 0===i.dialog&&(i.dialog=new i.Dialog),this.show=function(){i.dialog.show(t)},this}return t(i,null,[{key:"Dialog",value:function(){var i=$("div.modal#wps-save-dialog"),t=$("div.modal-body",i),s=$("div.modal-footer",i),e=$("textarea",t),t=$("button#button-copy",s),s=$("button#button-download",s);t.on("click",function(t){e.select(),document.execCommand("Copy")}),s.on("click",function(t){var i=new Blob([e.val()],{type:"text/plain;charset=utf-8"});saveAs(i,"namelist.wps",!0)}),this.show=function(t){e.text(t.getWPSNamelist().toString()),i.modal()}}}]),i}();var Qs={mass:{sw:0,nw:1,ne:2,se:3},u:{sw:4,nw:5,ne:6,se:7},v:{sw:8,nw:9,ne:10,se:11},unstaggered:{sw:12,nw:13,ne:14,se:15}},Vs=function(){function v(s,i,t){var e,a,n,r,h,o,l,d,_,u,c,p=this,g=(F(this,v),this.map=s,this);function f(t){m(),(n=new Us(a)).addTo(s),r.show(n),n.grid.select(),t&&(s.panTo(L.latLng(n.ref_lat,n.ref_lon)),s.fitBounds(n.grid.getBounds(),{paddingTopLeft:L.point(e.width()+e.offset().left,0)}))}function m(){n&&(n.remove(),n=null,0<g._geogridCornerMarkerGroups.length)&&g._geogridCornerMarkerGroups.forEach(function(t){t.remove()})}function M(t){r.validateNewDomain()&&(s.dragging.disable(),s.on("mousemove",y,this),s.on("mouseup",x,this),s.on("mouseout",x,this),h={startLatlng:t.latlng,startMarker:L.marker(t.latlng,{icon:L.divIcon({className:"grid-corner-icon"})}).addTo(s),endMarker:L.marker(t.latlng,{icon:L.divIcon({className:"grid-corner-icon"})}).addTo(s),drawPolygon:null,domainOnMap:!1},n=r.createNewDomain())}function y(t){var i=L.latLngBounds(h.startLatlng,t.latlng);null==h.drawPolygon?h.drawPolygon=L.polygon([i.getSouthWest(),i.getSouthEast(),i.getNorthEast(),i.getNorthWest()],{stroke:!0,color:"#3388ff",weight:1,opacity:1,dashArray:"3",fill:!1}).addTo(s):h.drawPolygon.setLatLngs([i.getSouthWest(),i.getSouthEast(),i.getNorthEast(),i.getNorthWest()]),h.endMarker.setLatLng(t.latlng),i=i.getCenter(),n.ref_lat=i.lat,n.ref_lon=i.lng,n.truelat1=n.ref_lat,n.truelat2=n.ref_lat,n.stand_lon=n.ref_lon,i=Math.round(s.distance(h.startLatlng,[h.startLatlng.lat,t.latlng.lng])/n.dx),t=Math.round(s.distance(h.startLatlng,[t.latlng.lat,h.startLatlng.lng])/n.dy),i<q.minGridSize||t<q.minGridSize?(n.remove(),r.hide(),h.domainOnMap=!1):(n.grid.e_we=i,n.grid.e_sn=t,h.domainOnMap?n.update():(n.addTo(s),h.domainOnMap=!0,r.show()))}function x(t){s.dragging.enable(),s.off("mousedown",M,this),s.off("mousemove",y,this),s.off("mouseup",x,this),s.off("mouseout",x,this),o.prop("disabled",!1),h?(null!=h.drawPolygon&&h.drawPolygon.remove(),h.startMarker.remove(),h.endMarker.remove(),h.domainOnMap?a=n.getWPSNamelist():n=a=null):r.hide()}this.options={sampleBaseUrl:"samples",anyFilename:!0},t&&(this.options=Object.assign(this.options,t)),e=$("#wps",i.getContainer()),r=new Ws($("#container-wps-form",e)),o=$("button#button-wps-new",e),t=$("button#button-wps-save",e),d=$("button#reset-domain",e),l=$("button#button-wps-open",e),_=$("input#file-open",e),d.on("click",function(t){f(!1)}),l.on("click",function(t){x(),_.click()}),t.on("click",function(t){new Js(n).show()}),_.on("change",function(t){var i,s;t.target.files&&0!=t.target.files.length&&(!0!==p.options.anyFilename&&"namelist.wps"!=t.target.files[0].name&&"wrfsi.nl"!=t.target.files[0].name?D("File Open Error",'Only files with the name "namelist.wps" or "wrfsi.nl" can be opened!'):(i=new FileReader,s=t.target.files[0].name,i.onerror=function(t){D("File Open Error","Unable to read file!")},i.onload=function(t){a="wrfsi.nl"==s?V.converFromWRFSIString(t.target.result):new V(t.target.result),f(!0)},i.readAsText(t.target.files[0]),_.val(null)))}),o.on("click",function(t){!function(){m(),o.prop("disabled",!0),s.on("mousedown",M,this),r.showNewDomain()}()}),this._geogridCornerMarkerGroups=[],location.hash&&(u=location.hash.substring(1),c="".concat(this.options.sampleBaseUrl,"/").concat(u,"/namelist.wps"),$.get(c,function(t){a=new V(t),i.open("wps"),f(!0),p._addGeogridCorners(u)},"text").fail(function(){D("File Load Error","Unable to load "+c)}))}return t(v,[{key:"_addGeogridCorners",value:function(t){this._addGeogridGridCorners(t,1)}},{key:"_addGeogridGridCorners",value:function(t,i){var s=this,e="".concat(this.options.sampleBaseUrl,"/").concat(t,"/geo_em.d").concat(i.toString().padStart(2,"0"),".nc.json"),a=!1;return fetch(e).then(function(t){if(!0===t.ok)return t.json();throw new Error("Geogrid JSON file ".concat(e," not found"))}).then(function(t){a=!0;t=L.featureGroup([s._createGeogridCornerMarker(t,"sw"),s._createGeogridCornerMarker(t,"nw"),s._createGeogridCornerMarker(t,"ne"),s._createGeogridCornerMarker(t,"se")]);t.addTo(s.map),s._geogridCornerMarkerGroups.push(t)}).then(function(){s._addGeogridGridCorners(t,i+1)}).catch(function(t){!0===a?console.error(t):console.debug(t)}),a}},{key:"_createGeogridCornerMarker",value:function(t,i){return L.marker(L.latLng(t.corner_lats[Qs.unstaggered[i]],t.corner_lons[Qs.unstaggered[i]]),{icon:L.divIcon({className:"geogrid-corner-icon",iconSize:8}),zIndexOffset:100})}}]),v}();var Hs=L.Control.Layers.extend({_localStorageKey:"_leaflet_persistent_layers",_layers:null,_currentBaseLayer:null,_overlays:null,_map:null,getCurrentLayer:function(){if(!this._currentBaseLayer){if(!this._layers)return null;var t=localStorage.getItem(this._localStorageKey+"_layer");t&&(this._currentBaseLayer=this._layers[t]),this._currentBaseLayer||(this._currentBaseLayer=this._getDefaultLayer())}return this._currentBaseLayer},_getDefaultLayer:function(){for(var t in this._layers)if(this._layers.hasOwnProperty(t))return this._layers[t];return null},_configZoom:function(){var t,i,s;this._currentBaseLayer&&(t=this._map.getZoom(),i=this._currentBaseLayer.options.minZoom||1,s=this._currentBaseLayer.options.maxZoom||13,this._map.setMinZoom(i),this._map.setMaxZoom(s),t<i?this._map.setZoom(i):s<t&&this._map.setZoom(s))},onAdd:function(t){var i=this;return(this._map=t).on("baselayerchange",function(t){localStorage.setItem(i._localStorageKey+"_layer",t.name),i._currentBaseLayer=i._layers[t.name],i._configZoom()}),this._configZoom(),L.Control.Layers.prototype.onAdd.call(this,t)},onRemove:function(t){t.off("baselayerchange")},initialize:function(t,i,s){this._layers=t,this._overlays=i,this._currentBaseLayer=this.getCurrentLayer(),L.Control.Layers.prototype.initialize.call(this,t,i,s)}});var I=L.GeoJSON.extend({getFeatureFilename:function(t){return t.properties.filename},getDownloadUrl:function(t,i){return i},data:null,_downloadedLayers:null,clearDownloaded:function(){null!=this._downloadedLayers&&($.each(this._downloadedLayers,function(){this.feature.downloaded=!1,this.setStyle({fillColor:null,fillOpacity:I.FillOpacity})}),this._downloadedLayers=null)},onAdd:function(t){var i,s;null==t.spin?this.addData(this.data):(t.spin(!0),setTimeout((i=this,s=t,function(){i.addData(i.data),s.spin(!1)}),1))},onRemove:function(t){this.clearLayers(this.data)},initialize:function(t,i){var n=this;null==i&&(I.CurrentColor>=I.Colors.length&&(I.CurrentColor=0),i=I.Colors[I.CurrentColor],I.CurrentColor++),L.setOptions(this,{style:{weight:I.Weight,fillOpacity:I.FillOpacity,color:i},onEachFeature:function(i,s){var t,e,a;s.on("mouseover",function(t){i.downloaded?s.setStyle({weight:3*I.Weight}):s.setStyle({weight:3*I.Weight,fillOpacity:3*I.FillOpacity})}),s.on("mouseout",function(t){i.downloaded?s.setStyle({weight:I.Weight}):s.setStyle({weight:I.Weight,fillOpacity:I.FillOpacity})}),i.downloaded&&s.setStyle({fillColor:I.ColorDownloaded,fillOpacity:3*I.FillOpacity}),(e=n.getFeatureFilename(i))&&(a=n.getDownloadUrl(i,e),s.bindTooltip(e,{sticky:!0,className:"tooltip-srtm"}),t='<div class="popup-elevation-data"><table>',null!=n.options.attribution&&(t+="<tr><td>Source:</td><td>"+n.options.attribution+"</td></tr>"),void 0!==n.registrationUrl&&(t+='<tr><td>Registration:</td><td><i class="fas fa-shield-alt text-danger"></i> <a href="'+n.registrationUrl+'" target="_blank">'+n.registrationUrl+"</a></td></tr>"),s.bindPopup(t=t+("<tr><td>Filename:</td><td>"+e+"</td></tr>")+('</table><a class="btn btn-outline-secondary btn-sm" role="button" href="'+a+'" target="_blank">Download</a></div>')),s.on("popupopen",function(t){$("div.popup-elevation-data a",t.popup.getElement()).on("click",{popup:t.popup,layer:t.sourceTarget,downloadUrl:a,feature:i},function(t){t.data.feature.downloaded=!0,t.data.layer.setStyle({fillColor:I.ColorDownloaded,fillOpacity:3*I.FillOpacity}),null==n._downloadedLayers&&(n._downloadedLayers=[]),t.data.layer.feature=t.data.feature,n._downloadedLayers.push(t.data.layer),t.data.layer.closePopup(),t.data.layer.fire("elevationDataDownload",{downloadUrl:a,filename:e,feature:t.data.feature,layer:t.data.layer,source:n},!0)})}))}}),L.GeoJSON.prototype.initialize.call(this,null,this.options),$.getJSON(t,function(t){n.data=t})}}),Zs=(I.Colors=["#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],I.ColorDownloaded="#e41a1c",I.CurrentColor=0,I.Weight=1,I.FillOpacity=.1,I.extend({attribution:'Provided by Japan Aerospace Exploration Agency (JAXA), product <a href="https://www.eorc.jaxa.jp/ALOS/en/aw3d30/" target="_blank">aw3d30</a>.',downloadBaseUrl:"ftp://ftp.eorc.jaxa.jp/",registrationUrl:"https://www.eorc.jaxa.jp/ALOS/en/aw3d30/registration.htm",getFeatureFilename:function(t){return t.properties.filename},getDownloadUrl:function(t,i){return this.downloadBaseUrl+t.properties.path+"/"+i},initialize:function(t,i){L.setOptions(this,{attribution:this.attribution}),I.prototype.initialize.call(this,t,i)}}));var Xs=I.extend({attribution:'Jarvis A., H.I. Reuter, A. Nelson, E. Guevara, 2008, Hole-filled seamless SRTM data V4, International Centre for Tropical Agriculture (CIAT), available from <a href="http://srtm.csi.cgiar.org" target="_blank">http://srtm.csi.cgiar.org</a>.',downloadBaseUrl:"http://srtm.csi.cgiar.org/wp-content/uploads/files/",downloadFolderByTileSize:{5:"srtm_5x5",30:"srtm_30x30"},downloadFolderByType:{TIFF:"TIFF",ASCII:"ASCII"},getFeatureFilename:function(t){return t.properties.SUFF_NAME&&"_"==t.properties.SUFF_NAME[0]?t.properties.SUFF_NAME.substring(1):t.properties.SUFF_NAME},getDownloadUrl:function(t,i){return this.downloadBaseUrl+i},initialize:function(t,i,s,e){if(i=i.toUpperCase().trim(),!this.downloadFolderByTileSize[s])throw"Invalid SRTM-CSI tile size";if(this.downloadBaseUrl+=this.downloadFolderByTileSize[s]+"/",!this.downloadFolderByType[i])throw"Invalid SRTM-CSI type";this.downloadBaseUrl+=this.downloadFolderByType[i]+"/",L.setOptions(this,{attribution:this.attribution}),I.prototype.initialize.call(this,t,e)}});function Ks(t,i,s,e){return new Xs(t,i,s,e)}var Ys=I.extend({downloadBaseUrl:"https://e4ftl01.cr.usgs.gov/MEASURES/",registrationUrl:"https://urs.earthdata.nasa.gov/",getDownloadUrl:function(t,i){return this.downloadBaseUrl+i},initialize:function(t,i,s){var e;switch(i){case 1:e="SRTMGL1.003",L.setOptions(this,{attribution:'NASA JPL.NASA Shuttle Radar Topography Mission Global 1 arc second. 2013, distributed by NASA EOSDIS Land Processes DAAC, <a href="https://doi.org/10.5067/MEaSUREs/SRTM/SRTMGL1.003" target="_blank">https://doi.org/10.5067/MEaSUREs/SRTM/SRTMGL1.003</a>.'});break;case 3:e="SRTMGL3.003",L.setOptions(this,{attribution:'NASA JPL.NASA Shuttle Radar Topography Mission Global 3 arc second. 2013, distributed by NASA EOSDIS Land Processes DAAC, <a href="https://doi.org/10.5067/MEaSUREs/SRTM/SRTMGL3.003" target="_blank">https://doi.org/10.5067/MEaSUREs/SRTM/SRTMGL3.003</a>.'});break;default:throw"Invalid arc second dimension. Allowed values are 1 and 3"}this.downloadBaseUrl=this.downloadBaseUrl+e+"/2000.02.11/",I.prototype.initialize.call(this,t,s)}});function te(t,i,s){return new Ys(t,i,s)}var ie=L.Control.extend({options:{position:"bottomleft",precision:4},initialize:function(t){L.Control.prototype.initialize.call(this,t)},onAdd:function(i){var t=L.DomUtil.create("div","leaflet-bar leaflet-touch leaflet-control leaflet-control-coordinates"),s=(this.latElement=L.DomUtil.create("div",null,t),this.lngElement=L.DomUtil.create("div",null,t),this);return i.on("mousemove",function(t){s.setCoordinates(t.latlng)}),i.on("contextmenu",function(t){s.popup&&s.popup.isOpen()&&s.popup.remove(),s.popup=L.popup().setLatLng(t.latlng).setContent("lat/lon: "+t.latlng.lat.toFixed(s.options.precision)+", "+t.latlng.lng.toFixed(s.options.precision)).openOn(i)}),s.setCoordinates(i.getCenter()),t},_addText:function(t,i){return t},setCoordinates:function(t){L.DomUtil.get(this.latElement).innerHTML="<span>lat: </span>"+t.lat.toFixed(this.options.precision),L.DomUtil.get(this.lngElement).innerHTML="<span>lon: </span>"+t.lng.toFixed(this.options.precision)}});Pi=t(function t(i){F(this,t);i=$.extend({},{div:null,jsonBaseUrl:null},i);if(!i.div||!i.div.length||1!=i.div.length)throw"invalid div option";e={"Esri World Topo":L.tileLayer.provider("Esri.WorldTopoMap"),"Esri World Street":L.tileLayer.provider("Esri.WorldStreetMap"),"Esri NatGeo":L.tileLayer.provider("Esri.NatGeoWorldMap"),"Esri World Imagery":L.tileLayer.provider("Esri.WorldImagery"),"Open Topo Map":L.tileLayer.provider("OpenTopoMap"),"Open Street Map":L.tileLayer.provider("OpenStreetMap")};var s,e=new Hs(e,null,{position:"topright"}),a=L.map(i.div[0],{layers:[e.getCurrentLayer()],center:[0,0],zoomControl:!1,zoom:Math.max(e.getCurrentLayer().options.minZoom,3)}),e=(e.addTo(a),L.control.sidebar({autopan:!1,closeButton:!0,container:"sidebar",position:"left",open:!0}).addTo(a));$("div.sidebar").show(),e.wps=new Vs(a,e),e.settings=new R(a,e),e.waypoints=new J(a,e),e.elevation=new B(a,e),e.elevation.addElevationDataOverlay("SRTM-CSI 90m (5x5,TIFF)",Ks("".concat(i.jsonBaseUrl,"/srtm/csi/srtm30_5x5.json"),"TIFF",5)),e.elevation.addElevationDataOverlay("SRTM-CSI 90m (30x30,TIFF)",Ks("".concat(i.jsonBaseUrl,"/srtm/csi/srtm30_30x30.json"),"TIFF",30)),e.elevation.addElevationDataOverlay("SRTM NASA v3, 1 arc second (~30m)",te("".concat(i.jsonBaseUrl,"/srtm/nasa/SRTMGL1.003.json"),1)),e.elevation.addElevationDataOverlay("SRTM NASA v3, 3 arc second (~90m)",te("".concat(i.jsonBaseUrl,"/srtm/nasa/SRTMGL3.003.json"),3)),e.elevation.addElevationDataOverlay("ALOS World 3D - 30m (AW3D30)",(i="".concat(i.jsonBaseUrl,"/srtm/alos/AW3D30.json"),new Zs(i,s))),e.open("wps"),L.control.zoom({position:"topright"}).addTo(a),L.control.scale({maxWidth:240,metric:!0,imperial:!0,position:"bottomright"}).addTo(a),new ie({position:"bottomright"}).addTo(a),L.DomUtil.addClass(a._container,"cursor-crosshair")});s.DomainWizard=Pi});